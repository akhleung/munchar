$perfect_proxy = 'false'

# Do only for mobile
# match_not($tablet, /true/) {

#Match a meta tag for desktop passthrough
match(fetch("/html/head/meta[@name='desktopView']/@content"), /true/) {
  log("meta tag passthrough")
  $perfect_proxy = "true"

  # match_not($host, /m\.(secure|video|slideshows|legacy|action)?\.?humanesociety\.org/) {
  #   log("disabling perfect_proxy for testing environmetns")
  #   $perfect_proxy = "false"
  # }
}

# Match hardcoded URLs
match($path) {
  with(/\/site\/SPageServer\?.*pagename\=drtv\_splashb\_MSI/) {
    log("url specific passthrough")
    $perfect_proxy = 'false'
  }
  with(/\/site\/SPageServer\?pagename\=drtv\_/){
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }
  with(/\/site\/SPageServer\?pagename\=seals\_2013video\&s\_src\=web\_hp\_bb1040213/) {
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }
  with(/\/forms\/virginia\-dogs\-against\-fox\-pens\.html/) {
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }
  # HSUS-425
  with(/\/your\_best\_shot\.html/) {
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }
  # HSUS - 480
  with(/\/you-are-a-hero-for-animals/) {
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }

}
# }

# Or, Match a URL argument
match($path) {
  with(/(\?|\&)mw\=d/) {
    log("url argument passthrough")
    $perfect_proxy = 'true'
  } 
}

# remove this when the tablet site goes live!
# match($host) {
#   with(/m\.[secure\.|action\.|slideshows\.|video\.]*humanesociety\.org/) {
#     match($tablet, /true/) {
#       $perfect_proxy = 'true'
# 
#       $(".//script[not(@type)]") {
#         %source = fetch("text()")
# 
#         match(%source, /mw_mobile_site/) {
#           log("found the redirect script")
#           remove()
#         }
#       }
#       
#     }
#   }
# }
# HSUS-273 The form on this page is mostly hidden.
match($path) {
  with(/forms\/virginia-dogs-against-fox-pens.html/) {
    log("url argument passthrough")
    $perfect_proxy = 'true'
  }
}
# end HSUS-273

# This file is meant to block out the site while underconstruction
# Make this active when first pushing to production to ensure 
# its not world visible.
$("/html") {
  $("./head") {
    $("./*") {
      remove()
    }
    insert("script", data-mw_keep: "true", type: "text/javascript", src: asset("javascript/main.js"))
    insert_bottom("style", "body {background-color: #eee;} div {padding:10px;} #coming-soon {font-size: 30px;} #explanation {font-size: 15px;} #mw_desktop_link {text-align:center;display:block;}")
  }
  $("./body") {
    $("./*") {
      remove()
    }
    insert_bottom("div", concat("Mobile ", $source_host, " Coming Soon!"), id: "coming-soon")
    insert_bottom("div", "We're currently in the process of building an <b>amazing</b> mobile experience. Please check back soon.", id: "explanation")
    $cookie_domain = concat($source_host, "")
    $cookie_domain {
      replace(/^(w+\d+\.)?/, ".")
    }
    # desktop link
     insert_bottom("div", class: "mw_footer_link_box", id: "mw_desktop_link_config"){
       attribute("matcher", $rewrite_incoming_matcher)
       attribute("replacement", $rewrite_incoming_replacement)
       attribute("cookie_hours", "0")
       attribute("cookie_domain", $cookie_domain)
       # adding desktop site link
       insert_top("a", class: "mw_desktop_link", id: "mw_desktop_link"){
         attribute("href", "http://" + $source_host)
         text("Visit our Desktop Site")
       }
     }
  }
}

$("./body") {
  add_class("mw_drtv_splash")
  $(".//div[@id='ga-content']//div[./script[contains(@src, 'jquery.js')]]") {
    $(".//div[contains(@class, 'mw_was_table')]") {
      $("./div[contains(@class, 'mw_was_tr')]/div[contains(@class, 'mw_was_td')][./p]") {
        add_class("mw_ps_wrap")
      }
      $("./div[contains(@class, 'mw_was_tr')][./div[contains(@class, 'mw_was_td')][./a/img][2]]") {
        add_class("mw_buttons_wrap mw_flex_box")
        $("./div[contains(@class, 'mw_was_td')]") {
          $temp_text=fetch("./a/img/@alt")
          remove("./a/img")
          $("./a") {
            text($temp_text)
          }
          add_class("mw_btn2 mw_flex_box_item_1")
        }
      }
      $("./div[contains(@class, 'mw_was_tr')]/div[contains(@class, 'mw_was_td')][./object]") {
        add_class("mw_movie_wrap")
      }
      $("./div[contains(@class, 'mw_was_td')][./img[contains(@src, 'gift_header')]]") {
        add_class("mw_gift_title")
        $("following-sibling::div[contains(@class, 'mw_was_tr')][1]/div[contains(@class, 'mw_was_td')]") {
          add_class("mw_gift_img")
        }
      }
    }
  }
  $(".//div[@id='ga-content']/div[contains(@class, 'mw_was_table')]") {
    add_class("mw_hide")
  }
  $("./div[@id='ga-container']") {
    insert_before("div", class: "mw_main") {
      copy_here("following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_buttons_wrap')]")
      copy_here("following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_movie_wrap')]")
      copy_here("following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_ps_wrap')]")
      insert("div", class: "mw_gift_wrap") {
        copy_here("ancestor::div[contains(@class, 'mw_main')]/following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_gift_title')]")
        copy_here("ancestor::div[contains(@class, 'mw_main')]/following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_gift_img')]")
      }  
      copy_here("following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_buttons_wrap')]")
    }
  }
}
$("./body") {
  add_class("mw_drtv_donation")
  $(".//select") {
    wrap("div", class:"mw_select_box")
    insert("div", class:"mw_arrows")
  }
  $("./div[contains(@class, 'mw_was_table')]") {
    insert_before("div", class:"mw_box2") {
      move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//div[@id='monthlytabs' or @id='onetimetabs']", "top") {
        attribute("class", "mw_flex_box")
        move_here(".//a", "bottom") {
          $("./self::a[./img[contains(@id, 'slices')]]") {
            attribute("class", "mw_slices_tab mw_flex_box_item_1")
          }
          $("./self::a[./img[contains(@id, 'table')]]") {
            attribute("class", "mw_table_tab mw_flex_box_item_1")
          }
          inner(fetch("./img/@alt")) {
            replace(/\s/, "-")
          }
          inner(fetch("./text()")+" Gift")
        }
        remove("./div[contains(@class, 'mw_was_tr')]")
      }
      move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//form[./input[@id='donor_email_opt_in'][@type='checkbox']]", "bottom") {
        move_here("../following-sibling::div[contains(@class, 'mw_was_table')]//div[contains(@class, 'mw_was_td')]/div[@class='ErrorMessage'][./span[@id='api-errorMessages-headline']]", "top") {
        }
        add_class("mw_gray_box")
        $("./input[@id='donor_email_opt_in']") {
          add_class("mw_hide2")
        }
        $("./fieldset/div[contains(@class, 'mw_was_table')]") {
          insert_before("div", class:"mw_donate_amount") {
            move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//span[not(./a)]", "top")
            move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//div[@id='amounts']", "bottom") {
              $("./input[@type='radio'][not(@id='level_other')]") {
                wrap("div", class:"mw_amount_num")
              }
              $("./input[@type='radio'][@id='level_other']") {
                wrap("div", class:"mw_amount_num mw_other_amount")
              }
              $("./label | ./input[@type='text']") {
                move_to("./preceding-sibling::div[contains(@class, 'mw_amount_num')][1]", "bottom")
              }
            }
          }
          remove()
        }
        $("./div[contains(@class, 'mw_was_table')]") {
          attribute("class", "mw_personal_detail")
          remove("./div[contains(@class, 'mw_was_tr')][.//img[contains(@src, 'divider')]]")
          $("./div[contains(@class, 'mw_was_tr')][1]/div[contains(@class, 'mw_was_td')][./span]") {
            %temp_class = fetch("./span/text()") {
              replace(/\s/, "_")
            }
            attribute("class", "mw_"+%temp_class)
            inner_wrap("div", class:"mw_information_title") {
              $("./self::div[./img]") {
                add_class("mw_credit")
              }
            }
            move_to("./ancestor::div[contains(@class, 'mw_was_tr')][1]", "before")
          }
          # billing information
          $("./div[@class='mw_Billing_Information']") {
            move_here("./following-sibling::div[contains(@class, 'mw_was_tr')][(*)][1]/div[contains(@class, 'mw_was_td')][1]", "bottom") {
              $("./div[@id='billinginfo']") {
                $("./div[contains(@class, 'mw_was_tr')]") {
                  add_class("mw_label_box")
                  $("./div[contains(@class, 'mw_was_td')][./label]") {
                    add_class("mw_label_title")
                    $("./label[@for='premium_id']") {
                      text() {
                        replace(/Please\ss/, "S")
                      }
                    }
                  }
                  $("./div[contains(@class, 'mw_was_td')]//select[./option[1][text()]]") {
                    insert_top("option")
                  }
                  $("./div[contains(@class, 'mw_was_td')]//select/option[@selected]") {
                    remove("./@selected")
                  }
                  $("./div[contains(@class, 'mw_was_td')][./input[@type='checkbox']]") {
                    add_class("mw_checkbox_content")
                  }
                }
              }
            }
          }
          # end billing information

          # payment information
          $("./div[@class='mw_Payment_Information']") {
            move_here("./following-sibling::div[contains(@class, 'mw_was_tr')][(*)][1]/div[contains(@class, 'mw_was_td')][1]", "bottom") {
              $("./div[@id='paymentinfo']") {
                $("./div[contains(@class, 'mw_was_tr')]") {
                  add_class("mw_label_box")
                  $("./div[contains(@class, 'mw_was_td')][./label]") {
                    add_class("mw_label_title")
                    $("./label[@for='card_cvv']") {
                      text() {
                        replace(/Card\sSecurity\sCode\/(CVV\:)/) {
                          set($1)
                        }
                      }
                    }
                    $("./label[@for='card_number']") {
                      text() {
                        replace(/Credit\s(Card\sNumber\:)/) {
                          set($1)
                        }
                      }
                    }
                  }
                }
              }
              $("./div[@id='security']") {
                move_here(".//input[@id='donate_button']", "top") {
                  insert_after("div", class:"mw_security") {
                    move_here("./following-sibling::div//a", "bottom")
                  }
                  btn_delegate() {
                    add_class("mw_btn2")
                  }
                }
                remove("./div[contains(@class, 'mw_was_tr')]")
              }
            }
          }
          # end # payment information

          remove("./div[contains(@class, 'mw_was_tr')]")
        }
      }
      # top content
      move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//div[@id='formtop']", "top") {
        $("./div[contains(@class, 'mw_was_tr')]") {
          $("./div[contains(@class, 'mw_was_td')][./span]") {
            $("./span") {
              add_class("mw_top_title")
              remove("./br")
            }
            $("./img") {
              add_class("mw_check_img")
            }
          }
          $("./div[contains(@class, 'mw_was_td')][./img][not(./span)]") {
            add_class("mw_img_wrap")
          }
          $("./div[contains(@class, 'mw_was_td')][./p]") {
            add_class("mw_top_content")
          }
        }
      }
      # end top content
    }
    remove()
  }
  match_not($path, /error/) {
    $(".//div[@class='ErrorMessage']") {
      add_class("mw_hide")
    }
  }
}
$("./body") {
  add_class("mw_drtv_base")
  # footer
  $(".//div[@id='mw_footer']") {
    move_here("ancestor::body//div[@id='FAQsection']/..", "before") {
      move_here("./script", "before")
      move_here("./div[@id='FAQsection']", "before") {
        remove("./@style")
        $("./p[contains(@class, 'faqheadline')]") {
          add_class("mw_hide")
        }
        $("./p[contains(@class, 'question')]") {
          add_class("mw_flex_box")
          wrap_text_children("span", class: "mw_text_wrap mw_flex_box_item_1")
        }
        $("./div[contains(@id, 'answer')]") {
          $("./ul") {
            add_class("mw_list1")
          }
        }
        inner_wrap("div", class: "mw_box2")
      }
      remove()
    }
    $(".//li[contains(@class, 'mw_link_center')]/a") {
      text() {
        replace("»", " »")
      }
    }
    remove(".//ul/br")
  }
  # end of footer
  $(".//p[./img and ./br]/br") {
    add_class("mw_keep_br")
  }
  remove(".//br[not(contanis(@class, 'mw_keep_br'))]")
  $(".//table") {
    remove(".//@style")
  }
  table_dump(".//table")
  remove(".//table/@style")
  # header
  $("./div[contains(@class, 'mw_header')]") {
    remove("./div[contains(@class, 'mw_donate_bar')]")
    remove("./div[contains(@class, 'mw_header_menu')]")
    insert_after("img", src: "http://www.humanesociety.org/assets/images/mobile-mastheads/drtv-2013-m.jpg", class: "mw_header_img")
  }
  $(".//div[@id='ga-header']") {
    add_class("mw_hide")
  }
  # end of header
  $("./div[@id='mw_drtv_footer']/div[@id='mw_footer']") {
    remove(".//img")
    remove(".//li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
  }
  $(".//div[./a[contains(@href, 'convio')][./img]]") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_drtv_thank")
  $("./div[contains(@class, 'mw_was_table')]/div[contains(@class, 'mw_was_tr')][./div[contains(@class, 'mw_was_td')]/img]") {
    add_class("mw_hide")
  }
  $(".//div[@id='body']") {
    move_here("./div/div/div[@id='rightCol-main-content']", "top")
    $("./div[not(@id='rightCol-main-content')]") {
      add_class("mw_hide")
    }
    $(".//a/strong[contains(text(), 'Click here')]") {
      text() {
        replace(/Click/, "Tap")
      }
    }
  }
  $("./div[@id='mw_drtv_footer']/div[@id='FAQsection']") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_flickr")
  attributes(id:"mw_flick_iframe")
  remove("./div[@class='mw_header'] | .//tr[./td[contains(@class, 'shimCell')]]")
  $(".//tr[./td[contains(@class, 'formLabelBottomLeft')]]") {
    wrap("div", class:"mw_label_box")
    add_class("mw_label")
  }
  $(".//table") {
    $(".//tr[not(contains(@class, 'mw_label'))]") {
      move_to("./preceding-sibling::div[@class='mw_label_box'][1]", "bottom")
    }
    table_dump(".")
  }
}
$("./body") {
  add_class("mw_maps_tablet")
  $("./div[@id='wrapper']") {
    $("./div[@id='page']") {
      remove("./div[@id='page-head']")
      add_class("mw_box2_tablet")
      $("./div[@id='contentDiv']") {
        remove("./div[@id='inside']/div[@id='head']")
        $("./div[@class='no-sidebar']/div[@id='cols']/div[@id='main']/div[contains(@class,'section')]") {
          $("./h2") {
            add_class("mw_h1")
          }
          $("./p") {
            text() {
              replace(/or use the scroll-down box/, "")
            }
          }
          $("./img[@usemap='#Map2']") {
            move_to("preceding-sibling::table/tbody/tr/td", "bottom")
          }
          $("./map[@id='Map2']") {
            move_to("preceding-sibling::table/tbody/tr/td", "bottom")
          }
          $(".//area") {
            attribute("href") {
              value() {
                rewrite("link")
              }
            }
          }
        }
        # Hide "Feral Cat Organizations" Page's "States" selection button
        $(".//div[contains(@class,'features')]") {
          add_class("mw_hide")
        }
      }
    }
  }
}
log("in video_home_tablet.ts")

$("./body") {
  add_class("mw_video_root_tablet mw_video_common_tablet")

  # remove(".//div[@id='masthead']") # or hide this with CSS?

  # adjust the header to accomidate the videos
  $(".//a[contains(@class, 'mw_header_spillover')]") {
    name("div")
    remove("./@href")
    move_here("./ancestor::body//div[@id='masthead']/a")

    $(".//img") {
      remove("./@width")
      remove("./@height")
    }
  }


  # video pages use a white logo.. which can't be seen on the white nav
  $(".//img[@id='HSUSLogo']") {
    # attribute("src", "http://www.humanesociety.org/assets/images/global/logo.png")
  }

  # Build the top nav

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content mw_bar6")
      }
    }

    # Turn the video link into an accordian
    $("./li[contains(@class, 'active')]") {
      # attribute("data-ur-set", "toggler")
      

      $("./a") {
        name("span")
        # attribute("data-ur-toggler-component", "button")
        attribute("onclick","return false;")
        
        # Clear out the 'Video' text
        text("")

        copy_here("./ancestor::div[@id='page']//td[@id='leftNav']/ul/li[@id='active']/a")
        text() {
          replace(/\xC2\xA0»/, "")
        }

      }

      move_here("./ancestor::div[@id='page']//td[@id='leftNav']/ul") {
        #name("div")
        remove("./li[@id='active']")
        # attribute("data-ur-toggler-component", "content")
        add_class("mw_menu_content")
      
        $("./li") {
          wrap_text_children("span")
          remove("./span")
          $("./a") {
            # add_class("mw_bar3")
          }
        }
      }
    }

    move_to("./ancestor::body//div[contains(@class, 'mw_header_spillover')]", "bottom")
  }

  $(".//div[@id='main']") {
    table_dump("./table")

    # Video carousel
    video_ajax()

  }

# This hopefully disables the injected CSS by the TubePress plugin without breaking the rest of TubePress
insert_bottom("script", "TubePressCss = {load : function(path){}}")

}
$("./body") {
  add_class("mw_video_page_tablet mw_video_common_tablet")

  # video pages use a white logo.. which can't be seen on the white nav
  $(".//img[@id='HSUSLogo']") {
    # attribute("src", "http://www.humanesociety.org/assets/images/global/logo.png")
    remove("./@width")
    remove("./@height")
  }

  # adjust the header to accomidate the videos
  $(".//a[contains(@class, 'mw_header_spillover')]") {
    name("div")
    move_here("./ancestor::body//div[@id='masthead']/a")
  }

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content mw_bar6")
      }
    }
    move_to("./ancestor::body//div[contains(@class, 'mw_header_spillover')]", "bottom")
  }

  table_dump(".//table")

  # Force the video player to fit nicely in the iPhone's portrait mode.
  # The video plays full screen so landscape should not be a matter.

  $(".//object[@id='myExperience']") {
    $("./param[@name='width']") {
      attribute("value", "500")
    }

    $("./param[@name='height']") {
      attribute("value", "280")
    }
  }

  # make the storyInfo a box2
  $(".//div[@id='storyInfo']") {
    add_class("mw_box2")

    # Remove the inline style of the story description (it added extra padding to the bottom)
    $("./div[@id='storyDescription']") {
      remove("./@style")
    }
  }

  

  # Carousel the videos
  $(".//div[@id='videos']") {
    attribute("data-ur-carousel-component","scroll_container")

    $("./div[@class='video']") {
      attribute("data-ur-carousel-component","item")
    }

    wrap("div", class:"mw_video_carousel", data-ur-set:"carousel", data-ur-carousel-component:"view_container", data-ur-infinite:"disabled", class:"mw_carousel_container")
  }
}
$("./body") {
  add_class("mw_video_page mw_video_common")

  $(".//ul[@id='topNav']") {
      #Remove the home link
      remove("./li[1]")

      $("./li") {
        add_class("mw_header_menu_item")
        $("./a") {
          add_class("mw_header_menu_item_content")
        }
      }
  }

  table_dump(".//table")

  # Force the video player to fit nicely in the iPhone's portrait mode.
  # The video plays full screen so landscape should not be a matter.

  $(".//object[@id='myExperience']") {
    $("./param[@name='width']") {
      attribute("value", "320")
    }

    $("./param[@name='height']") {
      attribute("value", "180")
    }
  }

  # make the storyInfo a box2
  $(".//div[@id='storyInfo']") {
    add_class("mw_box2")

    # Remove the inline style of the story description (it added extra padding to the bottom)
    $("./div[@id='storyDescription']") {
      remove("./@style")
    }
  }

  

  # Carousel the videos
  $(".//div[@id='videos']") {
    attribute("data-ur-carousel-component","scroll_container")

    $("./div[@class='video']") {
      attribute("data-ur-carousel-component","item")
    }

    wrap("div", class:"mw_video_carousel", data-ur-set:"carousel", data-ur-carousel-component:"view_container", data-ur-infinite:"disabled", class:"mw_carousel_container")
  }
}
$("./body") {
  add_class("mw_submit_success")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//ul[@id='tools']")
  remove(".//p[string-length(text())= 1]")
  remove("//img[@id='desktop_head']")
  
  # handle that empty div mess at the botom
  $(".//div[@id='contentDiv']/div") {
    remove("@style")
    wrap_text_children("span")
    remove("./span[string-length()<3]")
  }

  $(".//div[@id='cols']") {
    remove("./div[not(@id) and not(@class)]")
    remove("ancestor::div/following-sibling::br")
    $(".//div") {
      remove("@style")
    }
  }
}
$("./body") {
  add_class("mw_press_login")

  $(".//a[@class='mw_header_spillover']") {
    insert("img", src:"http://www.humanesociety.org/assets/images/global/logo.png")
  }

  # add a header 
  $(".//div[@id='wrapper']") {
    insert_top("div", class:"mw_head_spacer") {
      match($path) {
        with(/register/) {
          insert("div", class:"mw_head_spacer_text", "Register")
        }
        with(/login/) {
          insert("div", class:"mw_head_spacer_text", "Login")
        }
        with(/forgot\-password/) {
          insert("div", class:"mw_head_spacer_text_forgot", "Forgot Password")
        }
      }
      
    }
  }

  $(".//ul") {
    add_class('mw_box2 login_helper mw_flex_box')

    $("./li") {
      add_class("mw_flex_box_item_1 mw_account_button")
    }
    
  }

  $(".//div[@id='main']") {
    add_class("mw_box2_tablet")

    $('./h1') {
      add_class('mw_h1')
    }

    $(".//input[@type='submit']") {
      add_class("mw_btn2")
    }
  }
}
log("in video press root")
$("./body") {
  add_class("mw_video_press_root mw_video_common")

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content")
      }
    }


  }

  $(".//div[@id='main']") {

    table_dump("./table")

    $(".//div[@id='channelList']") {
      add_class("mw_box2")
      $(".//div[@class='thumb']") {
        $("./a") {
          attribute("class" ,"mw_channel_description")
        }
        $("./a[img]") {
          attribute("class", "mw_channel_image")
        }
      }
    }
  }

}
$("./body") {
  add_class("mw_slideshow_root_tablet mw_video_common_tablet")
  log("slideshows root")

  # slideshows pages use a white logo.. which can't be seen on the white nav
  $(".//img[@id='HSUSLogo']") {
    # attribute("src", "http://www.humanesociety.org/assets/images/global/logo.png")
    remove("./@width")
    remove("./@height")
  }

  # adjust the header to accomidate the videos
  $(".//a[contains(@class, 'mw_header_spillover')]") {
    name("div")
    remove("./@href")
    move_here("./ancestor::body//div[@id='masthead']/a")
  }

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content mw_bar6")
      }
    }

    # Turn the Slideshow nav into an accordion
    $("./li[contains(@class, 'active')]") {
        # attribute("data-ur-set", "toggler")
        

        $("./a") {
          name("span")
          # attribute("data-ur-toggler-component", "button")
          attribute("onclick","return false;")
        }

        move_here("./ancestor::div[@id='page']//div[@id='galleryNav']/ul") {
          remove("./li[@id='active']")
          # attribute("data-ur-toggler-component", "content")
          add_class("mw_menu_content")
        
          $("./li") {
            wrap_text_children("span")
            remove("./span")
          }
        }
      }
    move_to("./ancestor::body//div[contains(@class, 'mw_header_spillover')]", "bottom")
  }

  

  $(".//div[@id='shell']") {
    table_dump(".//table")

    remove(".//div[@id='galleryNav']")

    # deal with the slideshow
    $(".//div[@id='content']/script[not(@src)]") {
        text() {
          # replace('width: "650"', 'width: "320px"')
          replace('width: "650"', 'width: "500px"')
          # replace('height: "610"', 'height: "300px"')
          replace('height: "610"', 'height: "469px"')
        }
    }

    $(".//div[@id='share']") {
      add_class("mw_box2")
    }

    #turn playlist into carousel like the video page

    $(".//div[@id='playlist']") {
      add_class("mw_carousel_container")
      attributes(data-ur-carousel-component:"view_container", data-ur-set:"carousel", data-ur-infinite:"disabled")


      $("./div[@id='playlist_scroller']") {
        attributes(data-ur-carousel-component: "scroll_container", id:"mw_playlist_scroller")

        $("./div[@class='playlist_slideshow']") {
          attribute("data-ur-carousel-component", "item")
        }

      }
    }
  }

  

}
$("./body") {
  add_class("mw_individual_video")
  
  remove("./div[@class='mw_header']")
  
  $("./div[@id='shell']/div[@id='page']") {
    $("./div[@id='masthead']//img") {
      remove("./@width | ./@height")
    }

    $("./div[@id='main']//div[@id='player']") {      
      $(".//param[@name='width']") {
        match($tablet) {
          with(/true/) {
            attributes(value: "600")
          }
          else() {
            attributes(value: "300")
          }
        }
      }
      $(".//param[@name='height']") {
        match($tablet) {
          with(/true/) {
            attributes(value: "600")
          }
          else() {
            attributes(value: "300")
          }
        }
      }
    }
  }
  
  $(".//div[@id='footer']") {
    wrap_text_children("span") {
      $("self::span") {
        match(text(), (/\A\s+\Z/)) {
          remove()
        }
      }
    }
    $("./a") {
      move_here("following-sibling::span")
    }
  }

}
log("in video_home.ts")

$("./body") {
  add_class("mw_video_root mw_video_common")

  # remove(".//div[@id='masthead']") # or hide this with CSS?

  # Build the top nav

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content")
      }
    }

    # Turn the video link into an accordian
    $("./li[contains(@class, 'active')]") {
      attribute("data-ur-set", "toggler")
      

      $("./a") {
        name("span")
        attribute("data-ur-toggler-component", "button")
        attribute("onclick","return false;")
        
        # Clear out the 'Video' text
        text("")

        copy_here("./ancestor::div[@id='page']//td[@id='leftNav']/ul/li[@id='active']/a")
        text() {
          replace(/\xC2\xA0»/, "")
        }

      }

      move_here("./ancestor::div[@id='page']//td[@id='leftNav']/ul") {
        #add_class("mw_testing")
        #name("div")
        remove("./li[@id='active']")
        attribute("data-ur-toggler-component", "content")
        add_class("mw_menu_content")
      
        $("./li") {
          wrap_text_children("span")
          remove("./span")
        }
      }
    }


  }

  $(".//div[@id='main']") {
    table_dump("./table")

    # Video carousel
    video_ajax()
    
    $(".//div[@class='mw_box2'][./div[@id='shareContainer']]") {
      attributes(class: "mw_video_box")
      $("..") {
        add_class("mw_iframe_div")
      }
    }
    
    remove("./div/div[contains(@class, 'mw_was_tr')]/div[contains(@class, 'mw_was_td')][not(*)]")
  }

# This hopefully disables the injected CSS by the TubePress plugin without breaking the rest of TubePress
insert_bottom("script", "TubePressCss = {load : function(path){}}")

}
$("./body") {
  add_class("mw_slideshow_root mw_video_common")
  log("slideshows root")

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content")
      }
    }

    # Turn the Slideshow nav into an accordion
    $("./li[contains(@class, 'active')]") {
        attribute("data-ur-set", "toggler")
        

        $("./a") {
          name("span")
          attribute("data-ur-toggler-component", "button")
          attribute("onclick","return false;")
        }

        move_here("./ancestor::div[@id='page']//div[@id='galleryNav']/ul") {
          remove("./li[@id='active']")
          attribute("data-ur-toggler-component", "content")
          add_class("mw_menu_content")
        
          $("./li") {
            wrap_text_children("span")
            remove("./span")
          }
        }
      }

  }

  

  $(".//div[@id='shell']") {
    table_dump(".//table")

    remove(".//div[@id='galleryNav']")

    # deal with the slideshow
    $(".//div[@id='content']/script[not(@src)]") {
        text() {
          replace('width: "650"', 'width: "320px"')
          replace('height: "610"', 'height: "300px"')
        }
    }

    $(".//div[@id='share']") {
      add_class("mw_box2")
    }

    #turn playlist into carousel like the video page

    $(".//div[@id='playlist']") {
      add_class("mw_carousel_container")
      attributes(data-ur-carousel-component:"view_container", data-ur-set:"carousel", data-ur-infinite:"disabled")


      $("./div[@id='playlist_scroller']") {
        attributes(data-ur-carousel-component: "scroll_container", id:"mw_playlist_scroller")

        $("./div[@class='playlist_slideshow']") {
          attribute("data-ur-carousel-component", "item")
        }

      }
    }
  }

  

}
log("in video press root")
$("./body") {
  add_class("mw_video_press_root_tablet mw_video_common_tablet")

  # press pages use a white logo.. which can't be seen on the white nav
  $(".//img[@id='HSUSLogo']") {
    # attribute("src", "http://www.humanesociety.org/assets/images/global/logo.png")
    remove("./@width")
    remove("./@height")
  }

  # adjust the header to accomidate the videos
  $(".//a[contains(@class, 'mw_header_spillover')]") {
    name("div")
    move_here("./ancestor::body//div[@id='masthead']/a")
  }
  
  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content mw_bar6")
      }
    }


    move_to("./ancestor::body//div[contains(@class, 'mw_header_spillover')]", "bottom")
  }

  $(".//div[@id='main']") {

    table_dump("./table")

    $(".//div[@id='channelList']") {
      add_class("mw_box2")
      $(".//div[@class='thumb']") {
        $("./a") {
          attribute("class" ,"mw_channel_description")
        }
        $("./a[img]") {
          attribute("class", "mw_channel_image")
        }
      }
    }
  }

}
$("./body") {
  add_class("mw_animal_legacy_video")
  remove("./div[not(@id='shell')]")
  $("./div[@id='shell']/div[@id='page']/div[@id='main']/div[@id='video']/div[@class='tubepress_container']") {
    $("./div[@class='tubepress_normal_embedded_wrapper']") {
      remove("./@style")
      remove(".//iframe/@height")
    }
    $("./div[@class='tubepress_thumbnail_area']/div[@class='tubepress_thumbs']/div[@id='tubepress_thumbs_centerer']") {
      add_class("mw_flex_box")
      $("./div[@class='tubepress_thumb']") {
        add_class("mw_flex_box_item_1")
        $(".//img") {
          remove("./@width | ./@height")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_press_login")

  $(".//ul") {
    add_class('mw_box2 login_helper mw_flex_box')

    $("./li") {
      add_class("mw_flex_box_item_1 mw_account_button")
    }
    
  }

  $(".//div[@id='main']") {
    add_class("mw_box2")

    $('./h1') {
      add_class('mw_h1')
    }

    $(".//input[@type='submit']") {
      add_class("mw_btn2")
    }
  }
}
$("./body") {
  add_class("mw_animal_legacy")
  $("./div[@id='wrapper']/div[@id='page']/div[./table]") {
    move_here(".//td[./ul[@id='tools']]", "before") {
      add_class("mw_box")
      name("div")
      
      # share bar
      $("./ul[@id='tools']//ul[@id='share_bar']") {
        $("./li[./img[@class='share_image']]") {
          insert("span", fetch("./img/@alt"), class: "mw_share_text")
        }
        $("./li/like") {
          name("fb:like")
        }
        remove(".//img")
      }
      
      $("./div[@id='videoBox']/iframe") {
        remove("./@height")
        attribute("src") {
          value() {
            rewrite("link")
          }
        }
      }
      
      $("./div[@id='bottomBox']") {
        $(".//ul") {
          add_class("mw_list1")
        }
        $(".//div[@id='donateHead']/a") {
          wrap_text_children("span")
          insert_top("div", class: "addthis_button_facebook")
        }
      }
    }    
    remove()
  }
}
# state volunteer pages
# http://www.humanesociety.org/assets/maps/volunteer/volunteer_list.html?state=WA&state=National

$("./body") {
  add_class("mw_maplist_tablet")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//ul[@id='tools']/li[1]")

  # put the logo back in the spillover
  $(".//div[@class='mw_header']/a") {
    insert("img") {
      attribute("src", "/assets/images/global/logo.png")
    }
  }

  # main content
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//h2") {
      add_class("mw_h1")
    }
  }
}
# Main "Campaign" page
# http://www.humanesociety.org/issues/campaigns
#

# April 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_campaigns")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
  }

  $(".//div[@id='side']") {
    remove("./div") // what even is this
  }
  $(".//div[@id='main']/p[not(*)]") {
    match(fetch("./text()"), /\A[\s ]*\Z/) {
      remove()
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
  }
}
# Main "Action" page
# http://www.humanesociety.org/action
#

# Feb 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_action")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")

  # move section links up into a top bar
  $(".//ul[@id='action']//ul") {
    add_class("mw_flex_box")
    $("./li") {
      add_class("mw_flex_box_item_1")
      remove("@style")
      $("./a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    move_to("//div[@class=' mw_masthead']", "after")
    # make two rows
    insert_after("ul", class:"mw_flex_box") {
      move_here("preceding-sibling::ul/li[position()>4]")
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }

    $(".//div[@id='actnow']") {
      move_to("../div[@id='feature']", "after")
    }
    # $(".//ul[@id='featurette']") {
    #   add_class("mw_flex_box")
    #   $("./li") {
    #     add_class("mw_flex_box_item_1")
    #   }
    # }
    $(".//div[@id='profiles' or @id='toolkit']") {
      # $(".//p[@class='image']") {
      #   move_to("..", "top")
      # }
      
      $(".//p[not(@class)]") {
        add_class("mw_text")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $("./ul") {
      add_class("mw_sidebar1_h")
      move_here("./span/li") // de-nesting
      remove("./span")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
  }
}
# Main "Issues" page
# http://www.humanesociety.org/issues
#

# April 1 2013 Sarah LaFrance

$(".//body") {
  add_class("mw_issues")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
  }

  # HSUS-334 according
  $(".//ul[@id='issue-browser']") {
    attributes(data-ur-set:"tabs")
    $("./li") {
      %mw_tab_index = index()
      $("./a") {
        attributes(data-ur-tabs-component:"button", class:"mw_issue_button", data-ur-tab-id: "mw_tab_"+%mw_tab_index)
        remove("@href")
        insert("div", class:"mw_plusminus")
      }
      $("./ul") {
        attributes(data-ur-tabs-component:"content", class:"mw_sublist", data-ur-tab-id: "mw_tab_"+%mw_tab_index)
        $(".//a") {
          inject("  &raquo;  ")
        }
      }
    }
  }

  $(".//div[@id='side']") {
    remove("./div") // what even is this
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }
}
# Main "Issues" page
# http://www.humanesociety.org/issues/chimpanzee_research
#

# April 8 2013 Sarah LaFrance

$("./body") {
  add_class("mw_issue_cat")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//br")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[div[contains(@id, 'wayne')]]")

  # $(".//div[contains(@id, 'item-')]") {
  #   remove("@style")
  #   $(".//script") {
  #     inner() {
  #       replace(/width: "[\d]*"/, 'width: "100%"')
  #       replace(/height: "[\d]*"/, 'height: "300px"')
  #     }
  #   }
  # }
  
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    # HSUS-233
    # inner_wrap("div", class:"mw_contain_white")
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3 | .//p[@class='author' or @class='subhead']") {
    add_class("mw_h3")
  }

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  $(".//a[contains(@class, 'back')]") {
    inner() {
      prepend("  &laquo;  ")
    }
  }

  # main content
  $(".//div[@id='main']") {

    $(".//img") {
      remove("@align")
    }

    # apply a class to the youtube video
    $(".//div[iframe[contains(@src, 'youtube')]]") {
      add_class("mw_feature_video")
    }
    
    $(".//div[@id='feature']") {
      insert("div", class:"mw_save_seals") {
        move_here("../*[not(@id='images') and not(@id='tools')]")
        remove("./div[not([iframe])]") #remove child divs not containing an iframe
        $("./a[not(@class) and not(h2)]") { // the get app button
          add_class("mw_get_app")
          move_to("..", "bottom")
        }
      }
    }
    $(".//div[@class='video']") {
      $(".//h2") {
        text() {

        }
      }

      /*$(".//iframe)") {
        add_class("mw_testing")
        remove("./@width")
        remove("./@height")
      }*/
    }
    $(".//div[contains(@class, 'area-news')]") { // handle any bottom links
      wrap_together("./a", "div") {
        add_class("mw_news_links")
      }
    }
    $(".//div[contains(@class, 'area-news') or contains(@class, 'victories')]//li") { // news item
      insert_top("div", class:"mw_news_title") {
        move_here("../p[@class='image']")
        move_here("../p[@class='date']")
        move_here("../h3")
        move_here("../p[@class='excerpt']")
      }
    }
    # different news section format:
    $(".//div[contains(@class, 'area-news')]") {
      wrap_text_children("span")
      remove("./span")
      $(".//div[contains(@id, 'templatelist') and not(ul)]") {
        remove("@style")
        remove(".//hr")
        $(".//p[@class='image']") {
          wrap("div") {
            attribute("class", "mw_news_title")
            move_here("following-sibling::p[@class='date'][1]")
            move_here("following-sibling::h4[1]") {
              add_class("mw_h3")
            }
            move_here("following-sibling::p[1]")
          }
        }
      }
    }
    # HSUS-98: Paragraph breaks
    # URL: http://www.humanesociety.org/issues/cosmetic_testing/index.html
    $("./div[contains(@class, 'section-lead')]") {
      $("./ul") {
        remove("./@style")
        add_class("mw_list1")
      }
      $("./h2/following-sibling::p[1]") {
        wrap_text_children("span")
        $("./span[1]") {
          add_class("mw_break_p")
          move_here("./following-sibling::span[1] | ./following-sibling::span[2]", "bottom")
        }
      }
    }
    
    # HSUS-105
    # URL: http://www.humanesociety.org/issues/cosmetic_testing/becrueltyfree/
    $("./div[@id='pledgeform']") {
      # remove extra img and donate btn
      remove("./img[contains(@alt, 'Pledge')] | ./img[contains(@alt, 'pledge')] | .//div[@class='pledge-donate-btn']")
      $("./div[@class='pledge-form']") {
        insert_top("div", class: "mw_pledge_title", "Global Pledge to Be Cruelty-Free")
        $(".//form[@id='actionform']") {
          $("./input[@class='pledge-submit-btn']") {
            attributes(alt: fetch("./@alt"), onclick: "window.scrollTo(0,1);")
            btn_delegate() {
              add_class("mw_pledge_btn")
            }
          }
        }
        $(".//div[@id='thankyou']") {
          remove(".//a/text()")
        }
      }
      $("./following-sibling::div[@id='features']/ul/li") {
        add_class("mw_pledge_list")
        $("./p[@class='image']") {
          move_here("./preceding-sibling::h3", "after")
        }
      }
    }
    # end of HSUS-105
    
    $("./div[contains(@class, 's_borderless') or contains(@class, 'section')]") {
      # desktop site hide
      remove("./div[@class='video-player']")
      $("./p[./span[not(.//a)]]") {
        add_class("mw_h3")
      }
      $("./div[contains(@class, 'section')]/p") {
        add_class("mw_issue_p")
        $(".//strong[not(a)]") {
          add_class("mw_block_link")
        }
      }
      $("./p[not(@class)]") {
        add_class("mw_issue_p")
        $("./a[starts-with(text(), '»')]") {
          add_class("mw_arrow_link")
        }
        $("./a") {
          match(text(), /^\W\s$/) {
            $("./following-sibling::a[1]") {
              add_class("mw_arrow_link")
            }
            remove()
          }
          text() {
            replace(/^\W\s/, "")
          }
        }
      }
    }
    $("./div[@id='features']/ul/li") {
      inner_wrap("div", class:"mw_feature_article") {
        move_here("./p[@class='image']", "before")
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    # trying something out here
    $("./ul") {
      add_class("mw_sidebar1_h")
      # Fix for HSUS-526
      insert_after("div", class: "mw_flex") {
        move_here("./following-sibling::div") {
          add_class("mw_flex_box_item_1")
        }
        $(".//ul/li") {
          $(".//a") {
            add_class("mw_more")
            inject("  &raquo;  ")
          }
        }
      }
    }

    $("./div[@id='seals-app']") {
      $(".//a[contains(@class, 'more')]") {
        add_class("mw_get_app")
      }
    }

    $(".//div[@id='relatedissues-promo' or @id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
    }
    $(".//div[@id='resources-promo']") {
      // Fix for HSUS-526
      add_class("mw_sidebar9")
      $(".//h2|.//h3") {
        attribute("class", "mw_h2")
      }
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%; height: 300px")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  $(".//a[contains(text(),'AltTox.org')]") {
    add_class("mw_alttox")
  }
  # hide bread crumb
  $(".//div[@id='contentDiv']/div[@class='no-banner']//div[@id='feature']/div[@class='mw_save_seals']") {
    add_class("mw_hide")
  }
}
## HSUS - 443

$("./body") {
  add_class("mw_actform_mconnect")
  $(".//div[@id='container']") {
    remove("parent::div/@style")
    $("./table[@id='title-text']//p") {
      name("h1")
      add_class("mw_h1")
    }
    $("./table[@id='target']") {
      remove("@style|@height|@align|@width") 
      $(".//td") {
        remove("@align")
      }  
      $(".//p") {
        name("h2")
        add_class("mw_h2 mw_center")
      }
    }
    $("./table[@id='main-text']") {
      remove("@style|@height|@align|@width")
      $(".//td") {
        remove("@align")
      }
    }
    $("./table[@id='gray-text']") {
      remove("@width|@align|@height")
      $(".//td") {
        remove("@align")
      }
      move_to("./following-sibling::div[@id='form']", "top")
    }
    $(".//form/table[@id='mconnect-phoneandzip' or @id='basic']") {
      remove("@width|@align")
      $(".//input") {
        remove("@style")
      }
      $(".//input[@id='submit-button']") {
        attribute("value", "CALL NOW")
        $("..") {
          add_class("mw_center")
        }
      }
    }
    $(".//table[contains(@id,'logo')]") {
      $(".//img") {
        attribute("src") {
          value() {
            replace(/\s*$/,"")
          }
        }
      }
      remove("@style") {
        $(".//td") {
          remove("@align")
        }
      }
      move_to("./ancestor::div[@id='form']", "after")
    }
  }

  # Remove style attributes and other attributes that mess up styles
  $("./div[@id='ga-container']") {
    $(".//div[@id='form']") {
      remove(".//input/@style")
      remove(".//table[@id='mconnect-phoneandzip']/@width")
    }
    $(".//table") {
      remove("./@bgcolor | ./@style")
    }
    $(".//div[@id='ga-header']") {
      remove()
    }
  }
  # Remove the "powered by convio"
  $("./div[a[contains(@href, 'convio')]]") {
    remove()
  }
  
  $jsRemove = "$('form').submit(function() { $('#logo1').remove();$('#logo2').remove(); })"
  insert_javascript_at(position("bottom"),$jsRemove)

}
# http://action.humanesociety.org/site/PageNavigator/hsus_yearend2012_humaneheroes.html?utm_source=vanitybillyslegacy&utm_medium=hsusweb&utm_campaign=billyslegacy13
# http://action.humanesociety.org/site/PageServer?pagename=textsignup
# action subdomain forms

# April 11 2013 - Sarah LaFrance

# note there's currently no mobile mapping for these urls.

$("./body") {
  add_class("mw_actform")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//@style")
  remove(".//div[@id='wrapper']/br")

  # see if we have a top header already
  $("self::body[//div[@id='ga-header']]") {
    add_class("mw_has_header")
  }
  $(".//form[@id='findrepcomponent']") {
    remove(".//ul/li[@class='findreps-sidetab']")
  }
  
  # http://action.humanesociety.org/site/PageServer?pagename=textsignup
  $(".//form[contains(@action, 'profiles\/join')]/table") {
    remove(".//td/div/br")
    $(".//td[./input[@id='person_first_name' or @id='person_city']]") {
      wrap_together("./input", "div", class: "mw_merge_input mw_flex_box") {
        $("./input") {
          wrap("div", class: "mw_flex_box_item_1")
        }
      }
    }
  }
  
  # insert masthead section if we don't have one
  $(".//div[@id='wrapper' and not(.//div[contains(@class, 'mw_masthead')])]") {
    insert_top("div") {
      add_class("mw_masthead")
    }
  }

  # if we imported a desktop header image, pull it in
  $(".//div[@class=' mw_masthead']") {
    
    # HSUS-367 fixed masthead
    remove("//img[@id='desktop_head']")
    # move_here("//img[@id='desktop_head']") {
    #   
    #   $("preceding-sibling::img") {
    #     remove()
    #   }
    # }
  }

  # fix images
  $(".//img") {
    $img_src = fetch("@src")
    $img_src {
      replace(/\/site/, '')
    }
    attribute("src", $img_src)
  }

  # grab main div
  $(".//div[@id='ga-container' or @id='page']") {
    remove("./br") # weird little gap
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    $("./div[2]|./div[@id='contentDiv']") {
      add_class("mw_main mw_box2_tablet")
    }

    $(".//iframe") {
      attribute("height", '500px')
    }

    $(".//td[@class='findreps-split-or-content']/table/tr/td[@class='findreps-large-td'][1]//td[contains(text(), '+')]") {
      add_class("mw_plus")
    }

    match($path,/^\/site\/Survey/) {
      $(".//div[@class='appArea']") {
        remove(".//@width | .//@align")
      }
    }
    # hide spam control text
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_hide")
    }

    $(".//div[@class='appArea' and .//input[@class='Button']]") {
      add_class("mw_buttonBar")
    }
  }
  $(".//td") {
    $("./p[not(*)]") {
      text() {
        replace(/&nbsp/, "")
        replace(/^[\s\u00a0]+/, "")
        replace(/[\s\u00a0]+\|$/, "")
      }
    }
  }

}
# secure welcome page
# http://action.humanesociety.org/site/PageServer?pagename=humane_welcome_page&JServSessionIdr004=8w797fvbu1.app305b
#

# April 11 2013 Sarah LaFrance

$("./body") {
  add_class("mw_welcome")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//br")

  $(".//div[@id='main']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='contentDiv']") {
    remove("./div[not(@id)]")
    $(".//div[@id='wrapper-body']") {
      $("./p") {
        $("./a[not(*)]") {
          add_class("mw_more")
        }
      }
      remove("@style")
      $(".//*") {
        remove("@style")
      }
      $(".//iframe") {
        remove("@width")
        remove("@height")
      }
    }
  }

}
#  "Action" subsection page
# http://www.humanesociety.org/action/now
# http://www.humanesociety.org/action/fed_bill
# http://www.humanesociety.org/action/toolkit
#

# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press mw_news_base")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']") 
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[div[@id='wayne']]")
  remove(".//div[@class='toolsSpacer']")

  $(".//li[@class='more']//a|.//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='list-nav']") {
    remove("@id") // fix my styling screwup
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_no_display")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//p[@class='related']") {
    wrap_text_children("span")
  }

  # pagination stuff taken from press
  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
      remove(".//li[@class='expanded']/ul")
      move_here("./span/li")
      remove("./span")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
  }

}
# http://www.humanesociety.org/action/alerts/maryland/
# action alerts

$("./body") {
  add_class("mw_action_alerts")
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//div[@id='page-bottom-spacer']") {
      add_class("mw_hide")
      remove("@style")
    }
    remove("./div[@id='page-head']")
    $("./div[@id='contentDiv']") {
      remove("./div[@id='head']")
      $("./div[@id='cols']") {

        # content section
        $("./div[@id='main']") {
          $(".//h2") {
            add_class("mw_h2")
          }
          $(".//div[@id='top-pagination']"){
            add_class("mw_search1")
            $(".//label") {
              wrap_text_children("span")
            }
            $(".//button[@type='submit']") {
              add_class("mw_btn5")
              text("")
            }
          }
        }

        # right-nav
        $("./div[@id='side']/ul") {
          add_class("mw_sidebar1_h")
        }
      }
    }
  }
}
# Spay Day issue page
# http://www.humanesociety.org/issues/spay_day
# modified version of issue_subject.ts

# March 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_issue_cat mw_spay_day")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//br")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[contains(@id, 'item-')]") {
    remove("@style")
    $(".//script") {
      inner() {
        replace(/width: "[\d]*"/, 'width: "100%"')
        replace(/height: "[\d]*"/, 'height: "300px"')
      }
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3 | .//p[@class='author' or @class='subhead']") {
      add_class("mw_h3")
    }

    $(".//a[contains(@class, 'more')]") {
      inject("  &raquo;  ")
    }

    $(".//a[contains(@class, 'back')]") {
      inner() {
        prepend("  &laquo;  ")
      }
    }
    $("./div[@id='side']") {
      $("./ul[@id='action']") {
        add_class("mw_sidebar1_h")
      }
      $("./div[@id='relatedissues-promo']") {
        wrap("div", class:"mw_flex_box") {
          move_here("following-sibling::div[@id='resources-promo']")
          $("./div[contains(@class,'promo')]") {
            add_class("mw_flex_box_item_1")
            $("./ul/li") {
              $(".//a") {
                add_class("mw_more")
                inject("  &raquo;  ")
              }
            }
          }
        }
      }
    }
  }

  $(".//div[@id='main']") {

    $(".//div[contains(@class, 'section-lead')]") {
      $("./p[count(.//a)=3]") {
        add_class("mw_spay_p")
      }
    }
    $(".//div[contains(@class, 'area-news')]") { // handle any bottom links
      wrap_together("./a", "div") {
        add_class("mw_news_links")
      }
    }
    $(".//div[contains(@class, 'area-news') or contains(@class, 'victories')]//li") { // news item
      insert_top("div", class:"mw_news_title") {
        move_here("../p[@class='image']")
        move_here("../p[@class='date']")
        move_here("../h3")
        move_here("../p[@class='excerpt']")
      }
    }
    $("./div[contains(@class, 's_borderless') or contains(@class, 'section')]") {
      # desktop site hide
      remove("./div[@class='video-player']")
      $("./p[./span[not(.//a)]]") {
        add_class("mw_h3")
      }
      # $("./div[contains(@class, 'section')]/p") {
      #   add_class("mw_spay_p")
      # }
      # $("./p[not(@class)]") {
      #   add_class("mw_spay_p")
      # }
    }
    $("./div[@id='features']/ul/li") {
      inner_wrap("div", class:"mw_feature_article") {
        move_here("./p[@class='image']", "before")
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    $("./div[@id='seals-app']") {
      $(".//a[contains(@class, 'more')]") {
        add_class("mw_get_app")
      }
    }

    $(".//div[@id='relatedissues-promo' or @id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
    }
    $(".//div[@id='resources-promo']") {
      add_class("mw_sidebar2")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%; height: 300px")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  $(".//a[contains(text(),'AltTox.org')]") {
    add_class("mw_alttox")
  }

}
$("./body") {
  add_class("mw_protect_seals_pledge_tablet")

  # Remove header
  remove("./div[@class='mw_header']")
  # Remove the the powered by convio
  remove("./div[a[contains(@href, 'convio')]]")

  $("div[@id='ga-container']/div[@id='ga-content']/table") {
    remove("@style")
  }

  $(".//div[@id='wrapper']") {
    remove("./br")
  }

  $(".//div[@id='page']") {
    remove(".//div[@id='page-head']")
  }
}
# current url - http://www.humanesociety.org/testing/hsus_testing/editorial/protect_seals_1.html
# future url - http://www.humanesociety.org/issues/seal_hunt/2013_hunt/home.html

# when this file is moved to live, uncomment it's mapping in mappings.ts in the work section
# seal splash action action page

# March 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_sealsplat")

  # hide unneeded sections
  $(".//iframe[@id='hiddenframe']") {
    add_class("mw_hide")
  }
  # Fix for HSUS-525
  $(".//div[@id='infographiccontents']|.//div[@id='head']/div[@id='top_band']") {
    add_class("mw_hide")
  }
  $(".//div[@id='head']") {
    remove("./@style")
  }
  # End HSUS-525
  # Header logo
  $(".//div[@id='mw_slider_overlay']") {
    insert_after("div", class:"mw_header_logo") {
      move_here("//div[@class='logo']") {
        $("./a") {
          insert("img") {
            attribute("src", asset("images/headband.png"))
          }
        }
      }
    }
  }

  # main content
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//p[@class='author' or @class='subhead']") {
      add_class("mw_h3")
    }
    # HSUS-525
    remove(".//div[@id='page-head']")
    # no top headline
    $(".//div[@id='main']") {
      $(".//div[contains(@class,'section-lead')]") {
        move_here("following-sibling::div[@id='feature']")
      }
    }
    $(".//p") {
      inner() {
        replace(/\s+/, " ")
      }
    }
    # HSUS-525 - End
    # video and leadin; number links rotate carousel
    $(".//div[@id='billboard']") {
      attributes(data-ur-carousel-component:"view_container", data-ur-set:"carousel", data-ur-infinite:"disabled", data-ur-fill:1, data-ur-autoscroll:"disabled")
      insert_bottom("span", id:"mw_carousel_dots", data-ur-carousel-component:"dots" )

      wrap_together("./div", "div") {
        attributes(data-ur-carousel-component:"scroll_container")

        $("./div") {
          remove("./@style")
          attributes(data-ur-carousel-component:"item")
          $("./self::div[not(./iframe)]") {
            remove("./a[@id='infographicimagelink']/text() | ./div[@id='appstoretext']/a")
          }
        }

        $("./div[@id='page2']/div[@id='appstoreimagelink']") {
          insert_top("img", src:"https://secure3.convio.net/humane/images/content/pagebuilder/seals2012-qr2.gif")
          wrap_text_children("span", class:"mw_app_text")
        }

        $("./div[@id='page3']") {
          $("./a[@id='infographicimagelink']") {
            insert_top("img", src:"http://www.humanesociety.org/assets/images/logos_odd_sizes/seal_bb_infographic.jpg")
          }
          
          # replace their JS popup with a link to the image
          $(".//a[contains(@href,'popupInfographic')]") {
            attribute("href", "http://www.humanesociety.org/assets/images/logos_odd_sizes/seals_infograph_2012.jpg")
          }
        }
      }
    }

    # share bar
    $(".//div[@id='sharethispage']") {
      move_to("..", "top")

      # Adding a label
      insert_top("div", class:"share_label", "Share: ")

      # Just wrap the text children so we can hide them. Good idea Sarah!
      $("./a") {
        wrap_text_children("span")
      }
    }

    # form to pledge
    $(".//div[@id='sidebar']") {
      move_here("../a") // grab donate now button
      $("./a") {
        wrap("div", id:"mw_donate_btn")
      }
    }
    # twitter feeds and links
    $(".//div[@id='lowercontent']") {
      # twitter feed
      # a lot of this content isn't being pulled in
      # the javascript to grab other tweets isn't loading
      $("./div[@id='twitterfeeds']") {
        $(".//div[@id='livefromtheice']") {
          move_here(".//span[@class='twuser']", "top")
          move_here("./a[@id='followrebecca']", "top")
        }
        $(".//a[@id='mortweets']") {
          inject("  &raquo;  ")
        }
      }
      # news and get the app
      $("./div[@id='contentstories']") {
        $(".//div[@class='story']") {
          move_here(".//div[@class='storytext']/a")
          inner_wrap("div")
          move_here(".//a[./img]", "top")
          $("./self::div[not(./a)]") {
            move_here(".//img", "top")
          }
        }

        remove(".//br")
        # add raquos to the more links that need them
        $(".//a[@class='storymainlink' or @id='mediacontacts' or @id='morenews']") {
          inject("  &raquo;  ")
        }
      }
    }

    # side bar
    $(".//div[@id='side']") {
      $("./ul[@id='action']") {
        add_class("mw_sidebar1_h")
      }
    }

    # empty div
    $(".//div[@id='page-bottom-spacer']") {
      remove("@style")
    }
  } // close main

  # footer
  $(".//div[@id='contentDiv']") {
    # Fix for HSUS-525 and 526 moblie footer dislpayed
    #insert_bottom("div", class: "_footer mw_box1") {

    move_here("//div[@id='footer']") {
      remove("./div[./img]")
      attribute("id") {
        value() {
          replace("er", "")
        }
      }
    #}

    #manually styled footers
    move_here("//ul/li/a[contains(@href,'privacy')]/ancestor::div[1]") {
      remove("@style | ./img | ./div[@id='footerseals']")
      $("./div[@id='fineprint']") {
        name("li")
        add_class("mw_footer_info")
        move_to("./preceding-sibling::ul", "bottom")
      }
      $(".//*[@style]") {
        remove("@style")
      }
      $("./ul/li[1]") {
        add_class('mw_footer_copyright')
        wrap_text_children("span")
        $("./span[1]") {
          inner(fetch("./text()")+fetch("./following-sibling::a/text()"))
        }
        inner(fetch("./span[1]/text()"))
      }
      $(".//li[./a]") {
        add_class("mw_links_inline")
        remove("./self::li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
      }
    }

    insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
      insert("span", class:"footer-strong", "Moovweb")
    }
  }
  # footer

    #prep the footer for styling - no actually I just broke it never mind
    # $("./div[contains(@class, '_footer')]") {
    #   move_to("//div[@id='contentDiv']")
    #   $(".//div[@id='footer']") {
    #     attribute("id", "foot")
    #     $("./ul/li[1]") {
    #       add_class('mw_footer_copyright')
    #       wrap_text_children("span")
    #       remove("span[2]")
    #       text() {

    #       }
    #     }
    #     $(".//li[./a and position()>1]") {
    #       add_class("mw_link_center")
    #       $("./a") {
    #         add_class("mw_bar2")
    #         remove("@style")
    #       }
    #     }
    #   }
    # }
  }
  # Fix for HSUS-525
  $(".//div[contains(@id,'relatedissues-promo')]") {
    add_class("mw_sidebar3")
  }
  $(".//div[@id='resources-promo']") {
    add_class("mw_sidebar9")
  }
}
# Main "Our Work" page
# http://www.humanesociety.org/work
#

# April 1 2013 Sarah LaFrance

$(".//body") {
  add_class("mw_work")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $("./li") {
        add_class("mw_flex_box_item_1")
        $("./a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//div[@id='animalaccord']") { //main topic togglers
      remove(".//div[@class='clear']")
      $(".//div[@class='menu_head']/p") {
        move_to("../following-sibling::div[1]", "top") // text needs to go in content
      }

      $(".//div[@class='menu_head']") {
        add_class("mw_flex_box")
        wrap("div", class:"mw_animal_accord") {
          attributes(data-ur-set:"toggler")
          move_here("./following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content") {
              # fix double column in that one section
              $(".//div[@class='wildcolumn2']/a") {
                move_to("../preceding-sibling::div")
              }
              $(".//a") {
                add_class("mw_animal_button")
              }
            }
          }
        }
        attributes(data-ur-toggler-component:"button") {
          $("./img") {
            insert_after("div", class:"mw_plusminus")
            $("following-sibling::span") {
              add_class("mw_flex_box_item_1")
            }
          }
        }
      }
    }
  }
  
  #  HSUS-251 Resources boxes - width
  $(".//div[@id='side']") {
    $("./ul[@id='action']") {
      add_class("mw_flex_box mw_sidebar1_h")
      $("./li") {
        add_class("mw_flex_box_item_1")
      }
    }
    $(".//div[@id='bluenav']") {
      add_class("mw_sidebar6")
      $(".//a") {
        add_class("mw_more")
        inject("  &raquo;  ")
      }
      $("./ul") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
      move_to("following-sibling::ul[@id='action']","after")
    }
  }
  # END HSUS-251 Resources boxes - width
}
# faqs under issues
#

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_qanda")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")


  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
  }

  # main content
  $(".//div[@id='main']") {
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//div[@id='feature']") {
      move_here("..//ul[@id='tools']", "top")
      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    $(".//div[contains(@class, 's_borderless')]") {
      match($path) {
        with(/issues\/cloning\/qa/) {
          #HSUS-451: workaround for this url since it is on a different format than the others
          # dont remove the ul
        }
        else() {
          remove("./ul[1]")
        }
      }     
      remove(".//hr")
      # remove back to top button
      remove("./p[./a[contains(text(),'back to top')]]")
      $("./strong") {
        wrap("p", class:"mw_question")
      }
      $("./p[./strong]") { // question
        add_class("mw_question")
      }
      # remove the p without any content in it
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
      $("./p[@class='author']") {
        add_class("mw_hide")
      }
      $("./ul/preceding-sibling::p[1]") {
        add_class("mw_question_ul")
      }
      # HSUS-120
      # http://www.humanesociety.org/animal_community/resources/qa/common_questions_on_shelters.html#How_many_animals_enter_animal_shelters_e
      $("./h3[contains(@class,'mw_h3')]") {
        wrap("div", class:"mw_qa_content")
      }
      $("./p") {
        move_to("preceding-sibling::div[@class='mw_qa_content'][1]")
      }
    }
  }


  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
  }

}
 $(".//form") { 
 #HSUS-426 adding in convio source tracking
  log("HSUS-426")
  log($path)
  # %s_src = $path
  log("----")
  $path {
    capture(/(s\_src\=[^&]+)/)
    {
      $s_src = $1
    }
  }
  # %s_src = $1
  match($s_src) {
    with($1) {
      log("$s_src matches $1")
      $1 = ""
    }
    else() {
      $1 = concat("&",$1)
    }
  }
  # hardcoding it as requested
  %s_subsource = "s_subsrc=tablet"
  log(concat("s_src: ", $s_src))
  log(concat("s_subsource: ", %s_subsource))

  # Construct a new form post action
  %post_action = fetch("./@action")
  
  # To avoid adding the source/subsource multiple times
  match_not(%post_action, %s_subsource) {
    log("applying s_src & s_subsrc")
    %post_action {
      replace($s_src, "")
    }
    # attributes(action: concat(%post_action, %s_src, "&", %s_subsource))
    log("-- post_action --")
    log(%post_action)
    match(%post_action) {
     # if there are no other post arguments, make the $s_src first
     with(/\?/) {
       log("s_src is not the first variable")
       attributes(action: concat(%post_action,"&", $s_src, "&", %s_subsource))
     }
     else() {
       
       log("s_src is the first variable")
       attributes(action: concat(%post_action,"?", $s_src, "&", %s_subsource))
     }
    }

  }
  
}
# "Campaign" subcat page
# http://www.humanesociety.org/issues/campaigns/factory_farming
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_campaign_cat")

  # remove
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='petfinder-promo']")

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul[li[@class='current']]") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      remove("./li[1]")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[@id='mw_masthead']", "top")
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//div[@class='off-lead']/p") {
      add_class("mw_h3")
    }

    $(".//a[contains(@class, 'more')]") {
      inject("  &raquo;  ")
    }
  }

  # main content
  $(".//div[@id='main']") {
    remove("./div[@id='feature']")
    $(".//iframe") {
      remove("@width")
      remove("@height")
    }
    $(".//div[@id='features']") {
      $(".//li") {
        move_here("./p[@class='image']", "top")
      }
      $(".//p") {
        inner() {
          replace(/\xC2\xA0/, "")
        }
      }
    }
    
    $("./div[contains(@class, 's_borderless')]") {
      $("./h1") {
        add_class("mw_h1")
      }
      $("./p") {
        add_class("mw_campaign_p")
        $("./self::p[contains(@class, 'subhead')]") {
          add_class("mw_campaign_subtitle")
          move_here("./preceding-sibling::p[contains(@class, 'date')]", "after")
        }
      }
    }
  }


  # sidebar
  $(".//div[@id='side']") {
    # remove("./div")
    $("./ul") {
      add_class("mw_sidebar1_h")
      ##HSUS - 442 - repeated donate button - one is styled with give-bttn class
      remove("./li[@id='donate']/a[@class='give-bttn']") 
    }
  }

}
# secure join a pledge page
# https://mlocal.secure.humanesociety.org/site/Advocacy?cmd=display&page=UserAction&id=2823&autologin=yes&s_src=website&s_subsrc=campaigns
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_pledge_tablet")
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }
  $("./div[@id='wrapper']") {
    remove("./div[@id='page-head']")
    $("./div[@id='page']") {
      add_class("mw_box2_tablet")
    }
    remove(".//div[@id='head'] | .//div[@id='wrapper-body']/@style")
    $(".//input[@id='button']") {
      add_class("mw_btn4")
    }
    
  }
  # remove
  # remove("./div[not(@id)]")
  # Remove the the powered by convio
  $("./div[a[contains(@href, 'convio')]]") {
    remove()
  }

  fixImages()

  #not sure what this was fixing...
  # this was fixed on their end --SL
  # HSUS-518 Content repeated
  remove(".//div[@class='showondesktop']")
  # HSUS-518 Content repeated

  # remove inline styling
  $(".//table") {
    remove("@style")
    remove("@bgcolor")
  }
  $(".//img") {
    remove("@align")
    remove("@width")
    remove("@height")
  }
  $(".//input") {
    remove("@size")
  }

  $(".//h1") {
    add_class("mw_h1")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//h3|.//span[@class='AlertListName']") {
    add_class("mw_h3")
  }

  $(".//div[@id='ga-content']/table/tbody") {
    # remove("./tr[.//div[@id='ga-header']]")
    $(".//div[@id='ga-header']") {
      # %home = fetch("//a[@class='mw_header_spillover']/@href")
      wrap("a", href:fetch("//a[@class='mw_header_spillover']/@href"), class:"mw_header_full_width")

      $("./ancestor::td[1]") {
        add_class("mw_header_full_width")
      }
    }
    remove("./tr[./td[not(*)]]")
    $(".//table") {
      add_class("mw_level_2")
      remove(".//@width | .//@height | .//@align | .//img/@style") 
      $("./tbody/tr/td") {
        add_class("mw_holder")
        $("./self::td[./img]") {
          add_class("mw_img_td")
        }
        #remove("./div[img]")
      }
      $("./self::table[.//td[contains(@class, 'mw_img_td')]]") {
        add_class("mw_img_table")
      }
    }
    $(".//div[@id='action-alert'] | .//div[@class='appArea']") { # everything's in here  
      
      insert_top("div", class:"mw_share_buttons") {
        insert("p") {
          text() {
            set("Share")
          }
        }
        move_here("..//div[@id='share_bar']")

        # For when they don't wrap their share buttons in a div#share
        move_here("..//a[contains(@href, 'addthis')] | ..//a[contains(@href, 'on.fb')]") {
          $("./img[contains(@src,'facebook')]/..") {
            add_class("addthis_button_facebook")
          }
          $("./img[contains(@src,'twitter')]/..") {
            add_class("addthis_button_twitter")
          }
        }

        # Checks to see if the div#share_bar already exists, if not, moves in the share buttons
        $("../div[@class='mw_share_buttons'][not(div)]") {
          insert("div", id:"share_bar") {
            move_here("../a")
            move_here("./div[@class='mw_share_buttons']/a")
          }
        }

        # insert("div", id:"share_bar") {
        #   move_here("../a")
        # }

        # check if the share bar is empty
        $("./div[not(node())]") {
          $("..") {
            attribute("style", "display: none;")
          }
        }

      }

      $(".//form") {
        # remove white space
        $("./p[not(*)][text()]") {
          text() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
        }
        # Make phone number fields bring up the number keypad by default
        $("./div[contains(@id, 'column')]/fieldset[@id='info']/table[contains(@class, 'mw_level_2')]//span[@class='NetscapeFix']/input | ./div[contains(@id, 'column')]/fieldset[@id='info']//input[@id='phone']") {
          attribute("type", "tel")
        }
        
        #HSUS-426 adding in convio source tracking
        # This has been moved to convio_tablet.ts
        # log("HSUS-426")
        # log($path)
        # # %s_src = $path
        # log("----")
        # $path {
        #   replace(/(s\_src\=[^&]+)/)
        # }
        # %s_src = $1
        # match(%s_src) {
        #   with($1) {
        #     log("%s_src matches $1")
        #     $1 = ""
        #   }
        #   else() {
        #     $1 = concat("&",$1)
        #   }
        # }
        # # hardcoding it as requested
        # %s_subsource = "s_subsrc=tablet"
        # log(concat("s_src: ", %s_src))
        # log(concat("s_subsource: ", %s_subsource))
      
        # Construct a new form post action
        # %post_action = fetch("./@action")
        # attributes(action: concat(%post_action, "&", %s_src, "&", %s_subsource))
        
      }
      
      $(".//p[img]") {
        add_class("mw_top_image")
        $("./img") {
          remove("@style")
          remove("@height")
          remove("@width")
          remove("@hspace")
        }
      }

      #HSUS-495 20131204 Start
      $(".//form/p[img]") {
        add_class('mw_read_more')
        $("./img") {
          move_to("../a")
        }
      }
      #HSUS-495 20131204 End

      $("./form/img") {
        wrap("div", style:"text-align:center;") {
          #For HSUS-429 :Removed style attribute from the below code for  [Tablet] Increase Padding on Action Alert Images
          add_class("mw_img_pad")
          #End of HSUS-429
        }
      }
      $(".//div[@id='mobileheadlinetext']") {
        wrap_text_children("h1") {
          add_class("mw_h1")
        }

      }
      # Move the 'message' into column1
      $("./form/fieldset[@id='message']") {
        move_to("../div[@id='column1']", "top")
      }
      # Move the intro text to the top of the form
      $(".//div[@id='column1']/*[not(@id='message')]") {
        move_to("../..")
      }

      $(".//div[@id='column2']") {
        move_to("..", "bottom")
      }

      $(".//div[@id='column1']") {
        move_to("..", "bottom")

        $(".//div[@class='field-wrap']/textarea[@id='middle']") {
          remove("./@cols")
        }
      }

      # Wrap the columns into... columns haha
      # refine the page style
      # https://.secure.humanesociety.org/site/Advocacy?cmd=display&page=UserAction&id=6045
      $(".//form[@id='beanForm']") {
        wrap_together(".//div[contains(@id, 'column')]", "div", class:"mw_flex_box mw_form_column") {
          $("./div") {
            add_class("mw_flex_box_item_1")
          }
          # HSUS-295 (Tablet) Action Alert Submit Button & Form Position
          move_here("./div[@id='column2']") {
            move_here("ancestor::form[@id='beanForm']//script")
            move_here("ancestor::form[@id='beanForm']//div[contains(@class, 'bottom')]") {
              add_class("mw_bottom")
            }
          }
        }
        $(".//table[@id='survey-questions']//tr[@class='old-school']") {
          remove("./td[@class='req']")
          $(".//span[@class='NetscapeFix']/ancestor::td[1]") {
            add_class("mw_netscapeFix")
          }
        }
        # END HSUS-295 (Tablet) Action Alert Submit Button & Form Position
      }
    }
    # HSUS-495 (Tablet) Reduced padding above "Here's how to find the right dog for you:" by hiding the empty div.
    $(".//div[@id='action-alert']/form") {
      $("./div[count(*)=0]") {
        add_class("mw_hide");
      }
    }
    # HSUS-495 Ends
  }

  # youtube video fixes

  $(".//iframe[contains(@src, 'youtube')]") {
    remove("./@height | ./@width")
    attribute("style", "width: 100%;")

  }

  #prep to add in the footer
  $(".//ul[@style]/ancestor::div[@style]") {
    add_class("mw_pledge_footer")
    attribute("id", "foot")
    remove("@style")

    $(".//*[@style]") {
      remove("@style")
    }
    $(".//li") {
      add_class("mw_link_center")
      $("./a") {
        # attribute("style", "color: #a7a7a7;")
      }
      
    }
    remove(".//img")
  }

  $("//div[@class='_footer mw_box1']") {
    move_here("//div[@class=' mw_pledge_footer']", "top")
  }

  $(".//td[@class=' mw_holder'][p]/p[@style]") {
    add_class("mw_advocacy_suggestion")
    remove("@style")
  }

  # Use our <select> element identifiers
  $(".//select/..") {
    add_class("mw_select_arrows")
  }

  # custom keyboards
  $(".//input[contains(@name, 'email')]") {
    keyboard("email")
  }
  $(".//input[contains(@name, 'zip')]") {
    keyboard("numeric")
  }
  $(".//input[contains(@name, 'phone')]") {
    keyboard("tel")
  }

  # Hide the old share table.. with just the donation link
  $(".//a[contains(@href, 'donation')]") {
    add_class("mw_hide")
  }

  # Hide the first "send your message" not necessary for the tablet?
  $(".//div[@class='submit-wrap']") {
    add_class("mw_hide")
  }

  # Make the textarea taller
  $(".//textarea[@id='middle']") {
    attribute("rows","15")
  }

  # HSUS-379 Webform Submission for Alerts page
  $(".//form[@id='WebformInput']/div[@class='appArea']") {
    remove("./br | ./table//td/br | ./ancestor::div[@id='wrapper'][1]/br")
    $("./div[./img[contains(@src, 'webform.puzzle')]]") {
      add_class("mw_puzzle_img")
      wrap("div", class:"mw_puzzle_box mw_flex_box") {
        move_here("./following-sibling::div", "bottom")
        inner_wrap("div", class:"mw_puzzle_input mw_flex_box_item_1")
      }
      move_to("..", "before")
      $("./img") {
        attribute("src") {
          value() {
            replace(/(\/|\w|\.)+org\//, "")
          }
        }
      }
    }
    $("./p[./input[@class='Button']]") {
      remove("./text()")
      $("./input[@type='submit']") {
        add_class("mw_puzzle_button")
        $("./self::input[@id='CNV_submit']") {
          add_class("mw_btn2")
        }
        $("./self::input[@id='CNV_cancel']") {
          add_class("mw_btn4")
        }
      }
    }
  }
  
}
# Main recipe page
# http://www.humanesociety.org/issues/eating/recipes
# this is a lot like an issue subject landing but the recipe pages have tons of lists 
# for ingredients &c and I want those to look nice

# March 8 2013 Sarah LaFrance

$("./body") {
  add_class("mw_recipe_main")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2|.//p[@class='subhead' and string-length(text())>1]") {
      add_class("mw_h2")
    }
  }

  # main content
  $(".//div[@id='main']") {

    $(".//h3|.//p[@class='author' and string-length(text())>1]") {
      add_class("mw_h3")
    }
    $(".//table") {
      $("following-sibling::*") {
        add_class("mw_after_tbl")
      }
    }

    $(".//div[div[@id='images']]") {
      remove("@style") // unfloat this
    }
    # shuffle everything around into 2 sections
    insert("div", class:"mw_recipes") {
      move_here("..//table")
      move_here("..//*[contains(@class, 'mw_after_tbl')]")
    }
    insert("div", class:"mw_top_section") {
      remove("preceding-sibling::div[@id='feature']")
      move_here("//ul[@id='tools']")
      move_here("//div[contains(@class, 's_borderless')]/*")
      move_to("..", "top")
    }
    remove(".//div[contains(@class, 's_borderless')]")

    $(".//div[@class='mw_recipes' and not(table)]") {
      remove()
    }
    $(".//div[@class='mw_recipes']") {
      $(".//table") {
        $(".//tr") {
          $(".//td") {
            name("div")
            attributes(class:"mw_td")
          }
          name("div")
          attributes(class:"mw_tr")
        }
      }
      insert_top("div", class:"mw_recipe_list") {
        move_here("//div[@class='mw_tr']")
        $(".//div[@class='mw_td' and ./a[@name]]") {
          attributes(data-ur-set:"toggler")
          $("./a") {
            attributes(data-ur-toggler-component:"button", class:"mw_bar3")
            insert("div", class:"mw_plusminus")
          }
          move_here("../following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content", class:"mw_recipe_bar")
          }
          remove("following-sibling::div") // spacer
        }
        remove("./div[@class='mw_tr' and not(div[@align])]") // more spacers
        $(".//*") {
          remove("@align")
          remove("@valign")
          remove(".//br")
        }
      }
      remove(".//table")
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
      $("./p[1]") {
        wrap("div", class:"mw_flex_box") {
          move_here("following-sibling::p")
          $("./p") {
            add_class("mw_flex_box_item_1")
          }
        }
      }
    }
  }
}
# News main page
# http://www.humanesociety.org/news/
#

# Jan 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_news")

  # removing
  remove(".//div[@id='side']") // take out for now
  remove(".//div[@id='list-nav']")

  $(".//h2") {
    attribute("class","mw_h1")
  }


  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") {
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove("./div")
    remove("./ul[@id='site-nav']")
    remove("./h1")
  }

  $(".//div[@id='contentDiv']") {
    remove("./div[not(@id)]")
    $(".//div[@class='pagination']") { // search bar
      add_class("mw_search1")
      $(".//button") {
        add_class("mw_btn5")
        text() {
          clear()
        }
      }
    }

    $(".//li") { // news item
      add_class("mw_newsItem")
      insert("div") {
        move_here("../p[@class='date']")
        move_here("../h3")
      }
      move_here(".//img", "top")
      remove(".//p[@class='image']")
    }

    $(".//a[@class='more']") {
      wrap("div", class:"more-link")
    }

  }

}
$("./body") {
  add_class("mw_off_duty")

  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
  }
}
# News articles
# http://mlocal.humanesociety.org/news/press_releases/2013/01/wy-ag-gag-hb0126-opposition-011513.html
#

# Sarah LaFrance Jan 29 2013

$("./body") {
  add_class("mw_article")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//li[@id='pdf']")
  remove(".//div[@id='petfinder-promo']")

  table_dump(".//table")

  $(".//div[not(contains(@class,'mw_masthead'))]") {
    remove("@style")
  }

  $(".//div[@id='feature' and a[@class='back']]") {
    remove()
  }

  # clear sidebar in faith articles
  $(".//div[@id='side']") {
    remove("./style")
    remove("./div[contains(@id, '-promo')]")
    remove("./iframe")
  }

  $(".//div[contains(@class, 's_borderless')]") {

    # move_here("./p[contains(@class, 'author')]", "top")
    # move_here("./p[contains(@class, 'subhead')]", "top")
    # move_here("./h1[1]", "top")
    # move date to below author and subhead

    # social media buttons
    move_here(".//ul[@id='tools']", "top")
    $(".//ul[@id='share_bar']") {
      $("./li[1]") { // "Share"
        remove("./*")
        insert("h3", class:"mw_share") {
          inject("Share")
        }
      }
    }

    $(".//iframe|.//embed") {
      remove("@height")
      remove("@width")
    }

    # Kevin's telephone script from the seagate project

    inner() {
      replace(/((\d)*[ ()\-.\d]+\d)/) {
        %orig = %1
        %1 {
          replace(/\s/, "")
        }
        %stripped = %1
        %stripped {
          replace(/\D/, "")
        }
        # ignore access codes
        match_not(length(%stripped), /^[1-8]$/) {
          set("<a href='tel:" + %stripped + "'>" + %orig + "</a>")
        }
      }
    }

    # what is this even for? it's breaking pigeons problem solver
    # This is for HSUS-361,381,428 When there has a carousel in the accordion

    $("./div[@class='image-scroller']") {
      $carousel_ans = "false"
      $("./ul/li[position() > 1][./p[@class='image']]") {
        $carousel_ans = "true"
      }
      match($carousel_ans, /true/) {
        inner_wrap("div", data-ur-set:"carousel", data-ur-carousel-component:"view_container", data-ur-fill:"1") {
          $("./ul") {
            name("div")
            attributes(data-ur-carousel-component:"scroll_container")
            $("./li") {
              name("div")
              attributes(data-ur-carousel-component:"item")
            }
          }
          insert_bottom("div", data-ur-carousel-component: "dots")
          $("ancestor::div[contains(@id,'answer')][1]") {
            add_class("mw_carousel_ans")
          }
        }
      }
      $(".//p[@class='image']") {
        wrap("div", class:"mw_ans_img")
      }
    }
    # HSUS-369 Correct styling on Animal Tips pages
    $("./ul[@class='item-list']/li[@class='image']") {
      $("./p[@class='image']") {
        move_to("preceding-sibling::p[1]","before")
      }
      $("./p[@class='related']") {
        move_to("preceding-sibling::p[1]","after")
      }
      $("./ul//a") {
        inject("  &raquo;  ")
      }
    }
    # HSUS-370 [Mobile] Decrease line spacing in FAQ
    $("./p[./span[contains(@id,'question')]]") {
      add_class("mw_question_p")
    }
    $("./p[not(*)]") {
      match(fetch("./text()"), /\A[\s ]*\Z/) {
        remove()
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {

      }
      $(".//div[@class='module']/h3/a") {
        inner() {
          append("  &raquo;  ")
        }
      }
    }
  }
  

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_youtube_height_fix")
    attributes(width:"100%")
  }

  # handling forms
  $(".//form[@method='POST']") {
    add_class("mw_form_area")
    remove(".//br")

    # re-hide spam control
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_hide")
    }
  }

  # HSUS-34 Survey table, only restyle it for mobile because the table breaks the viewport.
  match($tablet) {
    with(/false/) {
      $("./div[@id='wrapper']//div[contains(@class,'s_borderless')][./h1/span[contains(text(),'SURVEY')]]") {
        $("./div[contains(@class,'mw_was_table')]") {
          $(".//div[contains(@class,'mw_was_tr')][position() > 1]/div[contains(@class,'mw_was_td')][1]") {
            var("mw_sub_header"+index(), fetch("./text()"))
            add_class(var("mw_sub_header"+index()))
            remove()
          }
          $(".//div[contains(@class,'mw_was_td')][not(*)]") {
            match(text(), (/\A\s+\Z/)) {
              remove()
            }
          }
          $(".//div[contains(@class,'mw_was_tr')][1]/div[contains(@class,'mw_was_td')]") {
            $("./ancestor::div[contains(@class,'mw_was_table')]") {
              insert("div",class:"mw_survey_item") {
                move_here("..//div[contains(@class,'mw_was_tr')]/div[contains(@class,'mw_was_td')][1]")
                $("./div[contains(@class,'mw_was_td')][position() > 1]") {
                  $mw_sub_header_index = index()
                  insert_top("span", var("mw_sub_header"+$mw_sub_header_index) + ":", class: "mw_title")
                }
              }
            }
          }
        }
        # remove &nbsp; , white space
        $(".//p[not(*)] | ./p[./br]") {
          inner() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
          remove("./br")
        }
        # end remove &nbsp; , white space
        remove(".//@style")
      }
    }
  }
  # end of HSUS-34
}
# common news tritium
# imported into article, news, press pages

# Sarah LaFrance Jan 31 2013

$("./body") {
  add_class("mw_news_base")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  # HSUS-366 Missing Portion of Body on Page
  # remove(".//p[string-length(text())= 1][not(./a)][not(@class='image')]")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='side']/div[@class='simple']")
  # remove(".//br")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h2")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='feature']/a") {
    inject_before("  &laquo;  ")
  }

  $(".//div[contains(@class, 's_borderless')]") {
    $(".//h3") {
      add_class("mw_h3")
    }
    $("./div[./p/strong[position() = 1]]") {
      add_class("mw_misc_content")
    }
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }


  # remove the width and height of the youtube video
  $(".//iframe[contains(@src, 'youtube')]") {
    attributes(width:"100%", height:"")
  }
  # for brightcove experiences
  $(".//object[@class='BrightcoveExperience']") {
    remove("param[@name='width']")
  }
  
  # For HSUS-469:(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
  }
  #END Of HSUS-469
}

# News main page
# http://www.humanesociety.org/news/
# 

# Jan 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
    }
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
        # check for base cases and remove surrounding numbers
        # match($previous) {
        #   with("false") { // we're on the first page of results
        #     remove("./div[position() > 4]")
        #   }
        #   with("true") {
        #     match($next) { // we're on the last page
        #       with("false") {
        #         remove("./div[position() < (("+$current+" mod 10)-3)]")
        #       }
        #       with("true") { // general case
        #         remove("./div[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
        #       }
        #     }
        #   }
        # }
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
  }
  
  # HSUS-261 Update styling for Baby Animal togglers
  $(".//div[contains(@class,'s_borderless')]") {
    $("./h2[not(contains(@class,'space'))]/preceding-sibling::h2[contains(@id,'question')][1]") {
      add_class("mw_news_question")
    }
    $(".//h2[contains(@id,'question')]") {
     wrap("div", class:"mw_question_block")
    }
  }
  # End HSUS-261 Update styling for Baby Animal togglers

}

$("./body") {
  add_class("mw_news_briefs")

  # removing
  remove(".//div[@id='side']") // take out for now
  remove(".//div[@id='list-nav']")

  $(".//h2") {
    attribute("class","mw_h1")
  }


  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") {
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove("./div")
    remove("./ul[@id='site-nav']")
    remove("./h1")
  }

  $(".//div[@id='contentDiv']") {
    remove("./div[not(@id)]")
    $(".//div[@class='pagination']") { // search bar
      add_class("mw_search1")
      $(".//button") {
        add_class("mw_btn5")
        text() {
          clear()
        }
      }
    }

    $(".//li") { // news item
      add_class("mw_newsItem")
      insert("div") {
        move_here("../p[@class='date']")
        move_here("../h3")
      }
      move_here(".//img", "top")
      remove(".//p[@class='image']")
    }

    $(".//a[@class='more']") {
      wrap("div", class:"more-link")
    }

  }

}
# interview article pages
# http://www.humanesociety.org/news/interview/2012/m-r-wells-090512.html
#

# March 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_interview")

  # removing
  

}
$("./body") {
  add_class("mw_whitepapers")

  $(".//div[@id='page-head'] | .//div[@id='head'] | .//div[@id='page-bottom-spacer']") {
    add_class("mw_hide")
  }

  #Add the box2 to the wrapper
  $(".//div[@id='page']") {
    add_class("mw_box2")
  }

  # The first h3 is an exception.. it is not in a li
  $(".//div[contains(@class, 'section')]/h3") {
    add_class("mw_whitepaper_header mw_bar5")
    attributes(data-ur-toggler-component:"button")
    wrap("div",class: "mw_whitepaper_container", data-ur-set:"toggler") {
      $("./following-sibling::p[1]") {
        #add_class("mw_clean_me_up_scotty")
        remove()
      }
    }
  } 

  $(".//div[contains(@class, 'section')]/li[h3]") {
    move_here("./h3", "after") {
      add_class("mw_whitepaper_header mw_bar5")
      attributes(data-ur-toggler-component:"button")
      wrap("div",class: "mw_whitepaper_container", data-ur-set:"toggler")
    }
  }
  $(".//div[contains(@class, 'section')]/li[a]") {
    add_class("mw_whitepaper_content ")
    move_to("./preceding-sibling::div[contains(@class, 'mw_whitepaper_container')][1]")
  }

  $(".//div[contains(@class, 'mw_whitepaper_container')]") {
    wrap_together("./li", "div", data-ur-toggler-component:"content")
    $("./div/li") {
      name("div")
      $("./a") {
        add_class('mw_bar2')
      }
      
    }
  }

  # Remove the extra <p>'s
  $(".//div[contains(@class, 'mw_whitepaper_container')]") {
    remove(".//p")
  }

  # Move the div#side outside the div#page
  $(".//div[@id='side']") {
    move_to("./ancestor::div[@id='page']", "after")
  }

}
# main news QA page
# http://www.humanesociety.org/news/resources/qa
# 

# Mar 4 2013 Sarah LaFrance
# only real change is to top pagination to fix the weird sorting issue

$("./body") {
  add_class("mw_press")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") { // this section is hidden with styles but we need to re-hide it
    add_class("mw_no_display")
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
        # check for base cases and remove surrounding numbers
        match($previous) {
          with("false") { // we're on the first page of results
            remove("./div[position() > 4]")
          }
          with("true") {
            match($next) { // we're on the last page
              with("false") {
                remove("./div[position() < (("+$current+" mod 10)-3)]")
              }
              with("true") { // general case
                remove("./div[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
              }
            }
          }
        }
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='state']") {
    add_class("mw_sidebar5")
  }

  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
  }

}
# Animal browse page
# http://www.humanesociety.org/animals/browse_animals.html
# 

# March 27 2013 Sarah LaFrance

$("./body") {
  add_class("mw_atoz") 

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//br")

  # main animal list

  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[1]", "top")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }
  $(".//div[@id='browseanimals']") {
    $("./h2") {
      add_class("mw_h1")
    }
    $("./p") {
      add_class("mw_h3")
    }
    $(".//li/a") {
      add_class("mw_animal_button")
    }
    $(".//li/a[contains(text(), ')') or contains(text(), 'Aquarium')]") {
      add_class("mw_parenth")
    }
  }

  $(".//div[@id='side']") {
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }

}
# subcategories of the animal page
# http://www.humanesociety.org/animals/pets
# http://www.humanesociety.org/animals/rabbits

# April 9 2013 Sarah LaFrance

$("./body") {
  add_class("mw_pets")

  #removals
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")

  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[@class='mw_masthead']", "top")
  }

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  # main content
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")

    # general classes
    $(".//h2") { // fix this so it doesn't mess up boxes
      add_class("mw_h1")
      text() { }
    }
    $(".//h3") {
      add_class("mw_h2")
    }

    # pull the pet selector into lead
    $(".//div[@id='main']/div[1]") {
      move_here("following-sibling::div/div[@class='headline']")
    }

    # ignore this for now
    $(".//object") {
      $("./param[@name='linkBaseURL']") {
        $val_var = fetch("@value")
      }
      name("iframe")
      attribute("src", $val_var)
    }
    $(".//iframe") {
      remove("@style")
    }

    $(".//select[@name='fieldname']") {
      remove("@style")
      $selected = fetch("./option[@selected]/text()")
      wrap("div", class: "mw_select1") {
        insert_bottom("span", class: "mw_select_content", $selected)
      }
    }
  }


  $(".//div[contains(@class, 's_borderless')]") {
    $(".//a[@class='more']") {
      $destination = fetch("@href")
      $destination {
        replace(/\s$/, "") //chop off the occasional trailing spaces
      }
      attribute("href", $destination)
    }
    $(".//h2") {
      move_to("..", "top")
    }
    $(".//div[@id='images']") {
      $(".//*") {
        remove("@style") // remove padding
      }
      move_here(".//p[@class='image']")
      remove("./ul")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//p[@class='image']//img") {
      add_class("mw_img_box")
    }
  }

  $(".//div[@id='moreabout']") { // link section with background image
    $(".//li/a") {
      inject("  &raquo;  ")
    }
  }

  $(".//div[contains(@class, 'area-news')]") { // news headings section
    $(".//li") { // news item
      add_class("mw_newsItem")
      insert("div") {
        move_here("../p[@class='date']")
        move_here("../h3")
      }
      move_here(".//img", "top")
      remove(".//p[@class='image']")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
      wrap("div", class:"more-link")
    }
  }

  # sidebars
  $(".//div[@id='side']") {
    remove("./div[not(@class)][not(contains(@id, 'magazine-promo'))]")
    $("./div[@class='resources-promo' or @id='relatedissues-promo']") { // blue boxes
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
    # resources on pets sidebar
    $(".//div[@class='resources-promo']") {
      add_class("mw_sidebar2")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
      $("./ul") {
        name("div")
        $("./li[./a[@class='more']]") {
          name("div")
        }
        $("./li[position() mod 4 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./li") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/li") {
          name("div")
          add_class("mw_flex_box_item_1")
        }
      }
    }
    # donate sidebar
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
      move_to("preceding-sibling::div","before")
    }
    
    $(".//div[@id='relatedissues-promo']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
      $("./ul") {
        name("div")
        $("./li[./a[@class='more']]") {
          name("div")
        }
        $("./li[position() mod 5 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./li") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/li") {
          name("div")
          add_class("mw_flex_box_item_1")
        }
      }
      $("./a[@class='more']") {
        wrap("div",class:"mw_view_more")
      }
    }
   $("./div[@id='magazine-promo']") {
     add_class("mw_sidebar7")
     $(".//a[contains(@class, 'more')]") {
       inject("  &raquo;  ")
     }
   }
  }
}
# Animal main page
# http://www.humanesociety.org/animals/


$("./body") {
  add_class("mw_animal_main")
  
  # # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='petfinder-promo']")
  
  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[1]", "top")
  }
  
  # HSUS-344
  # http://humanesociety.org/testing/cd-test2.html
  $(".//div[@id='cols']") {
    move_to("./following-sibling::div[@id='page']", "top")
  }
  # end of HSUS-344
  
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    remove("./div[not(@id)]") // empty
  
    # top navigation
    $(".//div[@id='page-head']") {
      move_here(".//ul//ul") { // grab the subcategory list from the main nav
        add_class("mw_flex_box")
        $(".//li") {
          add_class("mw_flex_box_item_1")
          $(".//a") {
            add_class("mw_bar3 mw_h3")
          }
        }
      }
      remove("./h1")
      remove("./ul[@id='site-nav']")
      remove("./div")
      move_to("//div[@class=' mw_masthead']", "after")
    }
   
    $(".//div[@id='main']") {
      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//h2") {
        add_class("mw_h2")
      }
      $(".//h3") {
        add_class("mw_h3")
      }
      remove(".//div[@class='toolsSpacer']")
    }
  
    $(".//div[@id='animalaccord']") { //main topic togglers
      remove(".//div[@class='clear']")
      $(".//div[@class='menu_head']") {
        wrap("div", class:"mw_animal_accord") {
          attributes(data-ur-set:"toggler")
          move_here("./following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content") {
              $(".//a") {
                add_class("mw_animal_button")
              }
            }
          }
        }
        attributes(data-ur-toggler-component:"button") {
          add_class("mw_flex_box")
          $(".//span") {
            add_class("mw_h1")
          }
          $("./img") {
            insert_after("div", class:"mw_plusminus")
            insert_after("div", class:"mw_ani_title")
          }
          $("./div[contains(@class, 'mw_ani_title')]") {
            add_class("mw_flex_box_item_1")
            move_here("../div")
            move_here("../span")
            move_here("../p")
          }
        }
      }
    }
  }
  #  HSUS-229 [Tablet] Visual Design Discrepancies from Mockup on Animal Page
  $(".//div[@id='side']") {
    $("./ul[@id='action']") {
      add_class("mw_flex_box mw_sidebar1_h")
      $("./li") {
        add_class("mw_flex_box_item_1")
      }
    }
    $(".//div[@id='bluenav']") {
      add_class("mw_sidebar6")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//a") {
        add_class("mw_more")
        inject("  &raquo;  ")
      }
      $("./ul") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
      move_to("following-sibling::ul[@id='action']","after")
    }
  }
  # END HSUS-229 [Tablet] Visual Design Discrepancies from Mockup on Animal Page
}


# cat problem solving section
# animals/cats/cat_problem_solver

# April 15 2013

$("./body") {
  add_class("mw_cat_problems")
  
  # this script is not used since we use moovweb accordion
  $("//script[contains(text(),'var jq191 = jQuery.noConflict();')]") {
    remove()
  }  

  # remove
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")

  # main content 
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    remove("./br")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h1")
      remove("./br")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    # back arrow on the go back link
    $("./p/a") {
      inner() {
        prepend("  &laquo;  ")
      }
      $("parent::p") {
        remove("@style")
      }
    }

    # only on main page
    $(".//div[@id='feature']") {
      $(".//a[@class='more']") {
        inject("  &raquo;  ")
      }
    }
    $(".//div[@id='features']") {
      $(".//li") {
        add_class("mw_problem")
        $("./p[@class='image']") {
          move_to("..", "top")
          remove(".//br")
        }
        $(".//a[@class='more']") {
          inject("  &raquo;  ")
        }
      }
    }

    # find and tag togglers
    $(".//div[@id='accordion']") {
      # remove the aria attributes that pull in jquery scripts
      attribute("id", "mw_accordion")
      $("./div") {
        attributes(data-ur-toggler-component:"content")
        $(".//img") {
          add_class("mw_img_box")
          wrap("div", class:"mw_image")
        }
        # HSUS-374 fixed two white box issue
        #$("./form[@class='checkboxes'][last()][./preceding-sibling::form[@class='checkboxes']]") {
        #  wrap("div", class:"mw_checkboxes") {
        #    move_here("./preceding-sibling::form[@class='checkboxes'] | ./preceding-sibling::p[./preceding-sibling::form[@class='checkboxes']] | ./preceding-sibling::ul[./preceding-sibling::form[@class='checkboxes']]", "bottom")
        #    $("./form[@class='checkboxes']") {
        #      remove("./@class")
        #    }
        #  }
        #  move_to("..", "bottom")
        #}
        wrap("div") {
          attributes(data-ur-set:"toggler")
          move_here("preceding-sibling::h3", "top")
          $("./h3") {
            wrap("div") {
              attributes(data-ur-toggler-component:"button")
              insert("div", class:"mw_plusminus")
            }
          }
        }
      }
    }
  }

        # # try expanding the carousel toggler to fix resizing
        # $(".//div[@data-ur-id='4']") {
        #   add_class("touch_carousel")
        #   $("./div") {
        #     attribute("data-ur-state", "enabled")
        #   }
        # }
        
  # side bar
  $(".//div[@id='side']") {
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }

}
# Search Results page
# http://www.humanesociety.org/search/search.jsp?query=rats
# using mockup 05-search-results.png

# Feb 11 2013 Sarah LaFrance

$("./body") {
  add_class("mw_search_results")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")

  # Repair the google custom search
  $(".//div[@id='main']") {
    wrap_text_children("span", class:"mw_hide")
    insert("gcse:search")
  }

  $(".//div[@id='page' and ./div[@id='sortby']]") {
    add_class("mw_no_main")
  }

  # search again and filter
  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
      $(".//label[@for='sortbytype']/span") {
        text() {
          replace("Content ", "")
        }
      }
    }
  }

  # results

  $(".//h2[@class='suggestions' or @class='results']") {
    add_class("mw_h2")
    inject("  :  ")
  }

  $(".//div[@id='featuredSearch']") {
    remove("@style")
  }

  $(".//ul[@class='item-list']") {
    $(".//h2") {
      add_class("mw_h3")
    }
    $(".//p[@class='related']") {
      wrap_text_children("span") {
        text() {
          replace("Related", "Related  :  ")
        }
      }
    }
  }

  # page numbers, adapted from press.ts
  $(".//div[contains(@class, 'pagination') and contains(@class, 'section')]") {
    attribute("id", "mw_pages")
    $(".//li[not(a)]") {
      add_class("mw_current")
    }
    $current = fetch(".//li[contains(@class, 'mw_current')]/text()")
    $previous = "false"
    $next = "false"
    $(".//li/a[@class='prev']") {
      $previous = "true"
      inner() {
        prepend("  &laquo;  ")
      }
    }
    $(".//li/a[@class='next']") {
      $next = "true"
      inner() {
        append("  &raquo;  ")
      }
    }

    $(".//li[contains(@class, 'mw_current')]") { 
      insert_before("div", class:"mw_pages") {
        move_here("../li[not(a[@class='prev']) and not(a[@class='next'])]")
        # check for base cases and remove surrounding numbers
        match($previous) {
          with("false") { // we're on the first page of results
            remove("./li[position() > 4]")
          }
          with("true") {
            match($next) { // we're on the last page
              with("false") {
                remove("./li[position() < (("+$current+" mod 10)-3)]")
              }
              with("true") { // general case
                remove("./li[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
              }
            }
          }
        }
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    remove("./div")
  }
}
# All fact sheets
# http://mlocal.humanesociety.org/issues/fisheries/facts/right_whale_extinction.html
# http://mlocal.humanesociety.org/animals/cats/facts/cat_wildlife.html
# http://mlocal.humanesociety.org/issues/campaigns/factory_farming/fact-sheets/ag_gag.html
# http://mlocal.humanesociety.org/issues/puppy_mills/facts/
# http://mlocal.humanesociety.org/issues/exotic_pets/facts/fact_fiction_monkeys_apes_pets.html

# Feb 21 2013 Sarah LaFrance

$("./body") {
    add_class("mw_fact_sheet")

    #removing
    remove(".//div[@id='head']")
    remove(".//div[@id='page-head']")
    remove(".//div[@id='page-bottom-spacer']")
    remove(".//p[string-length()<=1 and not(*)]")

    $(".//div[@id='cols']") {
      add_class("mw_box2_tablet")
    }

    # main content
    $(".//div[@id='main']") {

      # social media buttons
      move_here(".//ul[@id='tools']", "top")

      $(".//div[@id='feature']") {
        move_to("..", "top")
        $(".//a") {
          inner() {
            prepend("  &laquo;  ")
          }
        }
      }
      
      $(".//div[@id='feature'][./a]") {
        add_class("mw_borderwithback")
      }

      $(".//div[contains(@class, 's_borderless')]") { // actual article content
        # move date to below author and subhead
        move_here("./p[contains(@class, 'author')]", "top")
        move_here("./p[contains(@class, 'subhead')]", "top")
        move_here("./h1[1]", "top")

        $(".//p[string-length()<=1 and not(*)]") {
          match_not($path, /^\/apps\/protectseals\//) {
            remove()
          }
        }
        
        $(".//div[contains(@id,'image-')]") {
          remove("@style")
        }
        
        $(".//h1") {
          add_class("mw_h1")
        }
        $(".//h2") {
          add_class("mw_h2")
        }
        $(".//h3") {
          add_class("mw_h3")
          $("./following-sibling::*[1][self::p][not(@class)]") {
            add_class("mw_fact_p")
            remove("./br")
          }
        }
        
        # ticket 146, handling the table
        $(".//table") {
          $(".//tr") { // no ths in this table
            $(".//td") {
              name("div")
              attributes(class:"mw_datum")
              remove("@style")
            }
            name("div")
            attributes(class:"mw_test_row")
          }
          name("div")
          attributes(class:"mw_cos_table")
          move_here(".//div[contains(@class, 'mw_test_row')]")
          remove("./tbody")
        }
        
        # scope into the untabled table
        # Fix for HSUS-470
        match_not($path, /fur_fashion\/tips/) {
          $(".//div[@class='mw_cos_table']") {
            
            # HSUS-383
            # http://www.humanesociety.org/apps/protectseals/recommend.html
            match_not($path, /^\/apps\/protectseals\/recommend/) {
              # grab the headings for the data
              $("./div[1]") {
                $("./div[1]") {
                  remove() // first column label, not needed
                }
                $("./div[@class='mw_datum']") {
                  %index = index()
                  $(".//p") {
                    var("heading_" + %index, fetch(".//text()"))
                  }
                  remove()
                }
              }
            }
            # tweak test titles
            $("./div[@class='mw_test_row']") {
              # trim nbsps at the beginning of strings
              $(".//p|.//strong|.//div") {
                inner() {
                  replace(/^[\s]*/, '')
                }
              }
              $("./div[@class='mw_datum']") {
                remove("@align")
              }
              $("./div[1]") {
                remove(".//br")
                add_class("mw_h2")
                text() { }
                wrap_text_children("strong")
                
                # HSUS-383
                match($path, /^\/apps\/protectseals\//) {
                  # div/p , div/strong
                  $("self::div/*") {
                    match(text(), /^\*/) {
                      $("ancestor::div[1]/following-sibling::div[1]//label") {
                        add_class("mw_Required")
                      }
                    }
                  }
                  remove()
                }
              }
              $("./div[@class='mw_datum' and .//img]") {
                add_class("mw_animals")
                remove(".//br")
                insert("div", class:"mw_animal_imgs") {
                  move_here("..//img")
                  move_to("..", "top")
                }
              }
              insert("div", class:"mw_test_text") {
                move_here("../div[not(contains(@class, 'mw_h2'))]")
                $("./div[contains(@class, 'mw_datum')]") {
                  %index = index()
                  insert_top("strong") {
                    inject(var("heading_" + %index))
                  }
                }
              }
            }
          }
        }
        # End of HSUS-470  
        $(".//iframe") {
          remove("@height")
          remove("@width")
        }
        
        # forms are on protect seals app pages
        $(".//form") {
          add_class("mw_appform")
          $(".//*") {
            remove("@cols")
          }
          $(".//td[label[@for='cons_email_opt_in']]") {
            add_class("mw_checkboxrow")
          }
          $(".//p[input[@class='Button']]") {
            add_class("mw_buttonrow")
            $("./input") {
              wrap("span", class:"mw_button")
            }
            
            # HSUS-383
            match($path, /^\/apps\/protectseals\//) {
              add_class("mw_flex_box")
              $("./span") {
                add_class("mw_flex_box_item_1")
              }
            }
          }
        }
      }
    }
    # HSUS-317 Horizontal styling to boxes in bottom of page
    # side bar
    $(".//div[@id='side']") {
      remove("./br")
      $(".//a[@class='more']") {
        inject("  &raquo;  ")
      }
      $(".//div[@id='related-content']") {
        add_class("mw_sidebar3")
        $(".//h2") {
          add_class("mw_h2")
        }
        $("./div[@class='module'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./div[@class='module']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/div[@class='module']") {
          add_class("mw_flex_box_item_1")
          $("./h3/a") {
            inject("  &raquo;  ")
          }
        }
      }
      $(".//div[@id='magazine-promo']") {
        add_class("mw_sidebar7")
      }
      $("./ul[@id='action'][./li[@id='donate']]") {
        add_class("mw_sidebar1_h")
      }
    }
}
$("./body") {
  add_class("mw_drtv_splash")
  $("./div[@id='ga-container']/div[@id='ga-content']") {
    $("./table") {
      remove(".//@style | .//@align |.//hr | .//tr[./td[not(*)]]")
      # header
      move_here(".//div[@id='ga-header']", "before")
      $(".//table[./tr/td/table[@id='formtop']]") {
        $("./tr/td/table[@id='formtop']") {
          add_class("mw_box2")
          $("./tr/td") {
            remove("./br")
            $("./p[1]") {
              add_class("mw_title")
            }
          }
          $("./tr[./td/a]") {
            add_class("mw_left_content")
            $("./td[1]") {
              move_here("./ancestor::table[@id='formtop']/tr/td/p[position() > 3]","before")
            }
            # donate button
            $("./td/a[./img]") {
              inner(fetch("./img/@alt"))
              add_class("mw_btn2")
            }
          }
          # donate monthly box
          move_here("./ancestor::tr[1]/td[last()]/table", "bottom") {
            add_class("mw_right_video")
            $("./tr/td[./img[not(@border)]]") {
              inner(fetch("./img/@alt"))
              add_class("mw_img_alt")
            }
            $('./td[./img]') {
              inner("Your gift as a monthly donor")
              add_class("mw_img_alt")
            }
            # donate button
            $("./tr/td[./a]") {
              add_class("mw_donate_btn")
              $("./a") {
                inner(fetch("./img/@alt"))
                add_class("mw_btn2")
              }
            }
          }
        }
        $(".//div[@id='FAQsection']") {
          add_class("mw_box2")
        }
      }
      
    }
    table_dump("//table")
  }
  $("./div[@style]") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_drtv_donation")
  $(".//select") {
    wrap("div", class:"mw_select_box")
    insert("div", class:"mw_arrows")
  }
  $("./table") {
    insert_after("div", class:"mw_content")
    $(".//table[@id='body']/tr") {
      # top section
      $("./td[./table[@id='formtop']]") {
        name("div")
        remove(".//@style | .//@width")
        add_class("mw_formtop")
        move_here(".//td", "bottom") {
          name("div")
        }
        $("./div[./img[@alt='check']]") {
          add_class("mw_check")
        }
        $("./div[./p]") {
          add_class("mw_text_wrap")
        }
        $("./div[not(@class)][./img]") {
          add_class("mw_img_wrap")
        }
        remove("./table")
        move_to("./ancestor::body[1]/div[@class='mw_content']", "bottom")
      }
      # end of top section

      # donate form
      $("./td[./form]") {
        name("div")
        remove("./@style")
        add_class("mw_form")
        # monthly and one time button
        insert_top("div", class:"mw_gift_button") {
          $temp_type=fetch("./ancestor::table[@id='body']//table[@id='monthlytabs']/@id | ./ancestor::table[@id='body']//table[@id='onetimetabs']/@id")
          add_class("mw_" + $temp_type)
          move_here("./ancestor::table[@id='body']//table[@id='monthlytabs']//a | ./ancestor::table[@id='body']//table[@id='onetimetabs']//a", "bottom") {
            text(fetch("./img/@alt")+" Gift")
            remove("./img")
          }
        }
        # end of monthly and one time button

        # main form
        $("./form") {
          $("./table") {
            add_class("mw_main")
          }
          $("./fieldset") {
            add_class("mw_amount")
            remove(".//@style")
          }
          # remove the extra border
          remove("./table/tr[./td/img[not(@alt)]]")
          $("./table/tr[1]/td") {
            remove("./span/@style | ./@style")
            add_class("mw_main_title")
            # Payment Information
            $("./self::td[./img[@alt='Payment methods']]") {
              add_class("mw_payment")
            }
            # end of Payment Information
          }
          $(".//td[./input[@type='checkbox']]") {
            add_class("mw_check_address")
          }
          # for Card Security Code/CVV:
          $(".//table[@id='paymentinfo']//td[./span]") {
            add_class("mw_label")
          }
          # end of Card Security Code/CVV:
          $(".//table[@id='shippingaddressfields']/tr/td[./span]") {
            add_class("mw_main_title")
            remove("./span/@style | ./@style")
          }
          $(".//input[@id='donate_button']") {
            btn_delegate()
            $("./preceding-sibling::div[1]") {
              add_class("mw_btn2")
            }
          }
        }
        move_to("./ancestor::body[1]/div[@class='mw_content']", "bottom")
      }
      # "Know more" & "Other Ways"
      $("./td[./table//div[@id='FAQsection']]") {
        name("div")
        remove("./@style")
        add_class("mw_bottom_section mw_flex_box")
        insert_bottom("div", class:"mw_other mw_flex_box_item_1") {
          move_here("./preceding-sibling::table[1]//table/tr/td", "bottom") {
            name("div")
            remove(".//@style")
            $("./self::*[./img]") {
              add_class("mw_h3")
              text(fetch("./img/@alt"))
              remove("./img")
            }
          }
        }
        move_here(".//div[@id='FAQsection']", "botttom") {
          add_class("mw_flex_box_item_1")
        }
        remove("./table")
        move_to("./ancestor::body[1]/div[@class='mw_content']", "after")
      }
    }
    remove()
  }
}
$("./body") {
  add_class("mw_drtv_base")
  # header
  $("./table") {
    move_here("./tr/td[./img]", "before") {
      name("div")
      remove("./@width")
      add_class("mw_drtv_header")
    }
  }
  $(".//div[@id='ga-header'] | ./div[contains(@class, 'mw_drtv_header')]") {
    $("./img") {
      attributes(src: "http://www.humanesociety.org/assets/images/1024x256-tablet-mastheads/drtv-2013-tblt.jpg")
    }
  }
  # end of header

  # FAQ section
  $(".//div[@id='FAQsection']") {
    remove("./@style")
    $("./p[@class='faqheadline']") {
      add_class("mw_h3")
    }
    $("./p[@class='question']") {
      add_class("mw_bar6")
      remove("./img")
      attributes(data-ur-toggler-component:"button", id:"")
      wrap("div", data-ur-set:"toggler") {
        move_here("./following-sibling::*[contains(@id, 'answer')][1]", "bottom") {
          add_class("mw_answer")
          attributes(data-ur-toggler-component:"content", style:"")
          $("./ul") {
            add_class("mw_list1")
          }
        }
      }
    }
  }
  # end of FAQ section
}
$("./body") {
  add_class("mw_drtv_thank")
  # move table section
  $("./table") {
    insert_after("div", class:"mw_content")
    $(".//table[@id='body']/tr") {
      $("./td") {
        inner_wrap("div", class:"mw_section") {
          move_to("./ancestor::body/div[@class='mw_content']")
        }
      }
    }
    remove()
  }

  $("./div[@class='mw_content']") {
    remove("./div/table[@id='formtop']/..")
    remove("./div/table[@id='monthlytabs']/..")
    remove("./div/span[@class='Apple-style-span']/..")
    # content
    $("./div/div[@id='rightCol-main-content']") {
      remove(".//@style | .//@valign")
    }

    # "Know more" & "Other Ways"
    $("./div[./table//div[@id='FAQsection']]") {
      remove("./@style")
      add_class("mw_bottom_section mw_flex_box")
      insert_bottom("div", class:"mw_other mw_flex_box_item_1") {
        move_here("./preceding-sibling::table[1]//table/tr/td", "bottom") {
          name("div")
          remove(".//@style")
          $("./self::*[./img]") {
            add_class("mw_h3")
            text(fetch("./img/@alt"))
            remove("./img")
          }
        }
      }
      move_here(".//div[@id='FAQsection']", "botttom") {
        add_class("mw_flex_box_item_1")
      }
      remove("./table")
    }
  }
}
# Main "Campaign" page
# http://www.humanesociety.org/issues/campaigns
#

# Feb 8 2013 Sarah LaFrance

$("./body") {
  add_class("mw_campaigns")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")
  # remove(".//p[string-length(text())= 1]")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }


  $(".//div[@id='side']") {
    remove("./div") // what even is this
  }
  $(".//div[@id='main']/p[not(*)]") {
    match(fetch("./text()"), /\A[\s ]*\Z/) {
      remove()
    }
  }
}
# Main "Action" page
# http://www.humanesociety.org/action
#

# Feb 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_action")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")

  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='main']") {
    # grab the action items out of the action box
    # This is an action page!
    move_here("..//ul[@id='action']//ul", "top") {
      remove("@style")
      add_class("mw_top_menu")
      $("./li") {
        remove("@style")
        $("./a") {
          add_class("mw_bar3")
        }
      }
    }
    insert("div", class:"mw_container") { // let's consolidate
      move_here("../ul[@id='tools']")
      move_here("../div[contains(@class, 'section')]")
    }

    $("./ul[@id='featurette']") {
      move_to("..", "bottom")
    }
  }

  $(".//div[@id='side']") {
    $("./ul") {
      move_here("./span/li") // de-nesting
      remove("./span")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
  }
}
# Main "Issues" page
# http://www.humanesociety.org/issues
#

# Feb 8 2013 Sarah LaFrance

$(".//body") {
  add_class("mw_issues")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//ul[@id='issue-browser']") {
    $("./li") {
      attributes(data-ur-set:"toggler")
      $("./a") {
        attributes(data-ur-toggler-component:"button", class:"mw_issue_button")
        remove("@href")
        insert("div", class:"mw_plusminus")
      }
      $("./ul") {
        attributes(data-ur-toggler-component:"content", class:"mw_sublist")
        $(".//a") {
          inject("  &raquo;  ")
        }
      }
    }
  }

  $(".//div[@id='side']") {
    remove("./div") // what even is this
  }
}
# Main "Issues" page
# http://www.humanesociety.org/issues/chimpanzee_research
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_issue_cat")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  # remove(".//br")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[contains(@id, 'item-')]") {
    remove("@style")
    $(".//script") {
      inner() {
        replace(/width: "[\d]*"/, 'width: "100%"')
        replace(/height: "[\d]*"/, 'height: "300px"')
      }
    }
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3 | .//p[@class='author' or @class='subhead']") {
    add_class("mw_h3")
  }

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  $(".//a[contains(@class, 'back')]") {
    inner() {
      prepend("  &laquo;  ")
    }
  }

  # main content
  $(".//div[@id='main']") {
    $(".//img") {
      remove("@align")
    }

    # apply a class to the youtube video
    $(".//div[iframe[contains(@src, 'youtube')]]") {
      add_class("mw_feature_video")
    }
    
    $(".//div[@id='feature']") {
      insert("div", class:"mw_save_seals") {
        move_here("../*[not(@id='images') and not(@id='tools')]")
        remove("./div[not([iframe])]") #remove child divs not containing an iframe
        $("./a[not(@class) and not(h2)]") { // the get app button
          add_class("mw_get_app")
          move_to("..", "bottom")
        }
      }
    }
    # HSUS-270 Image not pulling on Issues page
    $(".//div[@class='video']") {
      $("./div[@class='video-player']/h2//div[@id='images']/ancestor::div[contains(@id,'image')][1]") {
        add_class("mw_video_image")
        remove("./@style")
      }
      # $(".//h2") {
      #         text() {
      # 
      #         }
      #       }

      /*$(".//iframe)") {
        add_class("mw_testing")
        remove("./@width")
        remove("./@height")
      }*/
    }
    $(".//div[contains(@class, 'area-news')]") { // handle any bottom links
      wrap_together("./a", "div") {
        add_class("mw_news_links")
      }
    }
    $(".//div[contains(@class, 'area-news') or contains(@class, 'victories')]//li") { // news item
      insert_top("div", class:"mw_news_title") {
        move_here("../p[@class='image']")
        move_here("../p[@class='date']")
        move_here("../h3")
        move_here("../p[@class='excerpt']")
      }
    }
    # different news section format:
    $(".//div[contains(@class, 'area-news')]") {
      wrap_text_children("span")
      remove("./span")
      $(".//div[contains(@id, 'templatelist') and not(ul)]") {
        remove("@style")
        remove(".//hr")
        $(".//p[@class='image']") {
          wrap("div") {
            attribute("class", "mw_news_title")
            move_here("following-sibling::p[@class='date'][1]")
            move_here("following-sibling::h4[1]") {
              add_class("mw_h3")
            }
            move_here("following-sibling::p[1]")
          }
        }
      }
    }
    # HSUS-98: Paragraph breaks
    # URL: http://www.humanesociety.org/issues/cosmetic_testing/index.html
    $("./div[contains(@class, 'section-lead')]") {
      $("./ul") {
        remove("./@style")
        add_class("mw_list1")
      }
      $("./h2/following-sibling::p[1]") {
        wrap_text_children("span")
        $("./span[1]") {
          add_class("mw_break_p")
          move_here("./following-sibling::span[1] | ./following-sibling::span[2]", "bottom")
        }
      }
    }
    
    # HSUS-105
    # URL: http://www.humanesociety.org/issues/cosmetic_testing/becrueltyfree/
    $("./div[@id='pledgeform']") {
      # remove extra img and donate btn
      remove("./img[contains(@alt, 'Pledge')] | ./img[contains(@alt, 'pledge')] | .//div[@class='pledge-donate-btn']")
      $("./div[@class='pledge-form']") {
        insert_top("div", class: "mw_pledge_title", "Global Pledge to Be Cruelty-Free")
        $(".//form[@id='actionform']") {
          $("./input[@class='pledge-submit-btn']") {
            attributes(alt: fetch("./@alt"), onclick: "window.scrollTo(0,1);")
            btn_delegate() {
              add_class("mw_pledge_btn")
            }
          }
        }
        $(".//div[@id='thankyou']") {
          remove(".//a/text()")
        }
      }
      $("./following-sibling::div[@id='features']/ul/li") {
        add_class("mw_pledge_list")
        $("./p[@class='image']") {
          move_here("./preceding-sibling::h3", "after")
        }
      }
    }
    # end of HSUS-105
    
    $("./div[contains(@class, 's_borderless') or contains(@class, 'section')]") {
      # desktop site hide
      remove("./div[@class='video-player']")
      $("./p[./span[not(.//a)]]") {
        add_class("mw_h3")
      }
      $("./div[contains(@class, 'section')]/p") {
        add_class("mw_issue_p")
      }
      $("./p[not(@class)]") {
        add_class("mw_issue_p")
        $("./a[starts-with(text(), '»')]") {
          add_class("mw_arrow_link")
        }
        $("./a") {
          match(text(), /^\W\s$/) {
            $("./following-sibling::a[1]") {
              add_class("mw_arrow_link")
            }
            remove()
          }
          text() {
            replace(/^\W\s/, "")
          }
        }
      }
    }
    $("./div[@id='features']/ul/li") {
      inner_wrap("div", class:"mw_feature_article") {
        move_here("./p[@class='image']", "before")
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    $("./div[@id='seals-app']") {
      $(".//a[contains(@class, 'more')]") {
        add_class("mw_get_app")
      }
    }

    $(".//div[@id='relatedissues-promo' or @id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h1")
      }
    }
    $(".//div[@id='resources-promo']") {
      add_class("mw_sidebar9")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%; height: 300px")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  $(".//a[contains(text(),'AltTox.org')]") {
    add_class("mw_alttox")
  }
  # hide bread crumb
  $(".//div[@id='contentDiv']/div[@class='no-banner']//div[@id='feature']/div[@class='mw_save_seals']") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_gigyalogin")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//br")

  $(".//div[@id='contentDiv']") {
    remove(".//@style")
    $("./div[not(*)]") {
      match(fetch("./self::text()"), /\A[\s ]*\Z/) {
        remove()
      }
    }
  }
}
## HSUS - 443

$("./body") {
  add_class("mw_actform_mconnect")
  $("./div[@id='container']") {
    $("./table[@id='title-text']//p") {
      name("h1")
      add_class("mw_h1")
    }
    $("./table[@id='target']") {
      remove("@style|@height|@align|@width") 
      $(".//td") {
        remove("@align")
      }  
      $(".//p") {
        name("h2")
        add_class("mw_h2 mw_center")
      }
    }
    $("./table[@id='main-text']") {
      remove("@style|@height|@align|@width")
      $(".//td") {
        remove("@align")
      }
    }
    $("./table[@id='gray-text']") {
      remove("@width|@align|@height")
      $(".//td") {
        remove("@align")
      }
      move_to("./following-sibling::div[@id='form']", "top")
    }
    $(".//form/table[@id='mconnect-phoneandzip' or @id='basic']") {
      remove("@width|@align")
      $(".//input") {
        remove("@style")
      }
      $(".//input[@id='submit-button']") {
        attribute("value", "CALL NOW")
        $("..") {
          add_class("mw_center")
        }
      }
    }
    $(".//table[contains(@id,'logo')]") {
      remove("@style") {
        $(".//td") {
          remove("@align")
        }
      }
      move_to("./ancestor::div[@id='form']", "after")
    }
  }
  
  $jsRemove = "$('form').submit(function() { $('#logo1').remove();$('#logo2').remove(); })"
  insert_javascript_at(position("bottom"),$jsRemove)

}
$("./body") {
  add_class("mw_protect_seals_pledge")
  
  # Remove the the powered by convio
  remove("./div[a[contains(@href, 'convio')]]")
  
  $("./div[@id='ga-container']/div[@id='ga-content']/table") {
    move_here(".//div[@id='ga-header']", "before")
    move_here(".//form[contains(@action, 'Survey')]", "before") {
      add_class("mw_box2")
      
      # page title
      $("./div[@class='appArea']/h3") {
        add_class("mw_h3")
      }
      
      # form table
      $("./div[@class='appArea']/table") {
        remove("./tr[1]")
        # remove empty td
        $(".//td[not(*)]") {
          match(text(), (/\A\s+\Z/)) {
            remove()
          }
        }
        $(".//p[not(*)]") {
          match(text(), (/\A\s+\Z/)) {
            remove()
          }
        }
        
        # dump table
        $(".//table | .//tr | .//td") {
          name("div")
        }
        
        $(".//div[@class='old-school']/div/div[@cellpadding='0']") {
          add_class("mw_was_table")
          $("./div[./div[position() > 2]]") {
            insert_top("div", class:"mw_input_title") {
              move_here("following-sibling::div[position() < 3]")
            }
          }
          $(".//select") {
            wrap("div", class: "mw_select_arrows")
          }
          
          
          $("ancestor::div[@class='old-school'][1]") {
            add_class("mw_form mw_box3")
            move_here(" following-sibling::div[@class='old-school']")
            
            insert("div", class: "mw_phone_box") {
              move_here("preceding-sibling::div[@class='old-school'][.//img[contains(@src, 'pagebuilder')]]") {
                $("./div/p") {
                  name("div")
                  add_class("mw_phone_text")
                  wrap_text_children("span")
                }
              }
              move_here("preceding-sibling::div[@class='old-school'][./div/label/span[contains(text(), 'Mobile')]]")
            }
          }
        }
        
      }
      
      # button
      $("./div[@class='appArea']/p") {
        name("div")
        remove_text_nodes()
        $("./input") {
          add_class("mw_btn1")
        }
        insert_top("div", class: "mw_input_button") {
          move_here("following-sibling::input[not(contains(@value, 'Thanks'))]")
        }
      }
    }
    remove()
  }
}
# secure welcome page
# http://action.humanesociety.org/site/PageServer?pagename=humane_welcome_page&JServSessionIdr004=8w797fvbu1.app305b
#

# Feb 14 2013 Sarah LaFrance

$("./body") {
  add_class("mw_welcome")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//br")

  $(".//div[@id='contentDiv']") {
    remove("./div[not(@id)]")
    $(".//div[@id='wrapper-body']") {
      $("./p") {
        $("./a[not(*)]") {
          add_class("mw_more")
        }
      }
      remove("@style")
      $(".//*") {
        remove("@style")
      }
      $(".//iframe") {
        remove("@width")
        remove("@height")
      }
    }
  }

}
#  "Action" subsection page
# http://www.humanesociety.org/action/now
# http://www.humanesociety.org/action/fed_bill
# http://www.humanesociety.org/action/toolkit
#

# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press mw_news_base")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']") 
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[div[@id='wayne']]")

  $(".//li[@class='more']//a") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_no_display")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//p[@class='related']") {
    wrap_text_children("span")
  }

  # pagination stuff taken from press
  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
        # check for base cases and remove surrounding numbers
        match($previous) {
          with("false") { // we're on the first page of results
            remove("./div[position() > 4]")
          }
          with("true") {
            match($next) { // we're on the last page
              with("false") {
                remove("./div[position() < (("+$current+" mod 10)-3)]")
              }
              with("true") { // general case
                remove("./div[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
              }
            }
          }
        }
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//ul[@id='action']") {
      remove(".//li[@class='expanded']/ul")
      move_here("./span/li")
      remove("./span")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
  }

}
$(".//form") {
  #HSUS-426 adding in convio source tracking
  log("HSUS-426")
  log($path)
  # %s_src = $path
  log("----")
  $path {
    capture(/(s\_src\=[^&]+)/)
    {
      $s_src = $1
    }
  }
  # %s_src = $1
  match($s_src) {
    with($1) {
      log("$s_src matches $1")
      $1 = ""
    }
    else() {
      $1 = concat("&",$1)
    }
  }
  # hardcoding it as requested
  %s_subsource = "s_subsrc=mobile"
  log(concat("s_src: ", $s_src))
  log(concat("s_subsource: ", %s_subsource))

  # Construct a new form post action
  %post_action = fetch("./@action")
  # To avoid adding the source/subsource multiple times
  match_not(%post_action, %s_subsource) {
    log("applying s_src & s_subsrc")
     %post_action {
       replace($s_src, "")
     }
     log("-- post_action --")
     log(%post_action)
     match(%post_action) {
      # if there are no other post arguments, make the $s_src first
      with(/\?/) {
        log("s_src is not the first variable")
        attributes(action: concat(%post_action,"&", $s_src, "&", %s_subsource))
      }
      else() {
        
        log("s_src is the first variable")
        attributes(action: concat(%post_action,"?", $s_src, "&", %s_subsource))
      }
     }
    
  }
   
}
# http://www.humanesociety.org/action/alerts/maryland/
# action alerts

$("./body") {
  add_class("mw_action_alerts")
  $(".//div[@id='page']") {
    add_class("mw_box2")
    $(".//div[@id='page-bottom-spacer']") {
      add_class("mw_hide")
      remove("@style")
    }
    remove("./div[@id='page-head']")
    $("./div[@id='contentDiv']") {
      remove("./div[@id='head']")
      $("./div[@id='cols']") {

        # content section
        $("./div[@id='main']") {
          $(".//h2") {
            add_class("mw_h2")
          }
          $(".//div[@id='top-pagination']"){
            add_class("mw_search1")
            $(".//label") {
              wrap_text_children("span")
              add_class("mw_flex_box")
            }
            $(".//input") {
              add_class("mw_flex_box_item_2")
            }
            $(".//button[@type='submit']") {
              add_class("mw_btn5")
              text("")
            }
          }
        }

        # right-nav
        $("./div[@id='side']/ul") {
          add_class("mw_sidebar1_h")
        }
      }
    }
  }
}
# Spay Day issue page
# http://www.humanesociety.org/issues/spay_day
# modified version of issue_subject.ts

# March 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_issue_cat")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//br")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[contains(@id, 'item-')]") {
    remove("@style")
    $(".//script") {
      inner() {
        replace(/width: "[\d]*"/, 'width: "100%"')
        replace(/height: "[\d]*"/, 'height: "300px"')
      }
    }
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3 | .//p[@class='author' or @class='subhead']") {
    add_class("mw_h3")
  }

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  $(".//a[contains(@class, 'back')]") {
    inner() {
      prepend("  &laquo;  ")
    }
  }

  $(".//div[@id='main']") {
    $(".//div[contains(@class, 'section-lead')]") {
      $("./p[count(.//a)=3]") {
        add_class("mw_spay_p")
      }
    }
    $(".//div[contains(@class, 'area-news')]") { // handle any bottom links
      wrap_together("./a", "div") {
        add_class("mw_news_links")
      }
    }
    $(".//div[contains(@class, 'area-news') or contains(@class, 'victories')]//li") { // news item
      insert_top("div", class:"mw_news_title") {
        move_here("../p[@class='image']")
        move_here("../p[@class='date']")
        move_here("../h3")
        move_here("../p[@class='excerpt']")
      }
    }
    $("./div[contains(@class, 's_borderless') or contains(@class, 'section')]") {
      # desktop site hide
      remove("./div[@class='video-player']")
      $("./p[./span[not(.//a)]]") {
        add_class("mw_h3")
      }
      # $("./div[contains(@class, 'section')]/p") {
      #   add_class("mw_spay_p")
      # }
      # $("./p[not(@class)]") {
      #   add_class("mw_spay_p")
      # }
    }
    $("./div[@id='features']/ul/li") {
      inner_wrap("div", class:"mw_feature_article") {
        move_here("./p[@class='image']", "before")
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    $("./div[@id='seals-app']") {
      $(".//a[contains(@class, 'more')]") {
        add_class("mw_get_app")
      }
    }

    $(".//div[@id='relatedissues-promo' or @id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h1")
      }
    }
    $(".//div[@id='resources-promo']") {
      add_class("mw_sidebar2")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%; height: 300px")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  $(".//a[contains(text(),'AltTox.org')]") {
    add_class("mw_alttox")
  }

}
# current url - http://www.humanesociety.org/testing/hsus_testing/editorial/protect_seals_1.html
# future url - http://www.humanesociety.org/issues/seal_hunt/2013_hunt/home.html

# when this file is moved to live, uncomment it's mapping in mappings.ts in the work section
# seal splash action action page

# March 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_sealsplat")

  # hide unneeded sections
  $(".//iframe[@id='hiddenframe']") {
    add_class("mw_hide")
  }
  # HSUS-525- Start
  $(".//div[@id='infographiccontents']|.//div[@id='top_band']") {
    add_class("mw_hide")
  }
  $(".//div[@id='head']") {
    remove("./@style")
  }
  # End HSUS-525
  # main content
  $(".//div[@id='page']") {
    $(".//div[@id='puppy-mills']") {
      add_class("mw_box2")
    }
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//div[@id='cols']/div[@id='side']/div[@id='related-content']") {
      add_class("mw_sidebar2 mw_relate_content")
    }
    remove(".//div[@id='page-head']")
    # no top headline
    $(".//div[@id='main']") {
      $(".//div[contains(@class,'section-lead')]") {
        move_here("following-sibling::div[@id='feature']")
      }
    }
    $(".//p") {
      inner() {
        replace(/\s+/, " ")
      }
    }
    # HSUS-525 - End
    # video and leadin; number links rotate carousel
    $(".//div[@id='billboard']") {
      attributes(data-ur-carousel-component:"view_container", data-ur-set:"carousel", data-ur-infinite:"disabled", data-ur-fill:1, data-ur-autoscroll:"disabled" )
      insert_bottom("span", id:"mw_carousel_dots", data-ur-carousel-component:"dots" )

      wrap_together("./div", "div") {
        attributes(data-ur-carousel-component:"scroll_container")

        $("./div") {
          remove("./@style")
          attributes(data-ur-carousel-component:"item")
          $("./self::div[not(./iframe)]") {
            remove("./a[@id='infographicimagelink']/text() | ./div[@id='appstoretext']/a")
          }
        }

        $("./div[@id='page2']/div[@id='appstoreimagelink']") {
          insert_top("img", src:"https://secure3.convio.net/humane/images/content/pagebuilder/seals2012-qr2.gif")
          wrap_text_children("span", class:"mw_app_text")
        }

        $("./div[@id='page3']") {
          $("./a[@id='infographicimagelink']") {
            insert_top("img", src:"http://www.humanesociety.org/assets/images/logos_odd_sizes/seal_bb_infographic.jpg")
          }
          
          # replace their JS popup with a link to the image
          $(".//a[contains(@href,'popupInfographic')]") {
            attribute("href", "http://www.humanesociety.org/assets/images/logos_odd_sizes/seals_infograph_2012.jpg")
          }
        }
      }
    }

    # share bar
    $(".//div[@id='sharethispage']") {
      move_to("..", "top")

      # Adding a label
      insert_top("div", class:"share_label", "Share: ")

      # Just wrap the text children so we can hide them. Good idea Sarah!
      $("./a") {
        wrap_text_children("span")
      }
    }




    # form to pledge
    $(".//div[@id='sidebar']") {
      move_here("../a") // grab donate now button
      $("./a") {
        wrap("div", id:"mw_donate_btn")
      }
    }
    # twitter feeds and links
    $(".//div[@id='lowercontent']") {
      # twitter feed
      # a lot of this content isn't being pulled in
      # the javascript to grab other tweets isn't loading
      $("./div[@id='twitterfeeds']") {
        $(".//div[@id='livefromtheice']") {
          move_here(".//span[@class='twuser']", "top")
          move_here("./a[@id='followrebecca']", "top")
        }
        $(".//a[@id='mortweets']") {
          inject("  &raquo;  ")
        }
      }
      # news and get the app
      $("./div[@id='contentstories']") {
        $(".//div[@class='story']") {
          move_here(".//div[@class='storytext']/a")
          $(".//a[./img]") {
            attribute("class", "mw_border_img")
          }
          $(".//img[not(./ancestor::a[contains(@class, 'mw_border_img')][1])]") {
            wrap("div", class:"mw_border_img")
          }
          $(".//a[@class='mw_border_img'] | .//div[@class='mw_border_img']") {
            wrap("div", class:"mw_center_img")
          }
        }

        remove(".//br")
        # add raquos to the more links that need them
        $(".//a[@class='storymainlink' or @id='mediacontacts' or @id='morenews']") {
          inject("  &raquo;  ")
        }
      }
    }

    #prep the footer for styling
    $("./div[contains(@class, '_footer')]") {
      move_to("//div[@id='contentDiv']")
      $(".//div[@id='footer']") {
        attribute("id", "foot")
        remove("./div[@id='footerseals']")
        $("./ul/li[1]") {
          add_class('mw_footer_copyright')
          wrap_text_children("span")
          remove("span[2]")
          text() {

          }
        }
        $(".//li[./a and position()>1]") {
          add_class("mw_link_center")
          $("./a") {
            add_class("mw_bar2")
            remove("@style")
          }
        }
      }
    }
  }
  # Fix for HSUS-525
  $(".//div[@id='relatedissues-promo']") {
    add_class("mw_sidebar3")
  }
  $(".//div[@id='resources-promo']") {
    add_class("mw_sidebar9")
  }
  # Fix for HSUS-525
  $(".//p[@class='image']") {
    wrap("div") {
      attribute("class", "mw_news_title")
      move_here("following-sibling::p[@class='date'][1]")
      move_here("following-sibling::h4[1]") {
        add_class("mw_h3")
      }
      move_here("following-sibling::p[1]")
    }
  }
 # Fix for HSUS-525
}
# Main "Our Work" page
# http://www.humanesociety.org/work
#

# Feb 8 2013 Sarah LaFrance

$(".//body") {
  add_class("mw_work")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
  }

  $(".//div[@id='main']") {

    $(".//div[@id='animalaccord']") { //main topic togglers
      remove(".//div[@class='clear']")
      $(".//div[@class='menu_head']/p") {
        move_to("../following-sibling::div[1]", "top") // text needs to go in content
      }

      $(".//div[@class='menu_head']") {
        add_class("mw_flex_box")
        wrap("div", class:"mw_animal_accord") {
          attributes(data-ur-set:"toggler")
          move_here("./following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content") {
              $(".//a") {
                add_class("mw_animal_button")
              }
            }
          }
        }
        attributes(data-ur-toggler-component:"button") {
          $("./img") {
            insert_after("div", class:"mw_plusminus")
            $("following-sibling::span") {
              add_class("mw_flex_box_item_1")
            }
          }
        }
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='bluenav']") {
      add_class("mw_box8")
      $(".//a") {
        add_class("mw_more")
        inject("  &raquo;  ")
      }
    }
  }
}
# faqs under issues
#

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_qanda")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  # main content
  $(".//div[@id='main']") {
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//div[@id='feature']") {
      move_here("..//ul[@id='tools']", "top")
      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    $(".//div[contains(@class, 's_borderless')]") {
      match($path) {
        with(/issues\/cloning\/qa/) {
          #HSUS-451: workaround for this url since it is on a different format than the others
          # dont remove the ul
        }
        else() {
          remove("./ul[1]")
        }
      }
      remove(".//hr")
      # remove back to top button
      remove("./p[./a[contains(text(),'back to top')]]")
      $("./strong") {
        wrap("p", class:"mw_question")
      }
      $("./p[./strong]") { // question
        add_class("mw_question")
      }
      # remove the p without any content in it
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
      $("./p[@class='author']") {
        add_class("mw_hide")
      }
      $("./ul/preceding-sibling::p[1]") {
        add_class("mw_question_ul")
      }
      # HSUS-120
      # http://www.humanesociety.org/animal_community/resources/qa/common_questions_on_shelters.html#How_many_animals_enter_animal_shelters_e
      $("./h3[contains(@class,'mw_h3')]") {
        wrap("div", class:"mw_qa_content")
      }
      $("./p") {
        move_to("preceding-sibling::div[@class='mw_qa_content'][1]")
      }
    }
  }


  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
  }

}
# secure join a pledge page
# https://mlocal.secure.humanesociety.org/site/Advocacy?cmd=display&page=UserAction&id=2823&autologin=yes&s_src=website&s_subsrc=campaigns
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_pledge")

  # remove
  # remove("./div[not(@id)]")
  # Remove the the powered by convio
  $("./div[a[contains(@href, 'convio')]]") {
    remove()
  }

  fixImages()

  #not sure what this was fixing...
  # HSUS-518 Content repeated
  remove(".//div[@class='showondesktop']")
  # HSUS-518 Content repeated

  # remove inline styling
  $(".//table") {
    remove("@style")
    remove("@bgcolor")
  }
  $(".//img") {
    remove("@align")
    remove("@width")
    remove("@height")
  }
  $(".//input") {
    remove("@size")
  }

  $(".//h1") {
    add_class("mw_h1")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//h3|.//span[@class='AlertListName']") {
    add_class("mw_h3")
  }

  $(".//div[@id='ga-content']/table/tbody") {
    remove("./tr[.//div[@id='ga-header']]")
    remove("./tr[./td[not(*)]]")
    $(".//table") {
      add_class("mw_level_2")
      #For HSUS-429 :Removed style attribute from the below code for  [Mobile] Increase Padding on Action Alert Images
      remove(".//@width | .//@height | .//@align")
      #End of HSUS-429 
      $("./tbody/tr/td") {
        add_class("mw_holder")
        $("./self::td[./img]") {
          add_class("mw_img_td")
        }
        #remove("./div[img]")
      }
    }
    $(".//div[@id='action-alert'] | .//div[@class='appArea']") { # everything's in here  
      
      insert_top("div", class:"mw_share_buttons") {
        insert("p") {
          text() {
            set("Share")
          }
        }
        move_here("..//div[@id='share_bar']")

        # For when they don't wrap their share buttons in a div#share
        move_here("..//a[contains(@href, 'addthis')] | ..//a[contains(@href, 'on.fb')]") {
          $("./img[contains(@src,'facebook')]/..") {
            add_class("addthis_button_facebook")
          }
          $("./img[contains(@src,'twitter')]/..") {
            add_class("addthis_button_twitter")
          }
        }

        # Checks to see if the div#share_bar already exists, if not, moves in the share buttons
        $("../div[@class='mw_share_buttons'][not(div)]") {
          insert("div", id:"share_bar") {
            move_here("../a")
            move_here("./div[@class='mw_share_buttons']/a")
          }
        }

        # insert("div", id:"share_bar") {
        #   move_here("../a")
        # }

        # check if the share bar is empty
        $("./div[not(node())]") {
          $("..") {
            attribute("style", "display: none;")
          }
        }

      }

      $(".//form") {
        # remove white space
        $("./p[not(*)][text()]") {
          text() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
        }
        # Make phone number fields bring up the number keypad by default
        $("./div[contains(@id, 'column')]/fieldset[@id='info']/table[contains(@class, 'mw_level_2')]//span[@class='NetscapeFix']/input | ./div[contains(@id, 'column')]/fieldset[@id='info']//input[@id='phone']") {
          attribute("type", "tel")
        }

        #HSUS-426 adding in convio source tracking
        # This has been moved to convio.ts
        # log("HSUS-426")
        # log($path)
        # # %s_src = $path
        # log("----")
        # $path {
        #   replace(/(s\_src\=[^&]+)/)
        # }
        # %s_src = $1
        # match(%s_src) {
        #   with($1) {
        #     log("%s_src matches $1")
        #     $1 = ""
        #   }
        #   else() {
        #     $1 = concat("&",$1)
        #   }
        # }
        # # hardcoding it as requested
        # %s_subsource = "s_subsrc=mobile"
        # log(concat("s_src: ", %s_src))
        # log(concat("s_subsource: ", %s_subsource))

        # Construct a new form post action
        # %post_action = fetch("./@action")
        # attributes(action: concat(%post_action, "&", %s_src, "&", %s_subsource))
      }


      $(".//p[img]") {
        add_class("mw_top_image")
        $("./img") {
          remove("@style")
          remove("@height")
          remove("@width")
          remove("@hspace")
        }
      }

      #HSUS-495 20131204 Start
      $(".//form/p[img]") {
        add_class('mw_read_more')
        $("./img") {
          move_to("../a")
        }
      }
      #HSUS-495 20131204 End

      $("./form/img") {
        wrap("div", style:"text-align:center;") {
          #For HSUS-429 :Removed style attribute from the below code for  [Tablet] Increase Padding on Action Alert Images
          add_class("mw_img_pad")
          #End of HSUS-429
        }
      }
      $(".//div[@id='mobileheadlinetext']") {
        wrap_text_children("h1") {
          add_class("mw_h1")
        }

      }
      # Move the 'message' into column1
      $("./form/fieldset[@id='message']") {
        move_to("../div[@id='column1']", "top")
      }
      # Move the intro text to the top of the form
      $(".//div[@id='column1']/*[not(@id='message')]") {
        move_to("../..")
      }

      $(".//div[@id='column2']") {
        move_to("..", "bottom")
      }

      $(".//div[@id='column1']") {
        move_to("..", "bottom")

        $(".//div[@class='field-wrap']/textarea[@id='middle']") {
          remove("./@cols")
        }
      }      

      $(".//div[contains(@class, 'bottom')]") {
        move_to("..", "bottom")
      }

      $(".//div[contains(@class, 'submit-wrap')]") {

      }
    }
  }

  # youtube video fixes

  $(".//iframe[contains(@src, 'youtube')]") {
    remove("./@height | ./@width")
    attribute("style", "width: 100%;")

  }

  #prep to add in the footer
  $(".//ul[@style]/ancestor::div[@style]") {
    add_class("mw_pledge_footer")
    attribute("id", "foot")
    remove("@style")

    $(".//*[@style]") {
      remove("@style")
    }
    $(".//li") {
      add_class("mw_link_center")
      $("./a") {
        attribute("style", "color: #a7a7a7;")
      }
      
    }
    remove(".//img")
  }

  $("//div[@class='_footer mw_box1']") {
    move_here("//div[@class=' mw_pledge_footer']", "top")
  }

  $(".//td[@class=' mw_holder'][p]/p[@style]") {
    add_class("mw_advocacy_suggestion")
    remove("@style")
  }

  # Use our <select> element identifiers
  $(".//select/..") {
    add_class("mw_select_arrows")
  }

  # custom keyboards
  $(".//input[contains(@name, 'email')]") {
    keyboard("email")
  }
  $(".//input[contains(@name, 'zip')]") {
    keyboard("numeric")
  }
  $(".//input[contains(@name, 'phone')]") {
    keyboard("tel")
  }

  # Hide the old share table.. with just the donation link
  $(".//a[contains(@href, 'donation')]") {
    add_class("mw_hide")
  }

  # HSUS-379 Webform Submission for Alerts page
  $("./div[@id='wrapper'][//form[@id='WebformInput']/div[@class='appArea']]/div[@id='page']") {
    remove("./div[@id='page-head']")
    $("./div[@id='contentDiv']") {
      remove("./div[not(@id='cols')]")
      $("./div[@id='cols']/div[@id='main']/div[@id='wrapper-body']") {
        remove("./@style")
        $("./form[@id='WebformInput']/div[@class='appArea']") {
          remove("./br | ./table//td/br | ./ancestor::div[@id='wrapper'][1]/br")
          $("./table//td/p") {
            %text_top = fetch("./text()") {
              replace(/\(\d+\)(\s|\d|\-)+(\w|\s|\.)+/, "")
            }
            %phone1 = fetch("./text()") {
              replace(%text_top, "")
              replace(/\s\D+\s.+/, "")
            }
            %phone1_value = %phone1
            %phone1_value {
              replace(/\D/, "")
            }
            %phone2 = fetch("./text()") {
              replace(%text_top, "")
              replace(/\(\d+\)(\s|\d|\-)+\w+\s/, "")
              replace(/\./, "")
            }
            %phone2_value = %phone2
            %phone2_value {
              replace(/\D/, "")
            }
            inner(%text_top+"<a href= tel:"+%phone1_value+">"+%phone1+"</a> or <a href= tel:"+%phone2_value+">"+%phone2+"</a>.")
          }
          $("./div[./img[contains(@src, 'webform.puzzle')]]") {
            add_class("mw_puzzle_img")
            wrap("div", class:"mw_puzzle_box") {
              move_here("./following-sibling::div", "bottom")
              inner_wrap("div", class:"mw_puzzle_input")
            }
            move_to("..", "before")
            $("./img") {
              attribute("src") {
                value() {
                  replace(/(\/|\w|\.)+org\//, "")
                }
              }
            }
          }
          $("./p[./input[@class='Button']]") {
            remove("./text()")
            $("./input[@type='submit']") {
              add_class("mw_puzzle_button")
              $("./self::input[@id='CNV_submit']") {
                add_class("mw_btn2")
              }
              $("./self::input[@id='CNV_cancel']") {
                add_class("mw_btn4")
              }
            }
          }
        }
      }
    }
  }
  # HSUS-495 - start
  $(".//form[@id='beanForm']") {
    remove(".//@style")
    $(".//iframe[contains(@src,'youtube')]") {
      $("..") {
        add_class("videoArea")
      }
    }
  }
  # HSUS-495 - end
}
# "Campaign" subcat page
# http://www.humanesociety.org/issues/campaigns/factory_farming
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_campaign_cat")

  # remove
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='petfinder-promo']")

  $(".//h2") {
    add_class("mw_h2")
    text() {

    }
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//div[@class='off-lead']/p") {
    add_class("mw_h3")
  }

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  # main content
  $(".//div[@id='main']") {
    remove("./div[@id='feature']")
    $(".//iframe") {
      remove("@width")
      remove("@height")
    }
    $(".//div[@id='features']") {
      $(".//li") {
        move_here("./p[@class='image']", "top")
      }
      $(".//p") {
        inner() {
          replace(/\xC2\xA0/, "")
        }
      }
    }
    
    $("./div[contains(@class, 's_borderless')]") {
      $("./h1") {
        add_class("mw_h1")
      }
      $("./p") {
        add_class("mw_campaign_p")
        $("./self::p[contains(@class, 'subhead')]") {
          add_class("mw_campaign_subtitle")
          move_here("./preceding-sibling::p[contains(@class, 'date')]", "after")
        }
      }
    }
  }


  # sidebar
  $(".//div[@id='side']") {
    remove("./div")
    ##HSUS - 442 - repeated donate button - one is styled with give-bttn class
    remove(".//li[@id='donate']/a[@class='give-bttn']")
  }

}
# Main recipe page
# http://www.humanesociety.org/issues/eating/recipes
# this is a lot like an issue subject landing but the recipe pages have tons of lists 
# for ingredients &c and I want those to look nice

# March 8 2013 Sarah LaFrance

$("./body") {
  add_class("mw_recipe_main")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2|.//p[@class='subhead' and string-length(text())>1]") {
    add_class("mw_h2")
  }

  # main content
  $(".//div[@id='main']") {

    $(".//h3|.//p[@class='author' and string-length(text())>1]") {
      add_class("mw_h3")
    }
    $(".//table") {
      $("following-sibling::*") {
        add_class("mw_after_tbl")
      }
    }

    $(".//div[div[@id='images']]") {
      remove("@style") // unfloat this
    }
    # shuffle everything around into 2 sections
    insert("div", class:"mw_recipes") {
      move_here("..//table")
      move_here("..//*[contains(@class, 'mw_after_tbl')]")
    }
    insert("div", class:"mw_top_section") {
      remove("preceding-sibling::div[@id='feature']")
      move_here("//ul[@id='tools']")
      move_here("//div[contains(@class, 's_borderless')]/*")
      move_to("..", "top")
    }
    remove(".//div[contains(@class, 's_borderless')]")

    $(".//div[@class='mw_recipes' and not(table)]") {
      remove()
    }
    $(".//div[@class='mw_recipes']") {
      $(".//table") {
        $(".//tr") {
          $(".//td") {
            name("div")
            attributes(class:"mw_td")
          }
          name("div")
          attributes(class:"mw_tr")
        }
      }
      insert_top("div", class:"mw_recipe_list") {
        move_here("//div[@class='mw_tr']")
        $(".//div[@class='mw_td' and ./a[@name]]") {
          attributes(data-ur-set:"toggler")
          $("./a") {
            attributes(data-ur-toggler-component:"button", class:"mw_bar3")
            insert("div", class:"mw_plusminus")
          }
          move_here("../following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content", class:"mw_recipe_bar")
          }
          remove("following-sibling::div") // spacer
        }
        remove("./div[@class='mw_tr' and not(div[@align])]") // more spacers
        $(".//*") {
          remove("@align")
          remove("@valign")
          remove(".//br")
        }
      }
      remove(".//table")
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7") // style this
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
    }
  }
}
$("./body") {
  add_class("mw_action_elected")
  # remove top image
  remove("//img[@id='desktop_head']")
  $("./div[@id='wrapper']/div[@id='page']") {
    remove("./div[@id='page-head']")
    $("./div[@id='contentDiv']") {
      add_class("mw_box2")
      move_here(".//div[@class='section'] | .//form[@id='findrepcomponent'] | .//script[contains(@src, 'findreps.js')]", "bottom")
      remove("./div[@id='head'] | ./div[@style][not(*)] | ./div[@id='cols']")
      $("./div[@class='section']") {
        $("./h2") {
          add_class("mw_h2")
        }
      }
      $("./form[@id='findrepcomponent']") {
        add_class("mw_light_gray_box")
        remove(".//br")
        move_here("./div[@id='findreps_top']/div[@id='findreps_top_text']", "before") {
          add_class("mw_h2")
        }
        $("./table[@class='findrepZipEntry'] | ./div[@id='findreps_top']/table[@class='findrepComponent']") {
          $("./tr[./td/input[@id='zip']]/td") {
            remove("./text()")
            $("./label[@for='zip']") {
              add_class("mw_block")
            }
          }
          $(".//input[@id='zip'][@type='text']") {
            add_class("mw_input")
            move_here("../following-sibling::td/input[@class='Button' or @class='findreps-button'][@type='submit']", "after")
          }
          $(".//input[@class='Button' or @class='findreps-button'][@type='submit']") {
            add_class("mw_btn4")
          }
          $("./tr[./td[@align='center']]") {
            add_class("mw_center")
            remove("./td/@align")
            move_here("./td/a", "bottom")
            remove("./td")
          }
        }
        $("./div[@id='findreps_top']/table[@class='findrepComponent']//table[@class='findreps-outer-table']") {
          $(".//td[not(*)][text()] | .//p[not(*)][text()]") {
            match(text(), (/\A\s+\Z/)) {
              remove()
            }
          }
          $(".//div[@class='findreps-inner-div']//tr[./td/input[not(./preceding-sibling::label)]]") {
            add_class("mw_zip_box")
            $("./td") {
              $name = fetch("./input/@name")
              move_here("../preceding-sibling::tr/td/label[@for='"+$name+"']", "top")
            }
          }
          $(".//input[@type='text']") {
            add_class("mw_input")
          }
        }
        # search zip
        move_here("./table[@class='findrepComponent']", "after") {
          insert_before("div", class:"mw_search_top") {
            move_here("./following-sibling::table[@class='findrepComponent']//div[contains(@class, 'float') or @class='findreps-bar']", "bottom")
            $("./div[@class='float-left']") {
              add_class("mw_flex_box")
              $("./ul[@class='findreps-tab']") {
                add_class("mw_flex_box_item_1")
                remove("./li[@class='findreps-sidetab']")
              }
            }
            remove("./div[@class='findreps-bar']")
          }
          $(".//div[@class='rep-info']/div/div[@class='content-node']") {
            $("./div[@class='basic-contact-info']/div/div[contains(@id, 'findreps')]") {
              add_class("mw_flex_box")
              $("./self::div[contains(@id, 'findreps_phone_info')]/div[@class='right-node']/p[@class='findreps-repInfo']") {
                name("a")
                attribute("href", "tel:"+fetch("./text()")) {
                  value() {
                    replace(/(\-|\s|\(|\))/, "")
                  }
                }
              }
              $("./div[@class='right-node']") {
                add_class("mw_flex_box_item_1")
              }
            }
            $("./div[@class='findreps_more_contact_info']") {
              $(".//nobr") {
                name("span")
                add_class("mw_block")
              }
              $(".//label[@class='label-node'][contains(text(), 'Phone')]/following-sibling::span") {
                name("a")
                attribute("href", "tel:"+fetch("./text()")) {
                  value() {
                    replace(/(\-|\s|\(|\))/, "")
                  }
                }
              }
            }
          }
        }
      }
      table_dump(".//table")
    }
  }
}
# restaurant locator form, and anything else that looks the same
# http://www.humanesociety.org/restaurant_locator

# Sarah LaFrance March 9, 2013

$("./body") {
  add_class("mw_rest_form_tablet")
  # HSUS-284 map
  attributes(onload:"initialize()")
  # end of HSUS-284 map

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length()<=1 and not(*)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class("mw_gray_inner")

      $("./div[contains(@class, 'section simple')]/h2") {
        add_class("mw_h3")
      }
      $("./div[.//input]") {
        add_class("mw_form")
        remove("@style")
        remove(".//br")
        $(".//p") {
          remove("@style")
        }
        $(".//input[contains(@value, 'Search')]") {
          wrap("div", class:"mw_btn_wrapper mw_flex_box") {
            $("./input[contains(@value, 'Search')]") {
              btn_delegate() {
                add_class("mw_btn1 mw_flex_box_item_1")
                text("FIND")
              }
            }
            move_here("following-sibling::input[contains(@value, 'Reset')]", "bottom") {
              btn_delegate() {
                add_class("mw_btn2 mw_flex_box_item_1")
                text("RESET")
              }
            }
          }
        }
      }
    }
  }
}
# 404 Page Not Found

# Sarah LaFrance Feb 22 2013

$("./body") {
  add_class("mw_not_found")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//ul[@id='tools']") // sorry if anyone wanted to share the 404
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//p[string-length(text())= 1]")
  remove("//img[@id='desktop_head']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  # main content
  $(".//div[@id='main']") {
    $(".//div[@id='feature']") {
      remove(".//br")
      # $(".//a[@class='more']") {
      #   inject("  &raquo;  ")
      # }
      $("./p") {
        add_class("mw_links")
      }
    }
  }

  # handle that empty div mess at the botom
  $(".//div[@id='contentDiv']/div") {
    remove("@style")
    wrap_text_children("span")
    remove("./span[string-length()<3]")
  }

  $(".//div[@id='cols']") {
    remove("./div[not(@id) and not(@class)]")
    remove("ancestor::div/following-sibling::br")
    $(".//div") {
      remove("@style")
    }
  }

}
# Animal browse page
# http://www.humanesociety.org/animals/browse_animals.html
# 

# Feb 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_atoz") 

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//br")

  # main animal list
  $(".//div[@id='browseanimals']") {
    $("./h2") {
      add_class("mw_h1")
    }
    $("./p") {
      add_class("mw_h3")
    }
    $(".//li/a") {
      add_class("mw_animal_button")
    }
  }

}
# subcategories of the animal page
# http://www.humanesociety.org/animals/pets
# http://www.humanesociety.org/animals/rabbits

# Feb 5, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_pets")

  #removals
  # remove("./script") // just trash all the javascript for now
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='simple']")

  $(".//h2") { // fix this so it doesn't mess up boxes
    add_class("mw_h1")
    text() { }
  }
  $(".//h3") {
    add_class("mw_h2")
  }

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul//ul") { // grab the subcategory list from the main nav
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
  }

  $(".//div[@id='main']") {

    $(".//object") {
      $("./param[@name='linkBaseURL']") {
        $val_var = fetch("@value")
      }
      name("iframe")
      attribute("src", $val_var)
    }
    $(".//iframe") {
      remove("@style")
    }

    $("./div[@class='section'][1]") { // combine top divs
      move_here("../div[@class='section']/div[@class='headline']")
      move_here("../div[contains(@class, 's_borderless')]")
    }
    remove("./div[@class='section'][2]")
    $(".//select[@name='fieldname']") {
      remove("@style")
      $selected = fetch("./option[@selected]/text()")
      wrap("div", class: "mw_select1") {
        insert_bottom("span", class: "mw_select_content", $selected)
      }
    }
  }

  $(".//div[contains(@class, 's_borderless')]") {
    $(".//a[@class='more']") {
      $destination = fetch("@href")
      $destination {
        replace(/\s$/, "") //chop off the occasional trailing spaces
      }
      attribute("href", $destination)
    }
    $(".//h2") {
      move_to("..", "top")
    }
    $(".//div[@id='images']") {
      move_here(".//p[@class='image']")
      remove("./ul")
    }

  }

  $(".//div[@id='moreabout']") { // get rid of the background image
    remove("@style")
    $(".//li/a") {
      add_class("mw_bar3 mw_h3")
    }
  }

  $(".//div[contains(@class, 'area-news')]") { // news headings section
    $(".//li") { // news item
      add_class("mw_newsItem")
      insert("div") {
        move_here("../p[@class='date']")
        move_here("../h3")
      }
      move_here(".//img", "top")
      remove(".//p[@class='image']")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
      wrap("div", class:"more-link")
    }
  }

  $(".//div[@id='side']") {
    remove("./div[not(@class)][not(contains(@id, 'magazine-promo'))]")
    $("./div[@class='resources-promo' or @id='relatedissues-promo']") { // blue boxes
      $(".//li/a") {
        inject("  &raquo;  ")
      }
    }
    $(".//div[@class='resources-promo']") {
      add_class("mw_sidebar2")
      $(".//h2") {
        add_class("mw_h2")
      }
    }
    $(".//div[@id='relatedissues-promo']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h1")
      }
    }
    $("./div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
    }
  }
}
# DEPRECATED AS OF MARCH 28 SEE COMMENT
# # press sections of animal
# # this page is not currently used, since qa.ts covers these pages fine.

# # Feb 5, 2013 Sarah LaFrance

# $("./body") {
#   add_class("mw_press mw_news_base")

#   # removals
#   remove(".//div[@id='head']")
#   remove(".//div[@id='page-head']")
#   remove(".//div[@class='toolsSpacer']")

#   $(".//h2") {
#     add_class("mw_h1")
#   }
#   $(".//h3") {
#     add_class("mw_h2")
#   }

#   # wild has sorting and searching, pets does not
#   $(".//div[@id='top-pagination']") {
#     add_class("mw_search2")
#     $(".//label") {
#       add_class("mw_flex_box")
#       wrap_text_children("span")
#     }
#     $(".//input") {
#       add_class("mw_flex_box_item_2")
#     }
#     $(".//button") {
#       add_class("mw_btn5")
#       text() {
#         clear()
#       }
#     }
#   }

#   $(".//div[@id='sortby']") {
#     add_class("mw_sort1")
#     attributes(data-ur-set:"toggler")
#     $(".//legend") {
#       wrap("div"){
#         attributes(data-ur-toggler-component:"button")
#         insert_top("div", class:"mw_plusminus")
#       }
#     }
#     wrap_together(".//p", "div") {
#       attributes(data-ur-toggler-component:"content")
#       $(".//label") {
#         wrap_text_children("span") {
#           inner() {
#             append("  :  ")
#           }
#         }
#       }
#     }
#   }

#   $(".//div[@id='contentDiv']") {
#     remove("./div[not(@id)]")
#     $(".//div[@class='pagination']") { // search bar
#       add_class("mw_search")
#       $(".//button") {
#         add_class("mw_btn5")
#         text() {
#           clear()
#         }
#       }
#     }
#   }

#   $(".//ul[@class='item-list']/li") { // news entry

#     $(".//p[@class='related']") {
#       wrap_text_children("span")
#     }
#     $(".//p[@class='image']") {
#       move_to("../p[contains(@class, 'author')]", "after")
#     }
#     $(".//ul") { // more link
#       move_to("..", "bottom")
#       $(".//a") {
#         inject("  &raquo;  ")
#       }
#     }
#   }

#   $(".//ul[@id='action']") {
#     add_class("mw_box5")
#     $(".//li") {
#       remove("./p")
#       remove("./form")
#     }
#     remove(".//li[not(@id)]")
#   }

#   $(".//div[@id='bottom-pagination']") { // next page etc.
#     $(".//table") {
#       $(".//td") {
#         name("div")
#       }
#     }
#     move_here(".//table//div")
#     remove(".//table")
#     remove(".//div[@class='pg-items']")
#     # test for presence of previous and next arrows to determine end cases
#     # then remove the surrounding page numbers to save room
#     $current = fetch(".//div[@class='pg-curr']/text()")
#     $previous = "false"
#     $next = "false"
#     $(".//div[@class='pg-prev']") {
#       $previous = "true"
#     }
#     $(".//div[@class='pg-next']") {
#       $next = "true"
#     }

#     $("./div[@class='pg-curr']") { 
#       insert_before("div", class:"mw_pages") {
#         move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
#         # check for base cases and remove surrounding numbers
#         match($previous) {
#           with("false") { // we're on the first page of results
#             remove("./div[position() > 4]")
#           }
#           with("true") {
#             match($next) { // we're on the last page
#               with("false") {
#                 remove("./div[position() < (("+$current+" mod 10)-3)]")
#               }
#               with("true") { // general case
#                 remove("./div[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
#               }
#             }
#           }
#         }
#       }
#     }

#     $(".//div[@class='pg-prev']/a") {
#       inner() {
#         prepend("  &laquo;  ")
#         replace("ious", "")
#       }
#     }
#     $(".//div[@class='pg-next']/a") {
#       inner() {
#         append("  &raquo;  ")
#       }
#     }
#   }

# }
# Animal main page
# http://www.humanesociety.org/animals/
# mockup #02-animals_kk
# km cY7 Rmd
# Feb 5 2013 Sarah LaFrancenj

$("./body") {
  add_class("mw_animals_main")
  # large chunks of this are copy-pasted from about_main.ts

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='petfinder-promo']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//div[@id='page']") {
    # remove("./div[not(@id)]") // empty

    # top navigation
    $(".//div[@id='page-head']") {
      move_here(".//ul//ul") { // grab the subcategory list from the main nav
        $("./li/a") {
          add_class("mw_bar3 mw_h3")
        }
      }
      remove("./h1")
      remove("./div")
      remove("./ul[@id='site-nav']")
    }

    $(".//div[@id='animalaccord']") { //main topic togglers
      remove(".//div[@class='clear']")
      $(".//div[@class='menu_head']/p") {
        move_to("../following-sibling::div[1]", "top") // text needs to go in content
      }
      $(".//div[@class='menu_head']") {
        wrap("div", class:"mw_animal_accord") {
          attributes(data-ur-set:"toggler")
          move_here("./following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content") {
              $(".//a") {
                add_class("mw_animal_button")
              }
            }
          }
        }
        attributes(data-ur-toggler-component:"button") {
          $("./img") {
            insert_after("div", class:"mw_plusminus")
          }
          $("./span[1]") {
            add_class("mw_ani_title")
          }
        }
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='bluenav']") {
      add_class("mw_sidebar6") // new universal class
      $(".//a") {
        add_class("mw_more")
        inject("  &raquo;  ")
      }
    }
  }
}
# cat problem solving section
# animals/cats/cat_problem_solver

# April 15 2013

$("./body") {
  add_class("mw_cat_problems")

  # remove
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//script[not(contains(@src, 'jquery'))]")
  remove(".//div[@id='petfinder-promo']")
     

  # main content 
  $(".//div[@id='main']") {
    remove("./br")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h1")
      remove("./br")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    # back arrow on the go back link
    $("./p/a") {
      inner() {
        prepend("  &laquo;  ")
      }
      $("parent::p") {
        remove("@style")
      }
    }

    # only on main page
    $(".//div[@id='feature']") {
      $(".//a[@class='more']") {
        inject("  &raquo;  ")
      }
    }
    $(".//div[@id='features']") {
      $(".//li") {
        add_class("mw_problem")
        $("./p[@class='image']") {
          move_to("..", "top")
          remove(".//br")
        }
        $(".//a[@class='more']") {
          inject("  &raquo;  ")
        }
      }
    }

    # find and tag togglers
    $(".//div[@id='accordion']") {
      $("./div") {
        attributes(data-ur-toggler-component:"content")
        $(".//img") {
          add_class("mw_img_box")
          wrap("div", class:"mw_image")
        }
        wrap("div") {
          attributes(data-ur-set:"toggler")
          move_here("preceding-sibling::h3", "top")
          $("./h3") {
            wrap("div") {
              attributes(data-ur-toggler-component:"button")
              insert("div", class:"mw_plusholder") {
                insert("div", class:"mw_plusminus")
              }
            }
          }
        }
      }
    }

  }
}
# Animal tips pages
# http://mlocal.humanesociety.org/animals/cats/tips/feline_vaccine_related_sarcoma.html
# 

# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_tips mw_article") 

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

}
$("./body") {
  add_class("mw_magazine_tablet")

  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
      $("./div[contains(@class,'s_borderless')]") {
        wrap_text_children("span")
        $("./span[contains(text(),'Have a great photo of an animal? ')]") {
          add_class("mw_h2")
        }
        $("./h3[not(*)] |./p[not(*)] |./span[not(*)] ") {
          match(fetch("./text()"), /\A[\s ]*\Z/) {
            remove()
          }
        }
        $(".//div[@id='images']//p[@class='image']/img") {
          add_class("mw_img_box")
        }
      }
      $("./div[@id='feature']/a[@class='back']") {
        wrap("div", class:"mw_back")
      }
      # HSUS-406
      $(".//div[contains(@id, 'aa_article')]/p[./span[contains(@class, 'dropcap')]]") {
        add_class("mw_first_p")
      }
    }
  }

  # Move the header here, beacuse of the upper nav
  $(".//div[@id='page']") {
    move_here(".//div[@class=' mw_masthead']", "top")
  }

  $(".//div[@id='page']//h1") {
    add_class("mw_h1")
  }
  $(".//div[@id='page']//h2") {
    add_class("mw_h2")
  }
  $(".//div[@id='page']//h3") {
    add_class("mw_h3")
  }

  $(".//div[@id='feature']") {
    # Wrap the text node in a span so I can move it around
    wrap_text_children("span", class:"feature_desc")

    # add mw_bar1 to the links
    $(".//a[@class='more']") {
      add_class("mw_bar1")
    }

    $(".//p[@class='image']//img") {
      add_class("mw_img_box")
    }
  }
  $(".//div[@id='features']") {
    $("./ul/li") {
      $("./p[./a]") {
        name("div")
        add_class("mw_flex_box_item_1")
        move_here("ancestor::li[1]/h3", "top")
      }
      $("./p[contains(@class, 'image')]") {
        wrap("div", class: "mw_flex_box") {
          move_here("ancestor::li/div")
        }
      }
    }
  }

  # images box

  
  $(".//div[@id='pubs']/ul/li") {
    add_class('mw_magazine_pub')

    $("./p[@class='date']") {
      wrap("div", class:"pub_float") {
        move_here("../h3")
      }
    }
  }

  $("./div[@id='wrapper']/div[@id='page']/div[@id='page-head']") {
    move_here("./ul[@id='site-nav']/li[contains(@class, 'expanded')]/ul", "top") {
      add_class("mw_flex_box")
      $("./li") {
        add_class("mw_flex_box_item_1")
      }
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
        # ticket 168, removing any stray whitespace from the links
        $url_text = fetch("@href")
        $url_text {
          replace(/[\s]*$/, '')
        }
        attribute("href", $url_text)
      }
    }
    remove("./ul[@id='site-nav'] | ./h1 | ./div[contains(@id, 'item')]")
  }

  # Fix the iFrame youtube video
  $(".//iframe") {
    remove("./@width | ./@height")
  }

  # Assign a page to the story pagination
  $(".//blockquote/p") {
    add_class("mw_pagination")
  }

  # For the multi-page stories.. wanted to call out the farm descriptions
  # example: http://mlocal.humanesociety.org/news/magazines/2012/07-08/back_to_the_land_page_5.html

  $(".//p[strong]") {
    add_class("mw_photo_caption_callout")
  }

  $(".//div[@id='page-bottom-spacer']") {
    remove()
  }
  # side bar
  $(".//div[@id='side']") {
    remove("./div[not(@class) and not(@id)]")
    # add_class("mw_flex_box")

    # Wrapp all the sidebar stuff except the yellow action
    # wrap_together("./div[not(@id='action')]", "div", class:"mw_flex_box") {
    #   move_to("..", "bottom")
    # }

    # Give the action sidebar the horizontal look
    # donate sidebar
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    # resources side bar
    $(".//div[@id='resources-promo']") {
      add_class("mw_sidebar3")
      $("./a[position() mod 4 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./a") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/a") {
          inject("  &raquo;  ")
          add_class("mw_flex_box_item_1")
        }
      }
      # end resources side bar
      # relate content side bar
      $(".//div[@id='related-content']") {
        add_class("mw_sidebar3")
        $(".//h2") {
          add_class("mw_h2")
        }
        $("./div[@class='module'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./div[@class='module']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/div[@class='module']") {
          add_class("mw_flex_box_item_1")
          $("./h3/a") {
            inject("  &raquo;  ")
          }
        }
        $("./p[@class='more-link']") {
          inject("  &raquo;  ")
        }
      }
      # end relate content sidebar

    $("./div[@id='resources' or @id='magazine-promo']") { // blue boxes
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//li/a | .//p/a") {
        inject("  &raquo;  ")
      }
    }

    # Give some of the other things the flexbox stuff
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
      $("./ul") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
    }
    
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
       $("./p[@class='allanimalsinclude'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./p[@class='allanimalsinclude']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/p[@class='allanimalsinclude']") {
          add_class("mw_flex_box_item_1")
          $("./a") {
            attributes(class:"more")
          }
        }
        $("./p[@class='more-link']") {
          inject("  &raquo;  ")
        }
        $("./h2") {
          wrap_text_children("span", class:"mw_h2_span")
          remove("./br")
        }
    }

    # move_to("./ancestor::div[@id='contentDiv']")
  }
  
  # HSUS-437
  $(".//div[@id='main']/div[contains(@class, 's_borderless')]//form[@class='checkboxes']/ul") {
    add_class("mw_checklist")
  }
}
# HSUS-424 : About events page
# http://www.humanesociety.org/about/events

$("./body") {
  add_class("mw_events")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//hr")

  $(".//div[contains(@class, 'section s_borderless')]") {
    remove("..//div[@id='feature'][./a[@class='back']]")
    # for the top jump links
    $("./p[./a[contains(@href, 'about/events/#')]]") {
      add_class("mw_jump_links_wrapper")
      $("./a[contains(@href, 'about/events/#')]") {
        add_class("mw_jump_links")
        $("self::a[contains(@href, 'Lobby_101_Seminars')]") {
          add_class("mw_learn_more")
        }
      }
      remove("./a[contains(@href, 'Lobby_101_Seminars')][position() > 1]")
      wrap_text_children("span") {
        match(inner(), (/\A\s*\Z/)) {
           remove()
        }
      }
    }

    # for the bottom events contents
    $("./h2[./a]") {
      add_class("mw_events_title")
      # replace the space behind the h2
      inner() {
        replace(/\s+\Z/, "")
      }
    }
    $("./p[not(contains(@class, 'mw_jump_links_wrapper') or contains(@class, 'date'))]") {
      add_class("mw_events_contents")
    }
    $("./p[./strong]") {
      add_class("mw_events_details_wrapper")
      inner() {
        replace(/^<strong>/,"<span class='mw_events_details'><strong>")
        replace(/\s<strong>/,"</span><span class='mw_events_details'><strong>")
        replace(/$/, "</span>")
      }
    }
  }
}
# end of HSUS-424
# In Your State page, only using the News section
# http://mlocal.humanesociety.org/about/state/

# January 27 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state")


  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='page']") { // fix nesting
    move_here(".//div[@id='main']/*")
    remove("./div[@id='contentDiv']")

    move_here(".//p[@class='lead']") {
      inner() {
        replace(/Click on a state below/, "Select a state") // map was removed
      }
      remove("./a[1]") // link leads to this page
      $(".//a") {
        attribute("class", "mw_bar3")
        inner() {
          replace( /\s.\s/, "") // remove extra raquo
        }
      }
    }

    $(".//div[@id='feature']") {
      # changing this entire map into a select menu
      add_class("mw_select1")
      remove("./img")
      insert("select") {
        # javascriptin it up to activate the links
        attribute("onchange", "if(this.options[this.selectedIndex].value != ''){window.top.location.href=this.options[this.selectedIndex].value}")
        insert("option", "Select a state")
        move_here("..//area") {
          inject(fetch("@alt"))
          name("option")
          remove("@coords")
          remove("@shape")
          $url = fetch("@href")
          $url{
            # strip the front of the href url so it doesn't redirect to desktop
            replace(/http:\/\/www\.humanesociety\.org/, "")
          }
          attribute("value", $url)
        }
      }
      remove("./map")
    }

    move_here(".//div[contains(@class, 'area-news')]/*")

    $(".//ul[not(@id='tools')and not(@id='share_bar')]") {
      add_class("mw_news_items")
      $(".//li") {
        insert("div", class:"mw_title") {
          move_here("../p[@class='date']")
          move_here("../h3")
        }
      }
    }

    $(".//h2/strong") {
      text() { }
      add_class("mw_h1")
    }
    $(".//h3/a") {
      add_class("mw_h3")
    }

    remove("./div[not(@id)]")
  }
}
# Department main page
# http://www.humanesociety.org/about/departments/
#

# Jan 30 2013 Sarah LaFrance

$("./body") {
  add_class("mw_dept")

  # removing
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//link")
  remove(".//div[@class='toolsSpacer']")
  remove(".//ul[@id='tools']")

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//div[@id='main']") {
    remove(".//br")
    $(".//h2") {
      attributes(data-ur-toggler-component:"button")
      insert("div") {
        add_class("mw_plusminus")
      }
      add_class("mw_bar3")
      wrap("div", class:"mw_deptItem", data-ur-set:"toggler") {
        move_here("following-sibling::*[1]")
        move_here(".//div[contains(@class, 'linksetMenu')]") {
          attributes(data-ur-toggler-component:"content")
        }
        $("./p") {
          attributes(data-ur-toggler-component:"content")
          add_class("navigationItem")
        }
        remove("./div[not(@class)]")
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
    move_here(".//div[@id='news']") {
      add_class("mw_sidebar4")
    }
  }

}
# Subcategory faith landing
# http://www.humanesociety.org/about/faith
#

# Mar 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faith")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='toolsSpacer']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//div[@class='section' and not(@id)]") { // lead section
    add_class("mw_lead")
    move_here("../ul[@id='tools']", "top")
    move_here(".//a[@class='more']")
  }

  $(".//div[@id='feature']") { // top heading
    $("./h2") { // page title
      move_to("..", "top")
      attribute("class", "mw_h1")
    }
  }

  $(".//div[@id='features']") {
    remove("./br")
    $(".//ul") {
      $("./li") {
        move_here("./p[@class='image']", "top")
        $(".//p") {
          remove(".//a[@class='more']")
        }
      }
    }
  }

  $(".//ul[@id='issue-browser']") { // list of faiths
    $("./li") {
      attributes(class:"mw_faith_toggle", data-ur-set:"toggler")
      $("./a") {
        attributes(class:"mw_bar3", data-ur-toggler-component:"button")
        remove("@href")
        insert("div", class:"mw_plusminus")
      }
      $("./ul") {
        attributes(class:"mw_faith_bar", data-ur-toggler-component:"content")
        $("./li/a[not(@class)]") {
          add_class("more")
        }
      }
    }
  }

  $(".//div[@id='main']") {
    remove(".//a[@class='back']")

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    $(".//h3|.//p[@class='author']") {
      add_class("mw_h3")
    }
    $(".//h4") {
      add_class("mw_h4")
    }
    insert("div", class:"mw_main") { // wrap all the main divs
      move_here("../div[not(contains(@class, 'mw_lead'))]")
      move_here("preceding-sibling::ul[@id='tools']", "top") // if there's no lead, grab share stuff
    }

    $(".//div[contains(@class, 's_borderless')]/ul[not(@id)]") {
      add_class("mw_article_list")
    }
  }

  $(".//div[@id='side']") { // sidebar links
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    remove(".//div[./div[@id='wayne']]")
    # need to replace that br with a space
    $(".//p") {
      remove("@style")
    }
    $("./div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $("./div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
    # For HSUS-483
    $("./div[(@id='wsd-promo') or (@id='wsd-promo2')]") {
      add_class("mw_sidebar8")
    }
    # End of HSUS-483
  }
  
}
# About employment page
# http://www.humanesociety.org/about/employment
# 

# January 25, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_employ")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")

  $(".//div[@id='main']") { // main content
    $(".//div[contains(@class, 's_borderless')]") {
      remove("..//div[@id='feature'] | ./h3/br")
      move_here("..//div[@id='feature']/a")

      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
        wrap("div", class:"mw_back")
      }

      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//p[./strong]") {
        add_class("mw_h2")
        inject("  :  ")
      }
    }
  }

  $(".//div[@id='side']") { // bottom donate box
    $("./div") {
      remove()
    }
  }
}
# About leadership page
# http://www.humanesociety.org/about/leadership
# all subpages
# http://mlocal.humanesociety.org/about/leadership/executive_staff/wayne_pacelle.html
# http://mlocal.humanesociety.org/about/leadership/board/hsus_board_directors.html

# January 23, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_leadership")

  remove(".//li/form")
  remove(".//li[@id='signup']/p")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@id='sortby']") // suppressed on the desktop
  remove(".//em[not(node())]")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='main']") {
    remove(".//div[@class='toolsSpacer']")

    $(".//h1") {
      attribute("class", "mw_h1")
    }
    $(".//h2") {
      attribute("class", "mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//div[@class='pagination']") { // search box
      add_class("mw_search1")
      $(".//label") {
        add_class("mw_flex_box")
        wrap_text_children("span")
      }
      $(".//input") {
        add_class("mw_flex_box_item_2")
      }
      $(".//button") {
        add_class("mw_btn5")
        text() {
         clear()
        }
      }
    }

    $(".//div[contains(@class, 's_borderless')]") {
      $("./p[position() mod 2=0]") { // get all the names so we can remove brs
        wrap_text_children("span")
      }
      # ticket HSUS-172
      # http://humanesociety.org/about/leadership/board/hsus_board_directors.html
      match($path, /^\/about\/leadership\/board\/hsus_board_directors/) {
        $("./p/br") {
          add_class("mw_keep")
        }
      }
      $(".//em") {
        move_to("preceding-sibling::span[1]")
      }
      $("./p/span[@style]") {
        remove(".//@style")
      }
    }

    $(".//li[@class='image']") { // person entry
      insert_top("div") {
        move_here("..//p[@class='image']//img")
        move_here("..//h2")
      }
      remove(".//p[@class='image']")
      $("./ul") {
        add_class("item-list") // ticket HSUS-172
      }
      $(".//li[@class='more']/a") {
        inject("  &raquo;  ")
      }
    }
  }

  remove(".//br[not(contains(@class, 'mw_keep'))]")
}
# State page
# http://mlocal.humanesociety.org/about/state/connecticut

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_page")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  $(".//div[@id='main']") {
    $("./div[@class='section']") {
      remove("./br")
      $("./p") {
        add_class("mw_section_p")
      }
      $("./div[@id='images']") {
        $(".//p[@class='image']") {
          wrap("div", class:"mw_image")
        }
        $(".//p[@class='caption']") {
          move_to("preceding-sibling::div[@class='mw_image']")
        }
      }
    }
    $("./div[@id='features']") {
      $(".//p[@class='image']") {
        wrap("div", class:"mw_flex_box") {
          move_here("following-sibling::p")
        }
      }
    }
  }
  # sidebar
  $(".//div[@id='side']") {
    # In your state
    $("./div[@id='state']") {
      add_class("mw_sidebar5")
    }
    $("./div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
    text() {

    }
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//iframe") {
    remove("@style")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

}
# Subcategory base page so we can detatch from the employ page
# http://www.humanesociety.org/about/*
#

# Feb 4 2013 Sarah LaFrance

$("./body") {
  add_class("mw_about")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h3")
  }
  $(".//h4") {
    add_class("mw_h4")
  }
  $(".//div[@id='images']/ul") {
    name("div")
    $("./li") {
      name("div")
    }
  }
  $(".//ul[not(@id)]") {
    add_class("mw_list1")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[@class='simple']")
  }
  
}
# Apodcast main page
# http://www.humanesociety.org/about/podcast
# 

# March 12, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_podcast")

  # remove unneeded section
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  # iframes for episodes
  $(".//iframe") {
    attribute("height", "480px")
  }

}
# individual event page
# http://www.humanesociety.org/about/events/humane_lobby_days_2013.html
# 

# March 5, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_event_page")
    # fixing up the masthead text for these pages - HSUS-516
  $(".//img[@class='mw_mobile_masthead_image']") {
    match(fetch("@src")) {
      with(/two_lines/) {
        $("following-sibling::div[@class='mw_masthead_title_text']") {
          add_class("mw_taller_text")
        }
      }
    }
  }
   # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length()<=1 and not(*)]")

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
      remove(".//br")
    }

  $(".//div[@id='main']") { // main content
    #For HSUS-434 : Add class for fixing the alignment issue
    add_class('mw_box2')
    #End of HSUS-434
    # top section with lead text and map
    $(".//ul[@id='tools']") {
      wrap("div", class:"mw_lead") {
        move_here("following-sibling::div[@class='section']")
        move_here("following-sibling::div[@id='feature' and .//iframe]")
        $(".//small") {
          wrap("div", class:"mw_caption")
          name("p")
          $(".//a") {
            remove("@style")
          }
        }
      }
    }    

    # a google maps iframe whee
    $(".//iframe") {
      $map_url = fetch("@src")
      $map_url {
        replace(/https/, "http") // fix itttttt
      }
      attribute("src", $map_url)
    }

    # wrap remaining sections into one
    # this is pretty sloppy, I'll clean it up later, need to tag more specifically -- SL
    $("./div[@class='mw_lead']") {
      insert_after("div", class:"mw_main") {
        move_here("following-sibling::div[contains(@class, 'section')]")
        $(".//div[not(@id)]") { // the faq section
          remove(".//img[contains(@id, 'question')]")
          # remove(".//br[following-sibling::br]")
          $(".//*") {
            remove("@style")
          }
          $(".//span[contains(@id, 'question')]") {
            name("h3")
            attributes(class:"mw_bar3", data-ur-toggler-component:"button")
            insert("div", class:"mw_plusminus")
            wrap("div", class:"mw_question") {
              attributes(data-ur-set:"toggler")
              move_here("following-sibling::div[1]") {
                attributes(data-ur-toggler-component:"content")
              }
            }
          }
        }
        $(".//div[table]") {
          move_here(".//td//a")
          remove(".//table")
          $("./div") {
            move_to("..", "bottom")
          }
          $("./a") {
            wrap("div") {
              add_class("mw_sponsor")
            }
          }
        }
        # $(".//div[not(//div[@class='mw_question'])]//p[count(a)=count(*) and count(a)>2]") {
        #   add_class("mw_links")
        #   $("./a") {
        #     add_class("mw_bar3")
        #   }
        #   wrap_text_children("span")
        #   remove("./span")
        # }
        $(".//div[contains(@class, 'question')]") {
          $("following-sibling::p") {
            attribute("class", "mw_get_faq")
          }
        }
        $(".//a[@class='more']") {
          inject("  &raquo;  ")
        }

        # try to grab nominee films for genesis
        $(".//div[contains(@class, 'simple')]") {
          $(".//p[preceding-sibling::h3[strong] or following-sibling::h3[strong]]") {
            add_class("mw_nominees")
            wrap_text_children("span") {
              match_not(inner(), /\S/) {
                remove()
              }
            }
            # remove("./span")
            remove(".//br")
            $("preceding-sibling::h3[strong]") {
              add_class("mw_h3_nom")
            }
            $("following-sibling::h3[strong]") {
              add_class("mw_h3_nom")
            }
             # for HSUS-516 - changing styling to be .mw_nominees > a to .mw_nominees > .mw_nominee_elements 
            inner_wrap("span", class: "mw_nominee_elements")
          } 
        }
        # HSUS-516 - making this not include nominees, moved after nominees designation
        $(".//div[not(//div[@class='mw_question'])]") {
          $(".//p[not(contains(@class, 'mw_nominees')) and (count(a)=count(*) and count(a)>2)]") {
            add_class("mw_links")
            $("./a") {
              add_class("mw_bar3")
            }
            wrap_text_children("span")
            remove("./span")
          }
        }
      } // close mw_main
    }

    # grab the bottom section of genesis pages
    $("./div[not(@class)]") {
      add_class("mw_genes")
      # presenter list
      $(".//p[a[contains(@href, 'imdb')]]") {
        add_class("mw_links")
        remove(".//br")
      }
      $("./div") {
        wrap_text_children("span")
        remove("./span")
      }
    }

    # remove any empty sections
    $(".//div[not(node())]") {
      remove()
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//span") {
        remove("@style")
      }
    }
    # HSUS-399 Looking for a pet side bar
    $("./div[@id='petfinder-promo']") {
      add_class("mw_pet_box")
      $("./p[@class='up']") {
        wrap("div", class:"mw_find_pet") {
          move_here("preceding-sibling::p", "top")
        }
      }
      $("./div[@class='mw_find_pet']") {
        move_to("following-sibling::img[1]", "after")
      }
    }
    # HSUS-413 : magazine-promo style
    $("./div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
    }
    # end of HSUS-413
    # relate content side bar
  #For  HSUS-434 : Added class for styling
  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")  
  }
  #End of HSUS-434
  # end relate content sidebar
  }
}
# About FAQ page
# http://www.humanesociety.org/about/contact/frequently_asked_questions.html
# http://www.humanesociety.org/about/contact/

# January 24, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faq")

  $(".//li") {
    inner() {
      replace(/\xC2\xA0/, "")
    }
  }

  $(".//div[@id='contentDiv']") {
    remove(".//div[@id='head']")
    $(".//div[contains(@class, 's_borderless')]") {
      move_here("preceding-sibling::div/a")
      remove(".//ul[@id='tools']")
      remove(".//p[@class='author']")

      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
      }

      $(".//p[.//strong]") {
        add_class("mw_subcats")
      }

      remove("preceding-sibling::div")

      $(".//p[contains(@class, 'subhead')]") {
        add_class("mw_h2")
        insert_after("div", class:"mw_blubox") {
          move_here("../h3/following-sibling::p[1]")
          move_here("../h3")
          $("./h3[1]") {
            move_to("..", "top")
          }
          $("./p[2]") {
            move_to("..", "bottom")
          }
        }
      }

      remove(".//div[@class='mw_blubox' and not(node())]") // remove the top box if empty

      # pull up misplaced ps
      move_here(".//div[contains(@class, 'last')]/p")

      $("./p[./a[@name]]") {
        wrap("div", class:"mw_answer")
      }

      $("./*[not(@class='mw_answer') and not(@class='back')]") {
        move_to("./preceding-sibling::div[@class='mw_answer']")
      }

      # set up accordions
      $("./ul") { // link togglers
        $("./li") {
          attributes(data-ur-set:"toggler")
          $("./a") {
            name("div")
            attributes(data-ur-toggler-component:"button", class:"mw_bart")
          }
          insert("div") {
            attributes(data-ur-toggler-component:"content")
            move_here("../../following-sibling::div[@class='mw_answer'][1]")
            $(".//p[./a[@name]]") {
              remove() // the restating of the question is redundant now
            }
          }
        }
      }
    }
  }

  $(".//div[@id='page-head']/ul") {
    remove(".//li")
    move_here("//p[@class=' mw_subcats']/a")
    remove("//p[@class=' mw_subcats']")
    $(".//a") {
      wrap("li")
      add_class("mw_bar3")
    }
  }

  $(".//div[@id='side']") {

    remove("./div[@id='related-content']")
  }
}
# About overview page
# http://www.humanesociety.org/about/overview
# 

# January 22, 2013 Sarah LaFrance

# this is going to be broken out into an about subcategory base if needed.

$("//body") {
  add_class("mw_overview")

  # remove unneeded section

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  remove(".//div[@id='page-head']")
  # remove(".//div[@class='section']")  // For HSUS-519
  remove(".//div[@class='simple']")
  remove(".//p[@class='author']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='contentDiv']") {
    copy_here("//ul//ul//ul", "top") { // sub-subcategory link list 
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove(".//div[@id='head']")
    
    # http://www.humanesociety.org/about/overview/
    # remove one br
    remove(".//div[contains(@class, 's_borderless')]/h1[contains(text(), 'Us:')]/following-sibling::p/br")
    
    # remove empty p
    $(".//div[contains(@class, 's_borderless')]//p[not(*)]") {
      match(text(), (/\A\s+\Z/)) {
        remove()
      }
      match_not(text(), (/.+/)) {
        remove()
      }
    }
    $(".//p[contains(@class, 'subhead')]") {
      add_class("mw_h3")
    }
    
    $(".//p[img[contains(@class, 'asset-image')]]") {
      remove("./@style")
      add_class("mw_img_p")
    }

    $(".//blockquote[not(.//blockquote)]") {
      add_class("mw_light_blue")
    }

    $(".//iframe") {
      remove("@style")
      remove("@width")
      remove("@height")
    }

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }

    $(".//div[@id='content']") {
      $(".//h3[@class='spacing']") {
        remove("./@class | ./@id")
        remove("./img")
        attributes(data-ur-set:"toggler")
        wrap_text_children("div", class:"mw_accomplish") {
          match(text(), (/\A\s+\Z/)) {
            remove()
          }
          attributes(class:"mw_acco_btn", data-ur-toggler-component:"button")
        }
        $("./div[contains(@id, 'answer')]") {
          remove("./@id | ./@style")
          attributes(class:"mw_acco_content", data-ur-toggler-component:"content")
        }
      }
    }

    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }

    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      move_to("..", "top") // place above the take action box
    }
    # HSUS-144 Update styling on Annual Report 2011
    $("./div[@id='cols']/div[@id='main']/div[.//div[@id='images']/ul/li/p[@class='image']]") {
      add_class("mw_image_section")
      remove("./p//br | following-sibling::div[contains(@class,'simple')]//strong//br")
      $("following-sibling::div[contains(@class,'simple')]/h2") {
        add_class("mw_h3")
      }
    }
    # End HSUS-144 Update styling on Annual Report 2011
  }

}
# About main page
# http://www.humanesociety.org/about
# using mockup 02-animals_kk

# January 22, 2013 Sarah LaFrance

# About section still needs some tweaks, tritium and styling needs to be
# combined and streamlined into better files

$("./body") {
  add_class("mw_about")

  # remove unneeded sections
  remove("./script") // just trash all the javascript for now
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }
  $(".//p[contains(@class, 'subhead') and not(node())]") {
    remove()
  }

  $(".//br") {
    inject_after(" ")
    remove()
  }
  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1 and not(*)]") { // this may be overpowered, keep an eye on it
    # it's ONLY intended to remove whitespace-only p tags
    remove()
  }

  $(".//div[@id='page']") {
    remove("./div[not(@id)]") // empty

    # top navigation
    $(".//div[@id='page-head']") {
      move_here(".//ul//ul") { // grab the subcategory list from the main nav
        $("./li/a") {
          add_class("mw_bar3 mw_h3")
        }
      }
      remove("./h1")
      remove("./ul[@id='site-nav']")
      remove("./div")
    }

    # main content
    $("./div[@id='contentDiv']") {
      $("./div[@id='head']") { // top big image
        remove(".//div[@id='top_band']")
        name("img")
        # attribute("src", "http://www.humanesociety.org/assets/images/page-head/about_us.jpg")
      }

      remove(".//img[@id='head']")

      $(".//p[@class='subhead']") {
        add_class("mw_h2")
      }
      $(".//h2") {
        add_class("mw_h3")
      }
      $(".//h4") {
        add_class("mw_h4")
      }

      $(".//div[@id='main']") {
        remove("./div[not(@class)]")
      }

      $("./div[@id='cols']") { // main content

        $(".//div[@class='section']") {
          move_here("//ul[@id='tools']", "top") {
            # HSUS 117 - align social share icons
            match($path, /^\/about\/contact\//) {
              add_class("mw_faq_share")
            }
          }
        }

        remove(".//div[@class='toolsSpacer']")
        $(".//div[@id='features']") { // list of articles
          $(".//h3") {
            text() { } // strip a tags
            add_class("mw_h2")
          }
        }

        $("./div[@id='side']") { // sidebar links
          remove(".//div[./div[@id='wayne']]")
          remove(".//div[@id='state']")
          remove(".//div[@class='simple']")
        }
      }
    }
  }
}
# Subcategory faith forms
# http://www.humanesociety.org/about/faith
#

# Mar 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faith_form mw_faith")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h2")
  }
  $(".//h4") {
    add_class("mw_h4")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='main']") {
    $("./div[@id='feature']") { // top heading
      $("./h2[1]") { // page title
        move_to("..", "top")
        attribute("class", "mw_h1")
      }
    }
    $(".//table") {
      $(".//td") {
        name("div")
        remove(".//br")
      }
      $(".//tr") {
        name("div")
        remove(".//br")
        move_to("../..")
      }
      remove()
    }
    $(".//div") {
      remove("@style")
      remove("@valign")
      remove("@width")
    }
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_spam")
    }
    $(".//input[@type='submit']") {
      $buttonText = fetch("@value")
      $buttonText {
        replace(/\./, "")
      }
      attribute("value", $buttonText)
    }
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[contains(@id, '-promo')]")
  }
  
}
# State ranking page
# http://mlocal.humanesociety.org/about/state/humane_state_ranking_2011.html

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_rank")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='options']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
    text() {

    }
  }
  $(".//h3") {
    add_class("mw_h3")
    remove("@style")
  }

  $(".//iframe") {
    remove("@style")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  # main content
  $(".//div[@id='main']") {

    $(".//p[@class='lead']") {
      inner() {
        # fixing instructions
        replace(/Hover over .* tier/, "Click on a tier to see state rankings, and click the name of a state")
      }
    }

    # the map section
    $("./p") {
      remove("./img")
      $("./map/area") {
        $state_name = fetch("@alt")
        $state_name {
          replace(/(\s|:)\s(\s)?.*/, '') // clip off the state name
        }
        attribute("id", $state_name)
      }
    }

    # the key box
    $("./div[not(@class) and ./img]") {
      add_class("mw_key")
      remove("@style")
      remove(".//br")
    }

    # tables with rankings
    $(".//div[./ul[@id='acc']]") {
      add_class("mw_rank_tables")
      remove("@style")
      $(".//li") {
        attributes(data-ur-set:"toggler")
        $("./h3") {
          attributes(data-ur-toggler-component:"button")
          #For HSUS-501: 2013 State Ranking page - remove map and have stacked percentages like example
          inner() {
            replace(/(.*)(-)(.*)/,"$1 - $3")
          }
          #End of HSUS-501
        }
        $("./div") {
          attributes(data-ur-toggler-component:"content")
          $(".//div[@class='acc-content']") {
            $(".//td") {
              add_class("mw_was_td")
              name("div")
              remove("@style")
            }
            $(".//tr") {
              name("div")
              add_class("mw_was_tr")
              remove("@style")
              remove("./div[1]")
              remove("./div[2]")
            }
            $(".//div[contains(@class, 'head')]") {
              remove()
            }
            $(".//div[@class=' mw_was_tr']") { // class is not header
              attributes(data-ur-set:"toggler")
              wrap_together("./div", "div") {
                attributes(data-ur-toggler-component:"button")
                $(".//div[@class=' mw_was_td']") {
                  $state_head = upcase(fetch("text()"))
                }
              }
              insert("div", data-ur-toggler-component:"content") {

                move_here("//map/area[@id='"+$state_head+"']") {
                  name("p")
                  inject(fetch("@alt"))
                  inject(fetch("@title"))
                  remove("@alt")
                  remove("@title")
                  remove("@shape")
                  remove("@coords")
                  remove(".//br")
                  #For HSUS-501: 2013 State Ranking page - remove map and have stacked percentages like example
                  wrap_text_children("span") {
                    attribute("class","mw_temp")
                  }
                  $(".//span[@class='mw_temp']") {
                    inner() {
                      replace(/(.*Score:\s[\d \%]*)(.*)/, "<span class='mw_bold'>$1</span>")
                    }
                  }
                  #End of HSUS-501
                }
              }
            }
          }
        }
      }
    }

    $(".//img") {
      $source = fetch("@src")
      $source {
        replace(/png.*/, "png")
      }
      attribute("src", $source)
    }

    $("./p") {
      remove()
    }
  }

  $(".//p[@class='lead'][last()]"){
    wrap_text_children("span"){
      text(){
        replace("Hover over a state for a summary, c", "C")
      }
    }
  }

}
# Department subpages
# http://www.humanesociety.org/about/departments/*
#

# Feb 21 2013 Sarah LaFrance

$("./body") {
  add_class("mw_department")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1 and not(*)]") {
    remove()
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
    text() {
      
    }
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//p[@class='lead']") {
    remove(".//br")
  }

  $(".//div[@id='features']") {
    $(".//li/p[@class='image']") {
      move_to("..", "top")
    }
  }

  $(".//div[contains(@class, 'area-news')]/a[@class='more']") {
    wrap("div", class:"more-link")
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[@id='state']")
    remove(".//div[@class='simple']")
    remove("./iframe")
    remove(".//br")
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%;")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  
  $(".//div[@id='main']/div[contains(@class, 's_borderless')]") {
    $("./p[@class='subhead']") {
      add_class("mw_h3")
    }
    $("./p[not(@class)]") {
      add_class("mw_part_p")
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//div[@id='petfinder-promo']") {
      add_class("mw_sidebar7")
    }
  }
  $(".//ul[@id='action']") {
    ## HSUS - 442
    remove("./li[@id='donate']/a[@class='give-bttn']")
  }
}
# All fact sheets
# http://mlocal.humanesociety.org/issues/fisheries/facts/right_whale_extinction.html
# http://mlocal.humanesociety.org/animals/cats/facts/cat_wildlife.html
# http://mlocal.humanesociety.org/issues/campaigns/factory_farming/fact-sheets/ag_gag.html
# http://mlocal.humanesociety.org/issues/puppy_mills/facts/
# http://mlocal.humanesociety.org/issues/exotic_pets/facts/fact_fiction_monkeys_apes_pets.html

# Feb 21 2013 Sarah LaFrance

$("./body") {
    add_class("mw_fact_sheet")

    #removing
    remove(".//div[@id='head']")
    remove(".//div[@id='page-head']")
    remove(".//div[@id='page-bottom-spacer']")
    remove(".//p[string-length()<=1 and not(*)]")

    # main content
    $(".//div[@id='main']") {

      # social media buttons
      move_here(".//ul[@id='tools']", "top")

      $(".//div[@id='feature']") {
        move_to("..", "top")
        $(".//a") {
          inner() {
            prepend("  &laquo;  ")
          }
        }
      }
      
      $(".//div[@id='feature'][./a]") {
        add_class("mw_borderwithback")
      }

      $(".//div[contains(@class, 's_borderless')]") { // actual article content
        # move date to below author and subhead
        move_here("./p[contains(@class, 'author')]", "top")
        move_here("./p[contains(@class, 'subhead')]", "top")
        move_here("./h1[1]", "top")

        $(".//p[string-length()<=1 and not(*)]") {
          remove()
        }

        # $("./p/br") {
        #   remove()
        # }

        $(".//div[contains(@id,'image-')]") {
          remove("@style")
        }

        $(".//h1") {
          add_class("mw_h1")
        }
        $(".//h2") {
          add_class("mw_h2")
        }
        $(".//h3") {
          add_class("mw_h3")
          $("./following-sibling::*[1][self::p][not(@class)]") {
            add_class("mw_fact_p")
            remove("./br")
          }
        }

        # ticket 146, handling the table
        $(".//table") {
          $(".//tr") { // no ths in this table
            $(".//td") {
              name("div")
              attributes(class:"mw_datum")
              remove("@style")
            }
            name("div")
            attributes(class:"mw_test_row")
          }
          name("div")
          attributes(class:"mw_cos_table")
          move_here(".//div[contains(@class, 'mw_test_row')]")
          remove("./tbody")
        }
        # Fix for HSUS-470
        match_not($path, /fur_fashion\/tips/) {
          # scope into the untabled table
          $(".//div[@class='mw_cos_table']") {
            # grab the headings for the data
            $("./div[1]") {
              $("./div[1]") {
                remove() // first column label, not needed
              }
              $("./div[@class='mw_datum']") {
                %index = index()
                log("############### AT "+ %index)
                $(".//p") {
                  var("heading_" + %index, fetch(".//text()"))
                }
                remove()
              }
            }
            # tweak test titles
            $("./div[@class='mw_test_row']") {
              # trim nbsps at the beginning of strings
              $(".//p|.//strong|.//div") {
                inner() {
                  replace(/^[\s]*/, '')
                }
              }
              $("./div[@class='mw_datum']") {
                remove("@align")
              }
              $("./div[1]") {
                remove(".//br")
                add_class("mw_h2")
                text() { }
                wrap_text_children("strong")
              }
              $("./div[@class='mw_datum' and .//img]") {
                add_class("mw_animals")
                remove(".//br")
                insert("div", class:"mw_animal_imgs") {
                  move_here("..//img")
                  move_to("..", "top")
                }
              }
              insert("div", class:"mw_test_text") {
                move_here("../div[not(contains(@class, 'mw_h2'))]")
                $("./div[contains(@class, 'mw_datum')]") {
                  %index = index()
                  insert_top("strong") {
                    inject(var("heading_" + %index))
                  }
                }
              }
            }
          }
        }
        # End of HSUS-470

        $(".//iframe") {
          remove("@height")
          remove("@width")
        }

        # forms are on protect seals app pages
        $(".//form") {
          add_class("mw_appform")
          $(".//*") {
            remove("@cols")
          }
          $(".//td[label[@for='cons_email_opt_in']]") {
            add_class("mw_checkboxrow")
          }
          $(".//p[input[@class='Button']]") {
            add_class("mw_buttonrow")
            $("./input") {
              wrap("div", class:"mw_button")
            }
          }
        }
      }
    }

    # side bar
    $(".//div[@id='side']") {
      remove("./br")
      $(".//a[@class='more']") {
        inject("  &raquo;  ")
      }
      $(".//div[@id='related-content']") {
        add_class("mw_sidebar3")
        $(".//h2") {
          add_class("mw_h2")
        }
      }
      $(".//div[@id='magazine-promo']") {
        add_class("mw_sidebar7")
      }
    }
}
$("./body") {
  add_class("mw_message_viewer")
  $(".//table") {
    remove("@style")
    remove("@bgcolor")
    remove("@width")
  }
  $("./table[.//link[contains(@href, 'sealpup_alert.jpg')]]") {
    wrap("div", class:"mw_viewer_container") {
      move_here("..//div[contains(@class, '_footer')]", "bottom")
      $(".//div[./h1]") {
        $(".//a[./img[contains(@src, 'submit_button_smaller')]]") {
          btn_delegate() {
            add_class("mw_submit_button")
            text("Submit")
          }
        }
      }
    }
    $(".//table[.//span[contains(text(), 'The Humane Society of the United States')]]") {
      move_to("ancestor::div[@class='mw_viewer_container']/div[contains(@class, '_footer')]", "top")
    }
    $(".//table[.//span[contains(text(), 'Trouble with links or images')]]") {
      add_class("mw_hide")
      $("following-sibling::table") {
        $(".//tr[./td/a/img[contains(@alt, 'Share on Facebook')]]") {
          $("self::tr | ./td") {
            name("div")
          }
          inner_wrap("div", class:"mw_share_buttons") {
            inner_wrap("div", class:"share_bar") {
              remove(".//@style")
              $("./div") {
                remove("@align")
              }
              $(".//img[contains(@src,'facebook')]/..") {
                add_class("addthis_button_facebook")
              }
              $(".//img[contains(@src,'twitter')]/..") {
                add_class("addthis_button_twitter")
              }
              $(".//img[contains(@src,'email')]/..") {
                add_class("addthis_button_email")
              }
              $("./div[not(./*)]") {
                add_class("mw_testing")
              }
              $(".//a") {
                text() {  
                  replace("")
                }
                $("./img") {
                  btn_delegate()
                }
              }
            }
            move_here(".//div[contains(@valign, 'bottom')]", "after") {
              add_class("mw_date_wrapper")
            }
            insert_top("p") {
              text() {
                set("Share")
              }
            }
          }
        }
      }
    }
  }
  $(".//div[contains(@class, '_footer')]") {
    remove(".//@style")
    $("./table//tr//span[contains(text(), ' All rights reserved')]") {
      inner_wrap("div", class:"mw_footer_copyright") {
        wrap_text_children("span")
        $("./span[contains(text(), 'All rights reserved')]") {
          add_class("mw_copyright_head")
        }
      }
    }
  }
  $(".//img") {
    remove("@align")
    remove("@width")
    remove("@height")
  }
  remove("./div[@id='cv-poweredBy']")
  remove(".//img[contains(@alt, 'Humane Action')]")
}
$("./body") {
  add_class("mw_shop")

  $(".//div[@id='main']") {
    add_class('mw_box2')
  }

  # make the corporate supporters big
  $(".//div[@id='feature']/h2") {
    add_class("mw_h1")
  }

  # Shop our corporate supporters
  $(".//div[@id='features']") { #Note the ID difference- feature vs features
    $('./h2') {
      add_class("mw_h3")
    }

    # Flexbox the image and description
    $("./ul/li") {
      add_class("mw_corporate_supporters")
    }
  }
  
  # Remove the spacer between the body content and footer
  $(".//div[@id='page-bottom-spacer']") {
    remove()
  }


}
$("./body") {
  add_class("mw_flickr")
  attributes(id:"mw_flick_iframe", onload:"resizeIframe('mw_flick_iframe')")
  remove("./div[@class='mw_header'] | .//tr[./td[contains(@class, 'shimCell')]]")
  $(".//tr[./td[contains(@class, 'formLabelBottomLeft')]]") {
    wrap("div", class:"mw_label_box")
    add_class("mw_label")
  }
  $(".//table") {
    $(".//tr[not(contains(@class, 'mw_label'))]") {
      move_to("./preceding-sibling::div[@class='mw_label_box'][1]", "bottom")
    }
    table_dump(".")
  }
}
$("./body") {
  add_class("mw_shop")

  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
    }
  }

  # make the corporate supporters big
  $(".//div[@id='feature']/h2") {
    add_class("mw_h1")
  }

  # Shop our corporate supporters
  $(".//div[@id='features']") { #Note the ID difference- feature vs features
    $('./h2') {
      add_class("mw_h3")
    }

    # Flexbox the image and description
    $("./ul/li") {
      add_class("mw_corporate_supporters")
    }
  }
  
  # Remove the spacer between the body content and footer
  $(".//div[@id='page-bottom-spacer']") {
    remove()
  }


}
$("./body") {
  add_class("mw_maplist")

  $(".//div[@id='inside']") {
    add_class("mw_box2")
  }

  # Hide stuff
  $(".//div[@id='head']") {
    add_class("mw_hide")
  }

  $(".//div[@class='section s_borderless']") {
    remove("./br")
  }

  # Fix the tools and hide the breadcrumb
  $(".//ul[@id='tools']/li[not(@id)]") {
    #remove("@style")
    add_class("mw_hide")
  }

  # $(".//div[contains(@class, 'section-lead')]/table//tr") {
  #   add_class("")
  # }

  # Trying out the table dump
  $(".//div[contains(@class,'section-lead')]") {
    $("./h2") {
      add_class("mw_h1")
      $("./strong") {
        inner() {
          replace(/^.*A/, 'A')
        }
      }
      $("following-sibling::p[1]") {
        remove()
      }
    }
    remove("./br")
    table_dump("./table")

    # remove the <th> row
    remove(".//div[contains(@class, 'mw_was_th')]")
  }

  # paginator
  table_dump(".//table[@class='paginator']")

  $(".//div[contains(@class, 'paginator')]") {

    # giving the number of items special treatment
    $(".//div[b]") {
      add_class("mw_pagination_items")
    }

    $(".//div[contains(@class, 'mw_was_tr')]") {
      remove(".//div[contains(@class, 'pg-items')]")

      $current = fetch(".//div[contains(@class, 'pg-curr')]/text()")
      $previous = "false"
      $next = "false"
      $(".//div[contains(@class, 'pg-prev')]") {
        $previous = "true"
      }
      $(".//div[contains(@class, 'pg-next')]") {
        $next = "true"
      }
      log(concat("current: ",$current," $next: ", $next," $previous: ", $previous))

      # check for base cases and remove surrounding numbers
      match($previous) {
        with("false") { // we're on the first page of results
          remove("./div[contains(@class, 'pg-page') and position() > 4]")
        }
        with("true") {
          match($next) { // we're on the last page
            with("false") {
              remove("./div[contains(@class, 'pg-page') and position() < (("+$current+" mod 10)-3)]")
            }
            with("true") { // general case
              remove("./div[contains(@class, 'pg-page') and position() < (("+$current+"mod 10)-1) or contains(@class, 'pg-page') and position() > (("+$current+" mod 10)+2)]")
            }
          } 
        }
      }
      # End check for base cases
    }
  }

  # remove useless back link
  $(".//div[@class='pagination']/following-sibling::p") {
    remove()
  }

  # remove the bottom spacer
  remove(".//div[@id='page-bottom-spacer']")
}
# Chimpanzee art contest

$("./body") {
  add_class("mw_chimp_art_contest_mobile")
  
  #Remove fancybox script
  # remove(".//script[contains(@src, 'fancybox')]")

  $(".//div[@id='contentDiv']") {
    add_class("mw_box2")

    $(".//form[contains(@id, 'survey')]") {
      add_class("mw_main_form")

      # Chimp blocks
      $(".//div[@class='finalist-blocks']") {
        remove("./a[@class='fancybox-thumb']/img/@style")
        # attributes(class:"mw-fancybox-thumb")

        # repalce the image placeholder with the actual image
        # Break out the chimp's painting into a separate carousel item
        $("./a[./img[contains(@src, 'mobile')]]") {
          %painting = fetch("@href")
          insert_after("a", class:"fancybox-thumb") {
            insert("img", src: %painting)
          }
        }

        $("./a[@class='fancybox-thumb']") {
          remove("@rel | @ data-fancybox-group")
          attributes(class:"mw-fancybox-thumb")
          name("div")
          attributes(data-ur-carousel-component:"item")
        }

        wrap_together("./div[@class='mw-fancybox-thumb']", "div") {
          attributes(data-ur-carousel-component:"scroll_container")
          wrap("div", data-ur-set:"carousel", data-ur-fill:"1", data-ur-autoscroll:"disabled", data-ur-carousel-component:"view_container", class:"chimp-carousel") {
            insert("div", data-ur-carousel-component:"dots")
          }
        }

        # Style the 'inline' paragraph
        $("./p[@style='display:inline;']") {
          remove("@style")
          add_class("mw-chimp-body-text")
        }
      }
    }

    # Voting form
    $(".//div[@id='chimps-fields-input-boxes']") {

      # Remove the fixed length of the fields
      $(".//input[@type='text']") {
        remove("@size")
        add_class("mw_input")
      }
    }

    contextual_keyboard(".//input[@name='cons_email']", "email") 
    contextual_keyboard(".//input[@name='cons_zip_code']", "numeric") 

    # make the button nice and big
    $(".//input[@class='chimps-submit-button']") {
      add_class("mw_btn1")
      wrap("div", class:"mw_submit_btn")
    }
  }

  # Move the bottom element back into the form
  $(".//div[@id='chimps-bottom-elements']") {
    move_to("./ancestor::div[@id='main']//form[contains(@id, 'survey')]", "bottom")
  }
  $(".//div[@id='main']/input[@type='hidden']") {
    move_to("./ancestor::div[@id='main']//form[contains(@id, 'survey')]", "bottom")
  }

  # change the footer
  $(".//div[@id='footer']") {
    attributes(id:'foot')
  }

}
$("./body") {
  add_class("mw_chimp_art_contest_tablet ")
  #Remove fancybox script
  # remove(".//script[contains(@src, 'fancybox')]")

  # header logo img
  $("./div[@class='mw_header']/a[@class='mw_header_spillover']/img") {
    attribute("src") {
      value() {
        replace(/[\/|\w|\.]+(\.\..*)/) {
          set($1)
        }
      }
    }
  }
  # end header logo img
  remove("./div[@id='wrapper']/br")
  $("./div[@id='wrapper']") {
    # insert_top("div", class: "mw_masthead") {
    #   insert("img", src: "http://www.humanesociety.org/assets/images/1024x256-tablet-mastheads/tablet_masthead_default.png", class: "mw_tablet_masthead_image")
    # }
    $("./div[@id='page']") {
      remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style] | ./br")
      $("./div[@id='contentDiv']/div[@id='cols']") {
        add_class("mw_box2_tablet")
        $("./div[@id='main']/div[@id='wrapper-body']") {
          remove("./@style")
          # share
          $("./ul[@id='share_bar']/li/img[@class='share_image']") {
            name("span")
            insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
            remove()
          }

          # Chimp blocks
          $(".//div[@class='finalist-blocks']") {
            remove("./a[@class='fancybox-thumb']/img/@style")

            # repalce the image placeholder with the actual image
            # Break out the chimp's painting into a separate carousel item
            $("./a[./img[contains(@src, 'mobile')]]") {
              %painting = fetch("@href")
              insert_after("a", class:"fancybox-thumb") {
                insert("img", src: %painting)
              }
            }

            $("./a[@class='fancybox-thumb']") {
              remove("@rel | @ data-fancybox-group")
              name("div")
              attributes(data-ur-carousel-component:"item", class:"mw-fancybox-thumb")
            }

            wrap_together("./div[@class='mw-fancybox-thumb']", "div") {
              attributes(data-ur-carousel-component:"scroll_container")
              wrap("div", data-ur-set:"carousel", data-ur-fill:"1", data-ur-autoscroll:"disabled", data-ur-carousel-component:"view_container", class:"chimp-carousel") {
                insert("div", data-ur-carousel-component:"dots")
              }
            }

            # Style the 'inline' paragraph
            $("./p[@style='display:inline;']") {
              remove("@style")
              add_class("mw-chimp-body-text")
            }
            
            # Move the title to the top above the carousel
            move_here("./p[@class='chimp-titles']", "top")

            # insert("div", class:"chimp-info") {
            #   move_here("../p[@class='chimp-titles']")
            #   move_here("../p[@class='mw-chimp-body-text']")
            #   move_here("../div[@class='chimp-label']")
            # }
          }

          # end share
          # $("./div[contains(@id, 'pov-col')]") {
          #   $(".//h3") {
          #     add_class("mw_h3")
          #   }
          #   $("./div[@class='pov-text']") {
          #     $("./h2") {
          #       add_class("mw_h2")
          #       remove("./br")
          #     }
          #     $("./p") {
          #       name("div")
          #       wrap_text_children("span")
          #       $("./br/following-sibling::span[1]") {
          #         wrap("div", class:"mw_wrap_div")
          #       }
          #       $("./a | ./span | ./strong") {
          #         move_to("preceding-sibling::div[1]", "bottom")
          #       }
          #       remove("./br")
          #     }
          #   }
          #   $(".//div[@class='pov']") {
          #     remove(".//@style | .//@width")
          #     $("./img") {
          #       add_class("mw_img")
          #     }
          #     $("./div[@id='pov-radio-error']") {
          #       move_to("./preceding-sibling::label[@class='pov-label']", "bottom")
          #     }
          #     $("./p[not(*)]") {
          #       text() {
          #         replace(/^[\s\u00a0]+/, "")
          #         replace(/[\s\u00a0]+\|$/, "")
          #       }
          #     }
          #   }
          #   # cast your vote area
          #   # $(".//div[@id='pov-fields-input-boxes']") {
          #   #   remove("./p/@style | ./div[@id='bogotext']//img/@style")
          #   #   $("./div/input") {
          #   #     add_class("mw_input")
          #   #   }
          #   #   $("./label[./input[@class='radio']]") {
          #   #     add_class("mw_radio")
          #   #     move_here("./following-sibling::div[@id='pov-radio-area-legal' or @id='pov-radio-error-legal']", "bottom")
          #   #   }
          #   #   $("./input[@class='pov-submit-button']") {
          #   #     add_class("mw_btn1")
          #   #     wrap("div", class: "mw_submit_btn")
          #   #   }
          #   # }
          #   # end cast your vote area
          # }
        }

        # Voting form
        $(".//div[@id='chimps-fields-input-boxes']") {

          # Remove the fixed length of the fields
          $(".//input[@type='text']") {
            remove("@size")
            add_class("mw_input")
          }
        }

        contextual_keyboard(".//input[@name='cons_email']", "email") 
        contextual_keyboard(".//input[@name='cons_zip_code']", "numeric") 

        # make the button nice and big
        $(".//input[@class='chimps-submit-button']") {
          add_class("mw_btn1")
          wrap("div", class:"mw_submit_btn")
        }
      }
    }
  }
  # Move the bottom element back into the form
  $(".//div[@id='chimps-bottom-elements']") {
    move_to("./ancestor::div[@id='main']//form[contains(@id, 'survey')]", "bottom")
  }
  $(".//div[@id='main']/input[@type='hidden']") {
    move_to("./ancestor::div[@id='main']//form[contains(@id, 'survey')]", "bottom")
  }
}
# reus_hsus_donation_2013 page

$("./body") {
  add_class("mw_reus_hsus_tablet")

  # Remove fixed with on table
  $(".//div[@id='ga-content']/table") {
    remove("@style")
    add_class("mw_reus_table")
  }

  $(".//div[@id='splash_container']") {
    add_class("mw_gray_inner")
    wrap("div", class:"mw_box2_tablet") 
  }

  # Remove the br's in the top_button
  $(".//div[@id='top_button']") {
    remove(".//br")
  }


  fixImages()
  # how the image URLS should look:
  # https://secure.humanesociety.org/images/content/pagebuilder/donate_monthly_red.png
  # how they turn out:
  # https://secure.humanesociety.org//site/images/content/pagebuilder/donate_now_red.png
  $(".//img") {
    %new_url = fetch("@src")
    %new_url {
      replace(/\/site/, "")
    }
    set("src", %new_url)

    log(fetch("@src"))

    wrap("div", class:"mw_donation_image_center")
  }
}
# reus_hsus_donation_2013 page

$("./body") {
  add_class("mw_reus_hsus_mobile")

  # Remove fixed with on table
  $(".//div[@id='ga-content']/table") {
    remove("@style")
    add_class("mw_reus_table")
  }

  # Remove kitty header
  remove(".//div[@id='ga-header']/img")

  $(".//div[@id='splash_container']") {
    move_here("./div[@id='column2']/img[contains(@src, 'splash_quote_seals')]", "top")
  }

  # Remove the br's in the top_button
  $(".//div[@id='top_button']") {
    remove(".//br")
  }



  fixImages()
  # how the image URLS should look:
  # https://secure.humanesociety.org/images/content/pagebuilder/donate_monthly_red.png
  # how they turn out:
  # https://secure.humanesociety.org//site/images/content/pagebuilder/donate_now_red.png
  $(".//img") {
    %new_url = fetch("@src")
    %new_url {
      replace(/\/site/, "")
    }
    set("src", %new_url)

    log(fetch("@src"))

    wrap("div", class:"mw_donation_image_center")
  }
}
# fewer modifications than mobile since we have more space
# http://mlocal.action.humanesociety.org/site/Calendar/888008295?view=DayList&Day=6,4,2013

# April 4, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_grid_day")

  ### fixing some inline js for HSUS-484
  $(".//script[contains(text(), 'jQuery')]") {
    inner() {
      replace("jQuery", "x$")
      replace("var theId=x$(this).attr('id')", "var theId=x$(this).attr('id')[0]")
      replace("removeAttr('onclick')", "attr('onclick', '')")
    }
   
  }
  $(".//script[contains(text(), 'YAHOO')]") {
   // remove()
  }

  # Hide no wrapper page header
  $("./self::body[not(./div[@id='wrapper'])]/div[@class='mw_header']") {
    add_class("mw_hide")
  }

  $(".//a[./img[contains(@src, 'share_on_twitter_small')]]") {
    add_class("mw_share_align")
    $("following-sibling::p[1]") {
      wrap_text_children("div", class: "mw_left_align")      
    }
  }

  $(".//a[./img[contains(@src, 'share_on_facebook_small')]]") {
    add_class("mw_share_align")
  }

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  # HSUS-504 Start
  # remove(".//br")
  # HSUS-504 End
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  fixImages()

#  repair the masthead
  $(".//div[@class=' mw_masthead']") {
    move_here("//img[@id='desktop_head']") {
      $("preceding-sibling::img") {
        add_class("mw_hide")
      }
    }
  }

  # main content
  $(".//div[@id='main' or @id='ga-content']") {
    add_class("mw_box2_tablet")
  }

  # fix tables
  //table_dump dump_table
  $(".//table") {
    $(".//tr") {
      $("./td|./th") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }

  # top box with go to date
  $(".//div[@id='main']") {
    $(".//*") {
      remove("@width")
      remove("@align")
    }
    $(".//*[not(contains(@class, 'mw_was_td'))]") {
      remove("@style")
    }
    $(".//div[contains(@class, 'mw_was_td') and .//strong/a]") { // top line
      add_class("mw_today")
    }
    $(".//form[@id='cal_form_3']") { 
      $(".//div[contains(@class, 'mw_today')]") {
        $(".//span") { // trim whitespace
          inner() {
            replace(/\s*$/, "")
            replace(/^\s*/, "")
          }
        }
      }
      # $(".//fieldset[@id='_date']") { 
      #   move_here(".//div[contains(@class, 'mw_was_td')]")
      #   name("div")
      # }

      # wrap the stuff for the gray box
      # $(".//div[@valign='middle']") {
      #   insert("div", class:"mw_graybox") {
      #     move_here("../div[not(contains(@class, 'mw_today'))]")
      #     $(".//div[@bgcolor]") {
      #       add_class("mw_gobutton")
      #       remove("@bgcolor")
      #     }
      #   }
      # }
    }

    ########## HSUS - 484 ##############
    $(".//div[@id='cal_event_calendar']") {
      add_class("mw_calendar")
      $(".//div[contains(@class, 'notInMonth')]") {

      }
    }
    $(".//div[@id='orgevent_filters']") {
      add_class("mw_hide")
    }
    $(".//form[div[@id='oedatepicker']]") {
      add_class("mw_graybox")
      $(".//div[img]") {
        add_class("mw_hide")
      }
      $(".//div[input[@type='submit']]") {
        add_class("Button")
      }
    }
    $(".//div[@class='monthNavigator' or @class='weekNavigator']") {
      add_class("mw_month_row")
      $("./span[2]") {
        add_class("mw_month")
      }

    }   
    $(".//div[contains(@class, 'daysOfWeekHeader')]") {
      add_class("mw_days_of_week_header ")
      $(".//span[contains(@id, 'dayOfWeek')]") {
        text() {
          replace(/(\S{3})\S*/, "$1")
        }
      }

    }   
    $(".//div[contains(@class, 'TabTable')]") {
      move_to("ancestor::div[contains(@class, 'mw_calendar')]", "before")
    }
    $(".//div[contains(@class, 'eventDetailPopupBox')]") {
      add_class("mw_hide")
    }
    $(".//div[contains(@class, 'notInMonth')]") {
      add_class("mw_yellow")
    }

    $(".//div[contains(@class, 'dayOfEventsHeader')]") {
      add_class("mw_hide")
    }

    ########## HSUS - 484 end ##############

    # bottom section with calendar
    # $(".//div[@class='appArea' and ./div]") {
    #   add_class("mw_calendar")

    # }
  }

  # main calendar
  $(".//div[contains(@class, 'mw_calendar')]") {
    remove("./p")
   # move_here(".//div[contains(@class, 'Backed')]") // fix nesting issues
    # two tables here, top one's buttons and month name
    # $("./div[1]") {
    #   add_class("mw_month_row")
    #   $(".//div[contains(@class, 'mw_was_td')][2]") {
    #     add_class("mw_month")
    #     move_to("..", "bottom")
    #     # remove(".//a")

    #   }
    # }
    # second one's the calendar
    $(".//div[contains(@class, 'Backed')]") {
      # weeks are trs
      $(".//div[contains(@class, 'mw_was_tr')]") {
        add_class("mw_flex_box")
      }
      # days are tds
      $(".//div[contains(@class, 'mw_was_td')]") {
        add_class("mw_flex_box_item_1")
        # get rid of that stupid whitespace
        $("./p") {
          inner() {
            replace(/[\s]*$/, '')
          }
        }
        # is it yellow?
        $("self::*[contains(@style, 'FFCC')]") {
          add_class("mw_yellow")
        }
        remove("@style")
      }
    }
  }


  ############################################

  # sign up for event page instead of calendar

  $(".//div[@id='ga-container']") {
    add_class("mw_signup")
    $(".//h1|.//*[contains(@class, 'ObjTitle')]") {
      add_class("mw_h1")
    }

    # remove stuff
    remove("following-sibling::div[//img[@alt='Powered By Convio']]")

    # deal with some table nesting
    move_here(".//div[contains(@class, '_footer')]")
    # grab the spillover link
    move_here("//a[@class='mw_header_spillover']", "top") {
      remove("@style")
      move_here("//div[@id='ga-header']") {
        # fix images in header
        $img_src = fetch(".//img/@src")
        $img_src {
          replace(/org\/\//, 'org\/')
          replace(/\/site/, '')
        }
        $(".//img") {
          attribute("src", $img_src)
        }
      }
    }



    $(".//div[@id='ga-content']") {
      move_here(".//div[@id='ga-header']")
      move_here(".//div[div[@class='appArea']]") { // can I assume there's only one of these?
        add_class("mw_signup_form")
      }
      # get empty tables
      # remove("./div[not(contains(@class, 'mw_signup_form'))]")
    }

    # main form content
    $(".//div[contains(@class, 'mw_signup_form')]") {
      $(".//p[input[@type='submit']]") {
        add_class("mw_buttonRow")
        name("div")
      }
      # fix tables in tables in tables
      $(".//div[contains(@class, 'mw_was_tr')]") {
        move_here(".//div[contains(@class, 'mw_was_tr')]")
        remove(".//div[contains(@class, 'mw_was_tbl')]")
      }
    }
    
    $("./div[@id='ga-content']/div[contains(@class, 'mw_signup_form')]/form/div[@class='appArea']") {
      $("./div[contains(@class, 'mw_was_tbl')]") {
        $("./div[contains(@class, 'mw_was_tr')][./div[contains(@class, 'mw_was_td')][./p[contains(text(), 'Name')]]]") {
          $("./div[contains(@class, 'mw_was_tr')]") {
            add_class("mw_row_width")
          }
          insert_bottom("div", class:"mw_row_align") {
            move_here("./preceding-sibling::div[contains(@class, 'mw_row_width')]", "bottom") {
              remove("./div[contains(@class, 'mw_was_td')]/text()")
            }
          }
        }
        # remove extra space
        $("./div[contains(@class, 'mw_was_tr')]") {
          $("./div[contains(@class, 'mw_was_td')]/p[not(*)][text()] | ./div[contains(@class, 'req')][not(*)][text()]") {
            inner() {
              replace(/^[\s\u00a0]+/, "")
              replace(/[\s\u00a0]+\|$/, "")
            }
          }
        }
        $("./div[contains(@class, 'mw_was_tr')][.//span[@class='Explicit'][contains(text(), 'number')]]//input[@type='text']") {
          attribute("type", "tel")
        }
        # Fix for HSUS-505
        $(".//span[contains(., 'Phone number')]"){
          text(){prepend("1. ")}
        }
        $(".//span[contains(., 'Mobile number')]"){
          text(){prepend("2. ")}
        }
        # Fix for HSUS-505
      }
      $("./p[./strong]") {
        add_class("mw_padding_space")
      }
      # HSUS-504 Start
      $("./br") {
        add_class("no_remove")
      }
      # HSUS-504 End
    }
    $(".//select[@id='days']") {
      wrap("div", class:"mw_days") {
        insert_bottom("span", class:"mw_days_icon")
        insert_bottom("span", class:"mw_days_border")
      }
    }
  }

  # Fixed img src
  $(".//img") {
    attribute("src") {
      value() {
        replace(/(org\/).*(\.\.)/) {
          set($1+$2)
        }
      }
    }
  }
  # HSUS-504 Start
  $(".//br[not(contains(@class,'no_remove'))]") {
  #  remove()
  }
  # HSUS-505
  $(".//br") {
    remove("./@class")
  }
  # HSUS-504 End

  //HSUS-505
  $(".//img[@class='ga-headerImgAlign']"){
  #  move_to("//div[@id='ga-container']", "before")
  }

}
#http://mlocal.action.humanesociety.org/site/Calendar?id=109422&view=Detail&autologin=true

$("./body") {
  add_class("mw_calendar_page") 

 
  $("./div[@id='ga-container']") {
    add_class("mw_main")
  }  
  $("./div[@id='ga-container']/div[@id='ga-content']") {
    add_class("mw_box2_tablet")    
  }
  
  $(".//div[@id='ga-container']") {
    move_here(".//div[contains(@class, '_footer')]")
    move_here(".//div[@id='ga-header']", "top") {
      wrap("a", href:fetch("//a[@class='mw_header_spillover']/@href"), class:"mw_header_full_width")
      $("./ancestor::td[1]") {
        add_class("mw_header_full_width")
      }
    }
  }
  # fix tables
  $(".//table") {
    $(".//tr") {
      $("./td|./th") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }
  $(".//div") {
    remove("@style")
  }
  $(".//div[@id='ga-content']") {
    # remove whitespace chunks
    $(".//div[contains(@class, 'mw_was_td')]") {
      wrap_text_children("span")
      $("./span") {
        inner() {
          replace(/\s\s[\s]*/, "")
        }
      }
      remove("./span[string-length(text)<2 and not(*)]")
    }

    # wrap the image element into a class
    $(".//span[@class='Explicit']/p") {
      $("following-sibling::div[contains(@class,'mw_was_tbl')]") {
        $(".//img") {
          wrap("div", class:"mw_main_img")
        }
      }
    }

    #removed calendar 
    remove(".//div[contains(@class, 'WrapperBack')]/preceding-sibling::p")      
    remove(".//div[contains(@class, 'WrapperBack')]")
    remove(".//a[contains(text(), 'Return to Calendar')]")

    #add class to the buy tickets button
    $(".//form[@name='UserDetail']/input[@id='buytickets']") {
      add_class("mw_signup_btn")
    }
  }  
 
}
# list of events for the day
# http://mlocal.action.humanesociety.org/site/Calendar/888008295?view=DayList&Day=6,4,2013

# March 6, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_cal_day")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//br")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  $(".//div") {
    remove("@style")
  }
  fixImages()

  # fix tables
  $(".//table") {
    $(".//th") {
      remove()
    }
    $(".//tr") {
      $("./td") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }

  # # ditch the weekly arrows
  # $(".//div[@valign='middle' and count(*)=1]") {
  #   remove()
  # }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    $(".//*") {
      remove("@style")
      remove("@width")
      remove("@align")
    }
    # top box with go to date
    $(".//div[@class='appArea'][2]") {
      add_class("mw_topbox")
      $(".//div[contains(@class, 'mw_was_td') and .//strong/a]") { // top line
        add_class("mw_today")
        $(".//strong") {
          wrap_text_children("span")
        }
      }
      # wrap stuff into gray box
      $(".//div[@valign='middle']") {
        insert("div", class:"mw_graybox") {
          move_here("../div[not(contains(@class, 'mw_today'))]")
          $(".//div[@bgcolor]") {
            add_class("mw_gobutton")
            remove("@bgcolor")
            wrap_text_children("span")
            remove("span")
          }
        }
      }
      $(".//form[@id='cal_form_3']//div[contains(@class, 'mw_today')]") {
        $(".//span") { // trim whitespace
          text() {
            replace(/\s*$/, "")
            replace(/^\s*/, " ")
          }
        }
      }
      $(".//label[@class='wrapable']") {
        remove()
      }

      $(".//div[@valign='middle']") 
    }
  }

  # bottom section with calendar
  $(".//div[@class='appArea' and ./div]") {
    add_class("mw_calendar")
    $("./div[1]") {
      add_class("mw_cal_head")
      move_here(".//div[contains(@class, 'mw_was_td')]")
      # remove("./div[@valign='middle']")
      # tag month name
      # $("./div[2]") {
      #   add_class("mw_month")
      #   remove(".//a")
      #   move_to("..", "bottom")
      # }
    }
    # tidy up dates
    $(".//div[@valign='top' and contains(@class, 'mw_was_td')]") {
      add_class("mw_date")
      # trim whitespace on number
      $("./p[not(a)]") {
        inner() {
          replace(/[\s]*$/, '')
        }
      }
    }
    $(".//img") {
      remove("@height")
      # fixing bad image src
      $image_src = fetch("@src")
      $image_src {
        replace(/site\/Calendar\//, '')
      }
      attribute("src", $image_src)
    }
  }

  # $(".//p[@class='callist']") {
  #   $(".//span[@class='callistevent']") {
  #     wrap_text_children("span", class: "mw_remove")
  #     remove(".//span[@class='mw_remove']")
  #   }
  # }

  $("./div[@id='wrapper']/div[contains(@class, 'mw_masthead')]") {
    move_here("./ancestor::html[1]/head/img[@id='desktop_head']", "bottom") {
      attribute("class", fetch("./preceding-sibling::img[1]/@class"))
    }
    remove("./img[not(@id='desktop_head')][@class='mw_tablet_masthead_image']")
  }
}
# event detail pages
# http://action.humanesociety.org/site/Calendar/1679217372?view=Detail&id=108621

# April 11, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_cal_event")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//br")
  remove(".//div[.//img[@alt='Powered By Convio']]") # dat sum convio? gtfo
  remove(".//p[./a/img[contains(@src, 'rsvp')]]")
  # remove(".//div[@id='contentDiv']/div[not(@id)]")
  $(".//div") {
    remove("@style")
  }

  # fix tables
  $(".//table") {
    $(".//tr") {
      $("./td") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
  }

  #remove more stuff
  # remove(".//div[@id='ga-header']")

  $(".//div[@id='ga-container']") {
    move_here(".//div[contains(@class, '_footer')]")
    move_here(".//div[@id='ga-header']", "top") {
      # %home = fetch("//a[@class='mw_header_spillover']/@href")
      wrap("a", href:fetch("//a[@class='mw_header_spillover']/@href"), class:"mw_header_full_width")

      $("./ancestor::td[1]") {
        add_class("mw_header_full_width")
      }
    }
  }

  $(".//div[@id='ga-content']") {
    add_class("mw_box2_tablet")
    move_here(".//div[@class=' mw_was_tr']")
    $(".//div[contains(@class, 'footer')]") {
      move_to("..", "bottom")
    }
    remove(".//table")
    remove("./div[contains(@class, 'mw_was_tr') and .//div[contains(@class, 'minical')]]")

    # remove whitespace chunks
    $(".//div[contains(@class, 'mw_was_td')]") {
      wrap_text_children("span")
      $("./span") {
        inner() {
          replace(/\s\s[\s]*/, "")
        }
      }
      remove("./span[string-length(text)<2 and not(*)]")
    }

    # locate and tag stuff
    $(".//a[contains(text(), 'Facebook')]") {
      add_class("mw_facebook_link")
    }
    $(".//div[.//li[contains(@style, '#a7a7a7')] and not(@class)]") { //footer stuff
      add_class("mw_event_foot")
      move_to("//div[contains(@class, '_footer')]")
    }
    # back link
    $(".//div[.//a[contains(text(), 'Return to Calendar')] and contains(@class, 'mw_was_tr')]") {
      add_class("mw_back")
      move_here(".//a") // aggghhhh nesting
      remove("./div")
      $("./a") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    # grab the main image
    $(".//div[@valign='top']") {
      # HSUS-412 : (Mobile & Tablet) Element not appearing on Calendar event
      move_here("//img[@align='bottom']/ancestor::div[contains(@class, 'mw_was_tr')]/following-sibling::div", "top")
      move_here("//img[@align='bottom']", "top")
      $("./img") {
        wrap("div", class:"mw_main_img")
      }
    }
  }
  # HSUS-479 - hiding the "Powered by blackbaud" image/link at bottom of pages
  $(".//div[a[contains(@href, 'convio.com/poweredby')]]") {
    add_class("mw_hide")
  }

  //HSUS-505
  $(".//span[@class='Explicit']"){
    insert_after("br", class:"mw-br")
  }

}


$("./body") {
  add_class("mw_legacy_article_tablet")

  remove("./div[@id='wrapper']/br")

  # Hide the empty spacer at the bottom
  $(".//div[@id='contentDiv']") {
    $("./div[@style]") {
      remove()
    }
  }

  # change the forced width of the tables
  $(".//table[@width]") {
    attribute("width", "70%")
  }

  # Make the main the white box
  $(".//div[@id='main']") {
    add_class("mw_box2_tablet")

    $("./div[@id='give']") {
      add_class("mw_gray_inner")
    }

    $(".//span[@class='headlineFont']") {
      add_class("mw_h2")
      # Make the title one line
      remove("./br")
    }

    $(".//span[@class='stelterArticleTitle']") {
      add_class("mw_h3")
    }

    # remove the left padding of the toolkit
    $(".//div[@id='toolkit']") {
      # Remove the Styling
      remove("./@style")
    }

    # HSUS-390
    # ref url: http://legacy.humanesociety.org/index.php?article=424&featured=true
    # Apparently some tables are stuffed in the cga_chart
    $(".//div[@id='cga_chart']/table[@class='giftsBody']/..") {
      # this will override the default hiding of the chart.
      # hopefully this does not break other things
      add_class("table")
    }

    # Remove the background image of the moreabout
    $(".//div[@id='moreabout']") {
      remove("@style")
    }

    # HSUS-386 Stelter Copyright Information
    $(".//span[@class='legalBodyFont']/p[contains(text(), 'Copyright')]") {
      add_class("mw_legal_copyright")
    }

  }

  #change the <span type="text/css"> back into style
  $(".//span[@type='text/css']") {
    name("style")
  }

  # Sidebar stuff
  $(".//div[@id='side']") {

    # Move the Explore links inside main
    $(".//span[@class='includeDocument']") {
      name("div")
      $("./li") {
        name("div")

        move_here(".//a")
        $("./a") {
          add_class("mw_bar3")
        }
        # HSUS-439 remove 'explore'
        remove(".//a[contains(@class,'explore')]")
        $("./a[1] | ./a[2]") {
          add_class("mw-half-width")
        }

        remove("./ul")
      }
      move_to("./ancestor::div[@id='cols']/div[@id='main']", "bottom")
    }

    # Make the action sidebar
    $(".//ul[@id='action']") {
      add_class('mw_sidebar1 mw_sidebar1_h')
      move_to("./ancestor::div[@id='cols']/div[@id='main']", "bottom")
    }
  }

  # For forms, make the submit button big
  $(".//input[@type='submit']") {
    add_class("mw_btn1")
  }

  # Make any input contextual
  contextual_keyboard(".//input[@name='email']", 'email')
  contextual_keyboard(".//input[@name='phone']", 'tel')

}
$("./body") {
  add_class("mw_legacy_root")

  remove("./div[@id='wrapper']/br")

  # Hide the empty spacer at the bottom
  $(".//div[@id='contentDiv']") {
    $("./div[@style]") {
      remove()
    }
  }

  # Make the main the white box
  $(".//div[@id='main']") {
    add_class("mw_box2")
    #For HSUS-388 : (Mobile & Tablet) Improvements to Legacy Landing Page
    $("./div[@id='give']") {
      add_class("mw_gray_inner")
      $("./div[contains(@class, 'stlfeature')]") {
        $("./h2") {
          add_class("mw_brown")
        }
      }  
      $("./div[contains(@class, 'area-news')]") {
        $("./h2") {
          add_class("mw_brown")
        }
        $("./div[contains(@class, 'sgrouplast')]"){
         add_class("noBorder")
        }
      }
    }
    #End of HSUS-388
    $(".//h2") {
      add_class("mw_h2")
      # Make the title one line
      remove("./br")
    }

    $(".//h3") {
      add_class("mw_h3")
    }

    # remove the left padding of the toolkit
    $(".//div[@id='toolkit']") {
      # Remove the Styling
      remove("./@style")
    }

    # Remove the background image of the moreabout
    $(".//div[@id='moreabout']") {
      remove("@style | ./ul/li/br")
      $("./ul/li/a") {
        inner(" "+fetch("./text()"))
      }
    }
  }

  # Sidebar stuff
  $(".//div[@id='side']") {

    # Move the Explore links inside main
    $(".//span[@class='includeDocument']") {
      name("div")
      $("./li") {
        name("div")
        # HSUS-439 remove 'explore'
        remove(".//a[contains(@class,'explore')]")
        $(".//a") {
          add_class("mw_bar3")
        }
      }
      move_to("./ancestor::div[@id='cols']/div[@id='main']//div[@id='give']", "bottom")
    }

    # Make the action sidebar
    $(".//ul[@id='action']") {
      add_class('mw_box5')
    }
  }
}
$("./body") {
  add_class("mw_legacy_root_tablet")

  # Hide the empty spacer at the bottom
  $(".//div[@id='contentDiv']") {
    $("./div[@style]") {
      remove()
    }
  }

  # remove extra space
  remove("./div[@id='wrapper']/br")

  # Make the main the white box
  $(".//div[@id='main']") {
    add_class("mw_box2_tablet")
    #For HSUS-388 : (Mobile & Tablet) Improvements to Legacy Landing Page
    $("./div[@id='give']") {
      add_class("mw_gray_inner")
      $("./div[contains(@class, 'stlfeature')]") {
        $("./h2") {
          add_class("mw_brown")
        }
      }
      $("./div[contains(@class, 'area-news')]") {
        $("./h2") {
          add_class("mw_brown")
        }
        $("./div[contains(@class, 'sgrouplast')]"){
          add_class("noBorder")
        }
      }
    }
    #End of HSUS-388 
    $(".//h2") {
      add_class("mw_h2")
      # Make the title one line
      remove("./br")
    }

    $(".//h3") {
      add_class("mw_h3")
    }

    # remove the left padding of the toolkit
    $(".//div[@id='toolkit']") {
      # Remove the Styling
      remove("./@style")
    }
     # remove the left padding of the toolkit

    # Remove the background image of the moreabout
    $(".//div[@id='moreabout']") {
      remove("@style | ./ul/li/br")
      $("./ul/li/a") {
        inner(" "+fetch("./text()"))
      }
    }
  }

  # Sidebar stuff
  $(".//div[@id='side']") {

    # Move the Explore links inside main
    $(".//span[@class='includeDocument']") {
      name("div")
      $("./li") {
        name("div")

        move_here(".//a")
        $("./a") {
          add_class("mw_bar3")
        }

        # HSUS-439 remove 'explore'
        remove(".//a[contains(@class,'explore')]")
        $("./a[1] | ./a[2]") {
          add_class("mw-half-width")
        }

        remove("./ul")
      }
      move_to("./ancestor::div[@id='cols']/div[@id='main']//div[@id='give']", "bottom")
    }

    # Make the action sidebar
    $(".//ul[@id='action']") {
      add_class('mw_sidebar1 mw_sidebar1_h')
      move_to("./ancestor::div[@id='cols']/div[@id='main']", "bottom")
    }
  }
}
$("./body") {
  add_class("mw_legacy_contact")
  $("./div[@id='wrapper']/div[@id='page']") {
    remove("./following-sibling::br")
    $("./div[@id='contentDiv']/div[@id='cols']") {
      remove("./following-sibling::div[contains(@style, 'height')][not(@id)]")
      $("./div[@id='main']") {
        add_class("mw_box2")
        $("./div[@id='give']") {
          $("./div[@id='stl_content']/div[@id='contactUsPage']") {
            $("./div[@id='pageTitle']/span[@class='pageTitle']") {
              add_class("mw_h2")
            }
            $("./div[@id='organizationInfo']/span[@class='orgTitle']") {
              add_class("mw_h3")
            }
            $("./div[@class='contactInfo']") {
              wrap_text_children("span")
              $("./span[@class='contactPhone']/following-sibling::span[1]") {
                name("a")
                attribute("href", "tel:"+fetch("./text()")) {
                  value() {
                    replace(/-/, "")
                  }
                }
              }
            }
            $(".//td[@class='cuSubmit']/input[@class='stelterbutton'][@type='submit']") {
              add_class("mw_btn1")
            }
          }
          $("./div[@id='stl_content']/p/span[@class='headlineFont']") {
            add_class("mw_h2")
          }
        }
        move_here("./following-sibling::div[@id='side']/ul[@id='action']/span[@class='includeDocument']/li[@class='expanded_landing']", "bottom") {
          name("div")
          remove(".//a[contains(@class,'explore')]")
          move_here("./ul/li/a", "bottom")
          remove("./ul | ./text()")
          $("./a") {
            add_class("mw_bar3")
          }
        }
      }
      $("./div[@id='side']/ul[@id='action']") {
        add_class("mw_box5")
        remove("./span[@class='includeDocument']")
      }
    }
  }
}
$("./body") {
  add_class("mw_legacy_article")

  remove("./div[@id='wrapper']/br")

  # Hide the empty spacer at the bottom
  $(".//div[@id='contentDiv']") {
    $("./div[@style]") {
      remove()
    }
  }

  # Some LIs are outside

  # change the forced width of the tables
  $(".//table[@width]") {
    # remove("./@width")
  }
  $(".//td/table/..") {
    remove("./@width")
    add_class("mw_td_contains_table")
  }

  # Make the main the white box
  $(".//div[@id='main']") {
    add_class("mw_box2")

    $(".//span[@class='headlineFont']") {
      add_class("mw_h2")
      # Make the title one line
      remove("./br")
    }

    $(".//span[@class='stelterArticleTitle']") {
      add_class("mw_h3")
    }

    # remove the left padding of the toolkit
    $(".//div[@id='toolkit']") {
      # Remove the Styling
      remove("./@style")
    }

    # HSUS-390
    # ref url: http://legacy.humanesociety.org/index.php?article=424&featured=true
    # Apparently some tables are stuffed in the cga_chart
    $(".//div[@id='cga_chart']/table[@class='giftsBody']/..") {
      # this will override the default hiding of the chart.
      # hopefully this does not break other things
      add_class("table")
    }

    # Remove the background image of the moreabout
    $(".//div[@id='moreabout']") {
      remove("@style")
    }
    # HSUS-386 Stelter Copyright Information
    $(".//span[@class='legalBodyFont']/p[contains(text(), 'Copyright')]") {
      add_class("mw_legal_copyright")
    }
  }

  # Next Steps.. trying to turn this into a list
  $(".//div[contains(@id, 'scroll_box')]") {
    wrap_text_children("span", class:"mw_hide")

    $("./span[a]") {
      wrap_text_children("span", class:"mw_hide")
    }

  }

  #change the <span type="text/css"> back into style
  $(".//span[@type='text/css']") {
    name("style")
  }

  # Sidebar stuff
  $(".//div[@id='side']") {

    # Move the Explore links inside main
    $(".//span[@class='includeDocument']") {
      name("div")
      $("./li") {
        name("div")
        remove(".//a[contains(@class,'explore')]")
        $(".//a") {
          add_class("mw_bar3")
        }
      }
      move_to("./ancestor::div[@id='cols']/div[@id='main']", "bottom")
    }

    # Make the action sidebar
    $(".//ul[@id='action']") {
      add_class('mw_box5')
    }
  }

  # For forms, make the submit button big
  $(".//input[@type='submit']") {
    add_class("mw_btn1")
  }

  # Remove any fixed sizes on the textboxes
  $(".//input") {
    remove("@size")
  }

  # Make any input contextual
  contextual_keyboard(".//input[contains(@name, 'email')]", 'email')
  contextual_keyboard(".//input[contains(@name, 'phone')] | .//input[contains(@id, 'phone')]", 'tel')
  contextual_keyboard(".//input[contains(@id, 'postal')]", "numeric")
}
$("./body") {
  add_class("mw_legacy_contact_tablet")
  $("./div[@id='wrapper']/div[@id='page']") {
    remove("./following-sibling::br")
    $("./div[@id='contentDiv']/div[@id='cols']") {
      remove("./following-sibling::div[contains(@style, 'height')][not(@id)]")
      $("./div[@id='main']") {
        add_class("mw_box2_tablet")
        $("./div[@id='give']") {
          add_class("mw_gray_inner")
          $("./div[@id='stl_content']/div[@id='contactUsPage']") {
            $("./div[@id='pageTitle']/span[@class='pageTitle']") {
              add_class("mw_h2")
            }
            $("./div[@id='organizationInfo']/span[@class='orgTitle']") {
              add_class("mw_h3")
            }
            $(".//td[@class='cuSubmit']/input[@class='stelterbutton'][@type='submit']") {
              add_class("mw_btn1")
            }
          }
          $("./div[@id='stl_content']/p/span[@class='headlineFont']") {
            add_class("mw_h2")
          }
        }
        move_here("./following-sibling::div[@id='side']/ul[@id='action']/span[@class='includeDocument']/li[@class='expanded_landing']", "bottom") {
          name("div")
          move_here("./ul/li/a", "bottom")
          remove("./ul | ./text()")
          $("./a") {
            add_class("mw_bar3")
          }
          # HSUS-439 remove 'explore'
          remove(".//a[contains(@class,'explore')]")
          $("./a[1] | ./a[2]") {
            add_class("mw-half-width")
          }
        }
        move_here("./following-sibling::div[@id='side']/ul[@id='action']", "bottom") {
          add_class("mw_sidebar1_h")
          remove("./span[@class='includeDocument']")
        }
      }
    }
  }
}
# Animal main page
# http://www.humanesociety.org/animal_community/
# 
# km cY7 Rmd
# Feb 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='resources']") {
    add_class("mw_sidebar2")
    $("./h2") {
      inject("Resources for <strong> the Animal Care Community</strong>")
      add_class("mw_h2")
    }
    $(".//a") {
      inject("  &raquo;  ")
    }
  }

}
# similar to main animals and action
# http://www.humanesociety.org/parents_educators/
# 
# km cY7 Rmd
# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_parents")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  # main content
  $(".//div[@id='main']") {

    $(".//div[@id='features']") { // swap stuff in the resources section
      $(".//li") {
        $("./p[@class='image']") {
          move_to("..", "top")
        }
        $(".//a[@class='more']") {
          inner() {
            replace(/\xC2\xA0/, "")
          }
        }
      }
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//li") {
        add_class("mw_newsItem")
      }
      $(".//a[@class='more']") {
        wrap("div", class:"more-link")
      }
    }
  }

  # side bar
  $(".//div[@id='resources']") {
    add_class("mw_sidebar2")
    $(".//a") {
      inject("  &raquo;  ")
    }
  }

}
# social media stuff!
# http://www.humanesociety.org/community/connect.html
# 
# March 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community mw_connect") // use the same styling as the main page

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//br")
  remove(".//hr")
  remove(".//div[@id='fb_likebox']")
  remove(".//div[@id='twitter_feed']")
  remove(".//div[@id='wayne_feed']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3|.//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }
  $(".//a[@class='back']") {
    inner() {
      prepend("  &laquo;  ")
    }
  }

  # social networks
  $(".//div[@id='button_container']") {
    $(".//p") {
      add_class("mw_social_button")
    }
  }

  # form to get texts
  $(".//div[@id='mobile']") {
    $("./div[@id='mobile_text']") {
      $("./form") {
        add_class("mw_text_signup")
        $(".//input[@type='text' or type='submit']") {
          wrap("div") {
            add_class("mw_text_input")
          }
        }
      }
      $("./a") {
        remove("@style")
        wrap("p")
      }
    }
    $("./div[@id='humane_tv_app']") {
      $("./span") {
        remove("@style")
        $(".//img") {
          remove("@width")
        }
        $(".//img[contains(@src, 'tv_')]") {
          add_class("mw_tv_app")
        }
      }
      remove("./strong")
    }
  }

  # causes and youtube
  $(".//div[@id='social_feeds']") {
    $(".//iframe[1]") {
      attribute("height", "250px")
    }
    $(".//iframe[2]") {
      attribute("height", "100px")
    }
  }

  # bottom two iframes need to be 250 and 100px tall


}
# animal care centers and shelters
# http://www.humanesociety.org/animal_community/shelters/cape.html
# 
# km cY7 Rmd
# Feb 14 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community") // use the same styling as the main page


  # remove the odd text nodes that are adding strange text
  wrap_text_children("span", class:"mw_hide")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  # remove(".//div[@id='feature']") //v c
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//br")
  remove(".//div[@id='related-content']/h2/@class")
  remove(".//div[@id='related-content']/h3/@class")
  
  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3|.//p[@class='author' or @class='subhead']") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='main']") {
    $(".//div[contains(@class, 'area-news')]") {
      $(".//li") {
        add_class("mw_news_item")
      }
      $(".//iframe") {
        remove("@style")
      }
    }
    $(".//ul[not(@id)]") {
      add_class("mw_ul")
    }
    # HSUS-148 South Florida Wildlife Center page styling
    $("./div[@id='feature']") {
      $("./h3[contains(@class,'mw_h3')]/following-sibling::p[1]") {
        name("div")
        wrap_text_children("span")
        $("./a") {
          wrap("div", class:"mw_feature_link")
        }
        $("./span") {
          move_to("preceding-sibling::div[@class='mw_feature_link']", "bottom")
        }
      }
    }
    $("./div[@id='feature' and not(*)]") {
      remove() // empty feature go byebye
    }
    $(".//blockquote//h2") {
      remove("@class")
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='resources']") {
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//h2[string-length()<1]") {
        inject("Resources for <strong> the Animal Care Community</strong>")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  $("./div[@id='related-content']") {
    add_class("mw_box8")
    $("./div/h3/a") {
      inject("  &raquo;  ")
    }
    $("./div/h3"){
      attributes(class:"")
    }
  }
  }

  # remove ads
  $(".//a[contains(@href, 'ads')]/..") {
    log("found an Ad")
    add_class("mw_hide")
  }
}
# resources for volunteers
# http://www.humanesociety.org/community/volunteers
# 
# km cY7 Rmd
# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_vols") // use the same styling as the main page

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  # HSUS-149 Join Us as Volunteer: Missing section
 
  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='features']") {
    $(".//li") {
      move_here("./p[@class='image']", "top")
    }
    $("./p[not(*)]") {
      match(fetch("./text()"), /\A[\s ]*\Z/) {
        remove()
      }
    }
  }

  # HSUS-314 US maps
  $(".//div[@id='main']") {
    $("./div[contains(@class, 'section-lead')]/table[.//map[@id='Map']]") {
      insert_before("div", class:"mw_map_locations", id:"us_map", data-ur-set:"toggler") {
        insert("div", "United States", class:"mw_location_header mw_bar5", data-ur-toggler-component:"button") {
          insert("span", " Tap to ", class: "mw_tap")
        }
        copy_here("../table//area")
        wrap_together("./area", "div", data-ur-toggler-component: "content") {
          $("./area") {
            %location = fetch("@alt")
            name("a")
            add_class("mw_bar4 mw_state")
            remove("@coords")
            text(%location)
            rewrite_links()
          }
        }
        attribute("data-ur-state", "enabled")
        $("./div") {
          attribute("data-ur-state", "enabled")
        }
      }
      $("following-sibling::div[.//select[@name='states']][1]") {
        add_class("mw_hide")
      }
      remove()
    }
    $(".//div[contains(@class, 's_borderless')]") {
      # HSUS-340 Styling Tweaks to Faith Volunteering Page
      # URL: http://www.humanesociety.org/community/volunteers/volunteer_leader_faith_outreach.html
      match($path, /volunteer_leader_faith_outreach/) {
        add_class("mw_faith")
        $(".//ul[not(@id)]") {
          add_class("mw_list1")
        }
        $("./p[./br][./strong]") {
          $("./br/preceding-sibling::strong[1]") {
            add_class("mw_break_line")
          }
        }
        $("./p[./strong]") {
          add_class("mw_p_title")
        }
      }
    }
    # HSUS-314 add line break
    $(".//div[@id='feature']/blockquote/p[@class='image']/following-sibling::span[1]") {
      name("div")
    }
  }
  # end of HSUS-314

  # for URL:http://www.humanesociety.org/community/volunteers/volunteer_leader_faith_outreach.html
  $(".//div[@id='side']/div[@id='related-content']") {
    add_class("mw_sidebar3")
  }
  # remove(".//div[@id='feature']") //v c
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//br")
}
# resources main
# http://www.humanesociety.org/animal_community/resources/
# 
# km cY7 Rmd
# Feb 14 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press mw_news_base")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//div[@id='bottom-pagination']")
  remove(".//br")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
    }
  }

  $(".//div[@id^='templatelist']") {
    insert("div") {
      move_here("../div[@id='list-nav']")
      move_here("../div[@id='sortby']")
    }
  }

  $(".//div[contains(@class, 's_borderless') and not(@id)]") {
    add_class("mw_content") // css selectors would be too cumbersome
    move_here("../../ul[@id='tools']", "top")
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
      $("./h2") {
        inject("Resources for <strong> the Animal Care Community</strong>")
        add_class("mw_h2")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

}
$("./body") {
  add_class("mw_email_preferences_tablet")
  remove(".//img[@id='desktop_head'] | .//div[@id='page-head']")
  $(".//div[@id='contentDiv']") {
    remove("./div[@id='head'] | ./div/@style")
    $("./div[not(*)]") {
      match(text(), /\A\s+\Z/) {
        remove()
      }
    }
    $("./div[@id='cols']") {
      add_class("mw_box2_tablet")
      $("./div[@id='main']") {
        add_class("mw_gray_inner")
        remove(".//div[@id='wrapper-body']/@style")
        $(".//h3[@class='ObjTitle']") {
          add_class("mw_h1")
        }
        $(".//input[@class='Button']") {
          add_class("mw_btn2")
        }
      }
    }
    # For "Unsubscribe Request" page
    $(".//label[@for='first_name']/ancestor::table[1]") {
      add_class("mw_URtable")
    }
  }
}
# Search Results page
# http://www.humanesociety.org/search/search.jsp?query=rats
# using mockup 05-search-results.png

# March 27 2013 Sarah LaFrance

$("./body") {
  add_class("mw_search_results")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")

  # Repair the google custom search
  $(".//div[@id='main']") {
    wrap_text_children("span", class:"mw_hide")
    insert("gcse:search")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  # search again and filter
  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//label") {
      wrap_text_children("span")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//p[not(button)]") {
        add_class("mw_sort_select")
      }
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
      $(".//label[@for='sortbytype']/span") {
        text() {
          replace("Content ", "")
        }
      }
    }
  }

  # results

  $(".//div[@id='main']/div[ul[@class='item-list' and ./*]]") {
    attribute("id", "mw_main_results")
    $(".//h2[@class='suggestions' or @class='results']") {
      add_class("mw_h2")
      inject("  :  ")
    }

    $(".//div[@id='featuredSearch']") {
      remove("@style")
    }

    $(".//ul[@class='item-list']") {
      $(".//h2") {
        add_class("mw_h3")
      }
      $(".//p[@class='related']") {
        wrap_text_children("span") {
          text() {
            replace("Related", "Related  :  ")
          }
        }
      }
    }
  }

  # page numbers, adapted from press.ts
  $(".//div[contains(@class, 'pagination') and contains(@class, 'section')]") {
    attribute("id", "mw_pages")
    $(".//li[not(a)]") {
      add_class("mw_current")
    }
    $current = fetch(".//li[contains(@class, 'mw_current')]/text()")
    $previous = "false"
    $next = "false"
    $(".//li/a[@class='prev']") {
      $previous = "true"
      inner() {
        prepend("  &laquo;  ")
      }
    }
    $(".//li/a[@class='next']") {
      $next = "true"
      inner() {
        append("  &raquo;  ")
      }
    }

    $(".//li[contains(@class, 'mw_current')]") { 
      insert_before("div", class:"mw_pages") {
        move_here("../li[not(a[@class='prev']) and not(a[@class='next'])]")
        # tablets are pretty wide so I'm leaving all ten numbers in.
      }
    }
  }

  # check if there's only this one page of results
  $(".//div[@id='main' and not(div[@id='mw_pages'])]") {
    add_class("mw_one_page")
  }

  # sidebar
  $(".//div[@id='side']") {
    remove("./div")
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }
}
# list of events for the day
# http://mlocal.action.humanesociety.org/site/Calendar/888008295?view=DayList&Day=6,4,2013

# March 6, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_grid_day")

    ### fixing some inline js for HSUS-484
    $(".//script[contains(text(), 'jQuery')]") {
      inner() {
       replace("jQuery", "x$")
       replace("var theId=x$(this).attr('id')", "var theId=x$(this).attr('id')[0]")
       replace("removeAttr('onclick')", "attr('onclick', '')")
     }

   }

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//br")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  fixImages()

  # fix tables
  $(".//table") {
    $(".//tr") {
      $("./td|./th") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }

  # top box with go to date
  $(".//div[@id='main']") {
    $(".//*") {
      remove("@width")
      remove("@align")
    }
    $(".//*[not(contains(@class, 'mw_was_td'))]") {
      remove("@style")
    }
    $(".//div[contains(@class, 'mw_was_td') and .//strong/a]") { // top line
      add_class("mw_today")
      $(".//strong") {
        wrap_text_children("span")
        $("./a") {
          $today_link = fetch("@href")
          $today_link {
            replace(/List/, 'Grid')
          }
        }
      }
    }
    # $(".//div[@bgcolor]") {
    #   add_class("mw_gobutton")
    #   remove("@bgcolor")
    #   wrap_text_children("span")
    #   remove("span")
    # }
    $(".//form[@id='cal_form_3']") {
      # $(".//div[contains(@class, 'mw_today')]") {
      #   $(".//span") { // trim whitespace
      #     text() {
      #       replace(/\s*$/, "")
      #       replace(/^\s*/, " ")
      #     }
      #   }
      # }
      # $(".//label[@class='wrapable']") {
      #   remove()
      # }
      # $(".//fieldset[@id='_date']") {
      #   move_here(".//div[contains(@class, 'mw_was_td')]")
      #   name("div")
      # }

      # wrap the stuff for the gray box
      # $(".//div[@valign='middle']") {
      #   insert("div", class:"mw_graybox") {
      #     move_here("../div[not(contains(@class, 'mw_today'))]")
      #   }
      # }
    }
  }

      ########## HSUS - 484 ##############
      $(".//div[@id='cal_event_calendar']") {
        add_class("mw_calendar")
        $(".//div[contains(@class, 'notInMonth')]") {

        }
      }
      $(".//div[@id='orgevent_filters']") {
        add_class("mw_hide")
      }
      $(".//form[div[@id='oedatepicker']]") {
        add_class("mw_graybox")
        $(".//div[img]") {
          add_class("mw_hide")
        }
        $(".//div[input[@type='submit']]") {
          add_class("Button")
        }
      }


      $(".//div[contains(@class, 'month') or contains(@class, 'week')]/div[contains(@class, 'daysOfWeekHeader')]") {
        add_class("mw_days_of_week_header ")
        $(".//span[contains(@id, 'dayOfWeek')]") {
          inner() {
            replace(/(\S{3})\S*/, "$1")
          }
        }

      }   
      $(".//div[contains(@class, 'TabTable')]") {
        move_to("ancestor::div[contains(@class, 'mw_calendar')]", "before")
      }
      $(".//div[contains(@class, 'eventDetailPopupBox')]") {
        add_class("mw_hide")
      }
      $(".//div[contains(@class, 'notInMonth')]") {
        add_class("mw_yellow")
      }
      $(".//p[@class='eventTypeLegend']") {
        add_class("mw_hide")
      }
      $(".//div[contains(@class, 'mw_was_tbl')]/div[contains(@class, 'Header')]") {
        add_class("mw_header_row")
      }
      $(".//div[contains(@class, 'dayOfEventsHeader')]") {
        add_class("mw_hide")
      }
      $(".//div[contains(@class, 'month')]/div[contains(@class, 'daysOfWeekHeader') or contains(@class, 'weekOfMonth')]/div[contains(@class, 'mw_was_td')][1]") {
        add_class("mw_hide")
      }
      $(".//div[contains(@class, 'Navigator') or @class='listHeader']") {
        $("./span") {
          add_class("mw_month")
        }
        $(".//a/img[contains(@src, 'left')]") {
          insert_before("span", class: "mw_left_arrow")
          add_class("mw_hide")
        }
        $(".//a/img[contains(@src, 'right')]") {
          insert_before("span", class: "mw_right_arrow")
          add_class("mw_hide")
        }
      }
      $(".//div[contains(@class, 'dayOfMonth') or contains(@class, 'dayOfWeek')]") {
        $("./div[contains(@class, 'Month') or contains(@class, 'Week')]/a") {
          inner() {
            replace(/[^\d]/, "")
          }
        }
        $("./div[@class='dayEvents'][div]") {
          add_class("mw_hide")
          insert_before("div", class: "mw_event_dot")
        }
      }

    # tagging today's date
    $(".//div[contains(@class, 'currentDay')]/div[contains(@class, 'dayEvents')]") {
      add_class("mw_today_date")
    }

    ########## HSUS - 484 end ##############

  # bottom section with calendar
  # $(".//div[@class='appArea' and ./div]") {
  #   add_class("mw_calendar")
  #   # tag today's date
  #   $(".//div[contains(@class, 'mw_was_td') and ./p[@class='PaddedEntrySmall']/a[@href='"+$today_link+"']]") {
  #     add_class("mw_today_date")
  #   }
  # }


  # grab today's events and pull them into the bottom
  $(".//div[@id='wrapper-body']") {
    insert("div", class:"mw_today_events") {
      copy_here("//div[contains(@class, 'mw_today_date')]")
      $(".//p/a") {
        add_class("mw_head_link")
        text() {
          clear()
        }
        inject("Today's Events  :")
      }
    }
  }

  # main calendar
  $(".//div[contains(@class, 'mw_calendar')]") {
    remove("./p")
    move_here(".//div[contains(@class, 'Backed')]") // fix nesting issues
    # two tables here, top one's buttons and month name
    $("./div[1]") {
      add_class("mw_month_row")
      $(".//div[contains(@class, 'mw_was_td')][2]") {
     #   add_class("mw_month")
        # move_to("..", "bottom") # taken out HSUS-484
        # remove(".//a") # taken out HSUS-484

      }
    }
    # second one's the calendar
    $("./div[contains(@class, 'Backed')]") {
      remove(".//img")
      # remove arrows
      $(".//div[@valign='middle']") {
        remove()
      }
      # weeks are trs
      # days are tds
      $(".//div[contains(@class, 'mw_was_td')]") {
        $("./div") {
          remove() // get rid of events
        }
        # get rid of that stupid whitespace
        $("./p") {
          inner() {
            replace(/[\s]*$/, '')
          }
        }
        # does it have any events?
        $("self::*[p/a]") {
          add_class("mw_has_event")
          $(".//a") {
            $dot_link = fetch("@href")
            name("span")
          }
          wrap("a") {
            attributes(href:$dot_link)
          }
          insert("div", class:"mw_event_dot")
        }
        # is it yellow?
        $("self::*[contains(@style, 'FFCC')]") {
          add_class("mw_yellow")
          $("parent::a") {
            add_class("mw_yellow")
          }
        }
        remove("@style")
      }
    }
  }

  $(".//div[contains(@class, 'dayOfMonth')] | .//div[contains(@class, 'dayOfWeek')]"){
    %href = fetch(".//a/@href")
    attributes(href:%href)
    //name("span")
  }

}
$("./body") {
  add_class("mw_calendar_page")

  # removals
  remove(".//div[@id='ga-header']")
  remove(".//br")
  $(".//div") {
    remove("@style")
  }

  # fix tables
  table_dump(".//table")

  $(".//div[@id='ga-container']") {
    move_here(".//div[contains(@class, '_footer')]")
  }

  $(".//div[@id='ga-content']") {
    move_here(".//div[@class=' mw_was_tr']")
    $(".//div[contains(@class, 'footer')]") {
      move_to("..", "bottom")
    }
    remove(".//table")
    remove("./div[contains(@class, 'mw_was_tr') and .//div[contains(@class, 'minical')]]")

    # remove whitespace chunks
    $(".//div[contains(@class, 'mw_was_td')]") {
      wrap_text_children("span")
      $("./span") {
        inner() {
          replace(/\s\s[\s]*/, "")
        }
      }
      remove("./span[string-length(text)<2 and not(*)]")
    }

    # locate and tag stuff
    # back link
    $(".//div[.//a[contains(text(), 'Return to Calendar')] and contains(@class, 'mw_was_tr')]") {
      add_class("mw_back")
      move_here(".//a")
      remove("./div")
      $("./a") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    # grab the main image
    $(".//div[@valign='top']") {
      move_here("//img[@align='bottom']", "top")
      $("./img") {
        wrap("div", class:"mw_main_img")
      }
    }
  }
  # for http://action.humanesociety.org/site/Calendar?view=Detail&id=109422 header
  $("./div[@id='ga-container'][.//input[@id='buytickets']]/preceding-sibling::div[@class='mw_header']") {
    add_class("mw_single_header")
  }
  # HSUS-375 [Mobile & Tablet] Sacramento events page
  # Remove the the powered by convio
  remove("./div[a[contains(@href, 'convio')]]")  
  # end of HSUS-375
}  

# list of events for the day
# http://mlocal.action.humanesociety.org/site/Calendar/888008295?view=DayList&Day=6,4,2013

# March 6, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_cal_day")
  $(".//a[./img[contains(@src, 'share_on_twitter_small')]]") {
    add_class("mw_share_align")
    $("following-sibling::p[1]") {
      wrap_text_children("div", class: "mw_left_align")      
    }
  }

  $(".//a[./img[contains(@src, 'share_on_facebook_small')]]") {
    add_class("mw_share_align")
  }
  
  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  # HSUS-504 Start
  # remove(".//br")
  # HSUS-504 Start
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  $(".//div") {
    remove("@style")
  }
  fixImages()

  # fix tables
  $(".//table") {
    $(".//th") {
      remove()
    }
    $(".//tr") {
      $("./td") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }

  # ditch the weekly arrows
  $(".//div[@valign='middle' and count(*)=1]") {
    remove()
  }


  $(".//div[@id='main']") {
    $(".//*") {
      remove("@style")
      remove("@width")
      remove("@align")
    }
    # top box with go to date
    $(".//div[@class='appArea'][2]") {
      add_class("mw_topbox")
      $(".//div[contains(@class, 'mw_was_td') and .//strong/a]") { // top line
        add_class("mw_today")
        $(".//strong") {
          wrap_text_children("span")
        }
      }
      # wrap stuff into gray box
      $(".//div[@valign='middle']") {
        insert("div", class:"mw_graybox") {
          move_here("../div[not(contains(@class, 'mw_today'))]")
          $(".//div[@bgcolor]") {
            add_class("mw_gobutton")
            remove("@bgcolor")
            wrap_text_children("span")
            remove("span")
          }
        }
      }
      $(".//form[@id='cal_form_3']//div[contains(@class, 'mw_today')]") {
        $(".//span") { // trim whitespace
          text() {
            replace(/\s*$/, "")
            replace(/^\s*/, " ")
          }
        }
      }
      $(".//label[@class='wrapable']") {
        remove()
      }

      $(".//div[@valign='middle']") 
    }
  }

  # bottom section with calendar
  $(".//div[@class='appArea' and ./div]") {
    add_class("mw_calendar")
    $("./div[1]") {
      add_class("mw_cal_head")
      move_here(".//div[contains(@class, 'mw_was_td')]")
      remove("./div[@valign='middle']")
      # tag month name
      $("./div[2]") {
        add_class("mw_month")
        remove(".//a")
        move_to("..", "bottom")
      }
    }
    # tidy up dates
    $(".//div[@valign='top' and contains(@class, 'mw_was_td')]") {
      add_class("mw_date")
      # trim whitespace on number
      $("./p[not(a)]") {
        inner() {
          replace(/[\s]*$/, '')
        }
      }
    }
    $(".//img") {
      remove("@height")
      # fixing bad image src
      $image_src = fetch("@src")
      $image_src {
        replace(/site\/Calendar\//, '')
      }
      attribute("src", $image_src)
    }
  }

  $(".//p[@class='callist']") {
    $(".//span[@class='callistevent']") {
      wrap_text_children("span", class: "mw_remove")
      remove(".//span[@class='mw_remove']")
    }
  }

  # event sign up page
  $(".//div[@id='ga-content']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
  }

  # HSUS-479 fix RSVP page styling
  $(".//div[contains (@class, 'mw_cal_head')]"){
    $("./div[contains(@class, 'mw_was_tr')]"){
      remove()
    }
    $(".//div[contains(@class, 'mw_was_tbl')]"){
      remove()
    }
    $("./div[contains(@class, 'mw_was_td')]"){
      add_class("mw_rsvp")
    }
    $("./div[contains(@class,'mw_rsvp')]/p[contains(., '*')]"){
      remove()
    }
    $("./div[contains(., 'Name:')]"){
      insert_top("p","*", class:"mw_required")
      add_class("mw_rsvp_name")
    }
    $(".//label[@for='cons_email']"){
      $(".."){
        insert_before("p","*", class:"mw_required")
      }
      $("./span"){
       remove()
      }
    }
    $(".//input[@id='cons_email']"){
      $(".."){add_class("mw_email_wrapper NetscapeFix")}
    }
    $("./div[contains(., 'Last')]"){
      move_to("//div[contains(@class, 'NetscapeFix')][1]", "after")
    }
  }
  $(".//label[@for='rsvp_num_guests']"){
    move_here("../input","bottom")
  }
  $(".//strong[contains(., 'Please answer the following')]"){
    add_class("mw_bold")
  }
  $(".//input[@id='cons_email_opt_in']"){
    move_to("following-sibling::label[@for='cons_email_opt_in']", "top")
  }
  $(".//span[@class='num'][.='1.']"){
    remove()
  }
  $(".//span[@class='num'][.='2.']"){
    remove()
  }
  $(".//div[@class='req mw_was_td']"){
    remove()
  }
  $(".//span[contains(., 'Phone number')]"){
    text(){prepend("1. ")}
  }
  $(".//span[contains(., 'Mobile number')]"){
    # HSUS-504 Start
    text(){prepend("2. ")}
    # HSUS-504 End
  }
  $(".//p[@class='ErrorMessage']"){
    move_to("//div[contains(@class, 'mw_rsvp_name')][1]", "before")
  }
  $(".//input[@id='rsvp_save']/.."){
    add_class("response_wrapper")
    wrap_text_children("span")
    remove("./span")
  }

  //HSUS-505 add some classes to make styling easier
  $(".//div[contains(@class, 'mw_calendar')]"){
    $("./br"){
      remove()
    }
    wrap_text_children("div")
    $("./a[contains(@class, 'mw_share_align')]/preceding-sibling::p[1]"){
      add_class("mw_last_description")
    }
  }


  //true when there's an error message complaining a field wasn't filled out during submission
  $unfilledFields = "false"
  $(".//span[@class='ErrorMessage']"){
    $unfilledFields = "true"
  }

  match($unfilledFields){
    with(/false/){
      $(".//p[@class='ErrorMessage']"){
        add_class("mw_hide")
      }
    }
  }
  
}
# event detail pages
# http://action.humanesociety.org/site/Calendar/1679217372?view=Detail&id=108621

# March 6, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_cal_event")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//br")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  remove("./div[./a[contains(@href, 'poweredby')]]")
  $(".//div") {
    remove("@style")
  }

  # fix tables
  $(".//table") {
    $(".//tr") {
      $("./td") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
  }

  #remove more stuff
  //remove(".//div[@id='ga-header']")

  $(".//div[@id='ga-container']") {
    move_here(".//div[contains(@class, '_footer')]")
  }

  $(".//div[@id='ga-content']") {
    move_here(".//div[@class=' mw_was_tr']")
    $(".//div[contains(@class, 'footer')]") {
      move_to("..", "bottom")
    }
    //remove(".//table")
    //remove("./div[contains(@class, 'mw_was_tr') and .//div[contains(@class, 'minical')]]")

    # remove whitespace chunks
    $(".//div[contains(@class, 'mw_was_td')]") {
      wrap_text_children("span")
      $("./span") {
        inner() {
          replace(/\s\s[\s]*/, "")
        }
      }
      //remove("./span[string-length(text)<2 and not(*)]")
    }

    # locate and tag stuff
    $(".//a[contains(text(), 'Facebook')]") {
      add_class("mw_facebook_link")
    }
    $(".//div[.//li[contains(@style, '#a7a7a7')] and not(@class)]") { //footer stuff
      add_class("mw_event_foot")
      move_to("//div[contains(@class, '_footer')]")
    }
    # back link
    $(".//div[.//a[contains(text(), 'Return to Calendar')] and contains(@class, 'mw_was_tr')]") {
      add_class("mw_back")
      //commented this out because it was moving the "text alerts" link
      //move_here(".//a") // aggghhhh nesting
      //remove("./div")
      $("./a") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    # grab the main image
    $(".//div[@valign='top']") {
      # HSUS-412 : (Mobile & Tablet) Element not appearing on Calendar event
      move_here("//img[@align='bottom']/ancestor::div[contains(@class, 'mw_was_tr')]/following-sibling::div", "top")
      move_here("//img[@align='bottom']", "top")
      $("./img") {
        wrap("div", class:"mw_main_img")
      }
    }
  }
  # for http://action.humanesociety.org/site/Calendar?view=Detail&id=109422 header
  $("./div[@id='ga-container'][.//input[@id='buytickets']]/preceding-sibling::div[@class='mw_header']") {
    add_class("mw_single_header")
  }
  # Fix for HSUS-481
  $(".//div[@align='center']") {
    add_class("mw_hide")
  }  
  # End of HSUS-481

  //HSUS-479: Repair RSVP page
  $(".//div[contains(@class, 'mw_back')]"){
    move_to("//div[@id='ga-content']")
  }

  $(".//div[@valign='bottom']/div/p[text()='*']"){
    add_class("mw_inline_block mw_name_header")
    move_to("//div[@valign='bottom']/div/p[text()='Name:']", "before"){
      add_class("mw_inline_block mw_name_header")
    }
  }

  $(".//label[@for='cons_first_name']"){
    $("./span"){
      add_class("mw_hide")
    }
    //add_class("mw_inline_block")
    move_to("//input[@name='cons_first_name']", "before")
  }

  $(".//label[@for='cons_last_name']"){
    $("./span"){
      add_class("mw_hide")
    }
    //add_class("mw_inline_block")
    move_to("//input[@name='cons_last_name']", "before")
  }

  $(".//label[@for='cons_email']"){
    add_class("mw_inline_block")
    move_to("//input[@name='cons_email']", "before")
  }

  $(".//div[@width='1%']/p[text()='*']"){
    add_class("mw_inline_block")
    move_to("//label[@for='cons_email']", "before")
  }

  $(".//label[@for='cons_email_opt_in']/span"){
    add_class("mw_inline")
    move_to("//input[@id='cons_email_opt_in']", "after")
  }

  $(".//*[contains(text(), ' ')]"){
    text(){
      replace(/\xC2\xA0/, "")
    }
  }

  $(".//h3[@class='ObjTitle']"){
    add_class("mw_padding_bottom")
    move_to("//div[@id='ga-header']")
  }

  $(".//div[@class='appArea']/p[position()<3]"){
    add_class("mw_padding_bottom")
    move_to("//div[@id='ga-header']")
  }

  $(".//span[@class='num'][contains(text(), '1')]"){
    add_class("mw_inline")
    move_to("//span[contains (text(), 'Phone number (optional):')]", "before"){
      add_class("mw_inline")
    }
  }

  $(".//span[@class='num'][contains(text(), '2')]"){
    add_class("mw_inline")  
    move_to("//span[contains (text(), 'Mobile number (optional):')]", "before")
  }

  $(".//span[contains (text(), 'Phone number (optional):')]"){
    add_class("mw_inline")
  }

  $(".//span[contains (text(), 'Mobile number (optional):')]"){
    add_class("mw_inline")
  }

  $(".//a[contains(text(), 'text alerts')]"){
    add_class("mw_text_alerts") 
    text(){
      replace(/«/, "")
    }
  }

  $(".//input[@value='Submit'] | .//input[@value='Reset'] | .//input[@value='Cancel']"){
    add_class("mw_btn6 mw_rsvp_btn")
  }



}

# Animal main page
# http://www.humanesociety.org/animal_community/
# 
# km cY7 Rmd
# April 2 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
  }

   # For HSUS-378 -(Tablet) Fix styling of Yellow Boxes
    # sidebar
  $(".//div[@id='side']") {
    # donate action sidebar
    $("./ul") {
      attributes(class:"mw_sidebar1_h")
    }
    # resourse sidebar
    $("./div[@id='resources']") {
      add_class("mw_sidebar2")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//h2[string-length()<1]") {
        inject("Resources for <strong> the Animal Care Community</strong>")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
      $("./ul") {
        name("div")
        $("./li[./a[@class='more']]") {
          name("div")
        }
        $("./li[position() mod 4 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./li") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/li") {
          name("div")
          add_class("mw_flex_box_item_1")
        }
      }
    }
    $("./div[@id='related-content']") {
      add_class("mw_sidebar3")
      $("./div/h3/a") {
        inject("  &raquo;  ")
      }
      $("./div/h3"){
        attributes(class:"")
      }
    }
  }
  # End of  HSUS-378 -(Tablet) Fix styling of Yellow Boxes
  # $(".//div[@id='resources']") {
  #   add_class("mw_sidebar2")
  #   $("./h2") {
  #     inject("Resources for <strong> the Animal Care Community</strong>")
  #     add_class("mw_h2")
  #   }
  #   $(".//a") {
  #     inject("  &raquo;  ")
  #   }
  # }

}
# similar to main animals and action
# http://www.humanesociety.org/parents_educators/
# 
# km cY7 Rmd
# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_parents")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")

  # main content
  $(".//div[@id='page']") {
    $(".//div[@id='cols']") {
      add_class("mw_box2_tablet")
    }
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }

    $(".//div[@id='features']") { // swap stuff in the resources section
      $(".//li") {
        $("./p[@class='image']") {
          move_to("..", "top")
        }
        $(".//a[@class='more']") {
          inner() {
            replace(/\xC2\xA0/, "")
          }
        }
      }
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//li") {
        add_class("mw_newsItem")
      }
      $(".//a[@class='more']") {
        wrap("div", class:"more-link")
      }
    }
  }

  # side bar
  $(".//div[@id='resources']") {
    add_class("mw_sidebar2")
    $(".//a") {
      inject("  &raquo;  ")
    }
  }

}
# social media stuff!
# http://www.humanesociety.org/community/connect.html
# 
# April 2 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community mw_connect") // use the same styling as the main page

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//br")
  remove(".//hr")
  remove(".//div[@id='fb_likebox']")
  remove(".//div[@id='twitter_feed']")
  remove(".//div[@id='wayne_feed']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3|.//p[@class='author']") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//a[@class='back']") {
      inner() {
        prepend("  &laquo;  ")
      }
    }
  }

  # social networks
  $(".//div[@id='button_container']") {
    $(".//p") {
      add_class("mw_social_button")
    }
  }

  # form to get texts
  $(".//div[@id='mobile']") {
    $("./div[@id='mobile_text']") {
      $("./form") {
        add_class("mw_text_signup")
        $(".//input[@type='text' or type='submit']") {
          wrap("div") {
            add_class("mw_text_input")
          }
        }
      }
      $("./a") {
        remove("@style")
        wrap("p")
      }
    }
    $("./div[@id='humane_tv_app']") {
      $("./span") {
        remove("@style")
        $(".//img") {
          remove("@width")
        }
        $(".//img[contains(@src, 'tv_')]") {
          add_class("mw_tv_app")
        }
      }
      remove("./strong")
    }
  }

  # causes and youtube
  $(".//div[@id='social_feeds']") {
    add_class("mw_hide")
    # $(".//iframe[1]") {
    #   attribute("height", "250px")
      
    # }
    # $(".//iframe[2]") {
    #   attribute("height", "100px")
    # }
  }

  # side bar
  $(".//ul[@id='action']") {
    add_class("mw_sidebar1_h")
  }

}
# animal care centers and shelters
# http://www.humanesociety.org/animal_community/shelters/cape.html
# 
# km cY7 Rmd
# March 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community") // use the same styling as the main page


  # remove the odd text nodes that are adding strange text
  wrap_text_children("span", class:"mw_hide")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='simple']")
  remove(".//br")
  remove(".//div[@id='related-content']/h2/@class")
  remove(".//div[@id='related-content']/h3/@class")
  
  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[1]", "top")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3|.//p[@class='author' or @class='subhead']") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//li") {
        add_class("mw_news_item")
      }
      $(".//iframe") {
        remove("@style")
      }
    }
    $(".//ul[not(@id)]") {
      add_class("mw_ul")
    }
    # HSUS-148 South Florida Wildlife Center page styling
    $("./div[@id='feature']") {
      $("./h3[contains(@class,'mw_h3')]/following-sibling::p[1]") {
        name("div")
        wrap_text_children("span")
        $("./a") {
          wrap("div", class:"mw_feature_link")
        }
        $("./span") {
          move_to("preceding-sibling::div[@class='mw_feature_link']", "bottom")
        }
      }
    }
    $("./div[@id='feature' and not(*)]") {
      remove() // empty feature go byebye
    }
    $(".//blockquote//h2") {
      remove("@class")
    }
  }
  # sidebar
  $(".//div[@id='side']") {
    # donate action sidebar
    $("./ul") {
      attributes(class:"mw_sidebar1_h")
    }
    # resourse sidebar
    $("./div[@id='resources']") {
      add_class("mw_sidebar2")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//h2[string-length()<1]") {
        inject("Resources for <strong> the Animal Care Community</strong>")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
      $("./ul") {
        name("div")
        $("./li[./a[@class='more']]") {
          name("div")
        }
        $("./li[position() mod 4 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./li") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/li") {
          name("div")
          add_class("mw_flex_box_item_1")
        }
      }
    }
  $("./div[@id='related-content']") {
    add_class("mw_sidebar3")
    $("./div/h3/a") {
      inject("  &raquo;  ")
    }
    $("./div/h3"){
      attributes(class:"")
    }
  }
  }

  # remove ads
  $(".//a[contains(@href, 'ads')]/..") {
    log("found an Ad")
    add_class("mw_hide")
  }
}
# resources for volunteers
# http://www.humanesociety.org/community/volunteers
# http://www.humanesociety.org/community/volunteers/volunteer_hsi_fa.html
# 
# km cY7 Rmd
# April 2 2013 Sarah LaFrance

$("./body") {
  add_class("mw_vols") // use the same styling as the main page

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }

    # deal with select
    $(".//div[form[select]]") {
      remove("@style")
      add_class("mw_select_div")
      $(".//select") {
        add_class("mw_select1")
      }
    }

    # remove feature if it's just the back button
    $(".//div[@id='feature' and a[@class='back']]") {
      add_class("mw_hide")
    }

    $(".//div[@id='features']") {
      $(".//li") {
        move_here("./p[@class='image']", "top")
      }
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
    }
    $(".//div[contains(@class, 's_borderless')]") {
      # HSUS-340 Styling Tweaks to Faith Volunteering Page
      # URL: http://www.humanesociety.org/community/volunteers/volunteer_leader_faith_outreach.html
      match($path, /volunteer_leader_faith_outreach/) {
        add_class("mw_faith")
        $(".//ul[not(@id)]") {
          add_class("mw_list1")
        }
        $("./p[./br][./strong]") {
          $("./br/preceding-sibling::strong[1]") {
            add_class("mw_break_line")
          }
        }
      }
      # end HSUS-340 Styling Tweaks to Faith Volunteering Page
    }
    $(".//div[@id='side']") {
      $("./ul") {
        add_class("mw_sidebar1_h")
      }
      $("./div[@id='related-content']") {
        add_class("mw_sidebar3")
      }
    }
  }
  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//br")
}
# resources main
# http://www.humanesociety.org/animal_community/resources/
# 
# km cY7 Rmd
# Feb 14 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press mw_news_base")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//div[@id='bottom-pagination']")
  remove(".//br")

  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
    }
  }

  $(".//div[@id^='templatelist']") {
    insert("div") {
      move_here("../div[@id='list-nav']")
      move_here("../div[@id='sortby']")
    }
  }

  $(".//div[contains(@class, 's_borderless') and not(@id)]") {
    add_class("mw_content") // css selectors would be too cumbersome
    move_here("../../ul[@id='tools']", "top")
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
      $("./h2") {
        inject("Resources for <strong> the Animal Care Community</strong>")
        add_class("mw_h2")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

}
$("./body") {
  add_class("mw_mapping_page")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
    remove("@style")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  # remove the #head and #page-head
  $(".//div[@id='page-head' or @id='head' or @id='page-bottom-spacer' or @class='toolsSpacer']") {
    remove()
  }
  remove(".//p[string-length()<2 and not(*)]")

  $(".//div[@id='main']") {
    add_class("mw_box2")

    # fix instructions
    $(".//p") {
      inner() {
        replace(/Click on a state.*-down box/, 'Click on the name of a state or province in the menus')
      }
    }

    # US Map
    $("./div[contains(@class,'section-lead')]/table") {
      insert_before("div", class:"mw_map_locations", id:"us_map", data-ur-set:"toggler") {
        insert("div", "United States", class:"mw_location_header mw_bar5", data-ur-toggler-component:"button") {
          insert("span", " Tap to ", class: "mw_tap")
        }
        copy_here("../table//area")
        wrap_together("./area", "div", data-ur-toggler-component: "content")
        # HSUS-196 hide USA map
        $("following-sibling::table[1]") {
          add_class("mw_hide")
          $("following-sibling::div[.//select[@name='states']][1]") {
            add_class("mw_hide")
          }
        }
        match($path,/volunteer_opportunities/) {
          $("self::div[@id='us_map']") {
            # add_class("mw_testing")
            attribute("data-ur-state", "enabled")
            $("./div") {
              attribute("data-ur-state", "enabled")
            }
          }
        }
        # End HSUS-196 hide USA map
      }

      # remove the special styling on the map
      $(".//img") {
        # remove("@style")
        remove("@width")
        remove("@height")
      }
    }

    $(".//div[@id='us_map']/div[not(@class)]/area") {
      %location = fetch("@alt")
      name("a")
      add_class("mw_bar4 mw_state")
      remove("@coords")
      text(%location)
      # rewrite_links()
    }

    # Canadian Map
    $(".//img[@usemap='#Map2']") {
      insert_before("div", class:"mw_map_locations", id:"canadian_map", data-ur-set:"toggler") {
        insert("div", "Canada", class:"mw_location_header mw_bar5", data-ur-toggler-component:"button") {
          insert("span", " Tap to ", class: "mw_tap")
        }
        copy_here("../map/area")

        wrap_together("./area", "div", data-ur-toggler-component: "content")
        # HSUS-196 hide Canada map
        $("following-sibling::img[1]") {
          add_class("mw_hide")
        }
      }

      remove("@style")
    }

    # Canadian <area> is different, it does not have an ALT thingy
    $(".//div[@id='canadian_map']/div[not(@class)]/area") {
      
      # Get the state identifier
      %location = fetch("@href")
      %location {
        replace(/^.+=/, "")
      }
      log(%location)

      #Look it up from the <select> menu
      $("./ancestor::div[contains(@class, 'section-lead')]//select/option[@value='"+%location+"']") {
        log("fetching state name")
        $state_name = fetch("text()")
        log($state_name)
      }

      name("a")
      add_class("mw_bar4 mw_state")
      remove("@coords")
      text($state_name)
    } #/ancestor::div[contains(@class, 'section-lead')]//select/option[@value='AB']

    remove(".//map")
  }
  rewrite_links()
}
# Department subpages
# http://www.humanesociety.org/about/departments/*
#

# Feb 21 2013 Sarah LaFrance

$("./body") {
  add_class("mw_department_tablet")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1 and not(*)]") {
    remove()
  }
  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
      text() {
        
      }
    }
    $(".//h3") {
      add_class("mw_h3")
    }
  }
  # HSUS-355 Ｒeduce spacing between title & content
  # http://humanesociety.org/about/departments/animal-rescue-team/animal_rescue_team.html
  $(".//div[@class='section']") {
    remove(".//br")
  }

  $(".//div[@id='features']") {
    $(".//li/p[@class='image']") {
      move_to("..", "top")
    }
  }

  $(".//div[contains(@class, 'area-news')]/a[@class='more']") {
    wrap("div", class:"more-link")
  }
  $(".//div[contains(@class, 'area-news')]") {
    $("./a") {
      wrap("div", class: "mw_news_links")
    }
  }
  # end of HSUS-355
  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')
    $("./div[@id='main']") {
      add_class("mw_gray_inner")
      # move_here("./ancestor::div[@id='cols']/div[@id='side']") {
      #   $("./*[@id='action']") {
      #     add_class("mw_sidebar1_h")
      #   }
      # }
    }
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
      ## HSUS - 442
      remove("./li[@id='donate']/a[@class='give-bttn']")
    }

  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    #    remove(".//div[@id='state']")
    remove(".//div[@class='simple']")
    remove("./iframe")
    remove(".//br")
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")

      $('.//li') {
        inner() {
          replace(/\xC2\xA0/, '')
        }
      }
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%;")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  
  $(".//div[@id='main']/div[contains(@class, 's_borderless')]") {
    $("./p[@class='subhead']") {
      add_class("mw_h3")
    }
    $("./p[not(@class)]") {
      add_class("mw_part_p")
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        add_class("mw_h2")
      }
      $("./div[@class='module'][position() mod 4=1]") {
        wrap("div", class:"mw_flex_box")
      }
      $("./div[@class='module']") {
        move_to("preceding-sibling::div[@class='mw_flex_box']")
      }
      $("./div[@class='mw_flex_box']/div[@class='module']") {
        add_class("mw_flex_box_item_1")
        $("./h3/a") {
          inject("  &raquo;  ")
        }
      }
    }
    $(".//div[@id='petfinder-promo']") {
      add_class("mw_sidebar7")
    }
  }

}
# Department main page
# http://www.humanesociety.org/about/departments/
#

# April 11 2013 Sarah LaFrance

$("./body") {
  add_class("mw_dept_tablet")

  # removing
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    remove(".//br")
    $(".//h2") {
      add_class("mw_bar3")
      wrap("div", class:"mw_deptItem") {
        move_here("following-sibling::*[1]")
        move_here(".//div[contains(@class, 'linksetMenu')]")
        $("./p") {
          add_class("navigationItem")
        }
        remove("./div[not(@class)]")
      }
    }
    $(".//div[@id='features']") {
      insert("div", class:"mw_column_right") {
        move_here("preceding-sibling::div[contains(@class, 'mw_deptItem') and position()<4]")
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
    move_here(".//div[@id='news']") {
      add_class("mw_sidebar4")
    }

    move_to("./preceding-sibling::div")
  }

  $(".//div[@id='side']") {
    $("./ul") {
      add_class("mw_sidebar1_h")
    }
  }

}
# About employment page
# http://www.humanesociety.org/about/employment
# 

# January 25, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_employ_tablet")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")

  $(".//div[@id='main']") { // main content
    add_class("mw_gray_inner")
    # wrap("div", class:"mw_box2_tablet")

    $(".//div[contains(@class, 's_borderless')]") {
      remove("..//div[@id='feature'] | ./h3/br")
      move_here("..//div[@id='feature']/a")

      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
        wrap("div", class:"mw_back")
      }

      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//p[./strong]") {
        add_class("mw_h2")
        inject("  :  ")
      }
    }
  }

  $(".//div[@id='side']") { // bottom donate box
    $("./div") {
      remove()
    }
    # $("./ul[@id='action']") {
    #   add_class("mw_sidebar1_h")
    # }
  }
}
# State ranking page
# http://mlocal.humanesociety.org/about/state/humane_state_ranking_2011.html

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_rank")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='options']")


  $(".//iframe") {
    remove("@style")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  # main content
  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    $(".//h3") {
      add_class("mw_h3")
      remove("@style")
    }

    $(".//p[@class='lead']") {
      inner() {
        # fixing instructions
        replace(/Hover over .* tier/, "Click on a tier to see state rankings, and click the name of a state")
      }
    }

    # the map section
    $("./p") {
      name("div")
      add_class("mw_map_holder")
      remove("./img/@style")
      # remove("./img")
      # $("./map/area") {
      #   $state_name = fetch("@alt")
      #   $state_name {
      #     replace(/(\s|:)\s(\s)?.*/, '') // clip off the state name
      #   }
      #   attribute("id", $state_name)
      # }
    }

    # the key box
    $("./div[not(@class) and ./img]") {
      add_class("mw_key")
      remove("@style")
      remove(".//br")
      # get rid of the blanks
      wrap_text_children("p")
      remove("p")
    }

    # tables with rankings
    $(".//div[./ul[@id='acc']]") {
      add_class("mw_rank_tables")
      remove("@style")
      # $(".//li") {
      #   attributes(data-ur-set:"toggler")
      #   $("./h3") {
      #     attributes(data-ur-toggler-component:"button")
      #   }
      #   $("./div") {
      #     attributes(data-ur-toggler-component:"content")
      #     $(".//div[@class='acc-content']") {
      #       $(".//td") {
      #         add_class("mw_was_td")
      #         name("div")
      #         remove("@style")
      #       }
      #       $(".//tr") {
      #         name("div")
      #         add_class("mw_was_tr")
      #         remove("@style")
      #         remove("./div[1]")
      #         remove("./div[2]")
      #       }
      #       $(".//div[contains(@class, 'head')]") {
      #         remove()
      #       }
      #       $(".//div[@class=' mw_was_tr']") { // class is not header
      #         attributes(data-ur-set:"toggler")
      #         wrap_together("./div", "div") {
      #           attributes(data-ur-toggler-component:"button")
      #           $(".//div[@class=' mw_was_td']") {
      #             $state_head = upcase(fetch("text()"))
      #           }
      #         }
      #         insert("div", data-ur-toggler-component:"content") {

      #           move_here("//map/area[@id='"+$state_head+"']") {
      #             name("p")
      #             inject(fetch("@alt"))
      #             inject(fetch("@title"))
      #             remove("@alt")
      #             remove("@title")
      #             remove("@shape")
      #             remove("@coords")
      #             remove(".//br")
      #             wrap_text_children("span")
      #           }
      #         }
      #       }
      #     }
      #   }
      # }
    }

    # $(".//img") {
    #   $source = fetch("@src")
    #   $source {
    #     replace(/png.*/, "png")
    #   }
    #   attribute("src", $source)
    # }

    # $("./p") {
    #   remove()
    # }
  }

}
# State page
# http://mlocal.humanesociety.org/about/state/connecticut

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_page_tablet")

  # remove stuff
  # remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")

  # Move the masthead outside the page and wrap
  $(".//div[@class=' mw_masthead']") {
    move_to("./ancestor::div[@id='page']/div[@id='page-head']", "top")
  }
  $(".//div[@id='page-head']") {
    $("./*[not(@class=' mw_masthead')]") {
      add_class("mw_hide")
    }
    move_to("./ancestor::div[@id='wrapper']","top")
  }
  $(".//div[@id='page']") {
    add_class("mw_gray_inner mw_box2_tablet")
    $(".//div[@id='main']") {
      $("./div[@class='section']") {
        remove("./br")
        $("./p") {
          add_class("mw_section_p")
        }
        $("./div[@id='images']") {
          $(".//p[@class='image']") {
            wrap("div", class:"mw_image")
          }
          $(".//p[@class='caption']") {
            move_to("preceding-sibling::div[@class='mw_image']")
          }
          $("following-sibling::p[contains(@class,'mw_section_p')]") {
            move_here("following-sibling::a[@class='more']")
          }
          wrap("div", class:"mw_flex_box mw_article_section") {
            move_here("following-sibling::p[contains(@class,'mw_section_p')]") {
              add_class("mw_flex_box_item_1")
            }
          }
        }
      }
      $("./div[@id='features']") {
        $(".//p[@class='image']") {
          wrap("div", class:"mw_flex_box") {
            move_here("following-sibling::p")
          }
        }
      }
    }
    # sidebar
    $(".//div[@id='side']") {
      # In your state
      $("./div[@id='state']") {
        add_class("mw_sidebar5")
        $("./h2") {
          add_class("mw_h2")
        }
      }
      # related-content
      $(".//div[@id='related-content']") {
        add_class("mw_sidebar3")
        $(".//h2") {
          add_class("mw_h2")
        }
        $("./div[@class='module'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./div[@class='module']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/div[@class='module']") {
          add_class("mw_flex_box_item_1")
          $("./h3/a") {
            inject("  &raquo;  ")
          }
        }
      }
    }
  }

  $(".//div[@id='main']//h1") {
    add_class("mw_h1")
  }
  $(".//div[@id='main']//h2") {
    add_class("mw_h2")
    text() {

    }
  }
  $(".//div[@id='main']//h3") {
    add_class("mw_h3")
  }

  $(".//iframe") {
    remove("@style")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//ul[contains(@class,'mw_sidebar1')]") {
    add_class("mw_sidebar1_h")
  }

  $(".//div[@id='options']"){
    $(".."){
      add_class("mw_stateRanks")
      remove("./@style")

      $("./div[contains(@id, 'options')]"){
        $("./a[1]"){
          attributes(onclick:"$(\".mw_range[data-ur-state='disabled']\").click();")
        }
        $("./a[2]"){
          attributes(onclick:"$(\".mw_range[data-ur-state='enabled']\").click();")
        }
      }

      $("./ul"){
        $("./li"){
          attributes(data-ur-set:"toggler")
          $("./h3"){
            add_class("mw_range")
            attributes(data-ur-toggler-component:"button")
            #For HSUS-501: 2013 State Ranking page - remove map and have stacked percentages like example
            inner() {
              replace(/(.*)(-)(.*)/,"$1 - $3")
            }
            #End of HSUS-501
          }
          $("./div"){
            attributes(data-ur-toggler-component:"content")

          }
        }
      }
    }
  }

  $(".//p[contains(@class, 'lead')][last()]"){
    wrap_text_children("span"){
      text(){
        replace("Hover over a state for a summary, c", "C")
      }
    }
  }

}
# Subcategory faith landing
# http://www.humanesociety.org/about/faith
#

# Mar 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faith_tablet")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='toolsSpacer']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//div[@class='section' and not(@id)]") { // lead section
    add_class("mw_lead")
    move_here("../ul[@id='tools']", "top")
    move_here(".//a[@class='more']")
  }

  $(".//div[@id='feature']") { // top heading
    $("./h2") { // page title
      move_to("..", "top")
      attribute("class", "mw_h1")
    }
  }

  $(".//div[@id='features']") {
    remove("./br")
    $(".//ul") {
      $("./li") {
        move_here("./p[@class='image']", "top")
        $(".//p") {
          remove(".//a[@class='more']")
        }
      }
    }
  }

  $(".//ul[@id='issue-browser']") { // list of faiths
    $("./li") {
      attributes(class:"mw_faith_toggle", data-ur-set:"toggler")
      $("./a") {
        attributes(class:"mw_bar3", data-ur-toggler-component:"button")
        remove("@href")
        insert("div", class:"mw_plusminus")
      }
      $("./ul") {
        attributes(class:"mw_faith_bar", data-ur-toggler-component:"content")
        $("./li/a[not(@class)]") {
          add_class("more")
        }
      }
    }
  }

  $(".//div[@id='main']") {
    remove(".//a[@class='back']")
    add_class("mw_gray_inner")
    wrap("div", class:"mw_box2_tablet") {
      move_here("./ancestor::div[@id='cols']//div[@id='side']") {
      # $("./div[@id='side']") {
        # wrap_together("./*[not(@id='action')]", "div", class:"mw_flex_box")
        $("./*[@id='action']") {
          add_class("mw_sidebar1_h")
          # move_to("./ancestor::div[contains(@class, 'mw_gray_inner')]//div[@id='side']", "before")
          # move_to("..", "before")
        }
      }
    }
    

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    $(".//h3|.//p[@class='author']") {
      add_class("mw_h3")
    }
    $(".//h4") {
      add_class("mw_h4")
    }
    insert("div", class:"mw_main") { // wrap all the main divs
      move_here("../div[not(contains(@class, 'mw_lead'))]")
      move_here("preceding-sibling::ul[@id='tools']", "top") // if there's no lead, grab share stuff
    }

    $(".//div[contains(@class, 's_borderless')]/ul[not(@id)]") {
      add_class("mw_article_list")
    }
  }

  $(".//div[@id='side']") { // sidebar links
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    remove(".//div[./div[@id='wayne']]")
    # need to replace that br with a space
    $(".//p") {
      remove("@style")
    }
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
    # For HSUS-483
    $(".//div[(@id='wsd-promo') or (@id='wsd-promo2')]") {
      add_class("mw_sidebar8")
      $("./p[./a[contains(@class, 'more')]]") {
        add_class("mw_more_button_wrapper")
      }
    }
    # End of HSUS-483
    # add_class("mw_flex_box")

    # $("./div[contains(@class,'mw_flex_box')]/*") {
    #   add_class("mw_flex_box_item_1")
    # }
  }
  
}
# Subcategory faith forms
# http://www.humanesociety.org/about/faith
#

# Mar 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faith_form mw_faith")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h2")
  }
  $(".//h4") {
    add_class("mw_h4")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='main']") {
    add_class("mw_gray_inner")

    wrap("div", class:"mw_box2_tablet")

    $("./div[@id='feature']") { // top heading
      $("./h2[1]") { // page title
        move_to("..", "top")
        attribute("class", "mw_h1")
      }
    }
    $(".//table") {
      $(".//td") {
        name("div")
        remove(".//br")
      }
      $(".//tr") {
        name("div")
        remove(".//br")
        move_to("../..")
      }
      remove()
    }
    $(".//div") {
      remove("@style")
      remove("@valign")
      remove("@width")
    }
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_spam")
    }
    $(".//input[@type='submit']") {
      $buttonText = fetch("@value")
      $buttonText {
        replace(/\./, "")
      }
      attribute("value", $buttonText)
    }
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[contains(@id, '-promo')]")
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
  }
  
}
# About overview page
# http://www.humanesociety.org/about/overview
# 

# April 8, 2013 Sarah LaFrance

$("//body") {
  add_class("mw_overview_tablet")

  # remove unneeded section
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='feature']/a[@class='back']")
  # remove(".//div[@class='section']")
  remove(".//div[@class='simple']")
  remove(".//p[@class='author']")
  remove(".//div[@id='page-bottom-spacer']")

  # general classes and tags
  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')
    $("./div[@id='main']") {
      add_class('mw_gray_inner')
    }
    $(".//p[contains(@class, 'subhead')]") {
      add_class("mw_h3")
    }
    
    $(".//p[img[contains(@class, 'asset-image')]]") {
      remove("./@style")
      add_class("mw_img_p")
    }

    $(".//blockquote[not(.//blockquote)]") {
      add_class("mw_light_blue")
    }

    $(".//iframe") {
      remove("@style")
      remove("@width")
      remove("@height")
    }

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//a[contains(@class, 'more')]") {
      inject("  &raquo;  ")
    }
  }

  # Moving the charitynavigator into the content div
  $(".//a[contains(@href, 'charitynavigator')]/img[contains(@src, 'charity_navigator')]/ancestor::div[1]") {
    remove("./@class")
    add_class("mw_charity_rating")
    move_to("./ancestor::div[@id='contentDiv']//div[@id='main']", "bottom")
    remove("./@style")
    $("./span") {
      remove("./@style")
    }
  }

  # pull the subcat links under the masthead
  $(".//ul//ul//ul") {
    add_class("mw_flex_box")
    $("./li") {
      add_class("mw_flex_box_item_1")
      remove("@style")
      $("./a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    move_to("//div[@class=' mw_masthead']", "after")
    # make two rows
    insert_after("ul", class:"mw_flex_box") {
      move_here("preceding-sibling::ul/li[position()>3]")
    }
  }

  # main content
  $(".//div[@id='contentDiv']") {

    # HSUS-144 Update styling on Annual Report 2011
    $(".//p[@class='image']]") {
      add_class("mw_image_section")
      remove("./p//br | following-sibling::div[contains(@class,'simple')]//strong//br")
      $("following-sibling::div[contains(@class,'simple')]/h2") {
        add_class("mw_h3")
      }
    }
    # End HSUS-144 Update styling on Annual Report 2011

    # remove one br
    remove(".//div[contains(@class, 's_borderless')]/h1[contains(text(), 'Us:')]/following-sibling::p/br")
    
    # remove empty p
    $(".//div[contains(@class, 's_borderless')]//p[not(*)]") {
      match(text(), (/\A\s+\Z/)) {
        remove()
      }
      match_not(text(), (/.+/)) {
        remove()
      }
    }

    $(".//div[@id='content']") {
      $(".//h3[@class='spacing']") {
        remove("./@class | ./@id")
        remove("./img")
        attributes(data-ur-set:"toggler")
        wrap_text_children("div", class:"mw_accomplish") {
          match(text(), (/\A\s+\Z/)) {
            remove()
          }
          attributes(class:"mw_acco_btn", data-ur-toggler-component:"button")
        }
        $("./div[contains(@id, 'answer')]") {
          remove("./@id | ./@style")
          attributes(class:"mw_acco_content", data-ur-toggler-component:"content")
        }
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
    # HSUS-222
    $("./ul[@id='action']") {
      add_class("mw_was_ul mw_flex_box")
      name("div")
      $("./li") {
        add_class("mw_was_li mw_flex_box_item_1")
        name("div")
      }
    }
    $("./div[@id='related-content']") {
      $("./div[@class='module'][1]") {
        wrap("div", class:"mw_flex_box") {
          move_here("./following-sibling::div[@class='module']")
          $("./div[@class='module']") {
            add_class("mw_flex_box_item_1")
          }
        }
      }
    }
    # end HSUS-222  
  }
}
# Apodcast main page
# http://www.humanesociety.org/about/podcast
# 

# March 12, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_podcast")

  # remove unneeded section
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  # iframes for episodes
  $(".//iframe") {
    attribute("height", "480px")
  }

}
# individual event page
# http://www.humanesociety.org/about/events/humane_lobby_days_2013.html
# 

# March 5, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_event_page_tablet")
  #For HSUS-434 : Add class for fixing the alignment issue
  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')
  }
  #End of HSUS-434
  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length()<=1 and not(*)]")


  $(".//div[@id='main']") { // main content
    #For HSUS-434 : Add class for fixing the alignment issue
    add_class('mw_gray_inner')
    #End of HSUS-434
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
      remove(".//br")
    }

    # top section with lead text and map
    $(".//ul[@id='tools']") {
      wrap("div", class:"mw_lead") {
        move_here("following-sibling::div[@class='section']")
        move_here("following-sibling::div[@id='feature' and .//iframe]")
        $(".//small") {
          $(".//a") {
            remove("@style")
          }
        }
      }
    }    

    # a google maps iframe whee
    $(".//iframe") {
      $map_url = fetch("@src")
      $map_url {
        replace(/https/, "http") // fix itttttt
      }
      attribute("src", $map_url)
    }

    # wrap remaining sections into one
    # this is pretty sloppy, I'll clean it up later, need to tag more specifically -- SL
    $("./div[@class='mw_lead']") {
      insert_after("div", class:"mw_main") {
        move_here("following-sibling::div[contains(@class, 'section')]") {
          remove(".//br")
        }
        $(".//div[not(@id)]") { // the faq section
          remove(".//img[contains(@id, 'question')]")
          # remove(".//br[following-sibling::br]")
          $(".//*") {
            remove("@style")
          }
          $(".//span[contains(@id, 'question')]") {
            name("h3")
            attributes(class:"mw_bar3", data-ur-toggler-component:"button")
            insert("div", class:"mw_plusminus")
            wrap("div", class:"mw_question") {
              attributes(data-ur-set:"toggler")
              move_here("following-sibling::div[1]") {
                attributes(data-ur-toggler-component:"content")
              }
            }
          }
        }
        $(".//div[table]") {
          move_here(".//td//a")
          remove(".//table")
          $("./div") {
            move_to("..", "bottom")
          }
          $("./a") {
            wrap("div") {
              add_class("mw_sponsor")
            }
          }
        }

        $(".//div[contains(@class, 'question')]") {
          $("following-sibling::p") {
            attribute("class", "mw_get_faq")
          }
        }
        $(".//a[@class='more']") {
          inject("  &raquo;  ")
        }

        # try to grab nominee films for genesis
        $(".//div[contains(@class, 'simple')]") {
          $(".//p[preceding-sibling::h3[strong] or following-sibling::h3[strong]]") {
            add_class("mw_nominees")
            wrap_text_children("span") {
              # for HSUS-516 - keeping in text
              match_not(inner(), /\S/) {
                remove()
              }
            }
            # remove("./span")
            remove(".//br")
            $("preceding-sibling::h3[strong]") {
              add_class("mw_h3_nom")
            }
            $("following-sibling::h3[strong]") {
              add_class("mw_h3_nom")
            }
            # for HSUS-516 - changing styling to be .mw_nominees > a to .mw_nominees > .mw_nominee_elements 
            inner_wrap("span", class: "mw_nominee_elements")
          } 
        }

        # HSUS-516 - making this not include nominees, moved after nominees designation
        $(".//div[not(//div[@class='mw_question'])]") {
          $(".//p[not(contains(@class, 'mw_nominees')) and (count(a)=count(*) and count(a)>2)]") {
            add_class("mw_links")
            $("./a") {
              add_class("mw_bar3")
            }
            wrap_text_children("span")
            remove("./span")
          }
        }
      } // close mw_main
    }

    # grab the bottom section of genesis pages
    $("./div[not(@class)]") {
      add_class("mw_genes")
      # presenter list
      $(".//p[a[contains(@href, 'imdb')]]") {
        add_class("mw_links")
        remove(".//br")
      }
      $("./div") {
        wrap_text_children("span")
        remove("./span")
      }
    }

    # remove any empty sections
    $(".//div[not(node())]") {
      remove()
    }
  }

  $(".//div[@id='side']") {
    # Action side bar
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//span") {
        remove("@style")
      }
    }
    # HSUS-413 : magazine-promo style
    $("./div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
      $("./p[1]") {
        wrap("div", class:"mw_flex_box") {
          move_here("following-sibling::p")
          $("./p") {
            add_class("mw_flex_box_item_1")
          }
        }
      }
    }
    # end of HSUS-413
    # HSUS-399 Looking for a pet side bar
    $("./div[@id='petfinder-promo']") {
      add_class("mw_pet_box")
      $("./p[@class='up']") {
        wrap("div", class:"mw_find_pet") {
          move_here("preceding-sibling::p", "top")
        }
      }
      $("./div[@class='mw_find_pet']") {
        move_to("following-sibling::img[1]", "after")
        move_here("preceding-sibling::h2", "top") {
          add_class("mw_h2")
        }
      }
    }
    $("./div[contains(@class, 'simple')][.//a[contains(@href, 'sponsors')]]") {
      add_class("mw_sponsors_wrapper")
      $("./h2") {
        add_class("mw_h3")
      }
    }
  }

  # Add in the slideshows
  $(".//div[@id='hsus_embedded_slideshow_container']") {
    insert_top("div", id:"slideshow")
  }
  # relate content side bar
  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
    $(".//h2") {
      add_class("mw_h2")
    }
    $("./div[@class='module'][position() mod 4=1]") {
      wrap("div", class:"mw_flex_box")
    }
    $("./div[@class='module']") {
      move_to("preceding-sibling::div[@class='mw_flex_box']")
    }
    $("./div[@class='mw_flex_box']/div[@class='module']") {
      add_class("mw_flex_box_item_1")
      $("./h3/a") {
        inject("  &raquo;  ")
      }
    }
    $("./p[@class='more-link']") {
      inject("  &raquo;  ")
    }
  }
  # end relate content sidebar

}
# Subcategory base page so we can detatch from the employ page
# http://www.humanesociety.org/about/*
#

# Feb 4 2013 Sarah LaFrance

$("./body") {
  add_class("mw_about_tablet")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class("mw_gray_inner")
    }
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h3")
  }
  $(".//h4") {
    add_class("mw_h4")
  }
  $(".//div[@id='images']/ul") {
    name("div")
    $("./li") {
      name("div")
    }
  }
  $(".//div[@id='page']//ul[not(@id)]") {
    add_class("mw_list1")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[@class='simple']")
  }

  $about_multiple_sides = "false"
  $(".//div[@id='side'][position()>1]") {
    add_class("mw_testing")
    $about_multiple_sides = "true"
  }
  
  match($about_multiple_sides, /false/) {
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
  }
}
# HSUS-424 : About events page
# http://www.humanesociety.org/about/events

$("./body") {
  add_class("mw_events_tablet")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//hr")

  # Add the tablet box2 wrapper
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      remove("./div[@id='feature'][./a[@class='back']]")
      $("./div[contains(@class, 'section s_borderless')]") {
        # for the top jump links
        $("./p[./a[contains(@href, 'about/events/#')]]") {
          add_class("mw_jump_links_wrapper")
          $("./a[contains(@href, 'about/events/#')]") {
            add_class("mw_jump_links")
            $("self::a[contains(@href, 'Lobby_101_Seminars')]") {
              add_class("mw_learn_more")
            }
          }
          remove("./a[contains(@href, 'Lobby_101_Seminars')][position() > 1]")
          wrap_text_children("span") {
            match(inner(), (/\A\s*\Z/)) {
               remove()
            }
          }
        }
        
        # for the bottom events contents
        $("./h2[./a]") {
          add_class("mw_events_title")
          # replace the space behind the h2
          inner() {
            replace(/\s+\Z/, "")
          }
        }
        $("./p[not(contains(@class, 'mw_jump_links_wrapper') or contains(@class, 'date'))]") {
          add_class("mw_events_contents")
        }
        $("./p[./strong]") {
          add_class("mw_events_details_wrapper")
          inner() {
            replace(/^<strong>/,"<span class='mw_events_details'><strong>")
            replace(/\s<strong>/,"</span><span class='mw_events_details'><strong>")
            replace(/$/, "</span>")
          }
        }
      }
    }
    # side bar
    $(".//div[@id='side']") {
      $("./ul") {
        add_class("mw_sidebar1_h")
      }
    }
  }
  # Fix for HSUS-481
  $(".//form[@name='UserDetail']") {
   # add_class("mw_hide")
  } 
  # End of HSUS-481
}
# end of HSUS-424
# In Your State page, only using the News section
# http://mlocal.humanesociety.org/about/state/

# January 27 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_tablet")


  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")

  # Move the masthead outside the page and wrap
  $(".//div[@class=' mw_masthead']") {
    move_to("//div[@id='wrapper']", "top")
  }

  $(".//div[@id='page']") {

    $(".//h2/strong") {
      text() { }
      add_class("mw_h1")
    }
    $(".//h3/a") {
      add_class("mw_h3")
    }

    add_class("mw_gray_inner")
    wrap("div", class:"mw_box2_tablet")
    move_here(".//div[@id='main']/*")

    $(".//p[@class='lead']") {
      remove("./a[1]") // link leads to this page
      $(".//a") {
        attribute("class", "mw_bar3")
        inner() {
          replace( /\s.\s/, "") // remove extra raquo
        }
      }
    }

    $(".//div[@id='feature']") {
      insert("p") {
        move_here("../preceding-sibling::div/p/a")
      }
    }

    move_here(".//div[contains(@class, 'area-news')]/*")

    $(".//ul[not(@id='tools')and not(@id='share_bar')]") {
      add_class("mw_news_items")
      $(".//li") {
        insert("div", class:"mw_title") {
          move_here("../p[@class='date']")
          move_here("../h3")
        }
      }
    }
    remove(".//div[@id='contentDiv']")
  }
}
# About main page
# http://www.humanesociety.org/about
# using mockup 02-animals_kk

# January 22, 2013 Sarah LaFrance

# About section still needs some tweaks, tritium and styling needs to be
# combined and streamlined into better files

$("./body") {
  add_class("mw_about_tablet")

  # remove unneeded sections
  remove("./script") // just trash all the javascript for now
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  $(".//p[contains(@class, 'subhead') and not(node())]") {
    remove()
  }

  $(".//br") {
    inject_after(" ")
    remove()
  }
  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1 and not(*)]") { // this may be overpowered, keep an eye on it
    # it's ONLY intended to remove whitespace-only p tags
    remove()
  }

  $(".//div[@id='page']") {
    remove("./div[not(@id)]") // empty
    move_here(".//div[@class=' mw_masthead']", "top")

    # top navigation
    $(".//div[@id='page-head']") {
      move_here(".//ul//ul") { // grab the subcategory list from the main nav
        $("./li/a") {
          add_class("mw_bar3 mw_h3")
        }
        add_class('mw_flex_box')
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
        insert_after("ul", class:"mw_flex_box") {
          move_here("preceding-sibling::ul[1]/li[position()>3]")
        }
      }
      remove("./h1")
      remove("./ul[@id='site-nav']")
      remove("./div")
    }

    # main content
    $("./div[@id='contentDiv']") {
      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//h2") {
        add_class("mw_h2")
      }
      $(".//h3") {
        add_class("mw_h3")
      }
      $("./div[@id='head']") { // top big image
        remove(".//div[@id='top_band']")
        name("img")
        # attribute("src", "http://www.humanesociety.org/assets/images/page-head/about_us.jpg")
      }

      remove(".//img[@id='head']")

      $(".//p[@class='subhead']") {
        add_class("mw_h2")
      }
      $(".//h2") {
        add_class("mw_h3")
      }
      $(".//h4") {
        add_class("mw_h4")
      }

      $(".//div[@id='main']") {
        remove("./div[not(@class)]")
        
        add_class("mw_gray_inner")
      }

      $("./div[@id='cols']") { // main content
        add_class("mw_box2_tablet")

        $(".//div[@class='section']") {
          move_here("//ul[@id='tools']", "top") {
            # HSUS 117 - align social share icons
            match($path, /^\/about\/contact\//) {
              add_class("mw_faq_share")
            }
          }
        }

        $(".//div[@id='features']") { // list of articles
          $(".//h3") {
            text() { } // strip a tags
            add_class("mw_h2")
          }
          $(".//li") {
            wrap_together("./p", "div") {
              add_class("mw_flex_box")
              $("./p[not(@class)]") {
                add_class("mw_flex_box_item_1")
              }
            }
          }
          
        }

        $("./div[@id='side']") { // sidebar links
          remove(".//div[./div[@id='wayne']]")
          remove(".//div[@id='state']")
          remove(".//div[@class='simple']")

          $(".//ul[@id='action']") {
            add_class("mw_sidebar1_h")
          }

          $("./ul") {
            add_class("mw_flex_box")
            $("./li") {
              add_class("mw_flex_box_item_1")
            }
          }
        }
      }
    }
  }
}
# About FAQ page
# http://www.humanesociety.org/about/contact/frequently_asked_questions.html
# http://www.humanesociety.org/about/contact/

# January 24, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faq")

  $(".//li") {
    inner() {
      replace(/\xC2\xA0/, "")
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='contentDiv']") {
    remove(".//div[@id='head']")
  #   $(".//div[contains(@class, 's_borderless')]") {
  #     move_here("preceding-sibling::div/a")
      remove(".//ul[@id='tools']")
      remove(".//p[@class='author']")

      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
      }

      $(".//p[.//strong]") {
        add_class("mw_subcats")
      }

  #     remove("preceding-sibling::div")

  #     $(".//p[contains(@class, 'subhead')]") {
  #       add_class("mw_h2")
  #       insert_after("div", class:"mw_blubox") {
  #         move_here("../h3/following-sibling::p[1]")
  #         move_here("../h3")
  #         $("./h3[1]") {
  #           move_to("..", "top")
  #         }
  #         $("./p[2]") {
  #           move_to("..", "bottom")
  #         }
  #       }
      }

  #     remove(".//div[@class='mw_blubox' and not(node())]") // remove the top box if empty

  #     # pull up misplaced ps
  #     move_here(".//div[contains(@class, 'last')]/p")

  #     $("./p[./a[@name]]") {
  #       wrap("div", class:"mw_answer")
  #     }

  #     $("./*[not(@class='mw_answer') and not(@class='back')]") {
  #       move_to("./preceding-sibling::div[@class='mw_answer']")
  #     }

  #     # set up accordions
  #     $("./ul") { // link togglers
  #       $("./li") {
  #         attributes(data-ur-set:"toggler")
  #         $("./a") {
  #           name("div")
  #           attributes(data-ur-toggler-component:"button", class:"mw_bart")
  #         }
  #         insert("div") {
  #           attributes(data-ur-toggler-component:"content")
  #           move_here("../../following-sibling::div[@class='mw_answer'][1]")
  #           $(".//p[./a[@name]]") {
  #             remove() // the restating of the question is redundant now
  #           }
  #         }
  #       }
  #     }
  #   }
  # }

  $(".//div[@id='page-head']/ul") {
    remove(".//li")
    move_here("//p[@class=' mw_subcats']/a")
    remove("//p[@class=' mw_subcats']")
    $(".//a") {
      wrap("li", class:'mw_flex_box_item_1')
      add_class("mw_bar3")
    }
  }

  $(".//div[@id='side']") {
    $("./ul") {
      add_class("mw_sidebar1_h")
    }
    remove("./div[@id='related-content']")
  }
}
# About leadership page
# http://www.humanesociety.org/about/leadership
# all subpages
# http://mlocal.humanesociety.org/about/leadership/executive_staff/wayne_pacelle.html
# http://mlocal.humanesociety.org/about/leadership/board/hsus_board_directors.html

# April 8, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_leadership")

  remove(".//li/form")
  remove(".//li[@id='signup']/p")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@id='sortby']") // suppressed on the desktop
  remove(".//em[not(node())]")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='main']") {
    remove(".//div[@class='toolsSpacer']")

    $(".//h1") {
      attribute("class", "mw_h1")
    }
    $(".//h2") {
      attribute("class", "mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//div[@class='pagination']") { // search box
      add_class("mw_search1")
      $(".//label") {
        add_class("mw_flex_box")
        wrap_text_children("span")
      }
      $(".//input") {
        add_class("mw_flex_box_item_2")
      }
      $(".//button") {
        add_class("mw_btn5")
        text() {
         clear()
        }
      }
    }

    $(".//div[contains(@class, 's_borderless')]") {
      $("./p[position() mod 2=0]") { // get all the names so we can remove brs
        wrap_text_children("span")
      }
      # ticket HSUS-172
      # http://humanesociety.org/about/leadership/board/hsus_board_directors.html
      match($path, /^\/about\/leadership\/board\/hsus_board_directors/) {
        $("./p/br") {
          add_class("mw_keep")
        }
      }
      $(".//em") {
        move_to("preceding-sibling::span[1]")
      }
      $("./p/span[@style]") {
        remove(".//@style")
      }
    }

    $(".//li[@class='image']") { // person entry
      insert_top("div", class: "mw_flex_box") {
        move_here("..//p[@class='image']//img")
        move_here("..//h2") {
          wrap("div", class: "mw_text mw_flex_box_item_1") {
            move_here("ancestor::li[@class='image']//p")
          }
        }

      }
      remove(".//p[@class='image']")
      $("./ul") {
        add_class("item-list") // ticket HSUS-172
      }
      $(".//li[@class='more']/a") {
        inject("  &raquo;  ")
      }
    }
  }

  remove(".//br[not(contains(@class, 'mw_keep'))]")
}
# HSUS 167 popup to add to the home screen
$("./head") {
  insert_bottom("script", type:"text/javascript") {
    text("var addToHomeConfig = {touchIcon:true, expire:525600, message:'Add HumaneSociety.org to your <strong>iPhone&apos;s</strong> home screen. Tap the %icon button &amp; choose &apos;Add to Home Screen&apos;.'};")
  }
  insert_bottom("script", src:asset("javascript/add2home.js"))
  $("./title") {
    text("HSUS")
  }
}

# Place holder/example file
$("./body") {

  $(".//div[@id='page']") {

    # Flex box for the side-by-side content
    insert_top("div", class:"mw_flex_box") {
      move_here("..//li[@id='donate']", "top") {
        #wrap("div", class:"mw_two_col")
        name('div')
        add_class('mw_box5 mw_flex_box_item_1')

        $("./a[1]") {
          add_class("mw_donate_title")
        }


        $(".//form//label") {
          move_here("./input[@type='radio']", "top")
        }

        # contextual_keyboard(".//input[@type='text']", "numeric")
        contextual_keyboard(".//input[@type='text']", "number")

        $(".//input[@id='payment-other']") {
          attribute("size", "5")
        }
        $(".//button") {
          add_class("mw_btn3")
          text("Donate")
        }
        $(".//div[@id='give_another_way']/a") {
          add_class("mw_btn3")
          text("Give another way")
        }
      }

      move_here("..//ul[@id='site-nav']", "top") {
        #wrap("div", class:"mw_two_col")
        add_class("mw_box2 mw_flex_box_item_1")
        name("div")

        $('./li') {
          name("div")
          add_class("home_menu_nav_bar")
        }
      }
    }
    

    # remove("./div[@id='page-head']")
    
    # Carousel ? 
    # move_here(".//ul[@id='billboard']", "top") {
    #   wrap("div", data-ur-set:"carousel", data-ur-carousel-component:"view_container", class:"mw_masthead")
    #   attribute("data-ur-carousel-component", "scroll_container")
    #   name("div")
    # 
    #   $("./li") {
    #     name("div")
    #     attribute("data-ur-carousel-component", "item")
    #   }
    # }

    move_here(".//div[contains(@class, 'mw_carousel_content_mobile')]", "top") {
      wrap("div", data-ur-set:"carousel", data-ur-fill:"1", data-ur-autoscroll:"enabled", data-ur-autoscroll-delay:"5000", data-ur-autoscroll-dir:"next" ,data-ur-carousel-component:"view_container", class:"mw_masthead mw_carousel") {
        insert_bottom("span", data-ur-carousel-component:"dots")
      }
      
      attribute("data-ur-carousel-component", "scroll_container")

      $("./div") {
        attribute("data-ur-carousel-component", "item")
        
        $("./div | ./a") {
          add_class("mw_content_text")
        }
      }
    }

    # Main content articles

    $("./div[@id='contentDiv']/div[@id='cols']") {
      add_class("mw_box2")
      $(".//ol/li") {
        insert("div", class:"mw_article_content") {
          move_here("./parent::li/h2")
          move_here("./parent::li/p[not(@class='image')]") {
            $("./a") {
              add_class("mw_bar1")
            }
          }
          
        }
      }
      # HSUS-436-START:(Mobile & Tablet) Minor spacing issues on homepage
      $("./div[@id='main']/img") {
        add_class("mw_hide")
      }
    }
    $(".//div[contains(@class,'area-news')]/div[position() = 1]") {
      remove("./@style")
      add_class("mw_news_heading")
    }
    # HSUS-436-END
    # HSUS-430 News Feed
    $(".//div[@id='cols']") {
      # Twitter/Facebook left hand feed , also HSUS-430 News Feed / News Brief
      $(".//div[@class='section simple area-news'] | .//div[@class='section news-brief-home-page s_borderless']") {
        #section news-brief-home-page-inner s_borderless
        add_class("mw_box2")

        # Make the connect link a bar_1
        $("./a[@class='more']") {
          add_class("mw_bar1")
        }

        # Change the H3 to something else.. because it is getting globally styled
        $(".//h3") {
          name("p")
          attribute("class", "mw_community_content")
        }

        # Give the divs wrapping the feeds names so we can sort the facebook first
        $(".//a[contains(@href, 'facebook')]/ancestor::div[not(@id)][1]") {
          add_class("mw_facebook_feed")
        }
        $(".//a[contains(@href, 'twitter')]/ancestor::div[not(@id)][1]") {
          add_class("mw_twitter_feed")
        }
        $(".//div[@class=' mw_twitter_feed']") {
          # comment out for HSUS-216: on mock up twitter feeds comes first
          # move_to("..", "bottom")
        }

        # Move Connect to bottom
        $(".//a[@class='more mw_bar1']") {
          move_to("..", "bottom")
        }

        # Remove the image
        remove(".//p[@class='image']")

        # Move the social feed to the top of #main 
        move_to("./ancestor::div[@id='cols']", "after")
      } 
    }
    # Truncate any news posts beyond 3
    remove(".//div[contains(@class, 'area-news')]//li[position()>3]")
    remove(".//div[contains(@class, 'news-brief-home-page')]//li[position()>3]")

    # End HSUS-430
    
    $("./div[@id='contentDiv']") {
      insert("div", class: "mw_flex_box") {
        # Signup stuff
        move_here("..//ul[@id='action']") {
          name("div")
          add_class("mw_box3 mw_flex_box_item_1")
          $("./li") {
            name("div")

            $(".//button") {
              add_class("mw_btn3")
            }

            contextual_keyboard(".//input[@id='cons_email']", "email")
            contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")
          }
        }

        # Wayne's Blog
        move_here("..//div[@id='wayne']") {
          add_class("mw_box4 mw_flex_box_item_1")
          #HSUS-450
          #$("./a[@id='podcastbutton1a']") {
          #  insert("img", src: asset("images/waynes_podcast.png"),class: "images-waynes_podcast")
          #}
          #END HSUS-450
        }
      }
      $("./div[@id='cols']/div[@id='main']/ol[@id='headlines']/li") {
        add_class("mw_flex_box")
        $("./div[@class='mw_article_content']") {
          add_class("mw_flex_box_item_1")
        }
      }
    }

    $(".//div[@id='foot']") {
      remove("./@style")
    } 
  }
}
# common news tritium
# imported into article, news, press pages

# Sarah LaFrance March 25

$("./body") {
  add_class("mw_news_main")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length(text())= 1][not(./a)][not(@class='image')]")
  remove(".//div[@id='petfinder-promo']")
  # remove(".//div[@id='side']")


  $(".//div[@id='wrapper']") {
    # move_here(".//div[@id='contentDiv']/div[1]", "top")
  }

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//p[@class='subhead']") {
      add_class("mw_h2")
    }
    $(".//p[@class='author']") {
      add_class("mw_h3")
    }
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      wrap_text_children("span")
    }
    $(".//button") {
      add_class("mw_arrow_btn")
      text() {
        clear()
      }
    }
  }

  $(".//div[contains(@class, 's_borderless')]//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }


  # remove the width and height of the youtube video
  $(".//iframe[contains(@src, 'youtube')]") {
    attributes(width:"100%", height:"")
  }
  # for brightcove experiences
  $(".//object[@class='BrightcoveExperience']") {
    remove("param[@name='width']")
  }
  
  # For HSUS-469:(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//ul[@id='action']") {
    add_class("mw_sidebar1_h")
    $("./li[@id='donate']") {
      $("./a[position() = 1]") {
        remove()
      }
    }
  }
  $(".//div[@id='related-content']") {
    add_class('mw_sidebar3')
  }

  # For HSUS-469:(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//div[@id='wayneNews']") {
    add_class("mw_sidebar7")
    insert_top("h2",class:'mw_h2')
    $("./a[@class='more']") {
      text() {
        replace("»    »","»")
      }
    }
  }
  $(".//div[@id='related-content']") {
    $(".//p[@class='more-link']") {
      $("./a[@class='more']") {
        text () {
          replace("»    »","»")
        }
      }
    }
  }

  #Fixed for HSUS-469 :(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//blockquote") {
    $(".//a[@class='more']") {
      text () {
        replace("»    »","»")
      }
    }
  }
  # End of HSUS-469
  $(".//h2[@class='mw_h2']") {
    inner () {
      append("WAYNE'S BLOG")
    }
  }
  # End of HSUS-469

  #Fixed for HSUS-469 :(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//div[contains(@class,'s_borderless')]") {
    $("./p[@class='date']") {
      add_class("mw_date")
    }
  }
}

# http://www.humanesociety.org/news/profile/off-duty/off_duty_series.html

$("./body") {
  add_class("mw_off_duty_tablet")
  $("./div[@id='wrapper']/div[@id='page']") {
    # top navigation
    $("./div[@id='page-head']") {
      move_here("./ul[@id='site-nav']/li/ul") {
        add_class("mw_flex_box")
        $(".//li") {
          add_class("mw_flex_box_item_1")
          $(".//a") {
            add_class("mw_bar3 mw_h3")
          }
        }
      }
      remove("./h1 | ./ul[@id='site-nav'] | ./div[.//img[contains(@src, 'mission_statement_text')]]")
      move_to("./ancestor::div[@id='wrapper']/div[contains(@class, ' mw_masthead')]", "after")
    }
    # end of top navigation
    add_class("mw_box2_tablet") 
    # main content
    $("./div[@id='contentDiv']/div[@id='cols']") {
      # more profiles section
      $("./div[@id='main']/div[contains(@class, 'area-news')]/div[contains(@id, 'templatelist')]") {
        $("./p[@class='image']") {
          wrap("div", class: "mw_list_wrap")
        }
        $("./h4") {
          add_class("mw_h4")
        }
        $("./p/a[contains(@class, 'more')]") {
          add_class("mw_bar1")
        }
        $("./p[@class='date'] | ./h4 | ./p[./a[contains(@class, 'more')]]") {
          move_to("./preceding-sibling::div[@class='mw_list_wrap'][1]")
        }
      }
      # end of more profiles section
      # end of donate bar 
    }
    # end of main content
  }
  # side bar
  $(".//div[@id='side']") {
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        add_class("mw_h2")
      }
      $("./div[@class='module'][position() mod 4=1]") {
        wrap("div", class:"mw_flex_box")
      }
      $("./div[@class='module']") {
        move_to("preceding-sibling::div[@class='mw_flex_box']")
      }
      $("./div[@class='mw_flex_box']/div[@class='module']") {
        add_class("mw_flex_box_item_1")
        $("./h3/a") {
          inject("  &raquo;  ")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_contact_us_info_tablet")
  $("./div[@id='wrapper']/div[@id='page']") {
    add_class("mw_box2_tablet")
    remove("./div[@id='page-head']")
    match($path, /forms\/contact\_us\/urban_wildlife\_sanctuary\_contact/) {
      $("./div[@id='contentDiv']/div[@id='inside']/div[@id='head']") {
        remove()
      }
    }
    $("./div[@id='contentDiv']/div[@id='cols']/div[@id='main']") {
      $("./div[contains(@class, 'section')]") {
        $("./h1") {
          add_class("mw_h1")
        }
        $("./h3") {
          add_class("mw_h3")
        }
        $("./p[not(*)][text()]") {
          text() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
        }
        $("./hr") {
          name("div")
          attribute("class", "mw_line")
        }
        $("./p/a[@name] | ./p/strong[./a[@name]]") {
          wrap("div", class:"mw_title") {
            move_here("./following-sibling::strong[1]", "bottom")
          }
        }
        remove("./br | ./h1/br | ./p/br")
        $("./ul") {
          add_class("mw_list1")
        }
      }
    }
    $(".//input[@id='cons_phone' or @id='cons_zip_code']") {
      attributes(type:"tel")
    }
  }
}
# News articles
# http://mlocal.humanesociety.org/news/press_releases/2013/01/wy-ag-gag-hb0126-opposition-011513.html
#

# Sarah LaFrance March 29 2013

$("./body") {
  add_class("mw_article")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//li[@id='pdf']")

  table_dump(".//table")
  
  # HSUS-348
  $(".//div[@id='images']") {
    attributes(data-ur-autoscroll: "disabled")
  }
  
  $(".//div[not(contains(@class,'mw_masthead'))]") {
    remove("@style")
  }

  $(".//div[@id='feature' and a[@class='back']]") {
    remove()
  }

  # clear sidebar in faith articles
  $(".//div[@id='side']") {
    remove("./style")
    remove("./div[contains(@id, '-promo')]")
    remove("./iframe")
    $(".//a[@id='media-contact']") {
      wrap("div", class:"mw_mediaBox")
      inner() {
        replace("2", "  &raquo;  ")
      }
    }
    # HSUS-233 Box styling
    $("./div[@id='related-content']") {
      add_class("mw_sidebar3")
      $("./h2") {
        insert_after("div", class: "mw_flex_box") {
          move_here("./following-sibling::div[@class='module']") {
            add_class("mw_flex_box_item_1")
          }
        }
      }
      $(".//div[contains(@class,'module')]/h3/a") {
        inner() {
          append("  &raquo;  ")
        }
      }
    }
    # end of HSUS-233
  }

  $(".//div[@id='page']/div[@id='contentDiv']//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[contains(@class, 's_borderless')]") {

    $(".//iframe|.//embed") {
      remove("@height")
      remove("@width")
    }
    # HSUS-369 Correct styling on Animal Tips pages
    $("./ul[@class='item-list']/li[@class='image']") {
      $("./p[@class='image']") {
        move_to("preceding-sibling::p[1]","before") {
          add_class("mw_img_content")
        }
      }
      $("./p[@class='related']") {
        move_to("preceding-sibling::p[1]","after")
      }
      $("./ul//a") {
        inject("  &raquo;  ")
      }
    }

    # Kevin's telephone script from the seagate project

    inner() {
      replace(/((\d)*[ ()\-.\d]+\d)/) {
        %orig = %1
        %1 {
          replace(/\s/, "")
        }
        %stripped = %1
        %stripped {
          replace(/\D/, "")
        }
        # ignore access codes
        match_not(length(%stripped), /^[1-8]$/) {
          set("<a href='tel:" + %stripped + "'>" + %orig + "</a>")
        }
      }
    }
    # below is breaking togglers on pigeon problem solver - ticket 381
    # This is for HSUS-361,381,428 When there has a carousel in the accordion
    $("./div[@class='image-scroller']") {
      $carousel_ans = "false"
      $("./ul/li[position() > 1][./p[@class='image']]") {
        $carousel_ans = "true"
      }
      match($carousel_ans, /true/) {
        inner_wrap("div", data-ur-set:"carousel", data-ur-carousel-component:"view_container", data-ur-fill:"1") {
          $("./ul") {
            name("div")
            attributes(data-ur-carousel-component:"scroll_container")
            $("./li") {
              name("div")
              attributes(data-ur-carousel-component:"item")
            }
          }
          insert_bottom("div", data-ur-carousel-component: "dots")
          $("ancestor::div[contains(@id,'answer')][1]") {
            add_class("mw_carousel_ans")
          }
        }
      }
    }
  }
  
  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_youtube_height_fix")
    attributes(width:"100%")
  }

  # handling forms
  $(".//form[@method='POST']") {
    add_class("mw_form_area")
    remove(".//br")

    # re-hide spam control
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_hide")
    }
  }

  # HSUS-34 Survey table, only restyle it for mobile because the table breaks the viewport.
  match($tablet) {
    with(/false/) {
      $("./div[@id='wrapper']//div[contains(@class,'s_borderless')][./h1/span[contains(text(),'SURVEY')]]") {
        $("./div[contains(@class,'mw_was_table')]") {
          $(".//div[contains(@class,'mw_was_tr')][position() > 1]/div[contains(@class,'mw_was_td')][1]") {
            var("mw_sub_header"+index(), fetch("./text()"))
            add_class(var("mw_sub_header"+index()))
            remove()
          }
          $(".//div[contains(@class,'mw_was_td')][not(*)]") {
            match(text(), (/\A\s+\Z/)) {
              remove()
            }
          }
          $(".//div[contains(@class,'mw_was_tr')][1]/div[contains(@class,'mw_was_td')]") {
            $("./ancestor::div[contains(@class,'mw_was_table')]") {
              insert("div",class:"mw_survey_item") {
                move_here("..//div[contains(@class,'mw_was_tr')]/div[contains(@class,'mw_was_td')][1]")
                $("./div[contains(@class,'mw_was_td')][position() > 1]") {
                  $mw_sub_header_index = index()
                  insert_top("span", var("mw_sub_header"+$mw_sub_header_index) + ":", class: "mw_title")
                }
              }
            }
          }
        }
        # remove &nbsp; , white space
        $(".//p[not(*)] | ./p[./br]") {
          inner() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
          remove("./br")
        }
        # end remove &nbsp; , white space
        remove(".//@style")
      }
    }
  }
  # end of HSUS-34

  $(".//div[@id='side']") {
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }
}
$("./body") {
  add_class("mw_forms_contact_tablet")

  $(".//div[@id='wrapper']") {
    $(".//div[@id='page']") {
      remove(".//div[@id='page-head']")
      remove("./div[@id='contentDiv']/div[@id='head']")
      add_class("mw_box2_tablet")
      $(".//input[@class='Button']") {
        btn_delegate() {
          add_class("mw_btn2 mw_SubmitButton")
          text("SUBMIT")
        }
      }
      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//form") {
        add_class("mw_box5")
      }
    }
  }
}
# common news tritium
# imported into article, news, press pages

# Sarah LaFrance Jan 31 2013

$("./body") {
  add_class("mw_news_base")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  #HSUS-366 Missing Portion of Body on Page
  # remove(".//p[string-length(text())= 1][not(./a)][not(@class='image')]")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='side']/div[@class='simple']")
  # remove(".//br")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h2")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='feature']/a") {
    inject_before("  &laquo;  ")
  }

  $(".//div[contains(@class, 's_borderless')]//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }


  # remove the width and height of the youtube video
  $(".//iframe[contains(@src, 'youtube')]") {
    attributes(width:"100%", height:"")
  }
  # for brightcove experiences
  $(".//object[@class='BrightcoveExperience']") {
    remove("param[@name='width']")
  }
}

$("./body") {
  add_class("mw_forms_base_tablet")
  # replace * color
  $(".//td") {
    inner() {
      replace(/(\*)/, "<span class='mw_red'>$1</span>")
    }
  }
  # desk top site top nav no exist background
   $(".//div[@id='wrapper']") {
     $header_img = "false"
     $("./div[contains(@class, 'mw_masthead')]") {
       $header_img = "true"
     }
     match($header_img, "false") {
       insert_before("div", class:"mw_new_masthead")
     }
   }
  # end desk top site top nav

  $(".//div[@id='page']") {
    remove(".//div[@id='page-head']")
    remove("./div[@id='page-bottom-spacer']")
    $("./div[@id='contentDiv']") {
      remove("./div[@id='head']")
    }
  }
}
# lots of pages
# http://www.humanesociety.org/news/press
# 

# March 29 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press_tablet")

  # removing
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//p[@class='subhead']") {
      add_class("mw_h2")
    }
    $(".//p[@class='author']") {
      add_class("mw_h3")
    }
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
      inner() {
        set("SORT PAGE LISTING") // just hard code it
      }
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
    }
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        add_class("mw_h2")
      }
      $("./div[@class='module'][position() mod 4=1]") {
        wrap("div", class:"mw_flex_box")
      }
      $("./div[@class='module']") {
        move_to("preceding-sibling::div[@class='mw_flex_box']")
      }
      $("./div[@class='mw_flex_box']/div[@class='module']") {
        add_class("mw_flex_box_item_1")
        $("./h3/a") {
          inject("  &raquo;  ")
        }
      }
    }
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
  }
  
}

$("./body") {
  add_class("mw_forms_tablet")
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    remove("./div[@id='contentDiv']/div[@id='article'or @id='inside']/div[@id='head']")
    remove(".//table/@style")
    $("./div[@id='contentDiv']/div[@id='inside']//div[@id='main']/div[@id='features']") {
      add_class("mw_form_features")
      remove("self::div[.//div[@id='flashcontent']]")
      $(".//h3") {
        add_class("mw_h3")
      }
      $(".//ul") {
        name("div")
        add_class("mw_ul")
        $("./li") {
          name("div")
          add_class("mw_li")
          wrap_text_children("span") {
            remove("self::span[contains(text(),'.')]")
          }
          $(".//p[@class='image']/following-sibling::p") {
            wrap("div",class:"mw_download_content") {
              move_here("following-sibling::a") {
                $("ancestor::div[1]") {
                  add_class("mw_download_section")
                }
              }
            }
          }
        }
      }
    }
    $(".//iframe") {
      attribute("src") {
        value() {
          rewrite("link")
        }
      }
      attributes(id:"mw_flick_wrapper", height:"")
    }
    $(".//form") {
      add_class("mw_box5")
    }
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//select/..") {
      add_class("mw_select_arrows")
    }
    $(".//input[@type='submit']") {
      btn_delegate() {
        add_class("mw_btn2 mw_SubmitButton")
        text("SUBMIT")
      }
    }
    $(".//input[@type='reset']") {
      btn_delegate() {
        add_class("mw_btn1 mw_SubmitButton")
        text("RESET")
      }
      $("./ancestor::div[1]") {
        add_class("mw_flex_box_item")
        $("./div") {
          add_class("mw_flex_box_item_1")
        }
      }
    }
    # HSUS-411 Share desktop URLs on Thank You page
    $(".//p[contains(@class, 'simple')]/a[contains(@href, 'facebook')]") {
      attribute("href") {
        value() {
          replace(/m(\w{5})?\./, "")
        }
      }
    }
    $(".//a[contains(@href, 'thankyou/mailto')]") {
      attribute("href") {
        value() {
          replace(/m(\w{5})?\./, "www.")
        }
      }
    }
    # right section
    $(".//div[@id='side']") {
      remove(".//h2")
      $("./ul") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
      $("./div[@id='resources']") {
        $("./ul") {
          add_class("mw_sidebar6")
          $("./li") {
            add_class("mw_flex_box_item_1")
            $("./a") {
              add_class("mw_more")
            }
          }
          $("./li[position() mod 4 = 0]") {
            wrap("ul", class:"mw_ul mw_flex_box") {
              move_here("./preceding-sibling::li")
            }
          }
        }
      }
      $("./div[@id='petfinder-promo']") {
        add_class("mw_hide")
      }
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
       $("./p[@class='allanimalsinclude'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./p[@class='allanimalsinclude']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/p[@class='allanimalsinclude']") {
          add_class("mw_flex_box_item_1")
          $("./a") {
            attributes(class:"more")
          }
        }
        $("./p[@class='more-link']") {
          inject("  &raquo;  ")
        }
        $("./h2") {
          wrap_text_children("span", class:"mw_h2_span")
          remove("./br")
        }
    }
  }
}
$("./body") {
  add_class("mw_news_briefs_tablet")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length(text())= 1][not(./a)][not(@class='image')]")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='side']")

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

}

$("./body") {
  add_class("mw_whitepapers")

  $(".//div[@id='page-head'] | .//div[@id='head'] | .//div[@id='page-bottom-spacer']") {
    add_class("mw_hide")
  }

  #Add the box2 to the wrapper
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  # The first h3 is an exception.. it is not in a li
  $(".//div[contains(@class, 'section')]/h3") {
    add_class("mw_whitepaper_header mw_bar5")
    attributes(data-ur-toggler-component:"button")
    wrap("div",class: "mw_whitepaper_container", data-ur-set:"toggler") {
      $("./following-sibling::p[1]") {
        remove()
      }
    }
  } 

  $(".//div[contains(@class, 'section')]/li[h3]") {
    move_here("./h3", "after") {
      add_class("mw_whitepaper_header mw_bar5")
      attributes(data-ur-toggler-component:"button")
      wrap("div",class: "mw_whitepaper_container", data-ur-set:"toggler")
    }
  }
  $(".//div[contains(@class, 'section')]/li[a]") {
    add_class("mw_whitepaper_content ")
    move_to("./preceding-sibling::div[contains(@class, 'mw_whitepaper_container')][1]")
  }

  $(".//div[contains(@class, 'mw_whitepaper_container')]") {
    wrap_together("./li", "div", data-ur-toggler-component:"content")
    $("./div/li") {
      name("div")
      $("./a") {
        add_class('mw_bar2')
      }
      
    }
  }

  # Remove the extra <p>'s
  $(".//div[contains(@class, 'mw_whitepaper_container')]") {
    remove(".//p")
  }

}
# main news QA page
# http://www.humanesociety.org/news/resources/qa
# scss is using _press.scss

# April 2 2013 Sarah LaFrance
# only real change is to top pagination to fix the weird sorting issue

$("./body") {
  add_class("mw_press mw_qa")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      wrap_text_children("span")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") { // this section is hidden with styles but we need to re-hide it
    add_class("mw_no_display")
  }

  $(".//ul[@class='item-list']/li") { // news entry
    match($path, /State_Directors/) {
      move_here("./p[contains(@class, 'image')]", "top") {
        name("div")
        attributes(class: "mw_image_p")
        wrap("div", class: "mw_flex_box")
      }
      $("./h2") {
        wrap("div", class: "mw_text mw_flex_box_item_1")
      }
      $("./div[contains(@class, 'mw_text')]") {
        move_here("following-sibling::p")
      }
      $("./div[contains(@class, 'mw_flex_box')]") {
        move_here("following-sibling::div[contains(@class, 'mw_text')]")
      }
    }
    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $("./ul") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }

    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
  }
  # HSUS-305 Line breaks on Pets News Page
  # URL: http://www.humanesociety.org/animals/pets/news.html
  match($path,/^\/animals\/pets\/news\.html/) {
    $(".//div[contains(@class,'simple')]") {
      add_class("mw_pet_news")
      $("./ul/li[./p[@class='image']]") {
        add_class("mw_pet_news_li")
      }
    }
  }

}
$("./body") {
  add_class("mw_gigya_login_tablet")

  $(".//div[@id='contentDiv']") {
    add_class("mw_box2_tablet")
  }
}
$("./body") {
  add_class("mw_tellafriend_tablet")
  $("./div[@class='mw_header']") {
    add_class("mw_hide")
  }
  $("./div[@id='ga-container']/div[@id='ga-content']") {
    move_here(".//div[@id='ga-header']", "top") {
      move_here("./following-sibling::table[1]//div[@id='action-alert' or @class='appArea']", "after") {
        attribute("class", "mw_box2_tablet")
        remove(".//@style")
        remove("./div[@class='showondesktop']")
        $("./h2") {
          attribute("class", "mw_h2")
        }
        $("./h3") {
          attribute("class", "mw_h3")
        }
        $("./div[contains(@class, 'taf-share-container')]") {
          add_class("mw_flex_box")
          $("./a") {
            wrap("span", class: fetch("./@class")+" mw_flex_box_item_1")
            remove(".//textarea/@cols")
            insert_bottom("span", fetch("./@class"), class:"mw_share_text") {
              text() {
                replace(/\w+_/, "SHARE ON ")
                replace("facebook", "FACEBOOK")
                replace("twitter", "TWITTER")
                replace("ON email", "VIA EMAIL")
              }
            }
          }
        }
        $("./div[@class='supertaf-donate-section']/div[@class='supertaf-donate-form']/form[@id='taf-donate']") {
          $("./div[@class='supertaf-donate-text']") {
            insert_top("div", "DONATE NOW", class:"mw_donate_title")
            // Fix for HSUS-510 Tablet
            wrap_text_children("div") {
              add_class("mw_donate_details")
              move_to("ancestor::body//div[@class='mw_donate_title']","bottom")
            }
            // Fix for HSUS-510 Tablet
          }
          $("./div[@class='supertaf-donate-amounts']") {
            $("./input[contains(@id, 'supertaf-amount')]") {
              wrap("div", class:"mw_amount")
            }
            $("./label | ./input[@id='supertaf-box']") {
              move_to("./preceding-sibling::div[@class='mw_amount'][1]", "bottom")
              $("./self::input[@id='supertaf-box']") {
                attribute("onclick", "document.getElementById('supertaf-amount-other').checked = true;")
              }
            }
            $("./input[@class='supertaf-donate-button']") {
              btn_delegate() {
                attribute("class", "mw_btn2")
                inner("CONTINUE")
              }
            }
          }
        }
        # HSUS-373
        # $("./div[@id='share_bar']") {
        #   add_class("mw_new_tell_a_friend")
        #   $(".//a[./img[@alt='Donate now']]") {
        #     add_class("mw_donate_now")
        #   }
        #   $(".//a") {
        #     insert("span", fetch("./img/@alt"))
        #     remove("./img")
        #   }
        # }
        # share logos
        $(".//div[@id='share_bar']") {
          add_class("mw_share_logos")
          remove("@id")
          # move_here(".//a")
          # remove("./table")
        }
        
        $("./div[@class='custom-twitter-share-text']") {
          add_class("mw_hide2")
        }
        # HSUS-427 Remove Excess White Space on Alert 5699's Thank You Page
        $("./iframe[contains(@src, 'glitternetwork')]") {
          add_class("mw_hide2")
        }
      }
    }
    $("./div[contains(@class, '_footer')]") {
      move_here("./preceding-sibling::table[1]//div[contains(@class, '_footer')]/div[@id='foot']", "top") {
        $("./ul/li") {
          attribute("class") {
            value() {
              replace(/\w+\s/, "")
            }
          }
        }
      }
    }
    remove("./table")
  }
  remove("./div[.//img[@alt='Powered By Convio']]")
}
$("./body") {
  add_class("mw_st_francis_box")

  $("./div[@id='wrapper']") {
    $("./div[@id='page']") {
      remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style] | ./br")
      $("./div[@id='contentDiv']/div[@id='cols']") {
        add_class("mw_box2") 
        $("./div[@id='main']/div[@id='wrapper-body']") {
          remove("./@style")
          # share
          $("./ul[@id='share_bar']/li/img[@class='share_image']") {
            name("span")
            insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
            remove()
          }
          # end share
          
          # toptext
          $("./div[@id='francis-toptext']") {            
            # removing all toptext style
            $("./*") {
              remove("@style")
            }
            
            $("./div[@id='francis-title']/h1") {
              add_class("mw_h2")
            }
            
            $("./div[a]") {
              attribute("id","mw_topic_photo")
            }
            
            #form title
            $("./p[position() = last()]"){              
              add_class("mw_h3")
              move_to("../../form","top")
            }
            
            $("./ul") {
              wrap("div") {
                attribute("id","mw_topics")
                move_here("./preceding-sibling::p[1]","top")
              }  
            }
            insert("div") {
              attribute("class","mw_topic")
              move_here("../div[@id='mw_topic_photo' or @id='mw_topics']")              
            }
          }
          # end toptext
          #form
          $("./form") {
            attribute("class","mw_st_form")
            $("./div[@id='chimps-bottom-elements']//input | ./div[@id='chimps-bottom-elements']//textarea") {
              remove("@style")
            }            
            $(".//input[@type='text'] | .//select") {
              add_class("mw_input")
            }
            $(".//input[@class='francis-submit-button']") {
             add_class("mw_btn1")
             wrap("div") {
               attribute("class","mw_submit_btn")
             }
            }
            $(".//div[@id='fields-input-boxes']/label[@class='francis-text-label']") {
              insert_after("span") {
                attribute("class","mw_spacer")
              }
            }
          }
          #
          
          $(".//script[contains(text(),'validate(')]") {
            text() {
              replace(/insertBefore/,"insertAfter")
            }            
          }
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_splash_mobile")

  $(".//table"){
    add_class("mw_splash_table")
    remove("@style")
    table_dump(".")
  }

  $(".//div[contains(@class, 'mw_splash_table')]"){
    $("./div/div/div/div/h3"){
      add_class("mw_splash_header")
    }
  }

  $(".//p[contains(@class, 'mw_donate_info')][last()]"){
    insert_after("div", class:"mw_donateButtons_wrapper"){
      move_here("//a[contains(@class, 'mw_donate_link')]")
    }
  }

  $(".//div[@class='mw_donateButtons_wrapper']/a[2]/img[@alt='donate now']/.."){
    move_to("../../p[contains(@class, 'mw_donate_info')][1]", "before")
    wrap("p", class:"mw_donate_info")
  }

  $(".//param[@name='movie']/../.."){
    remove("@style")
    add_class("mw_video_container")
  }

}
$("./body") {
  add_class("mw_site_donate")

  # Remove the header image
  #remove(".//div[@id='ga-header']") #HSUS-482
  remove(".//div[@id='ga-header']/img") #HSUS-524


  $(".//*[contains(@style, 'padding')]") {
    remove("./@style")
  }

  # Main donate form
  $(".//div[@id='donate-form']") {
    add_class("mw_box2")

    
    

    # center the one time gift image
    $(".//img[contains(@alt, 'one time gift')]/ancestor::td") {
      add_class("mw_one_time_gift_center")
    }

    #HSUS-230, Remove thermometer image.
    remove(".//div[@id='seal-thermometer']")

    # This might fix the images not displaying on older devices
    # the src looked something like src="////secure.humanesociety.org///../images/content/pagebuilder/19930.png"
    fixImages()

    # HSUS-524
    # Placed after fixImages() so that the "Or Make a One-time Gift" on
    # secure.humanesociety.org/site/Donation2?df_id=2320&2320.donation=form1&s_src=web_topnav_monthly
    # does not look weird
    bm("moving #donation-top into #donation-form") {
      move_here("./ancestor::div[@id='page-content']/preceding-sibling::div[@id='ga-header']/div[@id='donation-top']", "top")
    }
  }

  $(".//h3[img]/ancestor::td[1]") {
    add_class("mw_donate_desc")
    remove("@width")
    remove("@height")
  }

  # Move the hero imge to after the h3 tag
  $(".//h3/img[contains(@src,'jpg')]") {
    add_class("mooved")
    move_to("..", "after")
    remove("@width")
    remove("@height")
  }
  
  $(".//td[img]/..") {
    remove("./td[@id='caption']")
    $("./td") {
      add_class("mw_monthly_donation_desc")


      #move_here("./img", "top")
      $("./img[contains(@alt,'PayPal')]") {
        # fix for HSUS-511
        remove("./@src")
        add_class("images-pp_c_mark")
        # move_to("../..", "top")
      }
    }
    # Merge the header stuff into one td
    $("./td[1]") {
      move_here("../td[2]/*")

      $("./table") {
        remove("./@style")
      }
    }

  }

  # for the monthly donation form, to move the image below the h3 tag
  $(".//td[h3]/img[contains(@src, 'jpg') and not(@class)]") {
    add_class("mw_image_pad")
    # move_to("../..", "top")
    move_to("../h3", "after")
    # $("./following-sibling::p[1]") {
    #   add_class("mw_testing")
    # }
  }

  $(".//td/img[contains(@src, 'jpg') and not(@class)]") {
    add_class("mw_image_pad_float")
    move_to("..", "top")
  }

  # For the puppy mill page and similar
  $(".//td/div[@style and img]") {
    # Remove styling on the Div
    add_class("mw_captioned_img_styling")
    remove("@style")
  }

  # Hide pixel tracking
  $(".//div[@class=' mw_captioned_img_styling'][./img[contains(@src, 'googleadservices')]]") {
    add_class("mw_hide")
  }

  # Match <p>'s that only have &nbsp;
  #$(".//p | .//td") {
    # inner(){
    #   replace(/\xC2\xA0/, "")
    # }
  #}
  # match($text) {
  #   with(/\xC2\xA0/) {
  #     add_class("mw_testing")
  #   }
  # }

  # Humane card form
  $(".//img[contains(@alt, 'humane') and contains(@alt, 'card')] | .//img[@alt=' ']") {
    # add_class("mw_testing")

    $("./ancestor::table[1]") {
      # add_class("mw_testing")
      attribute("align", "center")

      $("./parent::td") {
        add_class("mw_card_center")
      }
    }
  }

  $(".//form[@id='ProcessForm']") {
  # Fix for HSUS-482
    #add_class("mw_box5")

    $(".//tbody[contains(@id, 'level-standard')]") {
      #HSUS-457: Start;
      $("./tr[@class='donationRepeatRowBefore']") { 
        add_class("mw_repeat_payment")
      }
      $("./tr[@class='FormRow' and contains(@id, 'level_standardauto_repeat_Row')]") { 
        add_class("mw_repeat_payment")
      }
      $js = "
      $(document).ready(function() {
       //$(\"table tr[class='donationRepeatRowBefore']\").remove();
       //$(\"table tr[id='level_standardauto_repeat_Row']\").remove();

       $(\"tbody tr[class='donationRepeatRowBefore']\").appendTo( $(\"tbody[id='level-standard.75156']\") );
       $(\"tbody tr[id='level_standardauto_repeat_Row']\").appendTo( $(\"tbody[id='level-standard.75156']\") );
       //$(\"input[id='level_standardauto_repeatname']\").appendTo( $(\"tbody[id='level-standard.75156']\") );

       //$(\"table tr[class='donationRepeatRowBefore']\").appendTo('table');
       //level-standard.75156

       //$(\"table[id='level-standard.75156'] .row:first\").remove().insertAfter($(\"table[id='level-standard.75156'] .row:last\"));

       //alert('done');
       });
"
# insert_javascript( $js )
      #HSUS-457: End;
      $("./following-sibling::tbody[1]") {
        add_class("mw_donation_note")
        
      }
      move_here("./following-sibling::tbody[contains(@class, 'mw_donation_note')]") {
        name("div")
      }
    }

    # Provide a way to limit the size of the labels of the radio buttions
    $(".//label[@class='RadioGroupLabel']/..") {
      add_class("radioGroupLabeltd")
    }

    # $(".//tbody[contains(@id, 'level-standard')]/following-sibling::tbody[1]") {
    #   add_class("mw_testing")
    #   $("./preceding-sibling::tbody[contains(@id, 'level-standard')]") {
    #     add_class("mw_testing")
    #   }
    #   # move_to("../preceding-sibling::tbody[contains(@id, 'level-standard')]")
    #   move_to("./ancestor::table[1]//tbody[contains(@id, 'level-standard')]")
    # }
  }

  # This should select the donation form table, first row
  $(".//tr[@class='FormRow'][1]") {
  # $(".//tbody[@class='FormRow'][1]//") {

    # Move the "Select Gift Amount away from the first option"
    # Fix for HSUS-482
    #insert_before("tr", class:"FormRow mw_gift_desc") {
      move_here("./following-sibling::tr[1]/td[@class='FormLabel']") {
        # Change the attribute so that we can hide the empty 
        # .requiredIndicator and .FormLabel <td>'s
        attribute("class", "mw_formlabel")
      }
    #}
    # End of HSUS-482
  }

  # bump down the radio button for the "other" donation amount
  $(".//input[@class='DonationLevelOtherAmount']/ancestor::tr[1]//input[@type='radio']") {
    add_class('mw_radio_alignment')
  }

  $(".//tbody[contains(@id, 'html-caption')]//td[@class='FormCaption']/p") {
    remove("./@style")
    add_class("mw_donation_info")
  }



  # Shift the .requiredIndicator (*) to the description
  $(".//tbody[contains(@id, 'billing') or contains(@id, 'email') or contains(@id, 'Recipient') or contains(@id, 'City') or contains(@id, 'Sender_Signature') or contains(@id, 'Zip_Code')]//td[@class='requiredIndicator']") {
    #add_class("mw_testing")
    move_to("./../preceding-sibling::tr[1]", 'top')
  }

  # Remove the [x] images from the errors, so that the text can be red instead
  remove(".//tr[@class='holdsErrorMsg']//img")

  # Remove the width="100%" from the error message
  $(".//tr[@class='holdsErrorMsg']/td[@class='FormInfoMsg']") {
    remove("./@width")
  }

  # Evenly space out the Credit card types
  $(".//tr[@id='payment_typecc_type_Row']/td[@class='FormInput']//table[1]") {
    add_class("mw_credit_card_flex")
  }

  # Improve the look of the credit card form
  $(".//td[@class='FormInput'][input]") {
    add_class("mw_donate_clear")
  }
  
  # Make the seals easier to deal with for CSS
  $(".//script[contains(@src, 'verisign')][1]/ancestor::table[1]") {
    add_class("mw_seals")
    remove("@height")
    # HSUS-230, align icons
    $("./ancestor::tr[@class='FormRow']") {
      add_class("mw_seals_center")
    }
  }
  $(".//div[@id='othergive']/following-sibling::table[contains(@class, 'mw_seals')]") {
    # attributes(class: "mw_bottom_seal", align:"center")
  }

  # Locate the other.. seal
  /*$(".//script[contains(@src, 'verisign')][2]/ancestor::table[1]") {
    add_class("mw_bottom_seals")
    # move_here("")
    }*/

    $(".//div[@id='vs_seal']/..") {
      attribute("id", "vs_seal_wrapper")

      $("./ancestor::table[1]/..") {
        attribute("id", "mw_bottom_seal")
      # name("div")
    }
  }

  # Make the Donate button pretty
  $(".//tbody[contains(@id, 'buttons')]") {
    $(".//td[@align='right']") {
      attribute("align", "center")
      # log("Does the image button exist?")
      # log($(".//ancestor::tbody[1]/following-sibling::tbody[1]//img[contains(@src, 'xdonation_form_submit')]"))
      
      match($(".//ancestor::tbody[1]/following-sibling::tbody[1]//img[contains(@src, 'donation_form_submit')]")) {
        with(/0/) {
          log("Image button exists for donation form, hiding #pstep_finish")
          $(".//input[@id='pstep_finish']") {
            remove("./@onmouseover | ./@onmouseout")
            add_class("mw_btn2")
            attribute("value", "Submit")
          }
        }
        else() {
          $(".//input[@id='pstep_finish']") {
            log("Image button exists for donation form, hiding #pstep_finish")
            add_class("mw_hide")
          }
          
        }
      }
      # $(".//input[@id='pstep_finish']") {
      #   remove("./@onmouseover | ./@onmouseout")
      #   add_class("mw_btn2")
      #   attribute("value", "Submit")
      # }
    }
  }

  # Pre wrap the expiration date credit card <select>

  $(".//fieldset[contains(@class, 'cardExpGroup')]/select") {
    %expdate = fetch("@id")
    wrap("div", id:concat(%expdate, "_wrapper"))
  }

  # add in some extra arrows for the select box
  $(".//select/..") {
    add_class("mw_select_arrows")
  }

  # Make the phone number dialable
  $(".//a[contains(@href, 'mailto')]/parent::p") {
    wrap_text_children("span") {
      $phone_text = fetch("./text()")
      $phone_num = ""
      $phone_text {
        log("trying to match a number")
        log(this())
        replace(/(\d*\-*\d{3}\-\d{3}\-\d{4})/) {
          #, contcat("<a tel:'", $1, "'>", $1, "</a>")
          $phone_num = $1
        }
      }
      /*match($phone_num, "") {
        name("a")
        attributes(href: "tel:"+$phone_num)
        }*/
        inner(){
        #$click_tel = concat("<a tel:'", $1, "'>", $1, "</a>")
        replace(/(\d*\-*\d{3}\-\d{3}\-\d{4})/, concat("<a href='tel:", $phone_num, "'>", $phone_num, "</a>"))
      }
    }
    
    $(".//a[strong]") {
      remove("@style")
    }
  }

  # converts a generic format phone number to be clickable on mobile
#Courtasey of the accenture project
/*@func XMLNode.telephonize() {
  $phone_text = fetch("./text()")
  $phone_num = ""
  $phone_text {
    replace(/^\s*([ \+\-()\d]{9,}\d)\s*$/) {
      $phone_num = $1
      log($phone_num)
    }
  }
  match_not($phone_num, "") {
    name("a")
    attributes(href: "tel:"+$phone_num)
  }
  }*/

  # footer detailing
  $(".//li[@class=' mw_link_center']/a") {
    add_class("mw_bar2")
    $("../..") {
      add_class("mw_footer_link_list")

      $("./li[not(@class)]") {
        add_class('mw_footer_copyright')
      }
    }
    
  }

  # Deal with youtube videos
  $(".//object") {
    $("./embed") {
      #remove("@width")
      #remove("@height")
      attributes(width:"100%", height:"200px")
    }
    $("..") {
      remove("@style")
    }
  }


  # Use custom keyboards
  contextual_keyboard(".//input[@id='billing_addr_zipname']", "numeric")
  contextual_keyboard(".//input[@id='donor_email_addressname']", 'email')
  # HSUS-96 - numeric keyboard with decimal
  # contextual_keyboard(".//input[@class='DonationLevelOtherAmount']", 'numeric')
  $(".//input[@class='DonationLevelOtherAmount']") {
    keyboard('number')
    #some browsers are particular about having a '$' in the value and won't display that
    %amount = fetch("@value")
    %amount {
      replace(/\$/, '')
    }
    attribute("value", %amount)
  }
  contextual_keyboard(".//input[@class='DonationLevelOtherAmount']", 'number')
  contextual_keyboard(".//input[@id='donor_phonename']", "tel")
  contextual_keyboard(".//input[@id='payment_typecc_numbername']", "numeric")
  contextual_keyboard(".//input[@id='payment_typecc_cvvname']", 'numeric')



  # Donation Thankyou page

  # vehicle donation
  $(".//img[contains(@src, 'vehicle')]/ancestor::table[1]") {
    add_class("mw_donate_vehicle")

    $(".//img/ancestor::td[1]") {
      add_class("mw_donate_vehicle_img")

      $("./following-sibling::td[1]") {
        add_class("mw_donate_vehicle_text")
      }
    }
  }

  # Share table
  $(".//img[contains(@src, 'facebook')]/ancestor::table[1]") {
    add_class("mw_donation_share")
    remove("@style")

    $(".//td[@width='20']") {
      remove()
    }


    $(".//td | .//tr") {
      remove("@width")
      remove("@height")
    }
  }


  # Summary table
  $(".//td[@class='FormSectionHeader']/ancestor::table[1]") {
    add_class("mw_transaction_summary mw_bar5")
    attribute("data-ur-toggler-component", "button")

    $("./following-sibling::table[1]") {
      attribute("data-ur-toggler-component", "content")
    }

    $("..") {
      attribute("data-ur-set", "toggler")
      attribute("style", "width: 100%;")
    }
  }
  

  $(".//div[@id='othergive']") {
    attribute("data-ur-set", "toggler")

    $("./h2") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")
    }

    $("./ul") {
      attribute("data-ur-toggler-component", "content")
    }

    $("..") {
      attribute("style", "width: 100%;")
    }
  }

  #HSUS-448: Start;
  # $(".//tbody[./tr[@id='donor_phone_Row']]") {
  #   # remove("preceding-sibling::tbody[1] | following-sibling::tbody[position() < 4]")
  # }
  # $(".//tr[@id='payment_typecc_cvv_Row']") {
  #   $("./td[contains(@class,'mw_donate_clear')]/a[@class='HelpLink']") {
  #     move_to("ancestor::tr[@id='payment_typecc_cvv_Row']/td[@class='FormLabel']") 
  #   }
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typeradio_Row']/td[@class='requiredIndicator']") {
  #   move_to("ancestor::tbody[1]/tr[contains(@class,'mw_gift_desc')]", "top")
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typelist_Row']/td[@class='requiredIndicator']") {
  #   move_to("ancestor::tbody[1]/tr[contains(@class,'FormRow mw_gift_desc')]", "top")
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typeradio_Row']/td[@class='FormInput']/fieldset/table") {
  #   add_class("mw_new_payments_inline")
  #   $("./tr"){
  #     add_class("mw_new_payments_inline_tr")
  #     $("./td[1]"){
  #       add_class("mw_new_payments_inline_tr_td_radio")
  #     }
  #     $("./td[2]"){
  #       add_class("mw_new_payments_inline_tr_td_flag")
  #     }
  #   }
  # }
  # $(".//img[@alt='PayPal']") {
  #   add_class("mw_new_payments_inline_tr_td_flag_image")
  #   $("../../td[contains(@class, 'mw_monthly_donation_desc')][2]"){
  #     text() {
  #       set("")
  #     }
  #   }
  #   move_to("../../td[contains(@class, 'mw_monthly_donation_desc')]")
  # }
  # $(".//a[@href='https://www.paypal.com/us/cgi-bin/webscr?cmd=xpt/Marketing/popup/OLCWhatIsPayPal-outside' and @class='Smaller']") {
  #   remove()
  # }
  # $(".//img[@alt='Amazon Payments']") {
  #   add_class("mw_new_payments_inline_tr_td_flag_image")
  #   $("../../td[contains(@class, 'mw_monthly_donation_desc')][2]"){
  #     text() {
  #       set("")
  #     }
  #   }
  #   move_to("../../td[contains(@class, 'mw_monthly_donation_desc')]")
  # }
  # $(".//a[@href='https://payments.amazon.com/sdui/sdui/about?nodeId=77175' and @class='Smaller']") {
  #   remove()
  # }
  # $(".//tr[@id='payment_typecc_type_Row']/td[contains(@class, 'mw_select_arrows')]") {
  #   add_class('mw_select_arrows_inline')
  # }
  # $(".//td[contains(@class,'mw_seals_center') and @valign='top' and @height='100%']") {
  #   remove()
  # }
  # $(".//input[@id='payment_typecc_cvvname']") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//input[@id='payment_typecc_exp_date_MONTH']") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//input[@id='payment_typecc_exp_date_YEAR']") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//tr[@id='payment_typepay_typelist_Row']/td") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//select[@id='payment_typepay_typelist']") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//div[@id='payment_typecc_exp_date_MONTH_wrapper']") {
  #   add_class("mw_div_50_p")
  # }
  # $(".//div[@id='payment_typecc_exp_date_YEAR_wrapper']") {
  #   add_class("mw_div_50_p")
  # }
  $(".//table[contains(@class, 'mw_seals') and @align='left' and @border=0]") {
    remove()
  }
  #HSUS-448: End;
  $(".//span[contains(text(), 'Select a Payment Type:')]") {
    move_here("ancestor::tr[contains(@class, 'FormRow')][1]/following-sibling::tr[1]/td[@class='requiredIndicator']", "top") {
      name("span")
    }
  }
  $(".//label[@for='payment_typepay_typeradiocredit']") { 
    $("..") {
      add_class("mw_v_align")
    }
  }
  remove(".//a[@class='Smaller']")
  remove(".//td[contains(@class,'mw_seals_center')][last()]")
  $(".//tr[@id='donor_email_opt_in_Row']") {
    remove("ancestor::tbody[1]")
  }
  # HSUS-482:[Mobile & Tablet] Gift Donation Form Styling
  
  $(".//input[@id='fulfill_eCard']") {
   move_to("ancestor::body//table[@class='tbl-ecard-type-select']//td[2]","bottom")
 }
 $(".//table[@id='overTable']/tbody[contains(@id,'tribute_type') or contains(@id,'tribute_notify') or contains(@id,'Card_Type')]") {
  add_class("mw_hidden")
}
  # Fix For HSUS-482
  $(".//td[@class='mw_formlabel']") {
    move_to("ancestor::body//tr[@id='payment_typecc_number_Row']","top")
  }
  $(".//tr[@valign='bottom']") {
    $("./td[@align='center']") {
      add_class("mw_new_padding")
    }
  }
  # Fix for HSUS-482
  $(".//tbody[.//div[@class='section-separator']]") {
    $(".//td") {
      add_class("mw_separator")
    }
  }
  $(".//tbody[contains(@id,'e_card_preview')]") {
    remove()
  }
  # End of HSUS-482
   # HSUS-482:End

   //HSUS-476
   $(".//div[@class='mw_powered_by']"){
    move_to("//div[@class='legal']")
  }

  $(".//img[@alt='better business bureau']/../.."){
    add_class("mw_float_right")
  }

  $(".//td[contains(@class, 'printed-card-section')]") {
    add_class("ecard-section")
  }

  # Fix for HSUS-487
  $(".//table[@id='overTable']/tbody[last() not(.//h3)]") {
    #".//table[@id='overTable']/tbody[last()]"
    # remove()
    add_class("mw_hide")
  }
  $(".//table[@id='overTable']/tbody[not(@id) or not(@class)]") {
    remove()
    # add_class("mw_testing")
  }
  $(".//tr[@id='level_standardauto_repeat_Row']") {
    $("./td[contains(@class,'FormLabel')]") {
      add_class("mw_display")
      $("./div") {
        add_class("mw_display")
      }
    }
  }
  match($path,/site\/Donation2\?df_id\=(14482\&14482)|(14481\&14481)/i) {
    $(".//div[@id='othergive']") {
      move_to("ancestor::body//div[@id='dataFormContainer']/table","after")
    }
  }
  match($path,/site\/Donation2\?df_id\=(14380\&14380)|(14381\&14381)/i) {
    $(".//div[@class=' mw_sidebar_content_hide']") {
      $("./img") {
        attribute("src") {
          value() {
            replace("////secure.humanesociety.org///","")
          }
        }
      }
      move_to("ancestor::body//div[@id='ga-header']","bottom")
      add_class("mw_alignment")
    }
  }
  $(".//div[@id='donation-top']") {
    $(".//div[./img]") {
      remove("@style")
    }
    remove("./br")
    $(".//img") {
      add_class("mw_width")
    }
    $(".//img[contains(@alt,'Or make a one time gift')]") {
      add_class("mw_center")
    }
  }

  $(".//label[@for='payment_typepay_typeradiopaypal']/.."){
    add_class("mw_paypal_wrapper")
  }
  # End OF HSUS-487

  $(".//td[contains(@class, 'printed-card-section')]"){
    $("./img"){
      move_to("..", "bottom")
    }
  }

  $(".//tr[@id='payment_typecc_number_Row']/td[@class='requiredIndicator']"){
    add_class("mw_hidden")
  }

  $(".//tr[@id='payment_typecc_number_Row']"){
    insert_top("td", "*", class:"requiredIndicator")
  }
  // Fix for HSUS-511
  $(".//div[contains(text(),'Billing Information')]/.."){
    add_class("mw_billing_separator")
    move_to("//tr[@id='billing_first_name_Row']", "top")
  }

  $needsPaymentRequiredText = "true"

  $(".//div[contains(text(), 'Payment Information')]/span"){
    //since we found the required payment text, we no longer need to insert it
    $needsPaymentRequiredText = "false"
  }

  match($needsPaymentRequiredText, /true/){
    $(".//div[contains(text(), 'Payment Information')]"){
      insert("span", "* Required")
    }
  }
  # HSUS-492: Make Thermometer Visible on Year End Donation Forms-Fixed
  $(".//div[@id='progress']/img[contains(@src,'DynImg')]"){
    %src = fetch("@src")
    %src {
      replace('DynImg', 'site/DynImg')
    }
    attribute("src", %src)
  }
 
  $(".//div[@id='side']") {
    move_to("ancestor::body//div[@id='donation-top']","after")
  }
  # HSUS-492-end

  # Fix for HSUS-511
  $(".//input[@id='pstep_finish']") {
    remove("./@class | ./@value")
    add_class("images-submit_logo")
  }
  $(".//table[contains(@summary,'Credit Card')]") {
    $(".//td//img") {
      remove("./@src | ./@alt")
    }
    $(".//img[@id='payment_typecc_type_Visa']") {
      add_class("images-cc_logo_retina")
    }
  }
  $(".//a[contains(text(),'ABOUT TRUST ONLINE')]") {
    add_class("mw_norton")
  }
  $(".//div[contains(@class,'section-separator')]/span") {
    text() {
      replace("* Required","Required")
    }
  }
  # Fix for HSUS-513
  $(".//div[contains(text(),'Choose the amount of your donation')]") {
    add_class("mw_new_margin")
  }
  remove(".//tbody[@id='html-caption.82150']|//tbody[@id='html-caption.74181']|//tbody[@id='html-caption.84661']|//tbody[@id='html-caption.44761']|//tbody[@id='html-caption.81560']|//tbody[@id='html-caption.84660']")
  remove(".//td[contains(@class,'RequiredCellWidth')]//ancestor::tr[1]") // For HSUS-512
  remove(".//td[@id='RightEdge']")
  remove(".//p[contains(@class,'mw_donation_info')][last()]")
  $(".//tbody[@id='level-standard.41522']") {
    $(".//tr[@class='FormRow']") {
      $("./td[@class=' mw_separator']") {
        add_class("mw_hide")
      }
    }
  }
  $(".//a[contains(.,'click here')]") { // For HSUS-512
    add_class("mw_donate_link")
    $("./u | ./strong") { // For HSUS-512 and HSUS-511
      text(" here")
      insert_top("span", "tap")
    }
  }
  remove(".//tbody[@id='html-caption.82150']|//tbody[@id='html-caption.74181']|//tbody[@id='html-caption.84661']")
  remove(".//td[contains(@class,'RequiredCellWidth')]//ancestor::tbody[1]") 
  remove(".//td[@id='RightEdge']")
  # Fix for HSUS-511
  $(".//tbody[contains(@id, 'buttons')]") {
    add_class("mw_margin_top_20")
  }
  # Start of Fix HSUS-511
  $(".//td[@class='FormCaption'][not(div)][not(p)]/ancestor::tbody") {
   remove()
  }
  # End Fix HSUS-511
}
$("./body") {
  add_class("mw_valor_award_tablet")
  # header logo img
  $("./div[@class='mw_header']/a[@class='mw_header_spillover']/img") {
    attribute("src") {
      value() {
        replace(/[\/|\w|\.]+(\.\..*)/) {
          set($1)
        }
      }
    }
  }
  # end header logo img
  remove("./div[@id='wrapper']/br")
  $("./div[@id='wrapper']") {
    insert_top("div", class: "mw_masthead") {
      insert("img", src: "http://www.humanesociety.org/assets/images/1024x256-tablet-mastheads/tablet_masthead_default.png", class: "mw_tablet_masthead_image")
    }
    $("./div[@id='page']") {
      remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style] | ./br")
      $("./div[@id='contentDiv']/div[@id='cols']") {
        add_class("mw_box2_tablet")
        $("./div[@id='main']/div[@id='wrapper-body']") {
          remove("./@style")
          # share
          $("./ul[@id='share_bar']/li/img[@class='share_image']") {
            name("span")
            insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
            remove()
          }
          # end share
          $("./div[contains(@id, 'pov-col')]") {
            $(".//h3") {
              add_class("mw_h3")
            }
            $("./div[@class='pov-text']") {
              $("./h2") {
                add_class("mw_h2")
                remove("./br")
              }
              $("./p") {
                name("div")
                wrap_text_children("span")
                $("./br/following-sibling::span[1]") {
                  wrap("div", class:"mw_wrap_div")
                }
                $("./a | ./span | ./strong") {
                  move_to("preceding-sibling::div[1]", "bottom")
                }
                remove("./br")
              }
            }
            $(".//div[@class='pov']") {
              remove(".//@style | .//@width")
              $("./img") {
                add_class("mw_img")
              }
              $("./div[@id='pov-radio-error']") {
                move_to("./preceding-sibling::label[@class='pov-label']", "bottom")
              }
              $("./p[not(*)]") {
                text() {
                  replace(/^[\s\u00a0]+/, "")
                  replace(/[\s\u00a0]+\|$/, "")
                }
              }
            }
            # cast your vote area
            $(".//div[@id='pov-fields-input-boxes']") {
              remove("./p/@style | ./div[@id='bogotext']//img/@style")
              $("./div/input") {
                add_class("mw_input")
              }
              $("./label[./input[@class='radio']]") {
                add_class("mw_radio")
                move_here("./following-sibling::div[@id='pov-radio-area-legal' or @id='pov-radio-error-legal']", "bottom")
              }
              $("./input[@class='pov-submit-button']") {
                add_class("mw_btn1")
                wrap("div", class: "mw_submit_btn")
              }
            }
            # end cast your vote area
          }
        }
      }
    }
  }
}
$("./body") {
  add_class("mw-take-your-pet")

  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1", id:"mw_footer") {
      move_here("//div[@id='footer']") {
        $("./p") {
          add_class("mw_content")
          move_to("./ancestor::div[@id='footer']", "bottom")
        }
        $("./ul") {
          wrap("div")
        }
      }
      remove(".//@style | ./div[@id='footer']/div[./img] | .//li[./a[contains(@href, 'facebook') or contains(@href, 'twitter')]]")

      $(".//ul/li[1]") {
        add_class('mw_footer_copyright')
      }
      $(".//li[./a]") {
        add_class("mw_link_center")
        $("./a") {
          add_class("mw_bar2")
        }
      }
      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # end footer

  remove(".//@style | ./div[@id='footer']/div[./img]")

  table_dump("./table")
  $("./div[contains(@class,'mw_was_table')]") {
    remove("./div[contains(@class,'mw_was_tr')][1]")
    $(".//div[@id='disaster-container']") {
      remove("./div[@class='infographicshare']")
    }
  }
}
$("./body") {
  add_class("mw-take-your-pet-tablet")

  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1") {

      move_here("//div[@id='footer']") {
        remove("./div[./img]")
        attribute("id") {
          value() {
            replace("er", "")
          }
        }
      }

      #manually styled footers
      move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
        remove("@style")
        remove("./img")
        $("./p") {
          name("li")
          add_class("mw_footer_info")
          move_to("./following-sibling::ul", "bottom")
        }
        $(".//*[@style]") {
          remove("@style")
        }
        $("./ul/li[1]") {
          add_class('mw_footer_copyright')
        }
        $(".//li[./a]") {
          add_class("mw_links_inline")
          remove("./self::li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
        }
      }

      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # footer

  remove(".//@style | ./div[@id='footer']/div[./img]")

  table_dump("./table")
  $("./div[contains(@class,'mw_was_table')]") {
    remove("./div[contains(@class,'mw_was_tr')][1]")
    $(".//div[@id='disaster-container']") {
      remove("./div[@class='infographicshare']")
      # HSUS-463: [Mobile & Tablet] Take Your Pet Contest Page
      insert_top("div", id: "mw_mast_head") {
        insert("img", src: asset("images/take_your_pet_landingpage.jpg"), alt: "take_your_pet_landingpage", width: "100%", height: "auto")
      }
      # End HSUS-463
    }
  }

}
$("./body") {
  add_class("mw_my_profile")
  $(".//div[contains(@class, 'mw_masthead')]/img | ./div[@class='mw_header']/a/img") {
    attribute("src") {
      value() {
        replace(/SPageNavigator\//, "")
      }
    }
  }
  remove(".//@style")
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
      remove(".//hr")
      $(".//h2") {
        add_class("mw_h1")
      }
      $(".//input[@type='image']") {
        $text = fetch("./@id")
        btn_delegate() {
          add_class("mw_btn4")
          text($text)
        }
      }
      # top profile info
      $(".//div[@id='centerHeader']") {
        add_class("mw_flex_box")
        $("./div") {
          add_class("mw_sidebar1 mw_flex_box_item_1")
          remove(".//a[@class='cta']/img")
          $("./p[not(./a)]") {
            add_class("mw_profile_p")
          }
          wrap_text_children("span", class: "mw_profile_p") {
            match(text(), /\A\s+\Z/) {
              remove()
            }
          }
        }
      }
      # Humane Society International
      $(".//div[@id='hsiAlert']") {
        add_class("mw_sidebar1")
      }
      # blue box
      $(".//div[@class='action']") {
        add_class("mw_sidebar2")
      }
      # wayne's blog
      $(".//div[@id='blog_feed']") {
        insert_top("h2", "WAYNE'S BLOG")
      }
    }
  }
  remove(".//div[@id='page-head'] | .//div[@id='head']")
  
  # HSUS-377 Giving Opportunities
  match($path, /^\/site\/donation($|\/[\d]+)/i) {
    $("./div[@class='mw_header']/a/img") {
      attribute("src") {
        value() {
          replace(/\/site\/Donation\/\.\./, "")
        }
      }
    }
    $(".//div[contains(@class, 'mw_masthead')]/img") {
      attribute("src") {
        value() {
          replace(/\/site\/Donation\/\.\..*/, "wrpr\/girlcat\.jpg")
        }
      }
    }
    $(".//div[@id='wrapper-body']/h3") {
      add_class("mw_h3")
    }
  }
}
$("./body") {
  add_class("mw_signup_tablet")

  # remove the odd text nodes that are adding strange text
  wrap_text_children("span", class:"mw_hide")

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//ul[@id='share_bar']") {
      $("./li[./img[contains(@class, 'share_image')]]") {
        text("Share")
        add_class("mw_share")
      }
      $("./li[./a[contains(@class, 'addthis')]]") {
        add_class("mw_social_icon")
      }
    }
    $("./div[@id='contentDiv']") {
      $("./div[not(@id)]") {
        remove()
      }
      # add_class("mw_gray_inner")
      # add_class("mw_box3")
      $("./div[@id='head'] | ./div[@id='head']/div[contains(@style, 'background')] | .//p") {
        remove("@style")
      }
      $(".//div[contains(@class, 'section')]/div[contains(@style, 'height')]") {
        remove("@style")
      }
    }
    $("./div[@id='page-bottom-spacer']") {
      remove()
    }

    $(".//div[@class='appArea'][table]") {
      # add_class("mw_box3")
    }

    $(".//div[@class='appArea']/p") {
      wrap_text_children("span")
      $("./span[string-length()<=4 and not(*)]") {
        remove()
      }
    }

    $(".//div[@id='wrapper-body']") {
      remove("./@style")
      $("./form[1]") {
        add_class("mw_box3")
      }
      remove("./div[@class='templateComponent']/preceding-sibling::p[1]")
    }

    $(".//h3") {
      add_class('mw_h1 mw_hide')
    }

    $(".//h1") {
      add_class("mw_h3")

      $("./following-sibling::p") {
        add_class("mw_signup_description")
      }
    }

    # Remove the td's with width of 5% or <br>s
    $(".//td[@width='5%'] | .//br") {
      remove()
    }

    # Give the td's containing the <label> a class
    $(".//input[not(@type='checkbox')]/ancestor::td[1] | .//select/ancestor::td[1]") {
      add_class("mw_signup_field")
    }
    $(".//td[./select]") {
      add_class("mw_select_arrows")
    }

    # make the checkboxes look nice-r
    $(".//input[@type='checkbox']/ancestor::td[1]") {
      add_class("mw_signup_checkbox")

      $("./following-sibling::td[1]") {
        add_class('mw_signup_checkbox_label')
      }
    }

    # Make the buttons on the bottom
    $(".//input[@id='ACTION_SUBMIT_SURVEY_RESPONSE']") {
      match($path) {
        # HSUS-422 : for the Meatless Monday Recipe submit button
        with(/pagename\=meatless_monday_contest/) {
          btn_delegate() {
            add_class("mw_btn2 mw_monday_contest_submit")
            text(fetch("following-sibling::input[@id='ACTION_SUBMIT_SURVEY_RESPONSE']/@value"))
          }
        }
        else() {
          add_class("mw_signup_btn")
        }
      }
    }

    $(".//input[@id='ACTION_CANCEL_RESPONSE_SUBMIT']") {
      add_class('mw_cancel_btn mw_hide')
    }
    
    # HSUS-422
    $(".//table[@id='meatlessmonday']") {
      remove(".//@width | .//@height | .//@style")
      $(".//td") {
        add_class("mw_signup_field")
      }
      $(".//td[./input[@id='cons_email_opt_in']]") {
        add_class("mw_cons_email_opt_in")
      }
    }
    match($path, /meatless/) {
      add_class("mw_meatless")
    }

    # Custom keyboards
    contextual_keyboard(".//input[@id='cons_email']", "email")
    contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")
    contextual_keyboard(".//input[@id='3314_2820_4_2322']", "tel")
    
  }
}
$("./body") {
  add_class("mw_edit_profile_tablet")
  # when error message appear, the img will broken
  $(".//img[contains(@src, 'ConsProfileUser') or contains(@src, 'ConsInterestsUser')]") {
    attribute("src") {
      value() {
        replace(/\/(ConsProfileUser|ConsInterestsUser)/, "")
      }
    }
  }
  remove(".//div[@id='page-head'] | .//ul[@id='site-nav'] | .//div[@id='head']")
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
      # main content
      $("./div[@id='wrapper-body']") {
        # desktop site display none
        $(".//p/a[contains(@href, 'Passwd')]") {
          add_class("mw_hide")
        }
        $(".//h3") {
          add_class("mw_h3")
        }
        # btns
        $(".//p[./input[@class='Button']]") {
          add_class("mw_btn_center")
          $("./input[@value='Save' or @title='Done' or @title='Register' or contains(@value, 'Home')]") {
            add_class("mw_btn2")
          }
          $("./input[@value='Cancel' or @value='Reset']") {
            add_class("mw_btn1")
          }
        }
        # end of btns
        
        # Email Subscriptions
        $(".//form[@id='ConsConfigInterests']") {
          remove("./table[.//input[@id='ConsInterestsUseremailPrefsEMAILOpenAll']] | ./table/@style")
          $(".//tr[./th]") {
            add_class("mw_table_title")
          }
        }
        # end of Email Subscriptions
      }
      # end of main content
    }
  }
  # table_dump(".//table")  
}
$("./body") {
  add_class("mw_splash_tablet")

  $(".//div[@class='mw_donation_image_center']/.."){
    add_class("mw_content_wrapper")
    $("./p"){
      add_class("mw_text_wrapper")
    }
  }

  $(".//table[@align='center']"){
    add_class("mw_contentTable")
    $("./tbody/tr[1]"){
      add_class("mw_splash_header")
    }
  }

  $(".//td[contains(@class, 'mw_content_wrapper')]"){
    move_here("./p[contains(@class, 'mw_donate_info')][1]", "top"){
      add_class("mw_donatebtn_top")
    }
  }
}

remove("//table/@style")
$("./body") {
  add_class("mw_signup")

  # remove the odd text nodes that are adding strange text
  wrap_text_children("span", class:"mw_hide")

  $(".//div[@id='page']") {

    $("./div[@id='contentDiv']") {
      $("./div[not(@id)]") {
        remove()
      }
      $("./div[@id='head'] | ./div[@id='head']/div[contains(@style, 'background')] | .//p") {
        remove("@style")
      }
      $(".//div[contains(@class, 'section')]/div[contains(@style, 'height')]") {
        remove("@style")
      }
    }
    $("./div[@id='page-bottom-spacer']") {
      remove()
    }

    $(".//div[@class='appArea']/p") {
      wrap_text_children("span")
      $("./span[string-length()<=4 and not(*)]") {
        remove()
      }
    }

    $(".//div[@id='wrapper-body']") {
      remove("./@style")
      $("./form[1]") {
        add_class("mw_box3")
        $(".//p[./input[@id='ACTION_CANCEL_RESPONSE_SUBMIT']]") {
          add_class("mw_submit_p")
        }
      }
      remove("./div[@class='templateComponent']/preceding-sibling::p[1]")
      # share bar
      $("./ul[@id='share_bar']") {
        $("./li[./img[@class='share_image']]") {
          insert("span", fetch("./img/@alt"), class: "mw_share_text")
          remove("./img")
        }
      }
    }

    $(".//h3") {
      add_class('mw_h1')
    }

    $(".//h1") {
      add_class("mw_h3")

      $("./following-sibling::p") {
        add_class("mw_signup_description")
      }
    }

    # Remove the td's with width of 5% or <br>s
    $(".//td[@width='5%'] | .//br") {
      remove()
    }

    # Give the td's containing the <label> a class
    $(".//input[not(@type='checkbox')]/ancestor::td[1] | .//select/ancestor::td[1]") {
      add_class("mw_signup_field")
    }
    $(".//td[./select]") {
      add_class("mw_select_arrows")
    }

    # make the checkboxes look nice-r
    $(".//input[@type='checkbox' and @id='3314_2820_7_2342_1']/ancestor::td[1]") {
      add_class("mw_signup_checkbox")

      $("./following-sibling::td[1]") {
        add_class('mw_signup_checkbox_label')
      }
    }

    # Make the buttons on the bottom
    $(".//input[@id='ACTION_SUBMIT_SURVEY_RESPONSE']") {
      match($path) {
        # HSUS-422 : for the Meatless Monday Recipe submit button
        with(/pagename\=meatless_monday_contest/) {
          btn_delegate() {
            add_class("mw_btn2 mw_monday_contest_submit")
            text(fetch("following-sibling::input[@id='ACTION_SUBMIT_SURVEY_RESPONSE']/@value"))
          }
        }
        else() {
          add_class("mw_signup_btn")
        }
      }
    }

    $(".//input[@id='ACTION_CANCEL_RESPONSE_SUBMIT']") {
      add_class('mw_cancel_btn')
    }
    # HSUS-422
    $(".//table[@id='meatlessmonday']") {
      remove(".//@style | .//@width | .//@height")
      $(".//td[./input[@id='cons_email_opt_in']]") {
        add_class("mw_cons_email_opt_in")
      }
    }


    # Custom keyboards
    contextual_keyboard(".//input[@id='cons_email']", "email")
    contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")
    contextual_keyboard(".//input[@id='3314_2820_4_2322']", "tel")
    
  }
}
$("./body") {
  add_class("mw_ticketing_tablet")
  # remove powered by convio img
  remove("./div[./a[contains(@href, 'poweredby')]]")
  $("./div[@id='ga-container']") {
    $("./div[@id='ga-content']/table") {
      add_class("mw_box2")
      $("./tbody/tr/td/table") {
        add_class("mw_main_content")
      }
    }
    $(".//table") {
      remove("./@style | ./@bgcolor | ./@align")
      $(".//h3") {
        add_class("mw_h2")
      }
      # main content
      $(".//div[@class='appArea']") {
        remove("./br")
        $("./p[not(*)]") {
          match(text(), /\A\s+\Z/) {
            remove()
          }
        }
        
        # name field
        $("./table[not(@class or @summary)]") {
          add_class("mw_name_field")
        }
        
        # Available Ticket Classes for This Event
        $("./table[@class='lc_Table']") {
          add_class("mw_main_table")
        }
        
        # RRequest Ticket Purchases Here
        $("./table[contains(@class, 'lc_Table')][.//td[@class='lc_Totals']]") {
          add_class("mw_summary_table")
          $("./tr[./td]/td[position() = last()]") {
            add_class("mw_calculated")
          }
        }
        # btns
        $("./p") {
          add_class("mw_btn_wrap")
          $("./input[@id='rsvp_save']") {
            add_class("mw_btn2")
          }
          $("./input[@id='rsvp_reset']") {
            add_class("mw_btn1")
          }
          $("./input[@id='rsvp_cancel']") {
            add_class("mw_btn1")
          }
        }
        # end of btns
      }
      # end of main content
    }
  }
  # for Ticket Class link
  # https://secure.humanesociety.org/site/Ticketing?view=Tickets&id=109422
  $("./div[@class='appArea'][./form[@name='TicketClassDetails']]/ancestor::body[1]") {
    add_class("mw_ticket_detail")
    $(".//h3") {
      add_class("mw_h2")
    }
  }
}
$("./body") {
  add_class("mw_chimps")
  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1", id:"mw_footer") {
      move_here("//div[@id='footer']") {
        $("./p") {
          add_class("mw_content")
          move_to("./ancestor::div[@id='footer']", "bottom")
        }
        $("./ul") {
          wrap("div")
        }
      }
      remove(".//@style | ./div[@id='footer']/div[./img] | .//li[./a[contains(@href, 'facebook') or contains(@href, 'twitter')]]")

      $(".//ul/li[1]") {
        add_class('mw_footer_copyright')
      }
      $(".//li[./a]") {
        add_class("mw_link_center")
        $("./a") {
          add_class("mw_bar2")
        }
      }
      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # end footer


  $("./table | ./div[@id='ga-container']/div[@id='ga-content']/table") {
    move_here(".//div[@class='lp-template-container']/..", "before") {
      attribute("class", "mw_box2")
      remove(".//@style | .//@height | .//@align | .//br[@clear='all']")
      name("div")
      $("./div[@class='lp-template-container']") {
        # Share icon
        $("./div[@class='infographicshare']") {
          $("./img") {
            name("span")
            text(fetch("./@alt"))
            remove("./@alt | ./@src")
          }
          $("./a") {
            text("")
          }
        }
        # "DONATE TO HELP CHIMPS" button
        $("./div[@id='lp-donate-button']") {
          move_to("./following-sibling::div[@class='lp-aa-box']", "before")
          $("./a") {
            add_class("mw_btn2")
            inner("DONATE TO HELP CHIMPS")
          }
        }
        $("./div[@class='lp-aa-box']") {
          remove("./div[./img]")
          $("./div") {
            wrap_text_children("span") {
              text() {
                replace(/^[\s\u00a0]+/, "")
                replace(/[\s\u00a0]+\|$/, "")
              }
            }
            remove("./br")
          }
        }
        # Donate now box
        $("./div[@class='lp-donate-box']/div[@class='supertaf-donate-section']/div[@class='supertaf-donate-form']/form[@id='taf-donate']") {
          $("./input[@name='s_src']") {
            add_class("mw_hide")
          }
          $("./div[@class='supertaf-donate-text']") {
            insert_before("div","DONATE NOW", class:"mw_donate_title")
          }
          $("./div[@class='supertaf-donate-amounts']") {
            $("./label | ./input[@id='supertaf-box']") {
              move_to("./preceding-sibling::div[@class='mw_amount'][1]", "bottom")
            }
            $("./input[@class='supertaf-donate-button']") {
              btn_delegate() {
                attribute("class", "mw_btn2")
                inner("CONTINUE")
              }
            }
            remove("./br | ./label | ./input[not(@id='supertaf-box' or @type='submit')]")
            $("./strong") {
              inner("$")
              wrap("div", class:"mw_amount") {
                move_here("./following-sibling::input[@id='supertaf-box']", "bottom")
              }
            }
          }
        }
      }
    }
    remove()
  }
}
$("./body") {
  add_class("mw_my_profile")
  remove(".//div[@id='page-head'] | .//div[@id='head']")
  $(".//div[@id='contentDiv']") {
    remove(".//@style")
    $("./div[@id='cols']/div[@id='main']/div[@id='wrapper-body']") {
      remove(".//hr")
      add_class("mw_main_wrap")
      $("./h2") {
        add_class("mw_h1")
      }
      $(".//input[@type='image']") {
        $text = fetch("./@id")
        btn_delegate() {
          add_class("mw_btn4")
          text($text)
        }
      }
      # top profile info
      $("./div[@id='centerHeader']/div") {
        add_class("mw_sidebar1")
        remove(".//a[@class='cta']/img")
        $("./p[not(./a)]") {
          add_class("mw_profile_p")
        }
        wrap_text_children("span", class: "mw_profile_p") {
          match(text(), /\A\s+\Z/) {
            remove()
          }
        }
      }
      # Humane Society International
      $("./div[@id='hsiAlert']") {
        add_class("mw_sidebar1")
      }
      # blue box
      $("./div[@class='action']") {
        add_class("mw_sidebar2")
      }
      # wayne's blog
      $("./div[@id='blog_feed']") {
        insert_top("h2", "WAYNE'S BLOG")
      }
      # Your Giving History
      $("./div[@id='transactionHistory']") {
        $("./h2") {
          add_class("mw_h1")
        }
      } 
    }
    remove("./div[not(contains(@id, 'cols'))]")
  }
  
  # HSUS-377 Giving Opportunities
  match($path, /^\/site\/donation($|\/[\d]+)/i) {
    $(".//div[@id='wrapper-body']/h3") {
      add_class("mw_h3")
    }
    $(".//div[@id='wrapper-body']/table") {
      add_class("mw_versign")
      table_dump(".")
    }
  }
}
$("./body") {
  add_class("mw_virtualtownhall")
  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1", id:"mw_footer") {
      move_here("//div[@id='footer']") {
        $("./p") {
          add_class("mw_content")
          move_to("./ancestor::div[@id='footer']", "bottom")
        }
        $("./ul") {
          wrap("div")
        }
      }
      remove(".//@style | ./div[@id='footer']/div[./img] | .//li[./a[contains(@href, 'facebook') or contains(@href, 'twitter')]]")

      $(".//ul/li[1]") {
        add_class('mw_footer_copyright')
      }
      $(".//li[./a]") {
        add_class("mw_link_center")
        $("./a") {
          add_class("mw_bar2")
        }
      }
      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # end footer
   
  $("./table | ./div[@id='ga-container']/div[@id='ga-content']/table") {
    move_here(".//div[@class='lp-template-container']/..", "before") {
      attribute("class", "mw_box2")
      remove(".//@style | .//@height | .//@align | .//br[@clear='all']")
      name("div")
      $("./div[@class='lp-template-container']") {        
        # Share icon
        $("./div[@class='townhallshare']") {
          $("./img") {
            name("span")
            text(fetch("./@alt"))
            remove("./@alt | ./@src")
          }
          $("./a") {
            text("")
          }
        }
        # "DONATE TO HELP CHIMPS" button
        $("./div[@id='lp-donate-button']") {
          move_to("./following-sibling::div[@class='lp-aa-box']", "before")
          $("./a") {
            add_class("mw_btn2")
            inner("DONATE") # HSUS-462 changed from DONATE NOW to DONATE
          }
        }
        #FORM AND SUBMIT
        $("./iframe[@id='townhall_iframe'] | ./div[@id='townhall-ty-elements']") {
          add_class("mw_hide")
        }
        $("./form") {
          $("./div[@id='townhall-bottom-elements']") {
            $("./p") {
              add_class("mw_h3")
              remove("./br")
            }
            $("./div[not(@id)]") {        
              add_class("mw_hide")
            }
          }
          $(".//input[@type='submit']") {
            add_class('mw_btn2')
            wrap("div",class:"mw_submit")
          }     
        }
        #END FORM AND SUBMIT        
      }
    }
    remove()
  }
}
$("./body") {
  add_class("mw_site_donate_tablet")
  
  #inject the blue logo
  $(".//div[@class='mw_header']/a[@class='mw_header_spillover']") {
    insert("img", class:"hsus_blue_logo", src:"http://www.humanesociety.org/assets/images/global/logo.png")
  }

  # Remove the header image
  # remove(".//div[@id='ga-header']")

  $(".//div[@id='ga-header']/div[@id='donation-top']") {
    move_to("./ancestor::div[@id='ga-header']/following-sibling::div[@id='page-content']//div[@id='donate-form']", "top")
  }

  # add a header 
  $(".//div[@id='shell'] | .//div[@id='wrapper']") {
    insert_top("div", class:"mw_head_spacer") {
      insert("div", class:"mw_head_spacer_text", "Donate")
    }
  }


  $(".//*[contains(@style, 'padding')]") {
    remove("./@style")
  }

  # Main donate form
  $(".//div[@id='donate-form']") {
    add_class("mw_box2_tablet")

    $("./table") {
      add_class("mw_gray_inner")
      # HSUS-358 remove empty p
      # https://secure.humanesociety.org/site/Donation2?df_id=1505&1505.donation=form1&s_src=webdn_mb_hptopnavD1505A
      $(".//td/h3") {
        add_class("mw_h1")
      }
      $("./tr/td/p[not(*)]") {
        text() {
          replace(/^[\s\u00a0]*$/, "")
        }
        match(fetch("./text()"), "") {
          remove()
        }
      }
      # end of HSUS-358
    }

    # center the one time gift image
    $(".//img[contains(@alt, 'one time gift')]/ancestor::td") {
      add_class("mw_one_time_gift_center")
    }

    # This might fix the images not displaying on older devices
    # the src looked something like src="////secure.humanesociety.org///../images/content/pagebuilder/19930.png"
    fixImages()
  }

  $(".//h3[img]/ancestor::td[1]") {
    add_class("mw_donate_desc")
    remove("@width")
    remove("@height")
    # move_to("..", "top")
  }

  # Tablet has hero image inline with header
  $(".//h3/img[contains(@src,'jpg')]") {
    move_to("..", "after")
    remove("@width")
    remove("@height")
  }

  # Change the "click here" to "tap here"
  $(".//a[contains(@href, 'Donation2') and not(./img)]") {
    text() {
      replace(/Click/, "tap")
      replace(/click/, "tap")      
    }
  }
  
  $(".//td[img]/..") {
    remove("./td[@id='caption']")
    $("./td") {
      add_class("mw_monthly_donation_desc")


      #move_here("./img", "top")
      $("./img[contains(@alt,'PayPal')]") {
        remove("./@src")
        add_class("images-pp_c_mark")
        # move_to("../..", "top")
      }

    }
    # Merge the header stuff into one td
    $("./td[1]") {
      move_here("../td[2]/*")

      $("./table") {
        remove("./@style")
      }
    }

  }
  # for the monthly donation form, to move the image below the h3 tag
  $(".//td[h3]/img[contains(@src, 'jpg') and not(@class)]") {
    add_class("mw_image_pad")
    # move_to("../..", "top")
    move_to("../h3", "after")
    # $("./following-sibling::p[1]") {
    #   add_class("mw_testing")
    # }
    wrap("div", class: "mw_captioned_img_styling")
  }

  $(".//td/img[contains(@src, 'jpg') and not(@class)]") {
    add_class("mw_image_pad_float")
    move_to("..", "top")
    wrap("div", class: "mw_captioned_img_styling")
  }

  # For the puppy mill page and similar
  $(".//td/div[@style and img]") {
    # Remove styling on the Div
    add_class("mw_captioned_img_styling")
    remove("@style")
  }

  # Match <p>'s that only have &nbsp;
  #$(".//p | .//td") {
    # inner(){
    #   replace(/\xC2\xA0/, "")
    # }
  #}
  # match($text) {
  #   with(/\xC2\xA0/) {
  #     add_class("mw_testing")
  #   }
  # }

  # Humane card form
  $(".//img[contains(@alt, 'humane') and contains(@alt, 'card')] | .//img[@alt=' ']") {
    # add_class("mw_testing")

    $("./ancestor::table[1]") {
      # add_class("mw_testing")
      attribute("align", "center")
      # HSUS-358 Click should be tap
      $(".//a/span[contains(text(), 'Click on the image')]") {
        text() {
          replace(/Click/, "Tap")
        }
      }
      $("./parent::td") {
        add_class("mw_card_center")
      }
    }
  }

  $(".//form[@id='ProcessForm']") {
  # Fix for HSUS-482
    #add_class("mw_box5") 

    $(".//tbody[contains(@id, 'level-standard')]") {
      #HSUS-457: Start;
      $currentId = fetch('@id')
      $("./tr[@class='donationRepeatRowBefore']") { 
        add_class("mw_repeat_payment")
      }
      $("./tr[@class='FormRow' and contains(@id, 'level_standardauto_repeat_Row')]") { 
        add_class("mw_repeat_payment")
      }
      $js = "
      $(document).ready(function() {
       $(\"tbody tr[class='donationRepeatRowBefore']\").appendTo( $(\"tbody[id='" + $currentId + "']\") );
       $(\"tbody tr[id='level_standardauto_repeat_Row']\").appendTo( $(\"tbody[id='" + $currentId + "']\") );
       });
"
insert_javascript( $js )
      #HSUS-457: End;
      $("./tr[@class='FormRow']") {        
        add_class("mw_radio_columns")
      }
      $("./following-sibling::tbody[1]") {
        add_class("mw_donation_note")        
      }
      move_here("./following-sibling::tbody[contains(@class, 'mw_donation_note')]") {
        name("div")
      }
    }    
    # Provide a way to limit the size of the labels of the radio buttions
    $(".//label[@class='RadioGroupLabel']/..") {
      add_class("radioGroupLabeltd")    
    }

    # $(".//tbody[contains(@id, 'level-standard')]/following-sibling::tbody[1]") {
    #   add_class("mw_testing")
    #   $("./preceding-sibling::tbody[contains(@id, 'level-standard')]") {
    #     add_class("mw_testing")
    #   }
    #   # move_to("../preceding-sibling::tbody[contains(@id, 'level-standard')]")
    #   move_to("./ancestor::table[1]//tbody[contains(@id, 'level-standard')]")
    # }
  }

  # This should select the donation form table, first row
  $(".//tr[@class='FormRow'][1]") {
    remove("./td/@colspan")
    $("./td[.//div[@id='wsformheader']]") {
      $(".//br") {
        name("span")
        text(" ")
      }
      add_class("mw_donate_subtitle")
    }
  # $(".//tbody[@class='FormRow'][1]//") {    
    # Move the "Select Gift Amount away from the first option"
    # Fix for HSUS-482
    #insert_before("tr", class:"FormRow mw_gift_desc") {
      move_here("./following-sibling::tr[1]/td[@class='FormLabel']") {
        # Change the attribute so that we can hide the empty 
        # .requiredIndicator and .FormLabel <td>'s
        attribute("class", "mw_formlabel")
      }
    }
  #} 
  # End of HSUS-482

  # bump down the radio button for the "other" donation amount
  $(".//input[@class='DonationLevelOtherAmount']/ancestor::td[1]") {
    # /ancestor::tr[1]//input[@type='radio']
    add_class('mw_radio_alignment')
    $("preceding-sibling::td[1]") {
      add_class("mw_other_td")
      $("ancestor::tbody[contains(@class,'DFEC_el_wrapper')][1]") {
        add_class("mw_choose_form")
        #remove(".//tr[@class='FormRow']")
      }
    }
  }

  $(".//tbody[contains(@id, 'html-caption')]//td[@class='FormCaption']/p") {
    remove("./@style")
    add_class("mw_donation_info")
    $("./ancestor::td[@class='FormCaption']") {
      add_class("mw_donate_subtitle")
      $(".//br") {
      # Fix for HSUS-482
        #name("span")
        #text(" ")
      # End of HSUS-482  
    }
  }
}

  # Shift the .requiredIndicator (*) to the description
  $(".//tbody[contains(@id, 'billing') or contains(@id, 'email') or contains(@id, 'Recipient') or contains(@id, 'City') or contains(@id, 'Sender_Signature') or contains(@id, 'Zip_Code')]//td[@class='requiredIndicator']") {
    #add_class("mw_testing")
    move_to("./../preceding-sibling::tr[1]", 'top')
  }

  # Remove the [x] images from the errors, so that the text can be red instead
  remove(".//tr[@class='holdsErrorMsg']//img")

  # Remove the width="100%" from the error message
  $(".//tr[@class='holdsErrorMsg']/td[@class='FormInfoMsg']") {
    remove("./@width")
  }
  
  # Remove
  $(".//p[contains(@class,'mw_donation_info')][contains(text(),'Who is this donation in memory of?')]/ancestor::tbody[@class='DFEC_el_wrapper'][1]") {
    remove("following-sibling::tbody[contains(@id,'html-caption')][1]")
  }
  remove(".//tr[@id='memorial_name_Row']/td[@class='requiredIndicator']")
  remove(".//tr[@id='recipient_s_state_province__Row']/td[@class='requiredIndicator']")

  # Evenly space out the Credit card types
  $(".//tr[@id='payment_typecc_type_Row']/td[@class='FormInput']//table[1]") {
    add_class("mw_credit_card_flex")
  }

  # Improve the look of the credit card form
  $(".//td[@class='FormInput'][input]") {
    add_class("mw_donate_clear")
  }
  
  # Make the seals easier to deal with for CSS
  $(".//script[contains(@src, 'verisign')][1]/ancestor::table[1]") {
    add_class("mw_seals")
    remove("@height")

    $("./ancestor::tr[@class='FormRow']") {
      add_class("mw_seals_center")
    }

    $("./ancestor::td[1]") {
      add_class("mw_seals_center")
      $(".//td[.//img[@alt='charity navigator']]") {
        add_class("mw_charity")
        $("ancestor::tbody[@class='DFEC_el_wrapper']/following-sibling::tbody[contains(@id,'html-caption')][1]") {
          add_class("mw_last_content")
          remove("following-sibling:: tbody[contains(@id,'html-caption')]")
        }
        # move_to("ancestor::tr[1]")
      }
    }
  }
  $(".//div[@id='othergive']/following-sibling::table[contains(@class, 'mw_seals')]") {
    attributes(class: "mw_bottom_seal", align:"center")
  }

  # Locate the other.. seal
  /*$(".//script[contains(@src, 'verisign')][2]/ancestor::table[1]") {
    add_class("mw_bottom_seals")
    # move_here("")
    }*/

    $(".//div[@id='vs_seal']/..") {
      attribute("id", "vs_seal_wrapper")
    }

  # Make the Donate button pretty
  $(".//tbody[contains(@id, 'buttons')]") {
    $(".//td[@align='right']") {
      attribute("align", "center")

      $(".//input[@id='pstep_finish']") {
        remove("./@onmouseover | ./@onmouseout")        
        #HSUS-210
        btn_delegate() {
          #add_class("mw_btn2 mw_SubmitButton")
          #text("SUBMIT")
          add_class("images-submit_logo")
        }
      }
    }
  }

  # Pre wrap the expiration date credit card <select>

  # HSUS-246 Donation Form Styling Improvements
  $(".//fieldset[contains(@class, 'cardExpGroup')]") {
    add_class("mw_flex_box")
    name("div")
    $("./select") {
      %expdate = fetch("@id")
      wrap("div", id:concat(%expdate, "_wrapper"),class:"mw_flex_box_item_1")
    }
  }

  # add in some extra arrows for the select box
  $(".//select/..") {
    add_class("mw_select_arrows")
  }
  # greeting card section
  $(".//tbody[contains(@id,'greeting_on_card_')]/tr[@id='greeting_on_card__Row']/td[@class='requiredIndicator']") {
    move_to("ancestor::tbody[1]/tr[contains(@class,'mw_gift_desc')]","top")
  }
  remove(".//tr[@id='payment_typecc_type_Row' or @id='state_province__Row' or @id='message_Row']/td[@class='requiredIndicator']")
  remove(".//label[contains(@for,'billing_addr_street2name') or contains(@for,'billing_addr_country')]/ancestor::tr[1]/td[@class='requiredIndicator']")

  # Make the phone number dialable
  $(".//a[contains(@href, 'mailto')]/parent::p") {
    wrap_text_children("span") {
      $phone_text = fetch("./text()")
      $phone_num = ""
      $phone_text {
        #log("trying to match a number")
        #log(this())
        replace(/(\d*\-*\d{3}\-\d{3}\-\d{4})/) {
          #, contcat("<a tel:'", $1, "'>", $1, "</a>")
          $phone_num = $1
        }
      }
      /*match($phone_num, "") {
        name("a")
        attributes(href: "tel:"+$phone_num)
        }*/
        inner(){
        #$click_tel = concat("<a tel:'", $1, "'>", $1, "</a>")
        replace(/(\d*\-*\d{3}\-\d{3}\-\d{4})/, concat("<a href='tel:", $phone_num, "'>", $phone_num, "</a>"))
      }
    }
    
    $(".//a[strong]") {
      remove("@style")
    }
  }

  # converts a generic format phone number to be clickable on mobile
#Courtasey of the accenture project
/*@func XMLNode.telephonize() {
  $phone_text = fetch("./text()")
  $phone_num = ""
  $phone_text {
    replace(/^\s*([ \+\-()\d]{9,}\d)\s*$/) {
      $phone_num = $1
      log($phone_num)
    }
  }
  match_not($phone_num, "") {
    name("a")
    attributes(href: "tel:"+$phone_num)
  }
  }*/

  # footer detailing
  $(".//li[@class=' mw_link_center']/a") {
    add_class("mw_bar2")
    $("../..") {
      add_class("mw_footer_link_list")

      $("./li[not(@class)]") {
        add_class('mw_footer_copyright')
      }
    }
    
  }

  # Deal with youtube videos
  $(".//object") {
    $("./embed") {
      #remove("@width")
      #remove("@height")
      attributes(width:"100%", height:"200px")
    }
    $("..") {
      remove("@style")
    }
  }


  # Use custom keyboards
  contextual_keyboard(".//input[@id='billing_addr_zipname']", "numeric")
  contextual_keyboard(".//input[@id='donor_email_addressname']", 'email')
  # HSUS-96 - numeric keyboard with decimal
  # contextual_keyboard(".//input[@class='DonationLevelOtherAmount']", 'numeric')
  $(".//input[@class='DonationLevelOtherAmount']") {
    keyboard('number')
    
    #some browsers are particular about having a '$' in the value and won't display that
    %amount = fetch("@value")
    %amount {
      replace(/\$/, '')
    }
    attributes(value: %amount, step:"0.01")
  }
  contextual_keyboard(".//input[@class='DonationLevelOtherAmount']", 'number')

  contextual_keyboard(".//input[@id='donor_phonename']", "tel")
  contextual_keyboard(".//input[@id='payment_typecc_numbername']", "numeric")
  contextual_keyboard(".//input[@id='payment_typecc_cvvname']", 'numeric')



  # Donation Thankyou page

  # vehicle donation
  $(".//img[contains(@src, 'vehicle')]/ancestor::table[1]") {
    add_class("mw_donate_vehicle")

    $(".//img/ancestor::td[1]") {
      add_class("mw_donate_vehicle_img")

      $("./following-sibling::td[1]") {
        add_class("mw_donate_vehicle_text")
      }
    }
  }

  # Share table
  $(".//img[contains(@src, 'facebook')]/ancestor::table[1]") {
    add_class("mw_donation_share")
    remove("@style")

    $(".//td[@width='20']") {
      remove()
    }


    $(".//td | .//tr") {
      remove("@width")
      remove("@height")
    }
  }


  # Summary table
  $(".//td[@class='FormSectionHeader']/ancestor::table[1]") {
    add_class("mw_transaction_summary mw_bar5")
    attribute("data-ur-toggler-component", "button")

    $("./following-sibling::table[1]") {
      attribute("data-ur-toggler-component", "content")
    }

    $("..") {
      attribute("data-ur-set", "toggler")
      attribute("style", "width: 100%;")
    }
  }
  
  $(".//tr[@id='payment_typecc_cvv_Row']") {
    $("./td[contains(@class,'mw_donate_clear')]/a[@class='HelpLink']") {
      move_to("ancestor::tr[@id='payment_typecc_cvv_Row']/td[@class='FormLabel']") 
    }
  }
  
  # taken out for HSUS-490

  # $(".//div[@id='othergive']") {
  #   attribute("data-ur-set", "toggler")

  #   $("./h2") {
  #     attribute("data-ur-toggler-component", "button")
  #     add_class("mw_bar5")
  #   }

  #   $("./ul") {
  #     attribute("data-ur-toggler-component", "content")
  #   }

  #   $("..") {
  #     attribute("style", "width: 100%;")
  #   }
  # }

  # HSUS-490  - all content is hidden from this except title, so just hide it completely
  $(".//div[@id='othergive']") {
    add_class("mw_hidden")
    ## commented out in cased needed, though seems as though it should just be hidden
    # add_class("mw_other_ways_give")
    # $(".//li") {
    #   add_class("mw_other_way")
    # }
    # $("./h2") {
    #   inner() {
    #     replace(/to Give/i, "<span class='mw_bold'>to Give</span>")
    #   }
    # }
  }
  
  #HSUS-448: Start;
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typeradio_Row']/td[@class='requiredIndicator']") {
  #   move_to("ancestor::tbody[1]/tr[contains(@class,'mw_gift_desc')]", "top")
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typelist_Row']/td[@class='requiredIndicator']") {
  #   move_to("ancestor::tbody[1]/tr[contains(@class,'FormRow mw_gift_desc')]", "top")
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typeradio_Row']/td[@class='FormInput']/fieldset/table") {
  #   add_class("mw_new_payments_inline")
  #   $("./tr"){
  #     add_class("mw_new_payments_inline_tr")
  #     $("./td[1]"){
  #       add_class("mw_new_payments_inline_tr_td_radio")
  #     }
  #     $("./td[2]"){
  #       add_class("mw_new_payments_inline_tr_td_flag")
  #     }
  #   }
  # }
  # $(".//img[@alt='PayPal']") {
  #   add_class("mw_new_payments_inline_tr_td_flag_image")
  #   $("../../td[contains(@class, 'mw_monthly_donation_desc')][2]"){
  #     text() {
  #       set("")
  #     }
  #   }
  #   move_to("../../td[contains(@class, 'mw_monthly_donation_desc')]")
  # }
  # $(".//a[@href='https://www.paypal.com/us/cgi-bin/webscr?cmd=xpt/Marketing/popup/OLCWhatIsPayPal-outside' and @class='Smaller']") {
  #   remove()
  # }
  # $(".//img[@alt='Amazon Payments']") {
  #   add_class("mw_new_payments_inline_tr_td_flag_image")
  #   $("../../td[contains(@class, 'mw_monthly_donation_desc')][2]"){
  #     text() {
  #       set("")
  #     }
  #   }
  #   move_to("../../td[contains(@class, 'mw_monthly_donation_desc')]")
  # }
  # $(".//a[@href='https://payments.amazon.com/sdui/sdui/about?nodeId=77175' and @class='Smaller']") {
  #   remove()
  # }
  # $(".//tr[@id='payment_typecc_type_Row']/td[contains(@class, 'mw_select_arrows')]") {
  #   add_class('mw_select_arrows_inline')
  # }
  # $(".//table[contains(@class, 'mw_seals') and @align='center' and @border=0]") {
  #   remove()
  # }
  $(".//table[@class='mw_bottom_seal']") {
    remove()
  }
  #HSUS-448: End;
  $(".//span[contains(text(), 'Select a Payment Type:')]") {
    move_here("ancestor::tr[contains(@class, 'FormRow')][1]/following-sibling::tr[1]/td[@class='requiredIndicator']", "top") {
      name("span")
    }
  }
  $(".//label[@for='payment_typepay_typeradiocredit']") { 
    $("..") {
      add_class("mw_v_align")
    }
  }
  remove(".//a[@class='Smaller']")
  # Fix for HSUS-482
  #remove(".//td[contains(@class,'mw_seals_center')][last()]") 
  $(".//tr[@id='payment_typecc_type_Row']/td") {
    add_class("mw_padding")
  }

  # Remove the seals from having a table align
  $(".//div[@id='side']") {
    $("./table") {
      remove("@align")
    }
  }

  # HSUS-482:[Mobile & Tablet] Gift Donation Form Styling
  
  $(".//input[@id='fulfill_eCard']") {
   move_to("ancestor::body//table[@class='tbl-ecard-type-select']//td[2]","bottom")
 }
 $(".//table[@id='overTable']/tbody[contains(@id,'tribute_type') or contains(@id,'tribute_notify') or contains(@id,'Card_Type')]") {
  add_class("mw_hidden")
}
  # Fix For HSUS-482
  $(".//tbody[@id='tribute_honoree_first_name.79286']") {
    $(".//td[@class='requiredIndicator']") {
      move_to("ancestor::body//tbody[@id='tribute_honoree_first_name.79286']/tr[1]","top")
    }
  }
  $(".//tbody[@id='tribute_honoree_last_name.79287']") {
    $(".//td[@class='requiredIndicator']") {
      move_to("ancestor::body//tbody[@id='tribute_honoree_last_name.79287']/tr[1]","top")
    }
  }
  #End of HSUS-482
  # HSUS-482:END
  # Fix For HSUS-482
  $(".//td[@class='mw_formlabel']") {
    move_to("ancestor::body//tr[@id='payment_typecc_number_Row']","top")
  }
  $(".//tr[@valign='bottom']") {
    $("./td[@align='center']") {
      add_class("mw_new_padding")
    }
  }
  # Fix for HSUS-482
  $(".//tbody[.//div[@class='section-separator']]") {
    $(".//td") {
      add_class("mw_separator")
    }
  }
  $(".//tbody[contains(@id,'e_card_preview')]") {
    remove()
  }
  # End of HSUS-482

  
  # HSUS-476
  $(".//div[@class='mw_powered_by']"){
    move_to("//div[@class='legal']")
  }

  $misaligned_seals = "true"

  $(".//img[@alt='eCard']"){
      //seals are properly aligned on this page
      $misaligned_seals = "false"
    }

    match($misaligned_seals){
      with(/true/){
        $(".//table[contains(@class, 'mw_seals')]"){
          add_class("mw_misaligned_seals")
        }
      }
    }
   # Fix for HSUS-487
   $(".//tr[@id='level_standardauto_repeat_Row']") {
    $("./td[contains(@class,'FormLabel')]") {
      add_class("mw_display")
      $("./div") {
        add_class("mw_display")
      }
    }
    $("./td[contains(@class,'FormInput')]") {
      move_to("ancestor::body//tbody[contains(@class,'mw_choose_form')]","after")
    }
  }
  match($path,/site\/Donation2\?df_id\=(14482\&14482)|(14481\&14481)/i) {
    $(".//div[@id='othergive']") {
      move_to("ancestor::body//div[@id='dataFormContainer']/table","after")
    }
  }
  match($path,/site\/Donation2\?df_id\=(14380\&14380)|(14381\&14381)/i) {
    $(".//div[@class=' mw_sidebar_content_hide']") {
      $("./img") {
        attribute("src") {
          value() {
            replace("////secure.humanesociety.org///","")
          }
        }
      }
      move_to("ancestor::body//div[@id='donation-top']","after")
      add_class("mw_alignment")
    }
  }
  $(".//td[contains(@class,'mw_seals_center')]") {
    $(".//td[.//img[@alt='charity navigator']|.//img[@alt='better business bureau']]") {
      # remove()
    }
  }
  $(".//tbody[contains(@id,'donor-email-opt-in')]") {
    remove()
  }
  # End OF HSUS-487

  $(".//td[contains(@class, 'printed-card-section')]"){
    $("./div/img"){
      move_to("../..", "bottom")
    }
  }

  $(".//tr[contains(@id,'billing_first_name')]"){
    $("./td[1]"){
      add_class("mw-donate-firstname")
    }
    $("./td[2]"){
      add_class("mw-donate-firstname")
    }
  }

  $(".//tbody[contains(@id,'billing-first-name')]"){
    insert_before("tbody", class:"section-separator-holder")
  }

  $(".//tbody[contains(@class,'section-separator-holder')]"){
    insert("tr", class:"FormRow")
    $("./tr"){
      insert("td", class:"FormCaption mw_separator")
      $("./td"){
      # Fix for HSUS-511 
      #  insert("div", "Billing Information", class:"section-separator mw-section-separator")
      }
    }
  }

  $(".//span[.='* Required']"){
    #add_class("mw_hidden")
    $("../../div[contains(text(), 'Billing Information')]"){
      #add_class("mw_hidden")
    }
  }

  $(".//label[@for='payment_typecc_numbername']"){
    move_to("//tr[@id='payment_typecc_number_Row']/td[1]","after")
    wrap("td", class:"FormLabel")
  }
  # HSUS-492: Make Thermometer Visible on Year End Donation Forms-Fixed
  $(".//div[@id='progress']/img[contains(@src,'DynImg')]"){
    %src = fetch("@src")
    %src {
      replace('DynImg', 'site/DynImg')
    }
    attribute("src", %src)
  }
  $(".//div[@id='side']"){
    move_to("ancestor::body//div[@id='donation-top']","after")
  }
  # HSUS-492-end

  # Fix for HSUS-511
  $(".//table[contains(@summary,'Credit Card')]") {
    $(".//td//img") {
      remove("./@src | ./@alt")
    }
    $(".//img[@id='payment_typecc_type_Visa']") {
      add_class("images-cc_logo_retina")
    }
  }
  $(".//a[contains(text(),'ABOUT TRUST ONLINE')]") {
    add_class("mw_norton")
  }
  $(".//div[contains(@class,'section-separator')]/span") {
    text() {
      replace("* Required","Required")
    }
  }
  match_not($path,/site\/Donation2\?1514.*/) {
    $(".//tbody[contains(@class,'mw_choose_form')]") {
      $(".//tr[@class='FormRow']") {
        move_to("ancestor::tbody","after")
      }
    }
  }
  # Fix for HSUS-511
#For HSUS-522 [Mobile & Tablet] Donation Form Update: Thermometer Wrapper One-Time (14940)
   $(".//span[@class='CheckBoxFormLabelText']"){
      text(){
        clear()
        set("Help animals all year with your monthly gift!")
      }
      move_to("//input[@id='level_standardauto_repeatname']","before")
      insert_after("br")     
      $("./ancestor::td[1]"){
       move_to("//tbody[@id='level-standard.82106']","after"){
        }
      }
  }
#End HSUS-522 [Mobile & Tablet] Donation Form Update: Thermometer Wrapper One-Time (14940)
  #Start Fix HSUS-511
  $(".//div[@id='donation-top']/div"){
    add_class("mw_vid")
  }
  #End Fix HSUS-511
}
$("./body") {
  add_class("mw_donate_login")
  remove(".//div[@id='page-head'] | .//div[@id='head'] | .//td/@width | .//table/@width")
  $(".//div[@id='contentDiv']") {
    remove(".//@style")
    $("./div[@id='cols']/div[@id='main']/div[@id='wrapper-body']") {
      add_class("mw_main_login")
      $("./span") {
        text() {
          replace(/^[\s\u00a0]+/, "")
          replace(/[\s\u00a0]+\|$/, "")
        }
      }
      remove("./br")
      $(".//div[@class='outer-border']") {
        $("./table/tr[1]/td[./span or ./form or ./div[@class='right-block']]") {
          add_class("mw_keep_td")
        }
        remove("./table/tr[1]/td[not(contains(@class, 'mw_keep_td'))]")
        $(".//table") {
          $(".//div[@class='input-border']//input/ancestor::tr[1]") {
            add_class("mw_input_form")
            $("./td[./input]") {
              add_class("mw_input_wrap")
            }
          }
          $(".//input[@type='submit']") {
            add_class("mw_btn2")
          }
          table_dump(".")
        }
        $("./span") {
          text() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
        }
        
        $(".//div[@class='actions']/following-sibling::div[@id]") {
          add_class("mw_social_login")
        }
        
        remove(".//br")
      }
    }
    $("./div[not(contains(@id, 'cols'))]") {
      remove()
    }
  }
}
$("./body") {
  add_class("mw_virtualtownhall_tablet")
  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1") {

      move_here("//div[@id='footer']") {
        remove("./div[./img]")
        attribute("id") {
          value() {
            replace("er", "")
          }
        }
      }

      #manually styled footers
      move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
        remove("@style")
        remove("./img")
        $("./p") {
          name("li")
          add_class("mw_footer_info")
          move_to("./following-sibling::ul", "bottom")
        }
        $(".//*[@style]") {
          remove("@style")
        }
        $("./ul/li[1]") {
          add_class('mw_footer_copyright')
        }
        $(".//li[./a]") {
          add_class("mw_links_inline")
          remove("./self::li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
        }
      }

      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # footer

  $("./table | ./div[@id='ga-container']/div[@id='ga-content']/table") {
    attribute("id", "wrapper")
    remove(".//@width | .//@align | .//@bgcolor | .//@style | .//br[@clear='all']")
    # Header image
    $("./tr[./td[not(./table)]] | ./tbody/tr[./td[not(./table)]]") {
      attribute("class", "mw_banner_img")
      $("./td//img") {
        attribute("src") {
          value() {
            replace(/[\/|\w|\.]+(\.\..*)/) {
              set($1)
            }
          }
        }
        move_to("./ancestor::tr[@class='mw_banner_img']", "bottom")
      }
      remove("./td[not(.//img)]")
      $("./following-sibling::tr[1]") {
        attribute("class", "mw_box2_tablet")
      }
    }
  }
  table_dump(".//table")
  $(".//div[@class='lp-template-container']") {
    $("./div[@class='townhallshare']") {
      attribute("id", "share")
      $("./img") {
        name("span")
        inner(fetch("./@alt"))
        remove("./@alt | ./@height | ./@src")
      }
      $("./a[contains(text(), 'Facebook')]") {
        add_class("addthis_button_facebook")
        remove("./text()")
      }
      $("./a[contains(text(), 'Twitter')]") {
        add_class("addthis_button_twitter")
        remove("./text()")
      }
      $("./a[contains(text(), 'Tumblr')]") {
        add_class("addthis_button_tumblr")
        remove("./text()")
      }
      $("./a[contains(text(), 'Pinterest')]") {
        add_class("addthis_button_pinterest")
        remove("./text()")
      }
      $("./a[contains(text(), 'Reddit')]") {
        add_class("addthis_button_reddit")
        remove("./text()")
      }
      $("./a[contains(text(), 'Email')]") {
        add_class("addthis_button_email")
        remove("./text()")
      }
    }
    $("./div[@id='lp-donate-button']/a") {
      attribute("class", "mw_btn2")
      inner("DONATE") # HSUS-462 changed from DONATE NOW to DONATE
    }
    
    #FORM AND SUBMIT
    $("./iframe[@id='townhall_iframe'] | ./div[@id='townhall-ty-elements']") {
      add_class("mw_hide")
    }
    $("./form") {
      $("./div[@id='townhall-bottom-elements']") {
        $("./p") {
          add_class("mw_h3")
          remove("./br")
        }
        $("./div[not(@id)]") {        
          add_class("mw_hide")
        }
      }
      $(".//input[@type='submit']") {
        add_class('mw_btn2')
        wrap("div",class:"mw_submit")
      }     
    }
    #END FORM AND SUBMIT

  }
  
  $(".//div[@id='body']/following-sibling::p[contains(text(),']]')]") {
    remove()
  }
  
  $(".//script[contains(text(),'validate(')]") {
    text() {
      replace(/insertBefore/,"insertAfter")
    }            
  }
}
$("./body") {
  add_class("mw_stock_gifts")
  
  $("./div[@id='wrapper']/div[@id='page']/div[@id='contentDiv']") {
    match($tablet) {
      with(/true/) {
        add_class("mw_box2_tablet")
      }
      else() {
        add_class("mw_box2")
      }
    }
    
    remove("../div[@id='page-bottom-spacer']")
    
    $(".//div[@id='main']/div[contains(@class, 's_borderless')]") {
      $("./h1") {
        add_class("mw_h1")
      }
      $("./ul[not(@id='tools')]") {
        add_class("mw_list1")
      }
      $("./p[not(*)]") {
        match(text(), (/\A\s+\Z/)) {
          remove()
        }
      }
    }
    
    match($tablet, /true/) {
      $(".//ul[@id='action']") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_ticketing")
  # remove powered by convio img
  remove("./div[./a[contains(@href, 'poweredby')]]")
  $("./div[@id='ga-container']") {
    $("./div[@id='ga-content']/table") {
      add_class("mw_box2")
    }
    $(".//table") {
      remove("./@style | ./@bgcolor | ./@align")
      $(".//h3") {
        add_class("mw_h3")
      }
      # main content
      $(".//div[@class='appArea']") {
        remove("./br")
        $("./p[not(*)]") {
          match(text(), /\A\s+\Z/) {
            remove()
          }
        }
        # name field
        $("./table[not(@class or @summary)]") {
          add_class("mw_name_field")
          $("./tr[.//input[@type='text']]") {
            $("./td[1]") {
              move_here("./following-sibling::td[1]/p", "bottom")
              remove("./following-sibling::td[1]")
              $("./p") {
                name("span")
              }
            }
          }
          # first / last
          $("./tr/td/table") {
            $("./tr[1]/td") {
              move_here("./ancestor::tr[1]/following-sibling::tr/td[position() = '"+ index() +"']", "bottom") {
                wrap_text_children("span") {
                  match(text(), /\A\s+\Z/) {
                    remove()
                  }
                }
              }
            }
          }
        }
        # end of name field
        
        # Available Ticket Classes for This Event
        $("./table[@class='lc_Table'][not(.//td[@class='lc_Totals'])]") {
          add_class("mw_main_tablet")
          move_here("./preceding-sibling::p[1]", "top")
          $("./tr[./th]") {
            $("./th") {
              var("th_" + index(), fetch("./p/text()"))
            }
          }
          $("./tr[position() > 1]") {
            $("./td") {
              remove("./@align")
              insert_top("span", class: "mw_table_field", var("th_" + index()) + ":")
            }
          }
          remove("./tr[./th]")
        }
        # end of Available Ticket Classes for This Event
        
        # RRequest Ticket Purchases Here
        $("./table[@class='lc_Table'][.//td[@class='lc_Totals']]") {
          add_class("mw_summary_table")
          move_here("./preceding-sibling::p[1]", "top")
          remove("./tr[./th] | .//td/@align")
        }
        # end of Request Ticket Purchases Here:
        
        $("./table[not(@class)][@summary]") {
          add_class("mw_info_table")
          remove(".//br")
          $("./tr[.//input]") {
            add_class("mw_info_item")
          }
          $("./tr/td[position() = last()]") {
            wrap_text_children("span") {
              match(text(), /\A\s+\Z/) {
                remove()
              }
            }
            move_here("./preceding-sibling::td[1]", "top") {
              add_class("mw_list_title")
              match(text(), /\A\s+\Z/) {
                remove()
              }
            }
          }
        }
        # btns
        $("./p") {
          add_class("mw_btn_wrap")
          wrap_text_children("span") {
            match(text(), /\A\s+\Z/) {
              remove()
            }
          }
          $("./input[@id='rsvp_save']") {
            add_class("mw_btn2")
          }
          $("./input[@id='rsvp_reset']") {
            add_class("mw_btn1")
          }
          move_here("./input[@id='rsvp_cancel']", "after") {
            add_class("mw_btn1")
            wrap("div", class: "mw_cancel_wrap")
          }
        }
        # end of btns
      }
      # end of main content
    }
  }
  table_dump(".//table")
  
  # for Ticket Class link
  # https://secure.humanesociety.org/site/Ticketing?view=Tickets&id=109422
  $("./div[@class='appArea'][./form[@name='TicketClassDetails']]/ancestor::body[1]") {
    add_class("mw_ticket_detail")
    $(".//h3") {
      add_class("mw_h3")
    }
  }
}
$("./body") {
  add_class("mw_donate")

  $(".//div[@id='cols']") {
    add_class("mw_box2")
  }

  $(".//div[contains(@class, 's_borderless')]") {
    remove("./@style")
  }

  # Remove all inline styles?
  #remove(".//*[@style]/@style")


  # Monthly donation | One Time Gift
  $(".//div[@id='monthly_sec'] | .//div[@id='onetime_sec']") {
    add_class("mw_box7 mw_donate_form")

    $("./h2") {
      add_class("mw_bar4")
    }

    $("./form") {
      $("./span") {
        add_class("mw_amount")
      }

      #move the input box into the associated label

      $(".//label") {
        move_here("./preceding-sibling::input", "top")
      }

      $(".//button") {
        add_class("mw_btn2")
      }

      $(".//p[button[@type='submit']]") {
        add_class("mw_btn_center")
      }

      # Make the custom amount a numeric keyboard
      $(".//input[@id='onetime-value'] | .//input[@id='monthly-value']") {
        # HSUS-96
        keyboard("number")
        attribute("size", "6")
      }
    }
  }

  # Become a member, humane leader, gift donation, memorial donation
  $(".//a[@class='more']") {
    add_class("mw_bar1")
  }

  # Make the Shop to help Animals and Other Ways to give togglers

  $(".//div[@id='otherways'] | .//div[@id='otherways']/following-sibling::div") {
    attribute("data-ur-set", "toggler")
    remove("./@style")

    $("./h2") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_help_animals")
    }
    $("./div[contains(@class, 'col')]") {
      attribute("data-ur-toggler-component", "content")
    }
  }

  # Bottom 
  $(".//div[@id='side']/div[last()][not(contains(@id,'state'))]") {
    add_class("mw_donate_seals mw_flex_box")
    remove("./@style")

    $("./a") {
      add_class("mw_flex_box_item_1")
    }

    $("./a/img") {
      remove("./@style")
    }
  }
  # Move the trust logos to the top of the donate form. HSUS-112

  $(".//div[@id='side']") {
    $("./div[contains(@class,'mw_donate_seals')]") {
      move_to("./ancestor::div[@id='cols']//div[@id='give']", "top")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    # wayne blog
    $(".//div[@id='wayne']") {
      add_class("mw_sidebar4")
    }
    # In your state
    $("./div[@id='state']") {
      add_class("mw_sidebar5")
    }
    move_to("ancestor::div[@id='cols']","after")
    remove("ancestor::div[@id='page']/div[@id='page-bottom-spacer']")
  }
  
  # HSUS-306 Philanthropy Contact page
  # http://www.humanesociety.org/donate/help/
  match($path,/^\/donate\/help/) {
    $(".//div[@id='main']/div[contains(@class,'section')]") {
      add_class("mw_help_section")
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
      $("self::div[contains(@class,'simple')]/h2[1]/following-sibling::p") {
        wrap_text_children("span", class:"mw_help_content")
        remove(".//br")
      }
      remove("./br")
      $("./h3") {
        add_class("mw_h3")
      }
      $("./h2") {
        add_class("mw_h2")
      }
      $("ancestor::div[@id='cols']/div[@id='side']") {
        # remove wayne's podcast and in your state section
        move_to("ancestor::div[@id='cols']","after")
      }
      remove("ancestor::div[@id='page']/div[@id='page-bottom-spacer']")
    }
  }
  # END HSUS-306 Philanthropy Contact page

}
$("./body") {
  add_class("mw_edit_profile")
  # when error message appear, the img will broken
  $(".//img[contains(@src, 'ConsProfileUser') or contains(@src, 'ConsInterestsUser')]") {
    attribute("src") {
      value() {
        replace(/\/(ConsProfileUser|ConsInterestsUser)/, "")
      }
    }
  }
  remove(".//div[@id='page-head'] | .//ul[@id='site-nav'] | .//div[@id='head']")
  # main content
  $(".//div[@id='wrapper-body']") {
    remove("./@style | ./br")
    # desktop site display none
    $(".//p/a[contains(@href, 'Passwd')]") {
      add_class("mw_hide")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    # btns
    $(".//p[./input[@class='Button']]") {
      add_class("mw_btn_center")
      $("./input[@value='Save' or @title='Done' or @title='Register' or contains(@value, 'Home')]") {
        add_class("mw_btn2")
      }
      $("./input[@value='Cancel' or @value='Reset']") {
        add_class("mw_btn1")
      }
    }
    # end of btns
    
    # edit profile
    $(".//form[@id='EditCons']/fieldset") {
      $(".//td[not(*)]") {
        match(text(), /\A\s+\Z/) {
          remove()
        }
      }
      $("./table[@class='grid']") {
        $("./tr") {
          $(".//table[contains(@class, 'cons-name')]") {
            $("./tr[1]") {
              $("./td") {
                move_here("../following-sibling::tr/td[1]") {
                  add_class("mw_edit_data")
                }
              }
            }
          }
        }
        $("./tr/td[./p[@class='label'][not(contains(text(), 'Opt-in'))]][not(.//input)][not(.//select)][not(.//label[@class='wrapable'])]") {
          add_class("mw_edit_field")
        }
        $(".//p[@class='label'][./label[@class='wrapable']]") {
          add_class("mw_input_title")
        }
        # Text Message Opt-in:
        $("./self::table[.//input[contains(@id, 'custom_boolean')]]") {
          $("./tr/td[1]/p") {
            add_class("mw_optin")
            move_here("../following-sibling::td/input", "top")
          }
        }
        $("./self::table[.//p[contains(text(), 'Opt-in')]]/tr/td[1]/p") {
          move_here("../following-sibling::td/span", "after")
          add_class("mw_optin_data")
        }
      }
      table_dump(".")
    }
    # end of edit profile
    
    # Email Subscriptions
    $(".//form[@id='ConsConfigInterests']") {
      remove("./table[.//input[@id='ConsInterestsUseremailPrefsEMAILOpenAll']] | ./table/@style | ./br")
      $("./table[@class='tree-view']") {
        $(".//tr[./th]") {
          $("./th") {
            var("th_" + index(), fetch("./p/text()"))
          }
        }
        $(".//tr[not(./th)]") {
          $("./td") {
            remove("./img[contains(@src, 'sp.gif')]")
            insert_top("span", class: "mw_tree_field", var("th_" + index()) + ":") {
              insert_after("div", class: "mw_tree_data") {
                move_here("./following-sibling::*", "bottom")
              }
            }
          }
        }
        remove(".//tr[./th]")
        table_dump(".")
      }
    }
    # end of Email Subscriptions
  }
  # end of main content
}
$("./body") {
  add_class("mw_hslf_donate_tablet")

  $(".//a[@class='mw_header_spillover']") {
    # insert("img", src:"http://www.humanesociety.org/assets/images/global/logo.png")
  }

  fixImages()

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
    }
  }

  # Remove the styling
  $(".//table") {
    remove("@style")
    remove("@bgcolor")

    $("./tbody/tr/td") {
      remove("@width")
    }
  }

  $("./table") {
    # add_class("mw_box1")
  }

  # Remove all inline styling.. except for those with display: none; for the tables and children
  $("./table//*[@style and not(contains(@style, 'display'))]") {
    remove("@style")
  }
  $(".//table[@bgcolor]") {
    remove("@bgcolor")
  }

  # The main donation form content
  $(".//table[@id='contentTable']") {

    $(".//td[@id='contentArea']") {
      #add_class("mw_box2")
      add_class("mw_box2_tablet") 
    }

    # remove the forced width
    remove("@width")

    # hide the sidebar links..
    $("../preceding-sibling::td") {
      add_class("mw_hide")
    }

    # Tag the row that the main content table is in
    $("./ancestor::tr[1]") {
      add_class("mw_content_table_row")
    }

    # Remove some margin styling
    $(".//td[@id='breadcrumbbar']") {
      remove("./br")
      $("./div") {
        remove("@style")
      }
      
    }

    # Before adding the arrows to the credit card popups, wrap them in <span>s
    $(".//fieldset[@class='cardExpGroup']/select") {
      wrap("span")
    }

    # add in some extra arrows for the select box
    $(".//select/..") {
      add_class("mw_select_arrows")
    }

    # Replace the "Make a donation" image with text.. because image text is so 1998
    $(".//td[@class='FormCaption']") {
      
      # Remove the forced width on the table
      $("./table") {
        remove("@style")
      }

      $(".//img[contains(@alt, 'Donation')]") {
        %title = fetch("@alt")

        insert_top("div", class:"mw_hslf_title", %title)
        add_class("mw_hide")

        $("..") {
          remove("./br")
        }
      }

      
    }

    # Here's where all the action takes place
    $(".//form[@id='ProcessForm']") {
      add_class("mw_gray_inner")
      $(".//table | .//tr | .//tbody") {
        name("div")
      }
      $(".//td") {
        name("span")
      }

      # try splitting up the donation amounts similar to how the mockup is
    $(".//div[contains(@id,'level-standard')]") {
        $("./div[contains(@class, 'FormRow') and position() < 7]") {
          add_class("mw_amount_column_one")
        }
        $("./div[position() > 6]") {
          add_class("mw_amount_column_two")
        }
      }
      wrap_together(".//div[contains(@class, 'mw_amount_column_one')]", "div", id:"mw_amount_column_one")
      wrap_together(".//div[contains(@class, 'mw_amount_column_two')]", "div", id:"mw_amount_column_two")

      # Provide a way to limit the size of the labels of the radio buttions
      $(".//label[@class='RadioGroupLabel']/..") {
        add_class("radioGroupLabeltd")

        $("./ancestor::div[@class='FormRow']") {
          add_class("mw_radio_columns")
        }
      }

      # bump down the radio button for the "other" donation amount
      $(".//input[@class='DonationLevelOtherAmount']/ancestor::td[1]") {
        # /ancestor::tr[1]//input[@type='radio']
        add_class('mw_radio_alignment')
      }

      $(".//span[@class='requiredIndicator'] | .//span[@class='FormLabel']") {
        inner() {
          replace(/\xC2\xA0/, '')
        }
      }

      # Make the Credit cards one row
      $(".//div[@id='payment_typecc_type_Row']//fieldset") {
        add_class("mw_creditcard_row")

        $("./div") {
          add_class("mw_flex_box")

          $("./span") {
            add_class("mw_flex_box_item_1")
          }
        }
      }

      $(".//div[@id='overTable']") {
        wrap_together("./div[not(contains(@id,'html-caption'))]", "div", class:"mw_box6 mw_form_donate")

        move_here("./div[contains(@id, 'html-caption')][1]", "top")
      }
    }
  }

  # Hide all the table rows that we are not using..

  $("./table/tbody/tr[not(@class)]") {
    add_class('mw_hide')
  }

  $(".//input[@class='NextButton']") {
    add_class ("mw_btn2")
    remove("@onmouseover")
    remove("@onmouseout")
  }


  ##########################################
  # This is an alternate form

  $(".//table[@id='formtop']/ancestor::table[@align='center'][1]") {
    remove("@width")
    add_class("mw_box2")

    $(".//td") {
      remove("@width")
      remove("@style")
      $("./p") {
        remove("@style")
      }
    }

    # Make the body text look more appealing
    $(".//tr[1]/td[1]/p[1]") {
      add_class("mw_hslf_donate_block_header")
    }

    $(".//param[@name='width']") {
      attribute("value", "280")
    }
  }

  $(".//img[contains(@alt, 'commercial')]") {
    add_class("mw_hide")
    %descText = fetch("@alt")

    insert_after("p", class:"commercialText", %descText)
    $("..") {
      attribute("style", "display: block;")
    }
  }

  # This is the donor gift
  $(".//td[@valign='top']") {
    remove("@bgcolor")
    $("./table") {
      remove("@width")
      add_class("mw_hsus_donation_gift")
    }
  }
  # remove the extra Donate Monthly button
  $(".//table[contains(@class, 'mw_hsus_donation_gift')]//img[contains(@alt, 'donate monthly')]/ancestor::tr[1]") {
    remove()
  }

  # Remove this <hr>
  $(".//td[hr]/..") {
    remove()
  }

  # Clean up the FAQ section
  # Remove their toggling script.. use ours
  $(".//div[@id='FAQsection']") {

    remove("./preceding-sibling::script")
    
    $("./p[contains(@class,'question')]") {
      remove("./img")
      add_class("mw_bar5")
      attribute("data-ur-toggler-component", "button")
    }

    $("./p[contains(@class, 'answer')] | ./div[contains(@id, 'answer')]") {
      attribute("data-ur-toggler-component", "content")
      remove("@style")

      # Wrap the Questions and Answers together
      wrap("div", data-ur-set:"toggler", class:"qa_section") {
        move_here("./preceding-sibling::p[contains(@id, 'question')][1]", "top")
      }
    }
  }

  # Custom Keyboards
  $(".//input[@class='DonationLevelOtherAmount']") {
    keyboard("number")
    attribute("size", "6")
  }
   contextual_keyboard(".//input[@id='billing_addr_zipname']", "numeric")
  contextual_keyboard(".//input[@id='donor_email_addressname']", "email")
  # contextual_keyboard(".//input[@id='donor_phonename']", 'tel')
  contextual_keyboard(".//input[@id='payment_typecc_numbername']", 'numeric')
  contextual_keyboard(".//input[@id='payment_typecc_cvvname']", 'numeric')
}
# tell a friend advocacy pages
# https://secure.humanesociety.org/site/Advocacy?cmd=display&page=ActionAlertTakenPage&id=6075


$("./body") {

  add_class("mw_tellafriend")
  fixImages()

  remove(".//div[@id='ga-header']/img")

  # are we in a taf-tab page?
  # some tell-a-friend pages have big sections with prewritten textareas.
  $(".//div[@id='ga-content' and .//div[contains(@class, 'taf-share-container')]]") {
    add_class("mw_taf_tabs")
  }

  # ditch convio
  $(".//div[a[contains(@href, 'poweredby')]]") {
    remove()
  }

  # main content, with tabs
  $(".//div[contains(@class, 'mw_taf_tabs')]") {

    move_here(".//div[@id='ga-header']", "top") {
    # this code use to fixed #HSUS-341 page and #HSUS-379 Thank you page
    # https://secure.humanesociety.org/site/Advocacy?cmd=display&page=OnScreenThanks&id=5951
    # https://secure.humanesociety.org/site/Advocacy?cmd=display&page=OnScreenThanks&id=6045
      move_here("./following-sibling::table[1]//div[@id='action-alert' or @class='appArea']", "after") {
        attribute("class", "mw_box2")
        remove(".//@style")
        remove("./div[@class='showondesktop']")
        $("./h2") {
          attribute("class", "mw_h3")
        }
        $("./h3") {
          attribute("class", "mw_h3")
        }
        # HSUS-510
        remove("./br")
        $("./div[contains(@class, 'taf-share-container')]") {
          attributes(data-ur-set:"tabs")
          insert_top("div", class:"mw_share_button mw_flex_box")
          $("./a") {
            name("div")
            %mw_tab_index = index()
            %mw_tab_class = fetch("./@class") {
              replace(/\w+_/, "")
            }
            insert_before("div", %mw_tab_class, data-ur-tabs-component:"button", class:"mw_"+%mw_tab_class+"_button mw_flex_box_item_1", data-ur-tab-id: "mw_tab_"+%mw_tab_index) {
              $("./self::div[contains(@class, 'facebook')]") {
                attribute("data-ur-state", "enabled")
              }
              move_to("./preceding-sibling::div[contains(@class, 'mw_share_button')]", "bottom")
            }
            attributes(data-ur-tabs-component:"content", data-ur-tab-id: "mw_tab_"+%mw_tab_index)
            $("./self::div[contains(@class, 'facebook')]") {
              attribute("data-ur-state", "enabled")
            }
            # fixed textarea no text issue
            $(".//textarea") {
              remove("./@rows | ./@cols | ./@unselectable | ./@disabled")
              attribute("readonly", " ")
            }
            insert_bottom("a", fetch("./@class"), class: fetch("./@class")+" mw_btn2", href: fetch("./@href")) {
              text() {
                replace(/\w+_/, "SHARE ON ")
                replace("facebook", "FACEBOOK")
                replace("twitter", "TWITTER")
                replace("ON email", "VIA EMAIL")
              }
              wrap("div", class:"mw_btn_box")
            }
          }
        }
        $("./div[@class='supertaf-donate-section']/div[@class='supertaf-donate-form']/form[@id='taf-donate']") {
          $("./div[@class='supertaf-donate-text']") {
            insert_top("div", "DONATE NOW", class:"mw_donate_title")
          }
          $("./div[@class='supertaf-donate-amounts']") {
            $("./label | ./input[@id='supertaf-box']") {
              move_to("./preceding-sibling::div[@class='mw_amount'][1]", "bottom")
            }
            $("./input[@class='supertaf-donate-button']") {
              btn_delegate() {
                attribute("class", "mw_btn2")
                inner("CONTINUE")
              }
            }
            # Fix for HSUS-510 : Mobile
            #remove("./br | ./label | ./input[not(@id='supertaf-box' or @type='submit')]")
            $("./strong") {
              #inner("$")
              # wrap("div", class:"mw_amount") {
              # move_here("./following-sibling::input[@id='supertaf-box']", "bottom")
              # }
            }
          }
        }
        # HSUS-373
        $("./div[@id='share_bar']") {
          add_class("mw_new_tell_a_friend")
          $(".//a[./img[@alt='Donate now']]") {
            add_class("mw_donate_now")
          }
          $(".//a") {
            insert("span", fetch("./img/@alt"))
            remove("./img")
          }
        }
        # HSUS-427 Remove Excess White Space on Alert 5699's Thank You Page
        $("./iframe[contains(@src, 'glitternetwork')]") {
          add_class("mw_hide2")
        }
      }
      # end revert code
    }
    remove("./table")
  }


  # main content, no tabs
  $(".//div[@id='ga-content' and not(@class)]") {
    # get header and fix nesting
    move_here(".//div[@class='appArea']", "top")
    move_here(".//div[@id='ga-header']", "top")
    remove("./table")

    $(".//div[@class='appArea' or @id='action-alert']") {
      add_class("mw_main mw_box2")

      # text
      $(".//div[@class='showonmobile']") {
        move_here(".//td") {
          name("div")
        }
        remove("./table")
        $(".//div[contains(@id, 'headline')]") {
          add_class("mw_h1")
        }
      }

      # share logos
      $(".//div[@id='share_bar']") {
        add_class("mw_share_logos")
        remove("@id")
        move_here(".//a")
        remove("./table")
      }
    }
  }

}

# old metamoai code

  # move_here("./following-sibling::table[1]//div[@id='action-alert' or @class='appArea']", "after") {

  # remove("./div[.//img[@alt='Powered By Convio']]")
$("./body") {
  add_class("mw_valor_award")
  remove("./div[@id='wrapper']/br")
  $("./div[@id='wrapper']/div[@id='page']") {
    remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style]")
    $("./div[@id='contentDiv']/div[@id='cols']/div[@id='main']/div[@id='wrapper-body']") {
      remove("./@style")
      # share
      $("./ul[@id='share_bar']/li/img[@class='share_image']") {
        name("span")
        insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
        remove()
      }
      # end share
      $("./div[contains(@id, 'pov-col')]") {

        $(".//h3") {
          add_class("mw_h3")
        }
        $("./div[@class='pov-text']") {
          $("./h2") {
            add_class("mw_h2")
            remove("./br")
          }
          $("./p") {
            name("div")
            wrap_text_children("span")
            $("./br/following-sibling::span[1]") {
              wrap("div", class:"mw_wrap_div")
            }
            $("./a | ./span | ./strong") {
              move_to("preceding-sibling::div[1]", "bottom")
            }
            remove("./br")
          }
        }
        $(".//div[@class='pov']") {
          remove(".//@style | .//@width")
          $("./img") {
            add_class("mw_img")
          }
          $("./p[not(*)]") {
            text() {
              replace(/^[\s\u00a0]+/, "")
              replace(/[\s\u00a0]+\|$/, "")
            }
          }
        }
        # cast your vote area
        $(".//div[@id='pov-fields-input-boxes']") {
          remove("./p/@style | ./div[@id='bogotext']//img/@style")
          $("./div/input") {
            add_class("mw_input")
          }
          $("./label[./input[@class='radio']]") {
            add_class("mw_radio")
            move_here("./following-sibling::div[@id='pov-radio-area-legal' or @id='pov-radio-error-legal']", "bottom")
          }
          $("./input[@class='pov-submit-button']") {
            add_class("mw_btn1")
            wrap("div", class: "mw_submit_btn")
          }
        }
        # end cast your vote area
      }
    }
  }
}
$("./body") {
  add_class("mw_donate_tablet")
  
  #HSUS-192 
  remove(".//div[@id='page-bottom-spacer']")
  
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  # add a header 
  # $(".//div[@id='shell'] | .//div[@id='wrapper']") {
  #   insert_top("div", class:"mw_head_spacer") {
  #     insert("div", class:"mw_head_spacer_text", "Donate")
  #   }
  # }

  $(".//div[contains(@class, 's_borderless')]") {
    remove("./@style")
  }

  # Remove all inline styles?
  #remove(".//*[@style]/@style")

  # Become a member, humane leader, gift donation, memorial donation
  $(".//a[@class='more']") {
    add_class("mw_bar1")
  }

  # main content
  $(".//div[@id='content']") {
    # top section
    $("./div[@id='givenow']") {
      # Monthly donation | One Time Gift
      $("./div[@id='monthly_sec'] | ./div[@id='onetime_sec']") {
        add_class("mw_box7 mw_flex_box_item_1 mw_donate_form")

        $("./h2") {
          add_class("mw_bar4")
        }

        $("./form") {
          $("./span") {
            add_class("mw_amount")
          }

          #move the input box into the associated label

          $(".//label") {
            move_here("./preceding-sibling::input", "top")
          }

          $(".//button") {
            add_class("mw_btn2")
          }

          $(".//p[button[@type='submit']]") {
            add_class("mw_btn_center")
          }

          # Make the custom amount a numeric keyboard
          $(".//input[@id='onetime-value'] | .//input[@id='monthly-value']") {
            keyboard("number")
            attribute("size", "6")
          }
        }
      }
      wrap_together("./div[contains(@class,'mw_box7')]", "div") {
        add_class("mw_flex_box")
      }
      # end of Monthly donation | One Time Gift

      $("./div[contains(@class, 'col')]/dt[@class='menu_head']") {
        wrap("div", class:"mw_content") {
          move_here("./following-sibling::p[@class='para'][1]", "bottom")
          move_here("./following-sibling::a[contains(@class, 'more')][1]", "bottom")
        }
      }
      $("./div[contains(@class, 'col1')]/div[contains(@class, 'mw_content')]") {
        add_class("mw_flex_box_item_1")
        wrap("div", class:"mw_flex_box") {
          move_here("./ancestor::div[@id='givenow'][1]/div[contains(@class, 'col2')]/div[contains(@class, 'mw_content')][1]", "bottom") {
            add_class("mw_flex_box_item_1")
          }
          move_to("..", "before")
        }
      }
      remove("./div[contains(@class, 'col')]")
    }
    # end of top section

    # Other Ways to give
    $(".//div[@id='otherways']") {
      remove(".//@style")
      # section title
      $("./h2") {
        add_class("mw_help_animals")
      }
      # end of section title
      # HSUS-232 align "Other Ways to give" section
      $("./div[contains(@class, 'col')]") {
        $("./dl") {
          name("div")
          add_class("mw_content")
        }
        $("./dt[@class='menu_head']") {
          wrap("div", class:"mw_content") {
            move_here("./following-sibling::dd[@class='menu_body'][1]", "bottom")
          }
        }
      }
      $("./div[contains(@class, 'col1')]/div[contains(@class, 'mw_content')]") {
        add_class("mw_flex_box_item_1")
        wrap("div", class:"mw_flex_box") {
          move_here("./ancestor::div[@id='otherways'][1]/div[contains(@class, 'col2')]/div[contains(@class, 'mw_content')][1]", "bottom") {
            add_class("mw_flex_box_item_1")
          }
          move_to("..", "before")
        }
      }
      remove("./div[contains(@class, 'col')]")
    }
    # end of Other Ways to give

    # Shop To Help Animals
    $("./div[contains(@class, 'section')][not(@id)]") {
      remove("./@style")
      # section title
      $("./h2") {
        add_class("mw_help_animals")
      }
      # end of section title
      $("./div[contains(@class, 'col')]") {
        add_class("mw_flex_box_item_1")
      }
      wrap_together("./div[contains(@class, 'col')]", "div") {
        add_class("mw_flex_box")
      }
    }
  }
  # end of main content

  # Bottom
  # HSUS-232 move the logos to the top right
  $(".//div[@id='side']/div[last()]") {
    add_class("mw_donate_seals")
    remove("./@style")
    $("./a/img") {
      remove("./@style")
    }
  }
  # end of HSUS-232

  # Move the trust logos to the top of the donate form. HSUS-112
  $(".//div[@id='side']/div[contains(@class,'mw_donate_seals')]") {
    move_to("./ancestor::div[@id='cols']//div[@id='give']", "top")
  }
  # end of HSUS-112
  
  # HSUS-306 Philanthropy Contact page
  # http://www.humanesociety.org/donate/help/
  match($path,/^\/donate\/help/) {
    $(".//div[@id='main']/div[contains(@class,'section')]") {
      add_class("mw_help_section")
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
      $("self::div[contains(@class,'simple')]/h2[1]/following-sibling::p") {
        wrap_text_children("span", class:"mw_help_content")
        remove(".//br")
      }
      remove("./br")
      $("./h3") {
        add_class("mw_h3")
      }
      $("./h2") {
        add_class("mw_h2")
      }
    }
  }
  # END HSUS-306 Philanthropy Contact page
  #  sidebar
  $(".//div[@id='side']") {
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5 mw_flex_box_item_1")
      $(".//h2") {
        add_class("mw_h2")
      }
      wrap("div",class: "mw_flex_box")
    }
    $("./div[./div[@id='wayne']]") {
      add_class("mw_flex_box_item_1")
      remove(".//@style")
      move_to("following-sibling::div[@class='mw_flex_box']")
      $("./div[@id='wayne']") {
        add_class("mw_sidebar4")
        $(".//h2") {
          add_class("mw_h2")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_st_francis_box_tablet")

  $("./div[@id='wrapper']") {
    $("./div[@id='page']") {
      remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style] | ./br")
      $("./div[@id='contentDiv']/div[@id='cols']") {
        add_class("mw_box2_tablet") 
        $("./div[@id='main']/div[@id='wrapper-body']") {
          remove("./@style")
          # share
          $("./ul[@id='share_bar']/li/img[@class='share_image']") {
            name("span")
            insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
            remove()
          }
          # end share
          
          # toptext
          $("./div[@id='francis-toptext']") {            
            # removing all toptext style
            $("./*") {
              remove("@style")
            }
            
            $("./div[@id='francis-title']/h1") {
              add_class("mw_h2")
            }
            
            $("./div[a]") {
              attribute("id","mw_topic_photo")
            }
            
            #form title
            $("./p[position() = last()]"){              
              add_class("mw_h3")
              move_to("../../form","top")
            }
            
            $("./ul") {
              wrap("div") {
                attribute("id","mw_topics")
                move_here("./preceding-sibling::p[1]","top")
              }  
            }
            insert("div") {
              attribute("class","mw_topic")
              move_here("../div[@id='mw_topic_photo' or @id='mw_topics']")              
            }
          }
          # end toptext
          #form
          $("./form") {
            attribute("class","mw_st_form")
            $("./div[@id='chimps-bottom-elements']//input | ./div[@id='chimps-bottom-elements']//textarea") {
              remove("@style")
            }            
            $(".//input[@type='text'] | .//select") {
              add_class("mw_input")
            }
            $(".//input[@class='francis-submit-button']") {
             add_class("mw_btn1")
             wrap("div") {
               attribute("class","mw_submit_btn")
             }
            }
          }
          #
          
          $(".//script[contains(text(),'validate(')]") {
            text() {
              replace(/insertBefore/,"insertAfter")
            }            
          }
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_hslf_donate")

  fixImages()

  # Remove the styling
  $(".//table") {
    remove("@style")
    remove("@bgcolor")

    $("./tbody/tr/td") {
      remove("@width")
    }
  }

  $("./table") {
    add_class("mw_box1")
  }

  # Remove all inline styling.. except for those with display: none; for the tables and children
  $("./table//*[@style and not(contains(@style, 'display'))]") {
    remove("@style")
  }
  $(".//table[@bgcolor]") {
    remove("@bgcolor")
  }

  # The main donation form content
  $(".//table[@id='contentTable']") {

    $(".//td[@id='contentArea']") {
      add_class("mw_box2")
    }

    # remove the forced width
    remove("@width")

    # hide the sidebar links..
    $("../preceding-sibling::td") {
      add_class("mw_hide")
    }

    # Tag the row that the main content table is in
    $("./ancestor::tr[1]") {
      add_class("mw_content_table_row")
    }

    # Remove some margin styling
    $(".//td[@id='breadcrumbbar']") {
      remove("./br")
      $("./div") {
        remove("@style")
      }
      
    }

    # Replace the "Make a donation" image with text.. because image text is so 1998
    $(".//td[@class='FormCaption']") {
      
      # Remove the forced width on the table
      $("./table") {
        remove("@style")
      }

      $(".//img[contains(@alt, 'Donation')]") {
        %title = fetch("@alt")

        insert_top("div", class:"mw_hslf_title", %title)
        add_class("mw_hide")

        $("..") {
          remove("./br")
        }
      }

      
    }

    # Here's where all the action takes place
    $(".//form[@id='ProcessForm']") {
      $(".//table | .//tr | .//tbody") {
        name("div")
      }
      $(".//td") {
        name("span")
      }

      $(".//span[@class='requiredIndicator'] | .//span[@class='FormLabel']") {
        inner() {
          replace(/\xC2\xA0/, '')
        }
      }

      # Make the Credit cards one row
      $(".//div[@id='payment_typecc_type_Row']//fieldset") {
        add_class("mw_creditcard_row")

        $("./div") {
          add_class("mw_flex_box")

          $("./span") {
            add_class("mw_flex_box_item_1")
          }
        }
      }

      $(".//div[@id='overTable']") {
        wrap_together("./div[not(contains(@id,'html-caption'))]", "div", class:"mw_box6 mw_form_donate")

        move_here("./div[contains(@id, 'html-caption')][1]", "top")
      }
    }
  }

  # Hide all the table rows that we are not using..

  $("./table/tbody/tr[not(@class)]") {
    add_class('mw_hide')
  }

  $(".//input[@class='NextButton']") {
    add_class ("mw_btn2")
    remove("@onmouseover")
    remove("@onmouseout")
  }


  ##########################################
  # This is an alternate form

  $(".//table[@id='formtop']/ancestor::table[@align='center'][1]") {
    remove("@width")
    add_class("mw_box2")

    $(".//td") {
      remove("@width")
      remove("@style")
      $("./p") {
        remove("@style")
      }
    }

    # Make the body text look more appealing
    $(".//tr[1]/td[1]/p[1]") {
      add_class("mw_hslf_donate_block_header")
    }

    $(".//param[@name='width']") {
      attribute("value", "280")
    }
  }

  $(".//img[contains(@alt, 'commercial')]") {
    add_class("mw_hide")
    %descText = fetch("@alt")

    insert_after("p", class:"commercialText", %descText)
    $("..") {
      attribute("style", "display: block;")
    }
  }

  # This is the donor gift
  $(".//td[@valign='top']") {
    remove("@bgcolor")
    $("./table") {
      remove("@width")
      add_class("mw_hsus_donation_gift")
    }
  }
  # remove the extra Donate Monthly button
  $(".//table[contains(@class, 'mw_hsus_donation_gift')]//img[contains(@alt, 'donate monthly')]/ancestor::tr[1]") {
    remove()
  }

  # Remove this <hr>
  $(".//td[hr]/..") {
    remove()
  }

  # Clean up the FAQ section
  # Remove their toggling script.. use ours
  $(".//div[@id='FAQsection']") {

    remove("./preceding-sibling::script")
    
    $("./p[contains(@class,'question')]") {
      remove("./img")
      add_class("mw_bar5")
      attribute("data-ur-toggler-component", "button")
    }

    $("./p[contains(@class, 'answer')] | ./div[contains(@id, 'answer')]") {
      attribute("data-ur-toggler-component", "content")
      remove("@style")

      # Wrap the Questions and Answers together
      wrap("div", data-ur-set:"toggler", class:"qa_section") {
        move_here("./preceding-sibling::p[contains(@id, 'question')][1]", "top")
      }
    }
  }

  # Custom Keyboards
  $(".//input[@class='DonationLevelOtherAmount']") {
    keyboard("number")
    attribute("size", "6")
  }
   contextual_keyboard(".//input[@id='billing_addr_zipname']", "numeric")
  contextual_keyboard(".//input[@id='donor_email_addressname']", "email")
  # contextual_keyboard(".//input[@id='donor_phonename']", 'tel')
  contextual_keyboard(".//input[@id='payment_typecc_numbername']", 'numeric')
  contextual_keyboard(".//input[@id='payment_typecc_cvvname']", 'numeric')
}
$("./body") {
  add_class("mw_chimps_tablet")
  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1") {

      move_here("//div[@id='footer']") {
        remove("./div[./img]")
        attribute("id") {
          value() {
            replace("er", "")
          }
        }
      }

      #manually styled footers
      move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
        remove("@style")
        remove("./img")
        $("./p") {
          name("li")
          add_class("mw_footer_info")
          move_to("./following-sibling::ul", "bottom")
        }
        $(".//*[@style]") {
          remove("@style")
        }
        $("./ul/li[1]") {
          add_class('mw_footer_copyright')
        }
        $(".//li[./a]") {
          add_class("mw_links_inline")
          remove("./self::li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
        }
      }

      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # footer

  $("./table | ./div[@id='ga-container']/div[@id='ga-content']/table") {
    attribute("id", "wrapper")
    remove(".//@width | .//@align | .//@bgcolor | .//@style | .//br[@clear='all']")
    # Header image
    $("./tr[./td[not(./table)]] | ./tbody/tr[./td[not(./table)]]") {
      attribute("class", "mw_banner_img")
      $("./td//img") {
        attribute("src") {
          value() {
            replace(/[\/|\w|\.]+(\.\..*)/) {
              set($1)
            }
          }
        }
        move_to("./ancestor::tr[@class='mw_banner_img']", "bottom")
      }
      remove("./td[not(.//img)]")
      $("./following-sibling::tr[1]") {
        attribute("class", "mw_box2_tablet")
      }
    }
  }
  table_dump(".//table")
  $(".//div[@class='lp-template-container']") {
    $("./div[@class='infographicshare']") {
      attribute("id", "share")
      $("./img") {
        name("span")
        inner(fetch("./@alt"))
        remove("./@alt | ./@height | ./@src")
      }
      $("./a[contains(text(), 'Facebook')]") {
        add_class("addthis_button_facebook")
        remove("./text()")
      }
      $("./a[contains(text(), 'Twitter')]") {
        add_class("addthis_button_twitter")
        remove("./text()")
      }
      $("./a[contains(text(), 'Tumblr')]") {
        add_class("addthis_button_tumblr")
        remove("./text()")
      }
      $("./a[contains(text(), 'Pinterest')]") {
        add_class("addthis_button_pinterest")
        remove("./text()")
      }
      $("./a[contains(text(), 'Reddit')]") {
        add_class("addthis_button_reddit")
        remove("./text()")
      }
      $("./a[contains(text(), 'Email')]") {
        add_class("addthis_button_email")
        remove("./text()")
      }
    }
    $("./div[@id='lp-donate-button']/a") {
      attribute("class", "mw_btn2")
      inner("DONATE TO HELP CHIMPS")
    }

    $("./div[@class='lp-aa-box']") {
      move_here("./preceding-sibling::div[@id='lp-donate-button'][1]", "before")
      remove("./div[./img]")
    }
    $("./div[@class='lp-donate-box']/div[@class='supertaf-donate-section']/div[@class='supertaf-donate-form']/form[@id='taf-donate']") {
      $("./div[@class='supertaf-donate-text']") {
        insert_top("h2", "DONATE NOW", class:"mw_h2")
      }
      $("./div[@class='supertaf-donate-amounts']") {
        $("./input[contains(@id, 'supertaf-amount')]") {
          wrap("div", class:"mw_amount")
        }
        $("./label | ./input[@id='supertaf-box']") {
          move_to("./preceding-sibling::div[@class='mw_amount'][1]", "bottom")
          $("./self::input[@id='supertaf-box']") {
            attribute("onclick", "document.getElementById('supertaf-amount-other').checked = true;")
          }
        }
        $("./input[@class='supertaf-donate-button']") {
          btn_delegate() {
            attribute("class", "mw_btn2")
            inner("CONTINUE")
          }
        }
      }
    }
    $("./following-sibling::p[@align='center']") {
      add_class("mw_narrow_size")
    }
  }
}
$("./body") {
  add_class("mw_donate_login")
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
      
    $("./div[@id='main']") {
      add_class('mw_gray_inner')
      $(".//td[./div[@class='right-block']]") {
        add_class("mw_right_block")
        remove(".//br")
      }
      $(".//form/ancestor::tr[1]") {
        add_class("mw_form_wrap")
        # td[1] in empty
        remove("./td[1]")
      }
      $(".//input[@type='submit']") {
        add_class("mw_btn2")
      }
      $(".//div[@class='outer-border']/table") { 
        remove("./tr[1]/td[1][not(./form)]")
        $(".//div[@class='input-border']//input/ancestor::tr[1]") {
          add_class("mw_input_form")
          $("./td[./input]") {
            add_class("mw_input_td")
          }
        }
        # https://secure.humanesociety.org/site/UserLogin
        $("./tr[1]/td[1]/form") {
          $("./ancestor::table[1]") {
            add_class("mw_login_fail")
          }
        }
      }
    }
  }
  remove(".//div[@id='page-head'] | .//div[@id='head'] | .//td/@width | .//table/@width")
}
$("./body") {
  add_class("mw_match_gift")

  $(".//div[@id='page']") {
    add_class("mw_box2")

    $(".//div[@id='wrapper-body']") {
      # Remove the left padding on the page description
      remove("./@style")

      $("./h1") {
        add_class("mw_h1")
      }

      $(".//a") {
        # remove the red color on the link
        remove("./@style")
      }

      $(".//input[@class='search_button']") {
        add_class("mw_btn2")
      }
    }
  }
}
$("./body") {
  add_class("mw_splash")

  $(".//div[@class='mw_donation_image_center']/../.."){
    $("./p"){
      add_class("mw_text_wrapper")
    }
  }

  $(".//div[@id='FAQsection']"){
    $("../p") {
      add_class("mw_donate_info")
    }
    $("../a") {
      add_class("mw_donate_link")
      remove(".//@style")
    }
  }

  $(".//iframe[contains(@src, 'youtube-nocookie')]/.."){
    add_class("mw_video_container")
    $(".."){
      add_class("mw_content_wrapper")
    }
  }
}

match($tablet) {
  with("true") {
    # for tablet-only Tritium
    @import _splash_tablet.ts
  }
  else() {
    # for mobile-only Tritium
    @import _splash_mobile.ts
  }
}
# http://www.humanesociety.org/sitemap.html
# very similar to animal_main but I'm making a separate file to keep that ts from getting too crazy

# March 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_animal_main mw_sitemap")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//p[string-length()<2 and not(*)]")
  remove(".//div[@class='toolsSpacer']")
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  # issue and section accordions
  $(".//ul[@id='issue-browser']") {
    $("./li") {
      $("./a") {
        wrap("div") {
          add_class("menu_head")
          attributes(data-ur-toggler-component:"button")
          insert_top("div", class:"mw_plusminus")
        }
        remove("@href")
        name("span")
        add_class("mw_h1")
      }
      $("./ul") {
        add_class("menu_body")
        attributes(data-ur-toggler-component:"content")
        $(".//a") {
          add_class("mw_animal_button")
        }
      }
      name("div")
      add_class("mw_animal_accord mw_map_accord")
      attributes(data-ur-set:"toggler")
    }
    name("div")
    add_class("menu_list")
  }

  # side bar
  $(".//div[@id='side']") {
    # add_class("mw_flex_box")
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5 mw_flex_box_item_1")
      $(".//h2") {
        add_class("mw_h2")
      }
      wrap("div",class: "mw_flex_box")
    }
    $("./div[./div[@id='wayne']]") {
      add_class("mw_flex_box_item_1")
      remove(".//@style")
      move_to("preceding-sibling::div[@class='mw_flex_box']")
      $("./div[@id='wayne']") {
        add_class("mw_sidebar4")
        $(".//h2") {
          add_class("mw_h2")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_email_preferences")
  remove(".//div[@id='page-head']")
  $(".//div[@id='contentDiv']") {
    remove("./div[@id='head'] | .//div[@id='wrapper-body']/@style | ./div/@style")
    $("./div[not(*)]") {
      match(text(), /\A\s+\Z/) {
        remove()
      }
    }
    $(".//h3[@class='ObjTitle']") {
      add_class("mw_h3")
    }
    $(".//input[@class='Button']") {
      add_class("mw_btn4 mw_unsubscribe_btn")
      $(".."){
        add_class("mw_inline_flex")
      }
    }
  }
  # wrap options
  $(".//td/label") {
    wrap_text_children("div", class: "mw_option_text") {
      match(text(), /\A\s+\Z/) {
        remove()
      }
      text() {
        replace(/^\s+/, "")
      }
    }
  }
  # For "Unsubscribe Request" page
  $(".//label[@for='first_name']/ancestor::table[1]") {
    add_class("mw_URtable")
    table_dump(".")
    $("./div[contains(@class,'mw_was_tr')]/div[contains(@class,'mw_was_td')]/span[@class='ErrorMessage']") {
      $("./ancestor::div[contains(@class,'mw_was_td')]") {
        add_class("mw_error_message")
      }
    }
  }
}
# Place holder/example file
# HSUS 167 popup to add to the home screen
$("./head") {
  insert_bottom("script", type:"text/javascript") {
    text("var addToHomeConfig = {touchIcon:true, expire:525600, message:'Add HumaneSociety.org to your <strong>iPad&apos;s</strong> home screen. Tap the %icon button &amp; choose &apos;Add to Home Screen&apos;.'};")
  }
  insert_bottom("script", src:asset("javascript/add2home.js"))
  $("./title") {
    text("HSUS")
  }
}


$("./body") {
  add_class("mw_tablet_home")

  # The carousel
  $(".//div[@id='wrapper']") {
    move_here(".//div[contains(@class, 'mw_carousel_content_tablet')]", "top") {
      wrap("div", data-ur-set:"carousel", data-ur-fill:"1", data-ur-autoscroll:"enabled", data-ur-autoscroll-delay:"4000", data-ur-autoscroll-dir:"next" ,data-ur-carousel-component:"view_container", class:"mw_masthead mw_carousel") {
        insert_bottom("span", data-ur-carousel-component:"dots")
      }
      
      attribute("data-ur-carousel-component", "scroll_container")

      $("./div") {
        attribute("data-ur-carousel-component", "item")
        
        $("./div | ./a") {
          add_class("mw_content_text")
        }
      }
    }

  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_noborder")

    # HSUS-430 New News Briefs
    $(".//div[@class='section news-brief-home-page-inner s_borderless']") {
      $(".//p[@class='image']") {
        move_to("..", "top")
      }
    }

    # Twitter/Facebook left hand feed , also HSUS-430 News Feed / News Brief
    $(".//div[@class='section simple area-news'] | .//div[@class='section news-brief-home-page s_borderless']") {
      #section news-brief-home-page-inner s_borderless
      add_class("mw_onefourth")

      # Make the connect link a bar_1
      $("./a[@class='more']") {
        add_class("mw_bar1")
      }

      # Change the H3 to something else.. because it is getting globally styled
      $(".//h3") {
        name("p")
        attribute("class", "mw_community_content")
      }

      # Give the divs wrapping the feeds names so we can sort the facebook first
      $(".//a[contains(@href, 'facebook')]/ancestor::div[not(@id)][1]") {
        add_class("mw_facebook_feed")
      }
      $(".//a[contains(@href, 'twitter')]/ancestor::div[not(@id)][1]") {
        add_class("mw_twitter_feed")
      }
      $(".//div[@class=' mw_twitter_feed']") {
        # comment out for HSUS-216: on mock up twitter feeds comes first
        # move_to("..", "bottom")
      }

      # Move Connect to bottom
      $(".//a[@class='more mw_bar1']") {
        move_to("..", "bottom")
      }

      # Move the social feed to the top of #main 
      move_to("./ancestor::div[@id='main']", "top")
    }
    # HSUS-436-START:(Mobile & Tablet) Minor spacing issues on homepage
    $(".//div[contains(@class,'area-news')]/div[position() = 1]") {
      remove("./@style")
      add_class("mw_news_heading")
    }
    # HSUS-436-END
    # Truncate any news posts beyond 3
    remove(".//div[contains(@class, 'area-news')]//li[position()>3]")
    remove(".//div[contains(@class, 'news-brief-home-page')]//li[position()>3]")

    

    # Articles and Donate/Signup/Blog
    $(".//ol[@id='headlines']") {
      #add_class("mw_flex_box")
      # make the articles 1/3 width
      $("./li") {
        # add_class("mw_flex_box_item_1")
        add_class("mw_third")

        $(".//a[@class='more']") {
          add_class("mw_bar1")
        }
      }

      # Donate, Signup, Blog
      wrap("div", class:"mw_threefourth mw_articles_action") {
        move_here("./ancestor::div[@id='cols']/div[@id='side']") {
          add_class("mw_flex_box")

          $("./ul") {
            # Donate section
            $("./li[@id='donate']") {
              add_class("mw_box5") #mw_flex_box_item_1
              name("div")
              move_to("./ancestor::div[@id='side']", "top")

              $("./a") {
                add_class("mw_h1")
              }

              # reorder the radio buttons
              $(".//label/input[@type='radio']") {
                move_to("./parent::label[1]", "top")
              }

              # Change the button look
              $(".//button") {
                add_class("mw_btn3")
                text("DONATE")
              }
              # HSUS-186
              $("./div[@id='give_another_way']/a") {
                text("Give another way")
              }
            }

            #Combine the Signup, takeaction and shop
            $("./li[@id='takeaction']") {
              name("div")
              # move_to("../li[@id='signup']")
            }
            $("./li[@id='shop']") {
              name("div")
              # move_to("../li[@id='signup']")
            }

            $("./li[@id='signup']") {
              # add_class("mw_box5")
              name("div")
              # move_to("./ancestor::div[@id='side']")
              contextual_keyboard(".//input[@id='cons_email']", "email")
              contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")

              # Change the button
              $(".//button") {
                add_class("mw_btn3")
              }
            }

            name("div")
            add_class("mw_box5")
            $("./div/a") {
              add_class("mw_h1")
            }
          }

          $("./div[contains(@id, 'rss')]") {
            add_class("mw_box4")
            remove("@style")
            #HSUS-450
            $(".//a[@id='podcastbutton1a']") {
              remove()
            }
            #END HSUS-450
            
            $("./a") {
              add_class("mw_h1")
            }
          }

          # Going to try and wrap the div's in divs (yo dawg) and do the flexbox
          $("./div") {
            wrap("div", class:"mw_flex_box_item_1")
          }

        }
      }
    }
  }
}

/*
//HSUS-473
$(".//p[@class='tax-statement'][1]"){
  insert_after("br")
  insert_after("br")
}
*/
# 404 Page Not Found

# Sarah LaFrance April 2 2013

$("./body") {
  add_class("mw_not_found")

  # Remove masthead image, HSUS-440
  remove(".//img[contains(@class,'mw_tablet_masthead_image')]")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//ul[@id='tools']") // sorry if anyone wanted to share the 404
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//p[string-length(text())= 1]")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  # main content
  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//div[@id='feature']") {
      remove(".//br")
      # $(".//a[@class='more']") {
      #   inject("  &raquo;  ")
      # }
      $("./p") {
        add_class("mw_links")
      }
    }
  }

  # handle that empty div mess at the botom
  $(".//div[@id='contentDiv']/div") {
    remove("@style")
    wrap_text_children("span")
    remove("./span[string-length()<3]")
  }

  $(".//div[@id='cols']") {
    remove("./div[not(@id) and not(@class)]")
    remove("ancestor::div/following-sibling::br")
    $(".//div") {
      remove("@style")
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $("./ul") {
      add_class("mw_sidebar1_h")
    }
  }

}
# http://www.humanesociety.org/sitemap.html
# very similar to animal_main but I'm making a separate file to keep that ts from getting too crazy

# March 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_animals_main")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//p[string-length()<2 and not(*)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//h2") {
    add_class("mw_h2")
  }

  # issue and section accordions
  $(".//ul[@id='issue-browser']") {
    $("./li") {
      $("./a") {
        wrap("div") {
          add_class("menu_head")
          attributes(data-ur-toggler-component:"button")
          insert_top("div", class:"mw_plusminus")
        }
        remove("@href")
        name("span")
      }
      $("./ul") {
        add_class("menu_body")
        attributes(data-ur-toggler-component:"content")
        $(".//a") {
          add_class("mw_animal_button")
        }
      }
      name("div")
      add_class("mw_animal_accord mw_map_accord")
      attributes(data-ur-set:"toggler")
    }
    name("div")
    add_class("menu_list")
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
      $(".//h2") {
        add_class("mw_h2")
      }
    }
    $(".//div[@id='wayne']") {
      remove("@style")
      add_class("mw_sidebar4")
      $(".//h2") {
        add_class("mw_h2")
      }
    }
  }
}
# restaurant locator form, and anything else that looks the same
# http://www.humanesociety.org/restaurant_locator

# Sarah LaFrance March 9, 2013

$("./body") {
  add_class("mw_rest_form")
  # HSUS-284 map
  attributes(onload:"initialize()")
  # end of HSUS-284 map
  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length()<=1 and not(*)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='main']") {
    add_class("mw_box2")

    $("./div[contains(@class, 'section simple')]/h2") {
      add_class("mw_h3")
    }
    $("./div[.//input]") {
      add_class("mw_form")
      remove("@style")
      remove(".//br")
      $(".//p") {
        remove("@style")
      }
      $(".//input[contains(@value, 'Search')]") {
        wrap("div", class:"mw_btn_wrapper mw_flex_box") {
          $("./input[contains(@value, 'Search')]") {
            btn_delegate() {
              add_class("mw_btn1 mw_flex_box_item_1")
              text("FIND")
            }
          }
          move_here("following-sibling::input[contains(@value, 'Reset')]", "bottom") {
            btn_delegate() {
              add_class("mw_btn2 mw_flex_box_item_1")
              text("RESET")
            }
          }
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_forms")

  # fix the redirection on meatless monday page
  $(".//script[contains(text(), 'window.location')]") {
    inner() {
      replace(/action\.humane/, 'm.action.humane')
    }
  }

  # Wrap the page in a box2
  $(".//div[@id='main']") {
    add_class("mw_box2")
    $("./div[@id='feature']") {
      table_dump(".//table")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//div[./div/div[contains(@id,'captcha_player')]]") {
        add_class("mw_captcha_section")
        $("ancestor::div[contains(@class,'mw_was_tr')][1]") {
          add_class("mw_submit_number")
        }
      }
    }
    $("./div[@id='features']") {
      add_class("mw_form_features")
      remove("self::div[.//div[@id='flashcontent']]")
      $(".//h3") {
        add_class("mw_h3")
      }
      $(".//ul") {
        name("div")
        add_class("mw_ul")
        $("./li") {
          name("div")
          add_class("mw_li")
          wrap_text_children("span") {
            remove("self::span[contains(text(),'.')]")
          }
          $(".//p[@class='image']/following-sibling::p") {
            wrap("div",class:"mw_download_content") {
              move_here("following-sibling::a") {
                $("ancestor::div[1]") {
                  add_class("mw_download_section")
                }
              }
            }
          }
        }
      }
    }
    $(".//p[contains(text(),'*')]") {
      add_class("mw_label_star")
    }
    $(".//p[not(*)]") {
      match(fetch("./text()"), /\A[\s ]*\Z/) {
        remove()
      }
    }
    $(".//div[contains(@class,'req')]") {
      add_class("mw_hide")
    }
    # HSUS-411 Share desktop URLs on Thank You page
    $(".//p[contains(@class, 'simple')]/a[contains(@href, 'facebook')]") {
      attribute("href") {
        value() {
          replace(/m(\w{5})?\./, "")
        }
      }
    }
    $(".//a[contains(@href, 'thankyou/mailto')]") {
      attribute("href") {
        value() {
          replace(/m(\w{5})?\./, "www.")
        }
      }
    }
    $(".//iframe") {
      attribute("src") {
        value() {
          rewrite("link")
        }
      }
      attributes(id:"mw_flick_wrapper", height:"")
    }
  }

  # Remove the styling on any header
  $(".//h1") {
    remove("@style")
  }

  $(".//div[contains(@id, 'image')]") {
    remove("@style")
    add_class("mw_img_center")
  }

  # remove any align stuff of the image
  $(".//img") {
    remove("@align")
  }
  
  # remove Spam text box - ticket #HSUS-169
  remove(".//div[./input[@id='denySubmit']]")
  
  # Make all the TD containing inputs blocks and take up 100% of the width
  $(".//input[not(@type='checkbox')]/.. | .//select/..") {
    add_class("mw_input_wrapper")
  }

  # Remove the width from the message box area
  $(".//textarea") {
    remove("@cols")
  }

  # make the selects look more selectable
  $(".//select/..") {
    add_class("mw_select_arrows")
  }

  # Make the submit button big and red
  $(".//input[@type='submit']") {
    attribute("value","Submit")
    add_class('mw_btn2')
  }

  # Remove any particular styling on the table.. or paragraph
  # E.G. http://mlocal.humanesociety.org/forms/humane_society_jobs.html
  $(".//table[@style] | .//p[@style]") {
    remove("@style")
  }

  $(".//div[@id='main']") {
    remove(".//div/@style")
  }

  # Custom Keyboards
  contextual_keyboard(".//input[@id='cons_phone']","tel")
  contextual_keyboard(".//input[@id='cons_email']","email")
  contextual_keyboard(".//input[@id='cons_zip_code']","number")

  # # remove sidebar boxes
  # $(".//div[@id='side']") {
  #   add_class("mw_hide")
  # }
  match($path,/^\/site\/Survey/) {
    add_class("mw_survey")
    $(".//div[@class='appArea']") {
      remove(".//@width | .//@align")
    }
    remove(".//div[@id='contentDiv']/div[not(@id)]")
    $(".//td/span[contains(@class, 'NetscapeFix')]/..") {
      add_class("mw_input_td")
    }
    $(".//td") {
      $("./p[not(*)]") {
        text() {
          replace(/&nbsp/, "")
          replace(/^[\s\u00a0]+/, "")
          replace(/[\s\u00a0]+\|$/, "")
        }
      }
      wrap_text_children("span") {
        text() {
          replace(/^[\s\u00a0]+/, "")
          replace(/[\s\u00a0]+\|$/, "")
        }
      }
      remove("./br")
     }
  }
  $(".//input[contains(@name, 'OptionalCode')]") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_magazine")

  $(".//div[@id='main']") {
    add_class('mw_box2')
    $("./div[contains(@class,'s_borderless')]") {
      wrap_text_children("span")
      $("./span[contains(text(),'Have a great photo of an animal? ')]") {
        add_class("mw_h2")
      }
      $("./h3[not(*)] |./p[not(*)] |./span[not(*)] ") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
    }
    $("./div[@id='feature']/a[@class='back']") {
      wrap("div", class:"mw_back")
    }
    $(".//span[@data-ur-carousel-component='dots']") {
      wrap("div",class:"mw_dots")
    }  
    # HSUS-406
    $(".//div[contains(@id, 'aa_article')]/p[./span[contains(@class, 'dropcap')]]") {
      add_class("mw_first_p")
    }
  }

  $(".//div[@id='page']//h1") {
    add_class("mw_h1")
  }
  $(".//div[@id='page']//h2") {
    add_class("mw_h2")
  }
  $(".//div[@id='page']//h3") {
    add_class("mw_h3")
  }

  $(".//div[@id='feature']") {
    # Wrap the text node in a span so I can move it around
    wrap_text_children("span", class:"feature_desc")

    # add mw_bar1 to the links
    $(".//a[@class='more']") {
      add_class("mw_bar1")
    }
  }

  # images box

  
  $(".//div[@id='pubs']/ul/li") {
    add_class('mw_magazine_pub')

    $("./p[@class='date']") {
      wrap("div", class:"pub_float") {
        move_here("../h3")
      }
    }
  }

  $("./div[@id='wrapper']/div[@id='page']/div[@id='page-head']") {
    move_here("./ul[@id='site-nav']/li[contains(@class, 'expanded')]/ul", "top") {
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
        # ticket 168, removing any stray whitespace from the links
        $url_text = fetch("@href")
        $url_text {
          replace(/[\s]*$/, '')
        }
        attribute("href", $url_text)
      }
    }
    remove("./ul[@id='site-nav'] | ./h1 | ./div[contains(@id, 'item')]")
  }

  # Fix the iFrame youtube video
  $(".//iframe") {
    remove("./@width | ./@height")
  }

  # Assign a page to the story pagination
  $(".//blockquote/p") {
    add_class("mw_pagination")
  }

  # For the multi-page stories.. wanted to call out the farm descriptions
  # example: http://mlocal.humanesociety.org/news/magazines/2012/07-08/back_to_the_land_page_5.html

  $(".//p[strong]") {
    add_class("mw_photo_caption_callout")
  }

  $(".//div[@id='page-bottom-spacer']") {
    remove()
  }
  
  $(".//div[@id='side']") {
    remove("./div[not(@class) and not(@id)]")
    $("./div[@id='resources' or @id='magazine-promo'] or @id='resources-promo']") { // blue boxes
      $("./h2") {
        add_class("mw_h1")
      }
      $(".//li/a | .//p/a") {
        inject("  &raquo;  ")
      }
      remove("./a[./img]")
    }
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
    }
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar2")
    }
    $(".//div[@id='magazine-promo' or @id='resources-promo'] ") {
      add_class("mw_sidebar7")
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
    }
  }
  
  # HSUS-437
  $(".//div[@id='main']/div[contains(@class, 's_borderless')]//form[@class='checkboxes']/ul") {
    add_class("mw_checklist")
  }
}
/*
  Mappings

  Mappings are matchers that we use to determine if we should execute a
  bit of Tritium during an execution. Aka, run something when we are
  are on a certain page.

  Example starting code:
  */

# new addition March 14: to redirect a site to desktop, match its url
#                        log some useful message and then set variable
#                        $desktop_export to "true". -- SL

# $mw_analytics = ""

match($status) {

  with(/302/) {
    log("--> STATUS: 302") # redirect: just let it go through
  }

  with(/200/) {
    log("--> STATUS: 200")

    # HSUS-479
    remove("./body/div[a[contains(@href,'poweredby')]]")

    match($host) {
      with(/video\.humanesociety\.org/) {
        log("--> Videos subdomain in mappings.ts")

        match($path) {

          ###############
          # Video Pages #
          ###############
          log($path)

          with(/^\/$|^\/\?/) { 
            log("--> Matching video root in mappings.ts") #/
            $mw_analytics = "HSUS-video-root"

            @import "pages/video_slideshow/video_home.ts"
          }


          # fix for the animal fighting & cruelty
          # the title is too long and messes up the header for iPhones in portrait mode.
          with(/index\.php\?id\=PLE01490092359B5C3/) {
            log("--> Matching index.php fix for long category title in mappings.ts")
            $("./head") {
              insert("style", type:"text/css", ".mw_video_common #topNav .mw_header_menu_item.active .mw_header_menu_item_content{font-size: 11px;}")
            }
            @import "pages/video_slideshow/video_home.ts"
            $mw_analytics = "HSUS-video-root"
          }

          with(/index\.php/) {
            log("--> Matching index.php in mappings.ts")
            @import "pages/video_slideshow/video_home.ts"
            $mw_analytics = "HSUS-video-root"
          }

          with(/category/) {
            log("--> Matching /category in mappings.ts")
            @import "pages/video_slideshow/video_home.ts"
            $mw_analytics = "HSUS-video-root"
          }

          with(/press\/video\.php/) {
            log("--> Matching video press page in mappings.ts")
            @import "pages/video_slideshow/video_press_page.ts"
            $mw_analytics = "HSUS-video-press-page"
          }

          # Press login..
          with(/press\/users/) {
            log("--> Matching press/users in mappings.ts")
            @import "pages/video_slideshow/login.ts"
            $mw_analytics = "HSUS-video-press-login"
          }

          with(/press/) {
            log("--> Matching video press root in mappings.ts")
            @import "pages/video_slideshow/video_press_home.ts"
            $mw_analytics = "HSUS-video-press-root"
          }

          with(/video/) {
            log("--> Matching /video/ in mappings.ts")
            @import "pages/video_slideshow/video_home.ts"
            $mw_analytics = "HSUS-video-root"
          }
          
          with(/frames/) {
            log("--> Matching /video/ in mappings.ts")
            @import "pages/video_slideshow/animal_legacy_video.ts"
            $mw_analytics = "HSUS-animal-legacy-video"
          }
          
          # HSUS-309
          # http://video.humanesociety.org/assets/links/view.php?bctid=1113136319001
          with(/^\/assets\/links\/view\.php\?/i) {
            log("--> Matching /video/ in mappings.ts") #"
            @import "pages/video_slideshow/individual_video.ts"
          }
        }

      }

        ##############
        # Slideshows #
        ##############

        with(/slideshows\.humanesociety\.org/) {
          log("--> Slideshows subdomain in mappings.ts")
          match($path) {
            with(/^\/$|^\/\?/) { #/
              log("--> Matching slideshows root in mappings.ts")
              @import "pages/video_slideshow/slideshow_home.ts"
              $mw_analytics = "HSUS-slideshow-root"
            }

            with(/index\/gallery/) {
              log("--> Matching slideshows index/gallery in mappings.ts")
              @import "pages/video_slideshow/slideshow_home.ts"
              $mw_analytics = "HSUS-slideshow-gallery"
            }
          }
        }

      #############################################
      # secure.humanesociety.org - Donations, etc #
      #############################################

      with(/secure3\.convio\.net/) {
        match($path) {
          with(/humane\/admin\/Donation2Preview/i) {
            log("--> importing pages/donate/_site_donate.ts in mappings.ts")
            @import "pages/donate/_site_donate.ts"
            $mw_analytics = "HSUS-site-donation"
          }
        }
      }

      with(/secure\.humanesociety\.org/) {
        log("--> Secure subdomain in mappings.ts")
        @import "pages/work/convio.ts"

        match($path) {
          # Example:
          # https://mlocal.secure.humanesociety.org/site/Donation2?df_id=1452&1452.donation=form1&source=gac4ac
          with(/site\/Donation2\?df_id\=1452\&1452/) {
            log("HSLF donation form")
            @import "pages/donate/_hslf_donate.ts"
            $mw_analytics = "HSUS-site-donation"
          }
          
          # https://secure.humanesociety.org/site/Donation/2093707163
          with(/^\/site\/donation($|\/[\d]+)/i) {
            log("--> importing pages/donate/_donate_login.ts in mappings_tablet.ts")
            @import "pages/donate/_my_profile.ts"
          }
          with(/site\/donation/i) {
            log("--> importing pages/donate/_site_donate.ts in mappings.ts")
            @import "pages/donate/_site_donate.ts"
            $mw_analytics = "HSUS-site-donation"
          }

          #Example:
          # https://mlocal.secure.humanesociety.org/site/SSurvey?SURVEY_ID=2820&ACTION_REQUIRED=URI_ACTION_USER_REQUESTS

          with(/site\/SSurvey/) {
            log("--> importing pages/donate/_sign_up.ts in mappings.ts")
            @import "pages/donate/_sign_up.ts"
            $mw_analytics = "HSUS-site-survey"
          }

          # Humane alert page
          # https://secure.humanesociety.org/site/Advocacy?cmd=display&page=OnScreenThanks&id=5951
          with(/site\/Advocacy\?(pagename=homepage\&)?.*\&page=(onscreenthanks|actionalerttakenpage)/i) {
            log("--> importing pages/donate/_tellafriend.ts in mappings.ts")
            @import "pages/donate/_tellafriend.ts"
            $mw_analytics = "HSUS-site-advocacy"
          }

          # pledges in campaign section
          # this isn't really under work, it can moved later for convenience
          with(/site\/Advocacy/) {
            log("--> importing pages/work/pledge.ts and pages/work/convio.ts in mappings.ts")
            @import "pages/work/pledge.ts"
            # @import "pages/work/convio.ts"
            $mw_analytics = "HSUS-site-advocacy"
          }

          # meatless monday signup
          with(/\/site\/SPageServer\?pagename\=meatlessmondaysignup/) {
            log("--> Importing pledge form for meatless monday")
            @import "pages/donate/_sign_up.ts"
            $mw_analytics = "HSUS-site-advocacy"
          }
          with(/pagename\=meatless_monday_contest/) {
            log("--> Importing pledge form for meatless monday")
            @import "pages/donate/_sign_up.ts"
            $mw_analytics = "HSUS-site-advocacy"
          }

          # https://secure.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013
          # https://secure.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
          with(/\/site\/SPageServer\?.*pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
            log("--> importing pages/drtv/drtv_base.ts in mappings.ts")
            @import "pages/drtv/drtv_base.ts"
            match($path) {
              with(/thanks/) {
                log("--> importing pages/drtv/drtv_donation.ts in mappings.ts")
                @import "pages/drtv/drtv_thank.ts"
              }
              else() {
                log("--> importing pages/drtv/drtv_donation.ts in mappings.ts")
                @import "pages/drtv/drtv_donation.ts"
              }
            }
          }

          # https://secure.humanesociety.org/site/SPageServer?pagename=drtv_splashb_MSI
          with(/\/site\/SPageServer\?.*pagename\=drtv\_splashb\_MSI/) {
            log("--> importing pages/drtv/drtv_base.ts in mappings.ts")
            @import "pages/drtv/drtv_base.ts"
            log("--> importing pages/drtv/drtv_donation.ts in mappings.ts")
            @import "pages/drtv/drtv_splash.ts"
          }

          # send the DRTV pages to desktop for the time being 
          with(/\/site\/SPageServer\?pagename\=drtv\_/) {
            log("--> Sending DRTV form to desktop")
            # $desktop_export = "true"
            # remove("//meta[@name='viewport']")
          }

          # pets of valor award
          # https://secure.humanesociety.org/site/SPageNavigator/pets_of_valor_vote.html
          # https://secure.humanesociety.org/site/SPageServer?pagename=pets_of_valor_vote
          with(/\/site\/(SPageNavigator\/|SPageServer\?\w+=)pets\_of\_valor\_vote/) {
            log("--> importing pages/donate/valor_award.ts in mappings.ts")
            @import "pages/donate/valor_award.ts"
          }

          # Chimps landing page

          # HSUS-436
          # https://secure.humanesociety.org/site/SPageServer?pagename=chimp_art_contest
          with(/^\/site\/SPageServer\?pagename\=chimp_art_contest/) {
            log("Chimps art test page")
            # @import pages/news/article.ts
            @import pages/custom/chimp_art_mobile.ts
          }

          with(/thanks_chimpanzee_art_contest.html$/) {
            # @import base_tablet.ts
            # @import "pages/forms.ts"
          }

          with(/site\/SPageServer\?.?pagename\=st_francis_day_box/) {
            log("--> importing pages/donate/_st_francis_box.ts in mappings.ts")
            @import "pages/donate/_st_francis_box.ts"
          }

          with(/site\/SPageServer\?.?pagename\=virtual_town_hall/) {
            log("--> importing pages/donate/_virtual_town_hall_tablet.ts in mappings.ts")
            @import "pages/donate/_virtual_town_hall.ts"
          }

          #HSUS-463
          #https://secure.humanesociety.org/site/SPageServer?pagename=take_your_pet
          with(/site\/SPageServer\?.?pagename\=take_your_pet/) {
            log("--> importing pages/donate/_take_your_pet.ts in mappings.ts")
            @import "pages/donate/_take_your_pet.ts"
          }

          # REUS donation
          # https://secure.humanesociety.org/site/SPageServer?pagename=reus_hsus_donation_2013_ye_research_ppc_splash
          # https://secure.humanesociety.org/site/SPageNavigator/reus_hsus_donation_2013_ye_research_ppc_splash.html
          with(/\/site\/(SPageNavigator\/|SPageServer\?pagename=)reus_hsus_donation_2013/) {
            log("--> importing pages/donate/valor_award.ts in mappings.ts")
            @import "pages/custom/reus_hsus_donation_2013_mobile.ts"
          }
          
          # HSUS-497
          # https://secure.humanesociety.org/site/SPageServer?pagename=EP_ppc_splash_mwcopy
          # https://secure.humanesociety.org/site/SPageServer?pagename=reus_HSUS_donation_2013_ye_stella_ppc_splash
          with(/ppc_splash/) {
            log("--> importing pages/donate/_splash.ts in mappings.ts")
            @import "pages/donate/_splash.ts"
          }

          with(/^\/site\/(SPageNavigator\/(new_life_for_chimps|puppy_mill_pledge_action_takers)\.html|SPageServer\?(\w+=\w+)+)/) {
            log("--> importing pages/donate/_chimps.ts in mappings.ts")
            @import "pages/donate/_chimps.ts"
          }

          # https://secure.humanesociety.org/site/UserLogin
          # https://secure.humanesociety.org/site/UserLogin?CMD=ForgotLogin
          # https://secure.humanesociety.org/site/UserLogin?CMD=ForgotPassword
          with(/site\/UserLogin/) {
            log("--> importing pages/donate/_donate_login.ts in mappings_tablet.ts")
            @import "pages/donate/_donate_login.ts"
          }
          # profile home
          # https://secure.humanesociety.org/site/SPageNavigator/HSUS_my_profile.html
          with(/^\/site\/SPageNavigator\/HSUS_my_profile/) {
            log("--> importing pages/donate/_donate_login.ts in mappings_tablet.ts")
            @import "pages/donate/_my_profile.ts"
          }
          # edit profile
          # https://secure.humanesociety.org/site/ConsProfileUser
          # https://secure.humanesociety.org/site/ConsInterestsUser
          with(/^\/site\/(ConsProfileUser|ConsInterestsUser)/i) {
            log("--> importing pages/donate/edit_profile.ts in mappings_tablet.ts")
            @import "pages/donate/edit_profile.ts"
          }
          
          # You're Invited
          # https://secure.humanesociety.org/site/Ticketing?view=Tickets&id=109422&JServSessionIdr004=e4u8fmzzg5.app305b
          with(/\/site\/Ticketing/) {
            log("--> importing pages/donate/ticketing.ts in mappings.ts")
            @import "pages/donate/ticketing.ts"
          }

          # catchall
          else() {
            log("--> importing pages/donate/_hslf_donate.ts in mappings.ts")
            @import "pages/donate/_hslf_donate.ts"
            $mw_analytics = "HSUS-site-donation"
          }
        }
      }

      ##########################################
      # action.humanesociety.org - Issues, etc #
      ##########################################

      with(/action\.humanesociety\.org/) {
        log("--> Action subdomain in mappings.ts")

        match($path) {
          # ticket HSUS-375 [Mobile & Tablet] Sacramento events page
          # http://m.action.humanesociety.org/site/Calendar?id=109422&view=Detail&autologin=true
          with(/site\/Calendar\?id=109422+&view=Detail+&autologin=true/i) {
            log('--> Calendar Page')
            @import "pages/calendar/calendar_page.ts"
          }
          # calendar events
          with(/site\/Calendar(\/[\d]*)?\?(id=[\d]*\&)?view=Detail/) {
            log('--> importing pages/calendar/event.ts')
            @import "pages/calendar/event.ts"
            $mw_analytics = "HSUS-calendar"
          }
          
          # http://action.humanesociety.org/site/Calendar?view=Detail&id=109422
          with(/site\/Calendar\?view=Detail/) {
            log("--> importing pages/calendar/event.ts")
            @import "pages/calendar/event.ts"
          }
          
          # http://action.humanesociety.org/site/Calendar?id=110964&view=RSVP
          with(/site\/Calendar\?id=[\d]*\&view=RSVP/) {
            log("--> importing pages/calendar/day_list.ts")
            @import "pages/calendar/day_list.ts"
          }
          # http://action.humanesociety.org/site/Calendar?view=RSVP&id=111041
          with(/site\/Calendar\?view=RSVP&id=[\d]*/) {
            log("--> importing pages/calendar/day_list.ts")
            @import "pages/calendar/day_list.ts"
          }
          # Calendar stuff
          with(/site\/Calendar\/[\d]*\?view=MonthGrid\&Day/) {
            # $path {
            #   replace(/Grid/, "List")
            # }
            # export("Location", $path)
            log('--> importing calendar instead of redirecting to list')
            @import "pages/calendar/day_grid.ts"
            $mw_analytics = "HSUS-calendar-day-grid"
          }

          # For HSUS-484
          #New Calendar URL?
          # url: http://action.humanesociety.org/site/PageNavigator/hsus_calendar.html
          with(/^\/site\/PageNavigator\/hsus_calendar.html/) {
            @import "pages/calendar/day_grid.ts"
          }
          # End of HSUS-484

          # day, week grid redirect
          with(/site\/Calendar\/[\d]*\?view=(Day|Week)Grid\&Day/) {
            log('--> redirecting grid mode calendar to list mode')
            $path {
              replace(/Grid/, "List")
            }
            export("Location", $path)
          }          
          # day, week, month list
          with(/site\/Calendar\/[\d]*\?view=(Day|Month|Week)List\&Day/) {
            log('--> importing pages/calendar/day_list.ts')
            @import "pages/calendar/day_list.ts"
            $mw_analytics = "HSUS-calendar-day-list"
          }
          
          # clicked to query
          with(/site\/Calendar(\/[\d]*|$)/) {
            log('--> importing pages/calendar/day_list.ts')
            @import "pages/calendar/day_list.ts"
            $mw_analytics = "HSUS-calendar-day-list"
          }

          with(/MatchingGifts/) {
            log("--> importing pages/donate/_matchinggifts.ts in mappings.ts")
            @import "pages/donate/_matchinggifts.ts"
            $mw_analytics = "HSUS-donation-matchinggifts"
          }
          # Your Seafood Boycott Helps: Do You Know Why?
          with(/MessageViewer/) {
            log("--> importing pages/message_viewer.ts in mappings.ts")
            @import "pages/message_viewer.ts"
            $mw_analytics = "HSUS-messageviewer"
          }

          # https://action.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013
          # https://action.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
          with(/\/site\/PageServer\?.*pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
            log("--> importing pages/drtv/drtv_base.ts in mappings.ts")
            @import "pages/drtv/drtv_base.ts"
            match($path) {
              with(/thanks/) {
                log("--> importing pages/drtv/drtv_thank.ts in mappings.ts")
                @import "pages/drtv/drtv_thank.ts"
              }
              else() {
                log("--> importing pages/drtv/drtv_donation.ts in mappings.ts")
                @import "pages/drtv/drtv_donation.ts"
              }
            }
          }

          # https://action.humanesociety.org/site/SPageServer?pagename=drtv_splashb_MSI
          with(/\/site\/PageServer\?.*pagename\=drtv\_splashb\_MSI/) {
            log("--> importing pages/drtv/drtv_base.ts in mappings.ts")
            @import "pages/drtv/drtv_base.ts"
            log("--> importing pages/drtv/drtv_splash.ts in mappings.ts")
            @import "pages/drtv/drtv_splash.ts"
          }

          # http://action.humanesociety.org/site/PageServer?pagename=electedOfficials
          # http://action.humanesociety.org/site/PageServer?pagename=electedOfficials_federal
          with(/site\/PageServer\?.*pagename\=electedOfficials/i) {
            log("--> importing pages/work/action_elected.ts in mappings.ts")
            @import "pages/work/action_elected.ts"
          }

          # this isn't really under work, it can moved later for convenience
          # http://action.humanesociety.org/site/PageServer?pagename=humane_welcome_page&JServSessionIdr004=8w797fvbu1.app305b
          with(/site\/PageServer/) {
            log('--> importing pages/work/welcome.ts in mappings.ts')
            @import "pages/work/welcome.ts"
            $mw_analytics = "HSUS-calendar-day"
          }
          # HSUS-344
          # http://action.humanesociety.org/site/GigyaLogin
          with(/site\/GigyaLogin/) {
            log('--> importing pages/work/gigyalogin.ts in mappings.ts')
            @import "pages/work/gigyalogin.ts"
          }
          # End HSUS-344

          ## HSUS - 443
          # mconnect action forms
          # http://www.action.humanesociety.org/site/PageNavigator/mconnect.html
          with(/site\/PageNavigator\/mconnect/i) {
            log('--> found mconnect action form')
            @import "pages/work_tablet/action_form_mconnect.ts"
            $mw_analytics = "HSUS-mconnect-action-form-tablet"
          }
          ## HSUS - 443
          
          # ticket HSUS-275 Billy's Legacy
          # http://action.humanesociety.org/site/PageNavigator/hsus_yearend2012_humaneheroes.html?utm_source=vanitybillyslegacy&utm_medium=hsusweb&utm_campaign=billyslegacy13
          with(/site\/PageNavigator/) {
            # http://action.humanesociety.org/site/PageNavigator/chimpsdeservebetterscientistendorsementthankyou.html
            # for the submit success page
            with(/chimpsdeservebetterscientistendorsementthankyou/) {
              log("--> importing pages/video_slideshow/submit_success.ts in mappings.ts")
              @import "pages/video_slideshow/submit_success.ts"
              $mw_analytics = "HSUS-animal-legacy"
            }
            else() {
              log("--> importing pages/video_slideshow/animal_legacy.ts in mappings.ts")
              @import "pages/video_slideshow/animal_legacy.ts"
              $mw_analytics = "HSUS-animal-legacy"
            }
          }

          # ticket HSUS-278 Protect seals pledge
          # http://action.humanesociety.org/site/Survey?ACTION_REQUIRED=URI_ACTION_USER_REQUESTS&SURVEY_ID=8382
          with(/^\/site\/Survey\?ACTION_REQUIRED=[^&]+&SURVEY_ID=8382/i) {
            log('--> found action form')
            @import "pages/work/protect_seals_pledge.ts"
            $mw_analytics = "HSUS-survey-seals-pledge"
          }
          # ticket HSUS-367 Unmapped Survey Page
          # http://action.humanesociety.org/site/Survey?ACTION_REQUIRED=URI_ACTION_USER_REQUESTS&SURVEY_ID=6038
          with(/^\/site\/Survey/) {
            log('--> Importing pages/forms.ts in mappings.ts')
            @import "pages/forms.ts"
            $mw_analytics = "HSUS-contact-form"
          }
          
          # HSUS-401
          # Email Preferences
          # http://action.humanesociety.org/site/CO?i=ATIXJfiAhQUCE76ukI6rs0KVyAmeQ6Wd&cid=0
          # http://action.humanesociety.org/site/CO?i=tigud82sbXBijJ127B_G1gfcRFWydCrg&cid=0
          # HSUS-402
          # http://mlocal.action.humanesociety.org/site/CO?unsub_interests=0&first_name=&last_name=&primary_email=456%40fs.com&unsub=Unsubscribe&op.unsubFallback=
          with(/^\/site\/co\?(i=.*cid=0|unsub_interests.*)/i) {
            log("--> importing pages/email_preferences.ts in mappings.ts")
            @import "pages/email_preferences.ts"
          }
          # Fix for HSUS-485
          #http://mlocal.action.humanesociety.org/site/CO;jsessionid=74DC692F46524B250E378A67C46872FF.app338b?op.unsubscribe.confirm=
          with(/^\/site\/co\?op.*/i) {
            log("--> importing pages/email_preferences.ts in mappings.ts")
            @import "pages/email_preferences.ts"
          }
          # End of HSUS-485
        }
      }

      ##########
      # Legacy #
      ##########

      with(/legacy\.humanesociety\.org/) {
        match($path) {

          # Article page
          with(/^\/index(\.html|\.php)\?article/) {
            log("--> importing pages/legacy/legacy_article.ts in mappings.ts")
            @import "pages/legacy/legacy_article.ts"
            $mw_analytics = "HSUS-legacy-article"
          }

          # Other Article
          with(/^\/Article/) {
            log("--> importing pages/legacy/legacy_article.ts in mappings.ts")
            @import "pages/legacy/legacy_article.ts"
            $mw_analytics = "HSUS-legacy-article"
          }

          # Brochures
          # http://legacy.humanesociety.org/ebrochures.php?ebrochure=24
          with(/ebrochures\.php/) {
            log("--> importing pages/legacy/? in mappings.ts")
            @import "pages/legacy/legacy_article.ts"
            $mw_analytics = "HSUS-legacy-article"
          }

          # Root page
          # http://legacy.humanesociety.org/
          with(/^\/$|^\/\?|^\/index\.html|^\/index\.php/) {
            log("--> importing pages/legacy/legacy_root.ts in mappings.ts")
            @import "pages/legacy/legacy_root.ts"
            $mw_analytics = "HSUS-legacy-root"
          }

          # Contact page
          # http://legacy.humanesociety.org/contact.php
          with(/^\/contact/) {
            log("--> importing pages/legacy/legacy_contact.ts in mappings.ts")
            @import "pages/legacy/legacy_contact.ts"
            $mw_analytics = "HSUS-legacy-contact"
          }
        }
      }

      
      # Regular site
      else() {
        match($path) {

          with(/^\/$|^\/\?|^\/index\.html/) {
            log("--> Importing pages/home.ts in mappings.ts")
            @import "pages/home.ts"
            $mw_analytics = "HSUS-home"
          }
          with(/newsfeedtest|newsbrieftest2/) {
            log("--> Importing pages/home.ts in mappings.ts")
            @import "pages/home.ts"
          }
          
          # URL: humanesociety.org/header-b.html
          with(/ws\-test\-b\.html|^\/testing.*homepage/) {
            log("--> Alt Header. Importing pages/home.ts in mappings.ts")
            @import "pages/home.ts"
            $mw_analytics = "HSUS-home"
          }

          # testing/wstest-mar-29.html
          # test_homepage_with_moovweb
          with(/testing\/wstest\-mar\-29\.html/) { 
            log("--> Importing pages/home.ts in mappings.ts")
            @import "pages/home.ts"
            $mw_analytics = "HSUS-home"
          }
          
          # stock gifts
          # http://www.humanesociety.org/donate/plan/stock_gifts.html
          with(/^\/donate\/plan\/stock_gifts/) {
            log("--> importing pages/donate/_stock_gifts.ts in mappings.ts")
            @import "pages/donate/_stock_gifts.ts"
            $mw_analytics = "HSUS-stock-gifts"
          }
          
          # Moved this ahead of /index.html for the donate/index.html page
          with(/\/donate\//) {
            log('--> Matching donate in mappings.ts')
            @import "pages/donate/_donate_root.ts"
            $mw_analytics = "HSUS-donate-root"
          }

          
          ###############
          # Index Page  #
          ###############
          with(/^\/index\.html/) {
            log('--> Matching index page in mappings.ts')
            $mw_analytics = "HSUS-home"
            
          }

          ######################
          # Internal Resources #
          ######################

          # with(/^\/(tips|issues)/) {
          #   log('--> Matching Internal Resources in mappings.ts')
          # }

          # not done
          with(/^\/restaurant_locator/) {
            log('--> Importing pages/restaurant_form.ts')
            @import "pages/restaurant_form.ts"
            $mw_analytics = "HSUS-restaurant-form"
          }

          with(/^\/sitemap\.html/) {
            log('--> Importing pages/sitemap.ts in mappings.ts')
            @import "pages/sitemap.ts"
            $mw_analytics = "HSUS-sitemap"
          }

          with(/^\/privacy\.html/) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-privacy"
          }

          ########
          # News #
          ########

          # this needs to go before news because of how ruby matches regexes

          //previous version of the mapping below. why are we matching on a testpage here?
          # with(/(^\/testing\/)|(^\/news\/(press_releases|news)\/($|index\.jsp*))/) {
            with(/(^\/news\/(press_releases|news)\/($|index\.jsp*))/) {
            log('--> Importing pages/news/press.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
            $mw_analytics = "HSUS-press"
          }
          with(/^\/news\/resources\/facts\//) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/qa.ts"
            $mw_analytics = "HSUS-qa"
          }
          with(/^\/news\/(resources\/qa|interview|dispatch)\//) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/qa.ts"
            $mw_analytics = "HSUS-qa"
          }
          # with(/^\/news\/(interview\/|magazines\/[^\/]*interview)/) {
          #   log('--> importing interview.ts in mappings.ts')
          #   @import "pages/news/interview.ts"
          # }
          with(/^\/news\/(press_releases|news)\//) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-news-article"
          }
          with(/^\/news\/related_news\.html/) {
            log('--> importing pages/news/press.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
            $mw_analytics = "HSUS-press"
          }
          with(/^\/news\/workplace_giving/) {
            log('--> importing pages/news/press.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
            $mw_analytics = "HSUS-press"
          }

          with(/^\/news\/publications\/whitepapers/) {
            log('--> importing pages/news/whitepapers.ts in mappings.ts')
            # @import "pages/news/news_base.ts"
            @import "pages/news/whitepapers.ts"
            $mw_analytics = "HSUS-whitepaper"
          }
          with(/^\/news\/blog/) {
            log('--> Importing pages/news/news.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news_tablet/news_main.ts"  
            $mw_analytics = "HSUS-blog"
            # @import "pages/news/news.ts"
            $(".//div[@id='page-head']") {
              add_class("mw_hide")
            }
            $mw_analytics = "HSUS-blog"
          }

          with(/^\/news\/profile\/off-duty/) {
            log('--> importing pages/news_tablet/off_duty.ts in mappings_tablet.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/off_duty.ts"
            $mw_analytics = "HSUS-off-duty"
          }

          with(/^\/news\/news\_briefs/) {
            log("--> Importing pages/news/news_base.ts in mappings.ts")
            # @import "pages/news/news_base.ts"
            # @import "pages/news/news_briefs.ts"

            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
          }


          with(/^\/news\/($|\?|index\.html)/) {
            log('--> Importing pages/news/news.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/news.ts"
            $mw_analytics = "HSUS-news"
          }

          #############
          # Magazines #
          #############

          # Magazine root
          with(/^\/news\/magazines\/($|\?|index\.html)/) {
            log("--> Importing pages/magazine_root.ts in mappings.ts")
            @import "pages/magazine_root.ts"
            $mw_analytics = "HSUS-magazine-root"
          }

          # Exploring the magazine 

          with(/^\/news\/magazines\//) {
            log("--> Importing pages/magazine_root.ts in mappings.ts")
            @import "pages/magazine_root.ts"
            $mw_analytics = "HSUS-magazine-root"
          }

          ###########
          # ANIMALS #
          ###########

          with(/^\/animals\/($|\?|index\.html)/) {
            log('--> Importing pages/animals/animal_main.ts in mappings.ts')
            @import "pages/animals/animal_main.ts"
            $mw_analytics = "HSUS-animal-main"
          }
          with(/^\/animals\/(pets|wild_neighbors)\/($|\?|index\.html)/) {
            log('--> Importing pages/animals/pets.ts in mappings.ts')
            @import "pages/animals/pets.ts"
            $mw_analytics = "HSUS-animal-pets"
          }
          with(/^\/animals\/(pets|wild_neighbors)\/news\.html/) {
            log('--> Importing pages/animals/animal_news.ts in mappings.ts')
            # @import "pages/animals/animal_news.ts"
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          with(/^\/animals\/browse_animals/) {
            log('--> Importing pages/animals/a_to_z.ts in mappings.ts')
            @import "pages/animals/a_to_z.ts"
            $mw_analytics = "HSUS-animal-a-to-z"
          }
          with(/^\/animals\/animal_news/) {
            log('--> Importing pages/animals/animal_news.ts in mappings.ts')
            # @import "pages/animals/animal_news.ts"
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          with(/^\/animals\/(animal_)?resources/) {
            log('--> Importing pages/news/press.ts in mappings.ts')
            @import "pages/news/press.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          # cat-ccordion section
          # temp location
          with(/testing\/hsus_testing\/editorial\/cat-accordion\.html/) {
            log('--> importing cat_problem_solver.ts in mappings.ts - testing environment')
            @import "pages/animals/cat_problem_solver.ts"
            $mw_analytics = "HSUS-animal-cat"
          }
          # permanent location
          with(/animals\/cats\/cat_problem_solver/) {
            log('--> importing cat_problem_solver.ts in mappings.ts')
            @import "pages/animals/cat_problem_solver.ts"
            $mw_analytics = "HSUS-animal-cat"
          }
          with(/^\/animals\/[^\/.]*\/tips\/($|\?|index\.html)/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal-qa"
          }
          with(/^\/animals\/[^\/]*\/tips\/[^\/]*\.html/) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/article.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal"
          }
          with(/^\/animals\/.*\/($|\?|index\.html)/) {
            log('--> Importing pages/animals/pets.ts in mappings.ts')
            @import "pages/animals/pets.ts"
            $mw_analytics = "HSUS-animal-pets"
          }
          with(/^\/animals\//) {
            log('--> Importing article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-animal-article"
          }
          # Fix for HSUS-493
          # http://humanesociety.org/news/resources/tips/thanksgiving-pets-turkeys-cooking.html
          with(/tips\/thanksgiving-pets-turkeys-cooking\.html/i) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-thanks-qa"
          }
          # End of HSUS-493
          ###################
          # Work and Issues #
          ###################
          with(/^\/work\/($|\?|index\.html)/) {
            log('--> Importing pages/work/work_main.ts in mappings.ts')
            @import "pages/work/work_main.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          with(/^\/issues\/($|\?|index\.html)/) {
            log('--> Importing pages/work/issues.ts in mappings.ts')
            @import "pages/work/issues.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          # ACTION section's in here
          with(/^\/action\/($|\?|index\.html)/) {
            log('--> Importing pages/work/action_main.ts in mappings.ts')
            @import "pages/work/action_main.ts"
            $mw_analytics = "HSUS-work-action"
          }
          with(/^\/action\/(now|fed_bill|toolkit)\/($|\?|index\.(html|jsp))/) {
            log('--> Importing pages/work/action_now.ts in mappings.ts')
            @import "pages/work/action_now.ts"
            $mw_analytics = "HSUS-work-action-now"
          }
          with(/^\/action\/(now|fed_bill|toolkit)\//) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-work-action-article"
          }
          # href http://www.humanesociety.org/action/alerts/maryland/
          with(/^\/action\/alerts\/[.]*/) {
            log('--> Importing pages/work/action_alerts.ts in mappings.ts')
            @import "pages/work/action_alerts.ts"
            $mw_analytics = "HSUS-work-action-alert"
          }
          with(/^\/action\/55_actions_to_help_animals\.html/) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts" 
            $mw_analytics = "HSUS-work-action-article"
          }
          with(/^\/issues\/campaigns\/($|\?|index\.html)/) {
            log('--> Importing pages/work/campaign.ts in mappings.ts')
            @import "pages/work/campaign.ts"
            $mw_analytics = "HSUS-work-campaign"
          }
          # fact sheets
          with(/^\/issues\/puppy_mills\/facts\/($|\?|index\.html)/) {
            log('--> Importing pages/work/campaign_subject.ts in mappings.ts')
            @import "pages/work/campaign_subject.ts"
            $mw_analytics = "HSUS-work-campaign-subject"
          }

          # HSUS-437
          with(/^\/issues\/animal_rescue\/tips\/pet_disaster/) {
            @import "pages/news/press.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-work-fact-news"
          }
          # End HSUS-437

          with(/^\/(animals|issues|animal_community)\/(campaigns\/)?[^\/]*\/(facts|fact-sheets|tips)/) {
            log('--> Importing pages/fact_sheet.ts in mappings.ts')
            @import "pages/fact_sheet.ts"
            $mw_analytics = "HSUS-work-fact-sheet"
          }
          with(/^\/issues\/(campaigns\/)?[^\/]*\/news\.html/) {
            log('--> Importing pages/news/press.ts in mappings.ts')
            @import "pages/news/press.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-work-fact-news"
          }
          # faqs
          with(/^\/(issues|animals|animal_community)\/.*\/qa/) {
            log('--> Importing pages/work/qanda.ts in mappings.ts')
            @import "pages/work/qanda.ts"
            $mw_analytics = "HSUS-work-qa"
          }
          with(/^\/issues\/campaigns\//) {
            log('--> Importing pages/work/campaign_subject.ts in mappings.ts')
            @import "pages/work/campaign_subject.ts"
            $mw_analytics = "HSUS-work-campaign"
          }
          with(/^\/issues\/issue_resources/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          with(/^\/issues\/issue_news\.html/) {
            log('--> Importing pages/news/press.ts in mappings_tablet.ts')
            @import "pages/news/press.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-work-news"
          }
          # eating and recipes
          with(/^\/issues\/eating\/recipes\/(recipes\.html|index\.html)?/) { #/
            log('--> Importing pages/work/recipes_main.ts')
            @import "pages/work/recipes_main.ts"
            $mw_analytics = "HSUS-work-recipes"
          }
          # spay day
          with(/^\/issues\/spay_day/) {
            log('--> Importing pages/work/spay_day.ts')
            @import "pages/work/spay_day.ts" 
            $mw_analytics = "HSUS-work-spayday"
          }

          # seal splat page
          with(/^\/issues\/seal_hunt\/2013_hunt\/home\.html/) {
            log('--> Importing pages/work/seal_splat.ts')
            @import "pages/work/seal_splat.ts"
            $mw_analytics = "HSUS-seal-splat"
          }
          with(/^\/issues\/seal_hunt\/((protect_seals|index)\.html)?/) { #/
            log('--> Importing pages/work/seal_splat.ts')
            @import "pages/work/seal_splat.ts"
            $mw_analytics = "HSUS-seal-spalt"
          }

          with(/^\/issues\//) {
            log('--> Importing pages/work/issue_subject.ts')
            @import "pages/work/issue_subject.ts"
            $mw_analytics = "HSUS-work-issues"
          }

          # app section for seal stuff
          with(/^\/apps\/protectseals\//) {
            log('--> Importing pages/fact_sheet.ts in mappings.ts')
            @import "pages/fact_sheet.ts"
            $mw_analytics = "HSUS-work-seal"
          }

          #############
          # Community #
          #############

          with(/^\/animal_community\/($|\?|index\.html)/) {
            log('--> Importing pages/community/community_main.ts')
            @import "pages/community/community_main.ts"
            $mw_analytics = "HSUS-community"
          }
          # url: http://www.humanesociety.org/animal_community/shelters/wildlife_care_center/sign-up-for-email-from-sfwc.html
          with(/sign-up-for-email-from-sfwc/) {
            log("--> importing pages/donate/_sign_up.ts in mappings.ts")
            @import "pages/donate/_sign_up.ts"
            $mw_analytics = "HSUS-community-signup"
          }
          with(/^\/animal_community\/shelters\/direct_care_news/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-community-shelters"
          }          
          with(/^\/animal_community\/shelters\/.*($|index\.html)/) {
            log('--> Importing pages/community/care_centers.ts')
            @import "pages/community/care_centers.ts"
            $mw_analytics = "HSUS-community-shelters"
          }
          with(/^\/animal_community\/resources\/($|\?|index\.html)/) {
            log('--> Importing pages/community/resources.ts')
            @import "pages/community/resources.ts"
            $mw_analytics = "HSUS-community-resources"
          }
          with(/^\/animal_community\/resources\/rescue_groups/) {
            log('--> Importing pages/news/article.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-community-article"
          }
          with(/^\/parents_educators\/($|\?|index\.html)/) {
            log('--> Importing pages/community/parents.ts')
            @import "pages/community/parents.ts"
            $mw_analytics = "HSUS-community-parents-educators"
          }
          with(/^\/parents_educators\//) {
            log('--> Importing pages/news/article.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-community-parents-educators"
          }
          with(/^\/community\/volunteers\//) {
            log('--> Importing pages/community/volunteers.ts')
            @import "pages/community/volunteers.ts"
            $mw_analytics = "HSUS-community-volunteers"
          }
          with(/^\/community\/connect\.html/) {
            log('--> Importing pages/community/connect.ts in mappings.ts')
            @import "pages/community/connect.ts"
            $mw_analytics = "HSUS-community-connect"
          }
          with(/^\/animal_community\/hsvma\/hsvma_ravs\.html/) {
            log('--> Importing pages/community/parents.ts')
            @import "pages/community/parents.ts"
            $mw_analytics = "HSUS-community-hsvma"
          }

          #########
          # About #
          #########

          with(/^\/about\/($|\?|index\.html)/) {
            log('--> Importing pages/about/about_main.ts in mappings.ts')
            @import "pages/about/about_main.ts"
            $mw_analytics = "HSUS-about"
          }
          with(/^\/about\/overview\//) {
            log('--> Importing pages/about/overview.ts in mappings.ts')
            @import "pages/about/overview.ts"
            $mw_analytics = "HSUS-about-overview"
          }
          with(/^(\/about\/leadership\/)|(\/testing\/ellen-pascale\/experts\.html)/) { // for HSUS-519
            log('--> Importing pages/about/leadership.ts in mappings.ts')
            @import "pages/about/overview.ts"
            @import "pages/about/leadership.ts"
            $mw_analytics = "HSUS-about-leadership"
          }
          with(/^\/about\/contact\//) {
            log('--> found FAQ page in mappings.ts')
            @import "pages/about/about_main.ts"
            @import "pages/about/faq.ts"
            $mw_analytics = "HSUS-about-faq"
          }
          with(/^\/about\/podcast\//) {
            log('--> Redirecting podcast to desktop in mappings.ts')
            $desktop_export="true"
            $mw_analytics = "HSUS-about-podcast-desktop-export"
          }
          with(/^\/about\/events\/($|\?|index\.html)/) {
            log('--> found events page')
            @import "pages/about/about_main.ts"
            @import "pages/about/events.ts"
            $mw_analytics = "HSUS-about-events"
          }
          with(/^\/about\/events\//) {
            log('--> Importing pages/about/event_page.ts in mappings.ts')
            @import "pages/about/event_page.ts"
            $mw_analytics = "HSUS-about-events"
          }
          with(/^\/about\/state\/($|\?|index\.html)/) {
            log('--> found main state page')
            @import "pages/about/about_main.ts"
            @import "pages/about/state_news.ts"
            $mw_analytics = "HSUS-about-state"
          }
          with(/^\/about\/state\/(humane_state_ranking|humane-state-ranking)/) {
            log('--> found state rank map')
            @import "pages/about/state_ranking.ts"
            $mw_analytics = "HSUS-about-state"
          }
          with(/^\/about\/state\//) {
            log('--> found state page')
            @import "pages/about/state_page.ts"
            $mw_analytics = "HSUS-about-state"
          }
          with(/^\/about\/departments\/($|\?|index\.html)/) {
            log('--> Importing pages/about/dept_main.ts in mappings.ts')
            @import "pages/about/dept_main.ts"
            $mw_analytics = "HSUS-about-departments"
          }

          # Faith department
          with(/^\/about\/departments\/faith\/($|\?|index\.html|facts\/statements|resources\.html)/) {
            log('--> Importing pages/about/faith_base.ts in mappings.ts')
            @import "pages/about/faith_base.ts"
            $mw_analytics = "HSUS-faith"
          }
          with(/^\/about\/departments\/faith\/animal_ministry_guide\/($|index\.html|food|wildlife|pet_resources)/) {
            log('--> Importing pages/about/faith_base.ts in mappings.ts')
            @import "pages/about/faith_base.ts"
            $mw_analytics = "HSUS-faith"
          }
          with(/^\/about\/departments\/faith\/(.*)?(order|register|share|fill-the-bowl)/) {
            log('--> Importing pages/about/faith_form.ts in mappings.ts')
            @import "pages/about/faith_form.ts"
            $mw_analytics = "HSUS-faith-form"
          }
          with(/^\/about\/departments\/faith\/related_news/) {
            log('--> Importing pages/news/press.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
            $mw_analytics = "HSUS-faith-news"
          }
          with(/^\/about\/departments\/faith\//) {
            log('--> Importing pages/about/faith_article.ts in mappings.ts')
            @import "pages/about/faith_base.ts"
            $mw_analytics = "HSUS-faith"
          }
          # end faith section

          with(/^\/about\/departments\/state_affairs\/State_Directors/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/qa.ts"
            $mw_analytics = "HSUS-about-departments-qa"
          }
          with(/^\/about\/departments\/([^\/]*\/($|\?|)|[^\/]*\.html)/) {
            log('--> Importing pages/about/departments.ts')
            @import "pages/about/departments.ts"
            $mw_analytics = "HSUS-about-departments"
          }
          with(/^\/about\/employment/) {
            log('--> importing pages/about/employ.ts in mappings.ts')
            @import "pages/about/employ.ts"
            @import "pages/about/about_base.ts"
            $mw_analytics = "HSUS-about-employment"
          }
          with(/^\/about\/podcast/) {
            log('--> sending podcast to desktop in amppings.ts')
            $desktop_export = "true"
            $mw_analytics = "HSUS-about-podcast-desktop-export"
          }
          with(/^\/about\//) {
            log('--> Importing pages/about/about_base.ts in mappings.ts')
            @import "pages/about/about_base.ts"
            $mw_analytics = "HSUS-about"
          }

          #############
          # Map Pages #
          #############
          with(/assets\/maps\/feral-cat-groups/) {
            log("--> Importing pages/maplist.ts in mappings.ts")
            @import "pages/maplist.ts"
            $mw_analytics = "HSUS-map-list"
          }
          with(/assets\/maps\/volunteer_opportunities/) {
            log("--> Importing pages/maps.ts in mappings.ts")
            @import "pages/maps.ts"
            $mw_analytics = "HSUS-map"
          }
          with(/assets\/maps\/affording\-your\-pet/) {
            log("--> Importing pages/maplist.ts in mappings.ts")
            @import "pages/maplist.ts"
            $mw_analytics = "HSUS-map-list"
          }

          with(/^\/assets\/maps\/.+\?/) { #/
            log("--> might be a list")
            log("--> Importing pages/maplist.ts in mappings.ts")
            @import "pages/maplist.ts"
            $mw_analytics = "HSUS-maps"
          }

          with(/^\/assets\/maps/) {
            log("--> Importing pages/maps.ts in mappings.ts")
            @import "pages/maps.ts"
            $mw_analytics = "HSUS-maps"
          }



          ##################
          # Search Results #
          ##################

          with(/^\/search\/(tweaked-)?search/) {
            log('--> Importing pages/search_results.ts in mappings.ts')
            @import "pages/search_results.ts"
            $mw_analytics = "HSUS-search"
          }
          with(/^\/search\.jsp/) {
            log('--> Importing pages/search_results.ts in mappings.ts')
            @import "pages/search_results.ts"
            $mw_analytics = "HSUS-search"
          }

          with(/^\/testing\/search\-test\.html/) {
            log('--> Importing pages/search_results.ts in mappings.ts')
            @import "pages/search_results.ts"
            $mw_analytics = "HSUS-search"
          }
          #################
          # Contact Forms #
          #################

          with(/forms/) {
            log('--> Importing pages/forms.ts in mappings.ts')
            @import "pages/forms.ts"
            $mw_analytics = "HSUS-contact-form"
          }

          ###########
          # TESTING #
          ###########

          # HSUS-242 windowshade example page
          with(/^\/testing\/hsus_testing\/editorial\/getting_ticks_off_dog\.html/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
          }
          # End HSUS-242 windowshade example page

          # HSUS-406 this entry only use for temp address and we can delete if the page is online
          with(/^\/testing\/hsus_testing\//) {
            log("--> Importing pages/magazine_root.ts in mappings.ts")
            @import "pages/magazine_root.ts"
            $mw_analytics = "HSUS-magazine-root"
          }
          # http://www.humanesociety.org/testing/pet_of_the_week_submission.html
          with(/^\/testing\/pet_of_the_week_submission\.html/) {
            @import "pages/forms.ts"
            $mw_analytics = "HSUS-contact-form"
          }
          # HSUS-406 end

          # HSUS-436
          # https://secure.humanesociety.org/site/SPageServer?pagename=chimp_art_contest
          with(/PageBuilderPreviewPage|^\/site\/SPageServer\?pagename\=chimp_art_contest/) {
            log("Chimps art test page")
            # @import pages/news/article.ts
            @import pages/custom/chimp_art_mobile.ts
          }

          with(/thanks_chimpanzee_art_contest.html$/) {
            # @import base_tablet.ts
            @import "pages/forms.ts"
          }


          # HSUS-436 End

          # HSUS-506 http://mlocal.humanesociety.org/testing/chris_keane/footer/test-footer-revisions.html
          with(/test-footer-revisions/) {
            log('--> footer revisions testpage')
            @import "pages/home.ts"
          }

          #########
          # Shop #
          #######

          with(/^\/shop/) {
            log("--> importing pages/shopping.ts mappings.ts")
            @import "pages/shop.ts"
            $mw_analytics = "HSUS-shop"
          }

          match($desktop_export, "true") {
            log("--> No page match in mappings.ts")
            @import desktop_redirect.ts
          }
          
          # HSUS-344
          # http://humanesociety.org/testing/cd-test2.html
          with(/^\/testing\/cd-test2\.html/) {
            log('--> Importing pages/animals/animal_main.ts in mappings.ts')
            @import "pages/animals/animal_main.ts"
            $mw_analytics = "HSUS-animal-main"
          }
          # end of HSUS-344
          with(/flickr/) {
            @import "pages/flickr.ts"
          }
          
          else() {
            match($desktop_export, "true") {
              log("--> No page match in mappings.ts")
              @import desktop_redirect.ts
            }
            log("--> No page match in mappings.ts")
            log("--> Doing a basic page mapping for CMS")
            $(".//body") {
              match($host) {
                with(/mstage|mlocal/) {
                  $("./div[@id='wrapper']") {
                    insert_top("div", style:"margin: 10px; padding: 10px; background-color: white; color: red;", "This page does not have an associated mapping for transformation. File it as a ticket for Moovweb")
                  }
                }
              }
              add_class("mw_no_match_basic")
              $(".//div[@id='main']") {
                add_class("mw_box2")
              }
            }
          }
        }
      }

      # match($path) {
      #   with(/(\?|\&)moov\=rainbows/) {
      #     $('./head') {
      #       log("MAKIN IT RAIN-BOW!")
      #       insert_bottom("style", type:"text/css", "#wrapper::before{ content:''; width:90%; height: 100%; position: fixed; bottom: -50%; left: 5%; display: block; box-shadow: 0px 0px 0px 3px red, 0px 0px 0px 6px orange, 0px 0px 0px 9px yellow, 0px 0px 0px 12px green, 0px 0px 0px 15px blue, 0px 0px 0px 18px purple; -webkit-border-radius: 100%; z-index: 999;}") 
      #     }
      #   }

      #   with(/(\?|\&)moov\=3d/) {
      #     $('./head') {
      #       log("MAKIN IT 3D!")
      #       insert_bottom("style", type:"text/css", "*{ box-shadow: 1px 1px 0px 1px red, 2px 2px 0px 1px orange, 3px 3px 0px 1px yellow, 4px 4px 0px 1px green, 5px 5px 0px 1px blue, 6px 6px 0px 1px violet, 7px 7px 0px 1px purple; }") 
      #     }
      #   }
      # }
    }
  }

  # search results are a 304?
  with(/304/) {
    log("--> STATUS: 304")
    match($path) {
      with(/search\/search/) {
        log('--> Importing pages/search_results.ts in mappings.ts')
        @import "pages/search_results.ts"
      }
    }
  }

  # 404 page?
  # http://mlocal.humanesociety.org/news/resources.html
  with(/404/) {
    log("--> STATUS: 404")
    @import "pages/page_not_found.ts"
  }

  else() {
    # not 200 or 302 response status
    log("--> STATUS: " + $status + " assuming its an error code pages/error.ts")
    @import "pages/error.ts"
  }

}

/*
  Mappings

  Mappings are matchers that we use to determine if we should execute a
  bit of Tritium during an execution. Aka, run something when we are
  are on a certain page.

  Example starting code:
  */

# new addition March 14: to redirect a site to desktop, match its url
#                        log some useful message and then set variable
#                        $desktop_export to "true". -- SL

match($path, /site\/Advocacy\?cmd\=display/) {;
  $status = "200"
}
match($status) {

  with(/302/) {
    log("--> STATUS: 302") # redirect: just let it go through
  }
  with(/200/) {
    log("--> STATUS: 200")
    match($host) {
      with(/video\.humanesociety\.org/) {
        log("--> Videos subdomain in mappings_tablet.ts")

        match($path) {

          ###############
          # Video Pages #
          ###############
          log($path)

          with(/^\/$|^\/\?/) { #/
            log("--> Matching video root in mappings_tablet.ts")
            $mw_analytics = "HSUS-video-root-tablet"

            @import "pages/video_slideshow/video_home_tablet.ts"
          }


          # fix for the animal fighting & cruelty
          # the title is too long and messes up the header for iPhones in portrait mode.
          # with(/index\.php\?id\=PLE01490092359B5C3/) {
          #   log("--> Matching index.php fix for long category title in mappings_tablet.ts")
          #   $("./head") {
          #     insert("style", type:"text/css", ".mw_video_common #topNav .mw_header_menu_item.active .mw_header_menu_item_content{font-size: 11px;}")
          #   }
          #   @import "pages/video_slideshow/video_home_tablet.ts"
          # }

          with(/index\.php/) {
            log("--> Matching index.php in mappings_tablet.ts")
            @import "pages/video_slideshow/video_home_tablet.ts"
            $mw_analytics = "HSUS-video-root-tablet"
          }

          with(/category/) {
            log("--> Matching /category in mappings_tablet.ts")
            @import "pages/video_slideshow/video_home_tablet.ts"
            $mw_analytics = "HSUS-video-root-tablet"
          }

          with(/press\/video\.php/) {
            log("--> Matching video press page in mappings_tablet.ts")
            @import "pages/video_slideshow/video_press_page_tablet.ts"
            $mw_analytics = "HSUS-video-press-page-tablet"
          }

          # Press login..
          with(/press\/users/) {
            log("--> Matching press/users in mappings_tablet.ts")
            @import "pages/video_slideshow/login_tablet.ts"
            $mw_analytics = "HSUS-video-press-login-tablet"
          }

          with(/press/) {
            log("--> Matching video press root in mappings_tablet.ts")
            @import "pages/video_slideshow/video_press_home_tablet.ts"
            $mw_analytics = "HSUS-video-root-tablet"
          }

          with(/video/) {
            log("--> Matching /video/ in mappings_tablet.ts")
            @import "pages/video_slideshow/video_home_tablet.ts"
            $mw_analytics = "HSUS-animal-legacy-video-tablet"
          }
          
          # HSUS-309
          # http://video.humanesociety.org/assets/links/view.php?bctid=1113136319001
          with(/^\/assets\/links\/view\.php\?/i) { #/
            log("--> Matching /video/ in mappings.ts")
            @import "pages/video_slideshow/individual_video.ts"
          }
        }

      }

        ##############
        # Slideshows #
        ##############

        with(/slideshows\.humanesociety\.org/) {
          log("--> Slideshows subdomain in mappings_tablet.ts")
          match($path) {
            with(/^\/$|^\/\?/) { #/
              log("--> Matching slideshows root in mappings_tablet.ts")
              @import "pages/video_slideshow/slideshow_home_tablet.ts"
              $mw_analytics = "HSUS-slideshow-root-tablet"

            }

            with(/index\/gallery/) {
              log("--> Matching slideshows index/gallery in mappings_tablet.ts")
              @import "pages/video_slideshow/slideshow_home_tablet.ts"
              $mw_analytics = "HSUS-slideshow-gallery-tablet"
            }
          }
        }

      #############################################
      # secure.humanesociety.org - Donations, etc #
      #############################################

      # Test Convio mapping
      with(/secure3\.convio\.net/) {
        match($path) {
          with(/humane\/admin\/Donation2Preview/i) {
            log("--> importing pages/donate/_site_donate.ts in mappings.ts")
            @import "pages/donate/_site_donate_tablet.ts"
            $mw_analytics = "HSUS-site-donation"
          }
        }
      }

      with(/secure\.humanesociety\.org/) {

        log("--> Secure subdomain in mappings_tablet.ts")
        @import "pages/work_tablet/convio_tablet.ts"
        match($path) {

          # Example:
          # https://mlocal.secure.humanesociety.org/site/Donation2?df_id=1452&1452.donation=form1&source=gac4ac
          with(/site\/Donation2\?df_id\=1452\&1452/) {
            log("HSLF donation form")
            @import "pages/donate/_hslf_donate_tablet.ts"
            $mw_analytics = "HSUS-site-donation-tablet"
          }
          
          # https://secure.humanesociety.org/site/Donation/2093707163
          with(/^\/site\/donation($|\/[\d]+)/i) {
            log("--> importing pages/donate/_my_profile_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_my_profile_tablet.ts"
          }
          with(/site\/donation/i) {
            log("--> importing pages/donate/_site_donate_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_site_donate_tablet.ts"
            $mw_analytics = "HSUS-site-donation-tablet"
          }

          #Example:
          # https://mlocal.secure.humanesociety.org/site/SSurvey?SURVEY_ID=2820&ACTION_REQUIRED=URI_ACTION_USER_REQUESTS


          with(/site\/SSurvey/) {
            log("--> importing pages/donate/_sign_up.ts in mappings_tablet.ts")
            @import "pages/donate/_sign_up_tablet.ts"
            $mw_analytics = "HSUS-site-survey-tablet"
          }

          # Humane alert page
          # https://secure.humanesociety.org/site/Advocacy?cmd=display&page=OnScreenThanks&id=5951
          with(/site\/Advocacy\?(pagename=homepage\&)?.*\&page=(onscreenthanks|actionalerttakenpage)/i) {
            # Formerly:
            # /site\/Advocacy\?(pagename=homepage\&)?cmd=display\&page=(onscreenthanks|actionalerttakenpage)/i
            log("--> importing pages/donate/_humane_tablet.ts in mappings.ts")
            @import "pages/donate/_tellafriend_tablet.ts"
            $mw_analytics = "HSUS-site-advocacy-tablet"
          }

          # pledges in campaign section
          # this isn't really under work, it can moved later for convenience
          with(/site\/Advocacy/) {
            log("--> importing pages/work/pledge_tablet.ts and pages/work_tablet/convio.ts in mappings_tablet.ts")
            @import "pages/work_tablet/pledge_tablet.ts"
            # @import "pages/work_tablet/convio_tablet.ts"
            $mw_analytics = "HSUS-site-advocacy-tablet"
          }

          # meatless monday signup
          with(/\/site\/SPageServer\?pagename\=meatlessmondaysignup/) {
            log("--> Importing pledge form for meatless monday")
            @import "pages/donate/_sign_up_tablet.ts"
            $mw_analytics = "HSUS-site-advocacy-tablet"
          }
          with(/pagename\=meatless_monday_contest/) {
            log("--> Importing pledge form for meatless monday")
            @import "pages/donate/_sign_up_tablet.ts"
            $mw_analytics = "HSUS-site-advocacy-tablet"
          }

          # https://secure.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013
          # https://secure.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
          with(/\/site\/SPageServer\?.*pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
            log("--> importing pages/drtv_tablet/drtv_base.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_base.ts"
            match($path) {
              with(/thanks/) {
                log("--> importing pages/drtv_tablet/drtv_thank.ts in mappings_tablet.ts")
                @import "pages/drtv_tablet/drtv_thank.ts"
              }
              else() {
                log("--> importing pages/drtv_tablet/drtv_donation.ts in mappings_tablet.ts")
                @import "pages/drtv_tablet/drtv_donation.ts"
              }
            }
          }

          # https://secure.humanesociety.org/site/SPageServer?pagename=drtv_splashb_MSI
          with(/\/site\/SPageServer\?.*pagename\=drtv\_splashb\_MSI/) {
            log("--> importing pages/drtv_tablet/drtv_base.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_base.ts"
            log("--> importing pages/drtv_tablet/drtv_splash.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_splash.ts"
          }

          # send the DRTV pages to desktop for the time being 
          with(/\/site\/SPageServer\?pagename\=drtv\_/) {
            log("--> Sending DRTV form to desktop")
            # $desktop_export = "true"
            # remove("//meta[@name='viewport']")
          }

          # pets of valor award
          # https://secure.humanesociety.org/site/SPageNavigator/pets_of_valor_vote.html
          # https://secure.humanesociety.org/site/SPageServer?pagename=pets_of_valor_vote
          with(/\/site\/(SPageNavigator\/|SPageServer\?\w+=)pets\_of\_valor\_vote/) {
            log("--> importing pages/donate/valor_award_tablet.ts in mappings.ts")
            @import "pages/donate/valor_award_tablet.ts"
          }

          # REUS donation
          # https://secure.humanesociety.org/site/SPageServerpagename=reus_hsus_donation_2013_ye_research_ppc_splash
          # https://secure.humanesociety.org/site/SPageNavigator/reus_hsus_donation_2013_ye_research_ppc_splash.html
          with(/\/site\/(SPageNavigator\/|SPageServer\?pagename=)reus_hsus_donation_2013/) {
            log("--> importing pages/donate/valor_award.ts in mappings_tablet.ts")
            @import "pages/custom/reus_hsus_donation_2013_tablet.ts"
          }

          # Chimps landing page
          with(/site\/SPageServer\?pagename\=chimp_art_contest/) {
            log("Chimps art test page")
            @import pages/custom/chimp_art_tablet.ts
          }

          with(/thanks_chimpanzee_art_contest.html$/) {
            # @import base_tablet.ts
            # @import pages/news_tablet/forms_tablet.ts
          }
          
          with(/site\/SPageServer\?.?pagename\=st_francis_day_box/) {
            log("--> importing pages/donate/_st_francis_box_tablet.ts in mappgins_tablet.ts")
            @import "pages/donate/_st_francis_box_tablet.ts"
          }
          
          with(/site\/SPageServer\?.?pagename\=virtual_town_hall/) {
            log("--> importing pages/donate/_virtual_town_hall_tablet.ts in mappgins_tablet.ts")
            @import "pages/donate/_virtual_town_hall_tablet.ts"
          }          

          #HSUS-463
          #https://secure.humanesociety.org/site/SPageServer?pagename=take_your_pet
          with(/site\/SPageServer\?.?pagename\=take_your_pet/) {
            log("--> importing pages/donate/_take_your_pet_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_take_your_pet_tablet.ts"
          }

          # HSUS-497
          # https://secure.humanesociety.org/site/SPageServer?pagename=EP_ppc_splash_mwcopy
          # https://secure.humanesociety.org/site/SPageServer?pagename=reus_HSUS_donation_2013_ye_stella_ppc_splash
          with(/ppc_splash/) {
            log("--> importing pages/donate/_splash.ts in mappings.ts")
            @import "pages/donate/_splash.ts"
          }

          with(/^\/site\/(SPageNavigator\/(new_life_for_chimps|puppy_mill_pledge_action_takers)\.html|SPageServer\?(\w+=\w+)+)/) {
            log("--> importing pages/work/pledge.ts in mappings_tablet.ts")
            @import "pages/donate/_chimps_tablet.ts"
          }
          # https://secure.humanesociety.org/site/UserLogin
          # https://secure.humanesociety.org/site/UserLogin?CMD=ForgotLogin
          # https://secure.humanesociety.org/site/UserLogin?CMD=ForgotPassword
          with(/site\/UserLogin/) {
            log("--> importing pages/donate/_donate_login_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_donate_login_tablet.ts"
          }
          # profile home
          # https://secure.humanesociety.org/site/SPageNavigator/HSUS_my_profile.html
          with(/^\/site\/SPageNavigator\/HSUS_my_profile/) {
            log("--> importing pages/donate/_my_profile_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_my_profile_tablet.ts"
          }
          # edit profile
          # https://secure.humanesociety.org/site/ConsProfileUser
          # https://secure.humanesociety.org/site/ConsInterestsUser
          with(/\/site\/(ConsProfileUser|ConsInterestsUser)/i) {
            log("--> importing pages/donate/edit_profile_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/edit_profile_table.ts"
          }
          
          # You're Invited
          # https://secure.humanesociety.org/site/Ticketing?view=Tickets&id=109422&JServSessionIdr004=e4u8fmzzg5.app305b
          with(/\/site\/Ticketing/) {
            log("--> importing pages/donate/ticketing_tablet.ts in mappings.ts")
            @import "pages/donate/ticketing_tablet.ts"
          }

          # catchall
          else() {
            log("--> importing pages/donate/_hslf_donate_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_hslf_donate_tablet.ts"
            $mw_analytics = "HSUS-site-donation-tablet"
          }
        }
      }

      #################
      # ACTION / WORK #
      #################

      with(/action\.humanesociety\.org/) {
        log("--> Action subdomain in mappings_tablet.ts")

        match($path) {
          # ticket HSUS-375 [Mobile & Tablet] Sacramento events page
          # http://m.action.humanesociety.org/site/Calendar?id=109422&view=Detail&autologin=true
          with(/site\/Calendar\?id=109422+&view=Detail+&autologin=true/i) {
            log('--> Calendar Page')
            @import "pages/calendar_tablet/calendar_page.ts"
          }
          # http://action.humanesociety.org/site/Calendar?id=111041&view=RSVP
          with(/site\/Calendar\?id=[\d]*\&view=RSVP/) {
           log("--> importing pages/calendar_tablet/day_grid.ts")
           @import "pages/calendar_tablet/day_grid.ts"
         }
          # http://action.humanesociety.org/site/Calendar*?view=RSVP&id=111041
          with(/site\/Calendar\?view=RSVP&id=[\d]*/) {
           log("--> importing pages/calendar_tablet/day_grid.ts")
           @import "pages/calendar_tablet/day_grid.ts"
         }
          # calendar events
          with(/site\/Calendar\/[\d]*\?view=Detail/) {
            log('--> importing pages/calendar_tablet/event.ts')
            # @import "pages/about_tablet/events_tablet.ts"
            @import "pages/calendar_tablet/event.ts"
            $mw_analytics = "HSUS-calendar-tablet"
          }
          # Fix for HSUS-481
          with(/site\/Calendar\?id/i) {
            log('--> importing pages/calendar_tablet/event.ts')
            # @import "pages/about_tablet/events_tablet.ts"
            @import "pages/calendar_tablet/event.ts"
          }
          # Fix for HSUS-481

          # http://action.humanesociety.org/site/Calendar?view=Detail&id=109422
          with(/site\/Calendar\?view=Detail/) {
            log("--> importing pages/calendar_tablet/event.ts")
            @import "pages/calendar_tablet/event.ts"
          }
          
          # Calendar stuff is handled differently to mobile
          with(/site\/Calendar\/[\d]*\?view=MonthGrid\&Day/) {
            # $path {
            #   replace(/Grid/, "List")
            # }
            # export("Location", $path)
            log('--> importing calendar instead of redirecting to list')
            @import "pages/calendar_tablet/day_grid.ts"
            $mw_analytics = "HSUS-calendar-day-grid-tablet"
          }
          # day, week grid redirect
          # with(/site\/Calendar\/[\d]*\?view=(Day|Week)Grid\&Day/) {
          #   log('--> redirecting grid mode calendar to list mode')
          #   $path {
          #     replace(/Grid/, "List")
          #   }
          #   export("Location", $path)
          # }          
          # day, week, month list
          with(/site\/Calendar\/[\d]*\?view=(Day|Month|Week)List\&Day/) {
            log('--> importing pages/calendar_tablet/day_list.ts')
            @import "pages/calendar_tablet/day_list.ts"
            $mw_analytics = "HSUS-calendar-day-list-tablet"
          }
          # # clicked to query or sign up page
          with(/site\/Calendar(\/[\d]*|$)/) {
            log('--> importing pages/calendar_tablet/day_grid.ts')
            @import "pages/calendar_tablet/day_grid.ts"
            $mw_analytics = "HSUS-calendar-day-list-tablet"
          }

          # https://action.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013
          # https://action.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
          with(/\/site\/PageServer\?.*pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
            log("--> importing pages/drtv_tablet/drtv_base.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_base.ts"
            match($path) {
              with(/thanks/) {
                log("--> importing pages/drtv_tablet/drtv_thank.ts in mappings_tablet.ts")
                @import "pages/drtv_tablet/drtv_thank.ts"
              }
              else() {
                log("--> importing pages/drtv_tablet/drtv_donation.ts in mappings_tablet.ts")
                @import "pages/drtv_tablet/drtv_donation.ts"
              }
            }
          }

          # https://action.humanesociety.org/site/SPageServer?pagename=drtv_splashb_MSI
          with(/\/site\/PageServer\?.*pagename\=drtv\_splashb\_MSI/) {
            log("--> importing pages/drtv_tablet/drtv_base.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_base.ts"
            log("--> importing pages/drtv_tablet/drtv_splash.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_splash.ts"
          }

          # with(/MatchingGifts/) {
          #   log("--> importing pages/donate/_matchinggifts.ts in mappings_tablet.ts")
          #   # @import "pages/donate/_matchinggifts.ts"
          # }
          # this isn't really under work, it can moved later for convenience
          # http://action.humanesociety.org/site/PageServer?pagename=humane_welcome_page&JServSessionIdr004=8w797fvbu1.app305b
            # with(/site\/PageServer\?pagename=humane_welcome_page/) {
            #   log('--> importing pages/work_tablet/welcome.ts in mappings_tablet.ts')
            #   @import "pages/work_tablet/welcome.ts"
            # }
          # HSUS-311 Protect seals pledge
          # http://action.humanesociety.org/site/Survey?ACTION_REQUIRED=URI_ACTION_USER_REQUESTS&SURVEY_ID=8382
          with(/^\/site\/Survey\?ACTION_REQUIRED=[^&]+&SURVEY_ID=8382/i) {
            log('--> importing pages/work_tablet/protect_seals_pledge_tablet.ts in mappings_tablet.ts')
            @import "pages/work_tablet/protect_seals_pledge_tablet.ts"
            $mw_analytics = "HSUS-survey-seals-pledge-tablet"
          }
          
          ## HSUS - 443
          # mconnect action forms
          # http://www.action.humanesociety.org/site/PageNavigator/mconnect.html
          with(/site\/PageNavigator\/mconnect/i) {
            log('--> found mconnect action form')
            @import "pages/work_tablet/action_form_mconnect.ts"
            $mw_analytics = "HSUS-mconnect-action-form-tablet"
          }
          ## HSUS - 443

          # For HSUS-484
          # url: http://action.humanesociety.org/site/PageNavigator/hsus_calendar.html.
          with(/\/PageNavigator\/hsus_calendar\.html/) {
            @import "pages/calendar_tablet/day_grid.ts"
          }
          # End of HSUS-484

          # action forms
          with(/site\/(PageServer|Survey|PageNavigator)/) {
            log('--> found action form')
            @import "pages/work_tablet/action_form.ts"
            $mw_analytics = "HSUS-action-form-tablet"
          }

          # HSUS-344 Gigya landing page
          with(/site\/GigyaLogin/) {
            log("Gigya landing")
            @import "pages/gigya_tablet.ts"
          }
          
          # HSUS-401
          # Email Preferences
          # http://action.humanesociety.org/site/CO?i=ATIXJfiAhQUCE76ukI6rs0KVyAmeQ6Wd&cid=0
          # http://action.humanesociety.org/site/CO?i=tigud82sbXBijJ127B_G1gfcRFWydCrg&cid=0
          # HSUS-402
          # http://mlocal.action.humanesociety.org/site/CO?unsub_interests=0&first_name=&last_name=&primary_email=456%40fs.com&unsub=Unsubscribe&op.unsubFallback=
          with(/^\/site\/co\?(i=.*cid=0|unsub_interests.*)/i) {
            log("--> importing pages/email_preferences_tablet.ts in mappings_tablet.ts")
            @import "pages/email_preferences_tablet.ts"
          }
          # Fix for HSUS-485
          #http://mlocal.action.humanesociety.org/site/CO;jsessionid=74DC692F46524B250E378A67C46872FF.app338b?op.unsubscribe.confirm=
          with(/^\/site\/co\?op.*/i) {
            log("--> importing pages/email_preferences_tablet.ts in mappings_tablet.ts")
            @import "pages/email_preferences_tablet.ts"
          }
          # End of HSUS-485
        }
      }

      ##########
      # Legacy #
      ##########

      with(/legacy\.humanesociety\.org/) {
        match($path) {

          # Article page
          with(/^\/index(\.html|\.php)\?article/) {
            log("--> importing pages/legacy/legacy_article.ts in mappings.ts")
            @import "pages/legacy/legacy_article_tablet.ts"
            $mw_analytics = "HSUS-legacy-article-tablet"
          }

          # Other Article
          with(/^\/Article/) {
            log("--> importing pages/legacy/legacy_article.ts in mappings.ts")
            @import "pages/legacy/legacy_article_tablet.ts"
            $mw_analytics = "HSUS-legacy-article-tablet"
          }

          # Brochures
          # http://legacy.humanesociety.org/ebrochures.php?ebrochure=24
          with(/ebrochures\.php/) {
            log("--> importing pages/legacy/? in mappings.ts")
            @import "pages/legacy/legacy_article_tablet.ts"
            $mw_analytics = "HSUS-legacy-article-tablet"
          }

          # Root page
          # http://legacy.humanesociety.org/
          with(/^\/$|^\/\?|^\/index\.html|^\/index\.php/) {
            log("--> importing pages/legacy/legacy_root.ts in mappings.ts")
            @import "pages/legacy/legacy_root_tablet.ts"
            $mw_analytics = "HSUS-legacy-root-tablet"
          }
          
          # Contact page
          # http://legacy.humanesociety.org/contact.php
          with(/^\/contact/) {
            log("--> importing pages/legacy/legacy_contact_tablet.ts in mappings.ts")
            @import "pages/legacy/legacy_contact_tablet.ts"
            $mw_analytics = "HSUS-legacy-contact-tablet"
          }
        }
      }

      # Regular site
      else() {
        match($path) {

          with(/^\/$|^\/\?|^\/index\.html/) {
            log("--> Importing pages/home.ts in mappings_tablet.ts")
            @import "pages/home_tablet.ts"
            $mw_analytics = "HSUS-home-tablet"
          }
          with(/newsfeedtest|newsbrieftest2/) {
            log("--> Importing pages/home.ts in mappings_tablet.ts")
            @import "pages/home_tablet.ts"
          }
          
          # URL: humanesociety.org/header-b.html
          with(/header\-b\.html|^\/testing.*homepage/) {
            log("--> Alt Header. Importing pages/home.ts in mappings_tablet.ts")
            @import "pages/home_tablet.ts"
            $mw_analytics = "HSUS-home-tablet"
          }

          with(/test_homepage_with_moovweb/) {
            log("--> Importing pages/home.ts in mappings_tablet.ts")
            # @import "pages/home.ts"
          }
          
          # stock gifts
          # http://www.humanesociety.org/donate/plan/stock_gifts.html
          with(/^\/donate\/plan\/stock_gifts/) {
            log("--> importing pages/donate/_stock_gifts.ts in mappings.ts")
            @import "pages/donate/_stock_gifts.ts"
            $mw_analytics = "HSUS-stock-gifts-tablet"
          }
          
          # Moved this ahead of /index.html for the donate/index.html page
          with(/\/donate\//) {
            log('--> Matching donate in mappings_tablet.ts')
            @import "pages/donate/_donate_root_tablet.ts"
            $mw_analytics = "HSUS-donate-root-tablet"
          }

          
          ###############
          # Index Page  #
          ###############
          with(/^\/index\.html/) {
            log('--> Matching index page in mappings_tablet.ts')
            $mw_analytics = "HSUS-home-tablet"
          }

          ######################
          # Internal Resources #
          ######################

          # with(/^\/(tips|issues)/) {
          #   log('--> Matching Internal Resources in mappings_tablet.ts')
          # }

          # not done
          with(/^\/restaurant_locator/) {
            log('--> Importing pages/restaurant_form.ts')
            @import "pages/restaurant_form_tablet.ts"
            $mw_analytics = "HSUS-restaurant-form-tablet"
          }

          with(/^\/sitemap\.html/) {
            log('--> Importing pages/sitemap.ts in mappings_tablet.ts')
            @import "pages/sitemap_tablet.ts"
            $mw_analytics = "HSUS-sitemap-tablet"
          }

          with(/^\/privacy\.html/) {
            log('--> Importing pages/news_tablet/article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-privacy-tablet"          
          }
          with(/(testing\/chris_keane\/moovweb\/test\-tablet\-masthead\-article\-page\.html)/) {
            log('--> Importing pages/news_tablet/article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
          }

          # 55 Ways to Help Animals
          # URL: http://www.humanesociety.org/action/55_actions_to_help_animals.html
          with(/^\/action\/55_actions_to_help_animals\.html/) {
            log('--> Importing pages/news_tablet/article.ts in mappings.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-work-action-article"
          }

          ########
          # News #
          ########

          # this needs to go before news because of how ruby matches regexes

          //previous version of the mapping below. why are we matching on a testpage here?
          # with(/(^\/testing\/)|(^\/news\/(press_releases|news)\/($|index\.jsp*))/) {
            with(/(^\/news\/(press_releases|news)\/($|index\.jsp*))/) {
            log('--> Importing pages/news_tablet/press.ts in mappings.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
            $mw_analytics = "HSUS-press"
          }
          with(/^\/news\/resources\/facts\//) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/qa.ts"
          }
          with(/^\/news\/(resources\/qa|interview|dispatch)\//) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/qa.ts"
            $mw_analytics = "HSUS-qa"
          }
          # with(/^\/news\/(interview\/|magazines\/[^\/]*interview)/) {
          #   log('--> importing interview.ts in mappings_tablet.ts')
          #   # @import "pages/news_tablet/interview.ts"
          # }
          with(/^\/news\/(press_releases|news)\//) {
            log('--> Importing pages/news_tablet/article.ts in mappings.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-news-article"
          }
          with(/^\/news\/related_news\.html/) {
            log('--> importing pages/news_tablet/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
          }
          with(/^\/news\/workplace_giving/) {
            log('--> importing pages/news_tablet/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
            $mw_analytics = "HSUS-press"
          }

          with(/^\/news\/publications\/whitepapers/) {
            log('--> importing pages/news_tablet/whitepapers.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/whitepapers.ts"
            $mw_analytics = "HSUS-whitepaper"
          }
          with(/^\/news\/resources\/research/) {
            log('--> importing pages/news_tablet/whitepapers.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
          }
          with(/^\/news\/blog/) {
            log('--> Importing pages/news_tablet/news.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_main.ts"
            $(".//div[@id='page-head']") {
              add_class("mw_hide")
            }
            $mw_analytics = "HSUS-blog"
          }
          with(/^\/news\/profile\/off-duty/) {
            log('--> importing pages/news_tablet/off_duty.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/off_duty.ts"
            $mw_analytics = "HSUS-off-duty"
          }
          # HSUS-430
          with(/^\/news\/news\_briefs/) {
            log("--> Importing pages/news_tablet/news_base.ts in mappings.ts")
            # @import "pages/news_tablet/news_briefs.ts"
            # @import "pages/news_tablet/press.ts"
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
          }
          # End HSUS-430

          with(/^\/news\/($|\?|index\.html)/) {
            log('--> Importing pages/news_tablet/news_main.ts in mappings.ts')
            @import "pages/news_tablet/news_main.ts"
            $mw_analytics = "HSUS-news"
          }

          #############
          # Magazines #
          #############

          # Magazine root
          with(/^\/news\/magazines\/($|\?|index\.html)/) {
            log("--> Importing pages/magazine_root.ts in mappings_tablet.ts")
            @import "pages/magazine_root_tablet.ts"
            $mw_analytics = "HSUS-magazine-root"
          }

          # Exploring the magazine 

          with(/^\/news\/magazines\//) {
            log("--> Importing pages/magazine_root.ts in mappings_tablet.ts")
            @import "pages/magazine_root_tablet.ts"
            $mw_analytics = "HSUS-magazine-root"
          }

          ###########
          # ANIMALS #
          ###########

          with(/^\/animals\/($|\?|index\.html)/) {
            log('--> Importing pages/animals_tablet/animal_main.ts in mappings.ts')
            @import "pages/animals_tablet/animal_main.ts"
            $mw_analytics = "HSUS-animal-main"
          }
          with(/^\/animals\/(pets|wild_neighbors)\/($|\?|index\.html)/) {
            log('--> Importing pages/animals_tablet/pets.ts in mappings.ts')
            @import "pages/animals_tablet/pets.ts"
            $mw_analytics = "HSUS-animal-pets"
          }
          with(/^\/animals\/(pets|wild_neighbors)\/news\.html/) {
            log('--> Importing pages/animals_tablet/animal_news.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          with(/^\/animals\/browse_animals/) {
            log('--> Importing pages/animals_tablet/a_to_z.ts in mappings_tablet.ts')
            @import "pages/animals_tablet/a_to_z.ts"
            $mw_analytics = "HSUS-animal-a-to-z"
          }
          with(/^\/animals\/animal_news/) {
            log('--> Importing pages/animals_tablet/animal_news.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          with(/^\/animals\/(animal_)?resources/) {
            log('--> Importing pages/news_tablet/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/press.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          # cat-ccordion section
          # temp location
          with(/testing\/hsus_testing\/editorial\/cat-accordion\.html/) {
            log('--> importing cat_problem_solver.ts in mappings_tablet.ts - testing environment')
            @import "pages/animals_tablet/cat_problem_solver.ts"
            $mw_analytics = "HSUS-animal-cat"
          }
          # permanent location
          with(/animals\/cats\/cat_problem_solver/) {
            log('--> importing cat_problem_solver.ts in mappings_tablet.ts')
            @import "pages/animals_tablet/cat_problem_solver.ts"
            $mw_analytics = "HSUS-animal-cat"
          }
          with(/^\/animals\/[^\/.]*\/tips\/($|\?|index\.html)/) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal-qa"
          }
          with(/^\/animals\/[^\/]*\/tips\/[^\/]*\.html/) {
            log('--> Importing pages/news_tablet/article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/article.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal"
          }
          with(/^\/animals\/.*\/($|\?|index\.html)/) {
            log('--> Importing pages/animals_tablet/pets.ts in mappings_tablet.ts')
            @import "pages/animals_tablet/pets.ts"
            $mw_analytics = "HSUS-animal-pets"
          }
          with(/^\/animals\//) {
            log('--> Importing article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-animal-article"
          }
          # Fix for HSUS-493
          # http://humanesociety.org/news/resources/tips/thanksgiving-pets-turkeys-cooking.html
          with(/tips\/thanksgiving-pets-turkeys-cooking\.html/i) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-thanks-qa"
          }
          # End of HSUS-493

          ###################
          # Work and Issues #
          ###################
          with(/^\/work\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/work_main.ts in mappings_tablet.ts')
            @import "pages/work_tablet/work_main.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          with(/^\/issues\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/issues.ts in mappings_tablet.ts')
            @import "pages/work_tablet/issues.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          # ACTION section's in here
          with(/^\/action\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/action_main.ts in mappings_tablet.ts')
            @import "pages/work_tablet/action_main.ts"
            $mw_analytics = "HSUS-work-action"
          }
          with(/^\/action\/(now|fed_bill|toolkit)\/($|\?|index\.(html|jsp))/) {
            log('--> Importing pages/work_tablet/action_now.ts in mappings_tablet.ts')
            @import "pages/work_tablet/action_now.ts"
            $mw_analytics = "HSUS-work-action-now"
          }
          with(/^\/action\/(now|fed_bill|toolkit)\//) {
            log('--> Importing pages/news_tablet/article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-work-action-article"
          }
          # href http://www.humanesociety.org/action/alerts/maryland/
          with(/^\/action\/alerts\/[.]*/) {
            log('--> Importing pages/work_tablet/action_alerts.ts in mappings_tablet.ts')
            @import "pages/work_tablet/action_alerts.ts"
            $mw_analytics = "HSUS-work-action-alert"
            $mw_analytics = "HSUS-work-action-article"
          }
          with(/^\/issues\/campaigns\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/campaign.ts in mappings_tablet.ts')
            @import "pages/work_tablet/campaign.ts"
            $mw_analytics = "HSUS-work-campaign"
          }
          # fact sheets
          with(/^\/issues\/puppy_mills\/facts\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/campaign_subject.ts in mappings_tablet.ts')
            @import "pages/work_tablet/campaign_subject.ts"
            $mw_analytics = "HSUS-work-campaign-subject"
          }
          # HSUS-437
          with(/^\/issues\/animal_rescue\/tips\/pet_disaster/) {
            log("Pet disaster prepairdness")
            log('--> Importing pages/fact_sheet.ts in mappings_tablet.ts')
            # @import "pages/fact_sheet_tablet.ts"
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
            $mw_analytics = "HSUS-news-tablet"
          }
          # End HSUS-437
          with(/^\/(animals|issues|animal_community)\/(campaigns\/)?[^\/]*\/(facts|fact-sheets|tips)/) {
            log('--> Importing pages/fact_sheet.ts in mappings_tablet.ts')
            @import "pages/fact_sheet_tablet.ts"
            $mw_analytics = "HSUS-work-fact-sheet"
          }
          with(/^\/issues\/(campaigns\/)?[^\/]*\/news\.html/) {
            log('--> Importing pages/news/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/press.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-work-fact-news"
          }
          # faqs
          with(/^\/(issues|animals|animal_community)\/.*\/qa/) {
            log('--> Importing pages/work_tablet/qanda.ts in mappings_tablet.ts')
            @import "pages/work_tablet/qanda.ts"
            $mw_analytics = "HSUS-work-qa"
          }
          with(/^\/issues\/issue_news\.html/) {
            log('--> Importing pages/news/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/press.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          with(/^\/issues\/campaigns\//) {
            log('--> Importing pages/work_tablet/campaign_subject.ts in mappings_tablet.ts')
            @import "pages/work_tablet/campaign_subject.ts"
            $mw_analytics = "HSUS-work-campaign"
          }
          with(/^\/issues\/issue_resources/) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-work-news"
          }
          # eating and recipes
          with(/^\/issues\/eating\/recipes\/(recipes\.html|index\.html)?/) { #/
            log('--> Importing pages/work_tablet/recipes_main.ts')
            @import "pages/work_tablet/recipes_main.ts"
            $mw_analytics = "HSUS-work-recipes"
          }
          # spay day
          with(/^\/issues\/spay_day/) {
            log('--> Importing pages/work_tablet/spay_day.ts')
            @import "pages/work_tablet/spay_day.ts" 
            $mw_analytics = "HSUS-work-spayday"
          }
          # seal splat page
          with(/^\/issues\/seal_hunt\/2013_hunt\/home\.html/) {
            log('--> Importing pages/work_tablet/seal_splat.ts')
            @import "pages/work_tablet/seal_splat.ts"
            $mw_analytics = "HSUS-seal-splat"
          }
          with(/^\/issues\/seal_hunt\/((protect_seals|index)\.html)?/) { #/
            log('--> Importing pages/work_tablet/seal_splat.ts')
            @import "pages/work_tablet/seal_splat.ts"
            $mw_analytics = "HSUS-seal-splat"
          }

          with(/^\/issues\//) {
            log('--> Importing pages/work_tablet/issue_subject.ts')
            @import "pages/work_tablet/issue_subject.ts"
            $mw_analytics = "HSUS-work-issues"
          }

          # # app section for seal stuff
          with(/^\/apps\/protectseals\//) {
           log('--> Importing pages/fact_sheet.ts in mappings.ts')
             # @import "pages/fact_sheet.ts"
             @import "pages/fact_sheet_tablet.ts"
           }

          #############
          # Community #
          #############

          with(/^\/animal_community\/($|\?|index\.html)/) {
            log('--> Importing pages/community_tablet/community_main.ts')
            @import "pages/community_tablet/community_main.ts"
          }
          with(/^\/animal_community\/shelters\/direct_care_news/) {
            log('--> Importing pages/news_tablet/press.ts WO')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/qa.ts"
          }
          with(/^\/animal_community\/shelters\/(.*\.html)?/) { #//
            log('--> Importing pages/community_tablet/care_centers.ts')
            @import "pages/community_tablet/care_centers.ts"
          }
          with(/^\/animal_community\/resources\/($|\?|index\.html)/) {
            log('--> Importing pages/community_tablet/resources.ts')
            @import "pages/community_tablet/resources.ts"
          }
          with(/^\/animal_community\/resources\/rescue_groups/) {
            log('--> Importing pages/news_tablet/article.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
          }
          with(/^\/animal_community\/careers/) {
            log('--> Importing pages/community_tablet/care_centers.ts')
            @import "pages/community_tablet/care_centers.ts"
          }
          with(/^\/animal_community\/working_shelters/) {
            log('--> Importing pages/news_tablet/press.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
          }          
          with(/^\/parents_educators\/($|\?|index\.html)/) {
            log('--> Importing pages/community_tablet/parents.ts')
            @import "pages/community_tablet/parents.ts"
          }
          with(/^\/parents_educators\//) {
            log('--> Importing pages/news_tablet/article.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
          }
          with(/^\/community\/volunteers\//) {
            log('--> Importing pages/community_tablet/volunteers.ts')
            @import "pages/community_tablet/volunteers.ts"
          }
          with(/^\/community\/connect\.html/) {
            log('--> Importing pages/community_tablet/connect.ts in mappings_tablet.ts')
            @import "pages/community_tablet/connect.ts"
          }
          with(/^\/animal_community\/hsvma\/hsvma_ravs\.html/) {
            log('--> Importing pages/community_tablet/parents.ts')
            @import "pages/community_tablet/parents.ts"
          }

          #########
          # About #
          #########

          with(/^\/about\/($|\?|index\.html)/) {
            log('--> Importing pages/about_tablet/about_main.ts in mappings_tablet.ts')
            @import "pages/about_tablet/about_main_tablet.ts"
          }
          with(/^\/about\/overview\//) {
            log('--> Importing pages/about_tablet/overview.ts in mappings_tablet.ts')
            @import "pages/about_tablet/overview_tablet.ts"
          }
          with(/^(\/about\/leadership\/)|(\/testing\/ellen-pascale\/experts\.html)/) {  // for HSUS-519
            log('--> Importing pages/about_tablet/leadership.ts in mappings_tablet.ts')
            @import "pages/about_tablet/overview_tablet.ts"
            @import "pages/about_tablet/leadership_tablet.ts"
          }
          with(/^\/about\/contact\//) {
            log('--> found FAQ page in mappings_tablet.ts')
            @import "pages/about_tablet/about_main_tablet.ts"
            @import "pages/about_tablet/faq_tablet.ts"
          }
          with(/^\/about\/podcast\//) {
            log('--> Redirecting podcast to desktop in mappings_tablet.ts')
            $desktop_export="true"
          }
          with(/^\/about\/events\/($|\?|index\.html)/) {
            log('--> found events page')
            @import "pages/about_tablet/about_main_tablet.ts"
            @import "pages/about_tablet/events_tablet.ts"
          }
          with(/^\/about\/events\//) {
            log('--> Importing pages/about_tablet/event_page.ts in mappings_tablet.ts')
            @import "pages/about_tablet/event_page_tablet.ts"
          }
          with(/^\/about\/state\/($|\?|index\.html)/) {
            log('--> found main state page')
            @import "pages/about_tablet/about_main_tablet.ts"
            @import "pages/about_tablet/state_news_tablet.ts"
          }
          # EX: http://www.humanesociety.org/about/state/humane_state_ranking_2012.html
          with(/^\/about\/state\/humane_state_ranking/) {
            log('--> found state rank map')
            @import "pages/about_tablet/state_ranking_tablet.ts"
          }
          with(/^\/about\/state\//) {
            log('--> found state page')
            log("--> importing /pages/about_tablet/state_page_tablet.ts in mappings_tablet.ts")
            @import "pages/about_tablet/state_page_tablet.ts"
          }
          with(/^\/about\/departments\/($|\?|index\.html)/) {
            log('--> Importing pages/about_tablet/dept_main.ts in mappings_tablet.ts')
            @import "pages/about_tablet/dept_main_tablet.ts"
          }

          # Faith department
          with(/^\/about\/departments\/faith\/($|\?|index\.html|facts\/statements|resources\.html)/) {
            log('--> Importing pages/about_tablet/faith_base.ts in mappings_tablet.ts')
            @import "pages/about_tablet/faith_base_tablet.ts"
          }
          with(/^\/about\/departments\/faith\/animal_ministry_guide\/($|index\.html|food|wildlife|pet_resources)/) {
            log('--> Importing pages/about_tablet/faith_base.ts in mappings_tablet.ts')
            @import "pages/about_tablet/faith_base_tablet.ts"
          }
          with(/^\/about\/departments\/faith\/(.*)?(order|register|share|fill-the-bowl)/) {
            log('--> Importing pages/about_tablet/faith_form.ts in mappings_tablet.ts')
            @import "pages/about_tablet/faith_form_tablet.ts"
          }
          with(/^\/about\/departments\/faith\/related_news/) {
            log('--> Importing pages/news/press.ts in mappings_tablet.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
          }
          with(/^\/about\/departments\/faith\//) {
            log('--> Importing pages/about_tablet/faith_article.ts in mappings_tablet.ts')
            @import "pages/about_tablet/faith_base_tablet.ts"
          }
          # end faith section

          with(/^\/about\/departments\/state_affairs\/State_Directors/) {
            log('--> Importing pages/news/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/qa.ts"
          }
          with(/^\/about\/departments\/([^\/]*\/($|\?|)|[^\/]*\.html)/) {
            log('--> Importing pages/about_tablet/departments.ts')
            @import "pages/about_tablet/departments_tablet.ts"
          }
          with(/^\/about\/employment/) {
            log('--> importing pages/about_tablet/employ.ts in mappings_tablet.ts')
            @import "pages/about_tablet/employ_tablet.ts"
            @import "pages/about_tablet/about_base_tablet.ts"
          }
          with(/^\/about\/podcast/) {
            log('--> sending podcast to desktop in amppings.ts')
            $desktop_export = "true"
          }

          with(/^\/about\//) {
            log('--> Importing pages/about_tablet/about_base_tablet.ts in mappings_tablet.ts')
            @import "pages/about_tablet/about_base_tablet.ts"
          }

          #############
          # Map Pages #
          #############
          with(/assets\/maps\/feral-cat-groups/) {
            log("--> Importing pages/maplist_tablet.ts in mappings_tablet.ts")
            @import "pages/maplist_tablet.ts"
          }
          # href http://www.humanesociety.org/assets/maps/volunteer_opportunities.html
          with(/assets\/maps\/volunteer_opportunities/) {
            log("--> Importing pages/maps_tablet.ts in mappings.ts")
            @import "pages/maps_tablet.ts"
          }
          with(/assets\/maps\/affording\-your\-pet/) {
            log("--> Importing pages/maplist_tablet.ts in mappings.ts")
            @import "pages/maplist_tablet.ts"
          }

          with(/^\/assets\/maps\/.+\?/) { #/
            log("--> might be a list")
            log("--> Importing pages/maplist_tablet.ts in mappings.ts")
            @import "pages/maplist_tablet.ts"
          }
          # href http://www.humanesociety.org/assets/maps/feral-cats.html
          with(/^\/assets\/maps/) {
            log("--> Importing pages/maps_tablet.ts in mappings_tablet.ts")
            @import "pages/maps_tablet.ts"
          }



          ##################
          # Search Results #
          ##################

          with(/^\/search\/(tweaked-)?search/) {
            log('--> Importing pages/search_results_tablet.ts in mappings_tablet.ts')
            @import "pages/search_results_tablet.ts"
          }
          with(/^\/search\.jsp/) {
            log('--> Importing pages/search_results_tablet.ts in mappings_tablet.ts')
            @import "pages/search_results_tablet.ts"
          }

          with(/^\/testing\/search\-test\.html/) {
            log('--> Importing pages/search_results.ts in mappings.ts')
            @import "pages/search_results_tablet.ts"
          }
          #################
          # Contact Forms #
          #################

          # with(/forms/) {
            # log('--> Importing pages/forms.ts in mappings_tablet.ts')
            # @import "pages/forms.ts"
          # }

          # href http://www.humanesociety.org/forms/contact_us/animal_experimentation_contact.html
          # href http://www.humanesociety.org/forms/contact_us/wildlife_contact_form.html
          with(/forms\/contact_us\/(animal_experimentation_contact|wildlife_contact_form).html/) {
            log('--> Importing pages/new_tablet/forms_contact_tablet.ts in mappings_tablet.ts')
            @import "pages/news_tablet/forms_base_tablet.ts"
            @import "pages/news_tablet/forms_contact_tablet.ts"
          }

          # href http://www.humanesociety.org/forms/contact_us/our_website_contact.html
          with(/forms\/contact_us/) {
            log('--> Importing pages/new_tablet/contact_us_info_tablet.ts in mappings_tablet.ts')
            @import "pages/news_tablet/forms_base_tablet.ts"
            @import "pages/news_tablet/contact_us_info_tablet.ts"
          }

          # href http://www.humanesociety.org/forms/puppy_buyer_complaint_form.html
          # href http://www.humanesociety.org/forms/humane_wildlife_services_request_form.html
          # href http://www.humanesociety.org/forms/pets_valor_nomination.html
          with(/forms/) {
            log('--> Importing pages/new_tablet/forms_tablet.ts in mappings_tablet.ts')
            @import "pages/news_tablet/forms_base_tablet.ts"
            @import "pages/news_tablet/forms_tablet.ts"
          }

          # HSUS-506 http://mlocal.humanesociety.org/testing/chris_keane/footer/test-footer-revisions.html
          with(/test-footer-revisions/) {
            log('--> footer revisions testpage')
            @import "pages/home_tablet.ts"
          }

          # HSUS-436
          with(/PageBuilderPreviewPage|/) {
            log("Chimps art test page")
            # @import pages/news/article.ts
            @import pages/custom/chimp_art_tablet.ts
          }
          with(/site\/SPageServer\?pagename\=chimp_art_contest/) {
            log("Chimps art test page")
            @import pages/custom/chimp_art_tablet.ts
          }

          with(/thanks_chimpanzee_art_contest.html$/) {
            # @import base_tablet.ts
            # @import pages/news_tablet/forms_tablet.ts
          }

          # End HSUS-436


          ########
          # Shop #
          ########

          with(/^\/shop/) {
            log("--> importing pages/shopping.ts mappings_tablet.ts")
            @import "pages/shop_tablet.ts"
          }

          match($desktop_export, "true") {
            log("--> No page match in mappings_tablet.ts")
            @import desktop_redirect.ts
          }
          
          # HSUS-344
          # http://humanesociety.org/testing/cd-test2.html
          with(/^\/testing\/cd-test2\.html/) {
            log('--> Importing pages/animals_tablet/animal_main.ts in mappings.ts')
            @import "pages/animals_tablet/animal_main.ts"
            $mw_analytics = "HSUS-animal-main"
          }
          # end of HSUS-344

          # HSUS-406 this entry only use for temp address and we can delete if the page is online
          with(/^\/testing\/hsus_testing\//) {
            log("--> Importing pages/magazine_root_tablet.ts in mappings_tablet.ts")
            @import "pages/magazine_root_tablet.ts"
            $mw_analytics = "HSUS-magazine-root"
          }
          # HSUS-406 end
          
          with(/flickr/) {
            @import "pages/flickr_tablet.ts"
          }

          else() {
            match($desktop_export, "true") {
              log("--> No page match in mappings_tablet.ts")
              @import desktop_redirect.ts
            }
            log("--> No page match in mappings_tablet.ts")
            log("--> Doing a basic page mapping for CMS")
            $(".//body") {
              match($host) {
                with(/mstage|mlocal/) {
                  $("./div[@id='wrapper']") {
                    insert_top("div", style:"margin: 10px; padding: 10px; background-color: white; color: red;", "This page does not have an associated mapping for transformation. File it as a ticket for Moovweb")
                  }
                }
              }
              add_class("mw_no_match_basic")
              $(".//div[@id='main']") {
                add_class("mw_box2")
              }
            }
          }
        }
      }

#       match($path) {
#         with(/(\?|\&)moov\=rainbows/) {
#           $('./head') {
#             log("MAKIN IT RAIN-BOW!")
#             insert_bottom("style", type:"text/css", "#wrapper::before{ content:''; width:90%; height: 100%; position: fixed; bottom: -50%; left: 5%; display: block; box-shadow: 0px 0px 0px 3px red, 0px 0px 0px 6px orange, 0px 0px 0px 9px yellow, 0px 0px 0px 12px green, 0px 0px 0px 15px blue, 0px 0px 0px 18px purple; -webkit-border-radius: 100%; z-index: 999;}") 
#           }
#         }
# 
#         with(/(\?|\&)moov\=3d/) {
#           $('./head') {
#             log("MAKIN IT 3D!")
#             insert_bottom("style", type:"text/css", "*{ box-shadow: 1px 1px 0px 1px red, 2px 2px 0px 1px orange, 3px 3px 0px 1px yellow, 4px 4px 0px 1px green, 5px 5px 0px 1px blue, 6px 6px 0px 1px violet, 7px 7px 0px 1px purple; }") 
#           }
#         }
#       }
}
}

  # search results are a 304?
  with(/304/) {
    log("--> STATUS: 304")
    match($path) {
      with(/search\/search/) {
        log('--> Importing pages/search_results_tablet.ts in mappings_tablet.ts')
        @import "pages/search_results_tablet.ts"
      }
    }
  }

  # 404 page?
  # http://mlocal.humanesociety.org/news/resources.html
  with(/404/) {
    log("--> STATUS: 404")
    @import "pages/page_not_found_tablet.ts"
  }

  else() {
    # not 200 or 302 response status
    log("--> STATUS: " + $status + " assuming its an error code pages/error.ts")
    @import "pages/error.ts"
  }

}

# HSUS-420 : New Accordion
$(".//div[@id='toggle']") {
  $(".//dl[@class='accordion']") {
    name("div")
    attributes(data-ur-set: "toggler")
  }
  $(".//dt") {
    add_class("mw_bar3")
    name("div")
    attributes(data-ur-toggler-component: "button", data-ur-state: "disabled")
  }
  $(".//dd") {
    name("div")
    attributes(data-ur-toggler-component: "content")
    wrap_text_children("p") {
      match(text(), (/\A\s+\Z/)) {
        remove()
      }
    }
  }
}

# HSUS-433: Style Vine Video for site, make universal
$(".//iframe[@class='vine-embed']") {
  add_class("mw_vine_video")
  attributes(width: "100%", height: "280")
  $("./parent::div[contains(@id, 'item')]") {
    add_class("mw_vine_video_wrapper")
  }
}
# Fix for HSUS-444
remove(".//div[contains(@id, 'splashbox_widget_c')]")
# End of HSUS-444

#HSUS-452, make checklists universal
  $uid = 'mw_1'
  $("//form[contains(@class, 'checkboxes')]") {
    $("./ul") {
      name("table")
      $("./li") {
        name("tr")
        $("./input") {
          attributes(id: $uid, onchange: '$("[for=\'"+this.id+"\']").attr("checked", function(idx, old) { return !old; });')
          wrap("td")
        }
        $("./label") {
          attributes(for: $uid, onclick: ";")
          wrap("td")
        }
        $uid = $uid+'1'
      }
    }
  }
#END HSUS-452
# HSUS-420 : New Accordion
$(".//div[@id='toggle']") {
  $(".//dl[@class='accordion']") {
    name("div")
    attributes(data-ur-set: "toggler")
  }
  $(".//dt") {
    add_class("mw_bar3")
    name("div")
    attributes(data-ur-toggler-component: "button", data-ur-state: "disabled")
  }
  $(".//dd") {
    name("div")
    attributes(data-ur-toggler-component: "content")
    wrap_text_children("p") {
      match(text(), (/\A\s+\Z/)) {
        remove()
      }
    }
  }
}

# HSUS-433: Style Vine Video for site, make universal
$(".//iframe[@class='vine-embed']") {
  add_class("mw_vine_video")
  attributes(width: "auto", height: "300")
  $("./parent::div[contains(@id, 'item')]") {
    add_class("mw_vine_video_wrapper")
  }
}

# Fix for HSUS-444
remove(".//div[contains(@id, 'splashbox_widget_c')]")
# End of HSUS-444

#HSUS-452, make checklists universal
$uid = 'mw_1'
$("//form[contains(@class, 'checkboxes')]") {
  $("./ul") {
    name("table")
    $("./li") {
      name("tr")
      $("./input") {
        attributes(id: $uid, onchange: '$("[for=\'"+this.id+"\']").attr("checked", function(idx, old) { return !old; });')
        wrap("td")
      }
      $("./label") {
        attributes(for: $uid, onclick: ";")
        wrap("td")
      }
      $uid = $uid+'1'
    }
  }
}
#END HSUS-452


$("./head") {
  remove("./*[not(self::meta[@name='viewport'])]")
  insert("meta", id: "mw_desktop_link_config", cookie_hours: "24", immediate: "true", this_page_only: "true")
  insert("script", type: "text/javascript", src: asset("javascript/main_mobile.js"))
}
remove("./body")
# The main file executed by Tritium. The start of all other files.

match($content_type) {
  with(/html/) {
    # Rewrite the xmlns nodes before the html parser clobbers them
    replace(/\<(\/?)(\w+)\:\w+\>/, "$2_mwns_") #/ 
    # replace(/\<(\/?)(\w+\:\w+)\>/, "$2_mwns_") #/ 

    replace(/\<\/body\>/,"") #/
    replace(/\<\/html\>/,"") #/
    append("</body> </html>")


    @import "device_detection.ts"  
    @import "check_fragment.ts"
    # Force UTF-8 encoding. If you'd like to auto-detect the encoding,
    # simply remove the "UTF-8" argument.  e.g. html(){ ... }
    match($html_fragment, /false/) {
      # html("UTF-8") { # The donate pages are ISO-8859-1 encoded, so autodetection would be best (HSUS-171)
      html() {

              
        # This file is meant to be used while the site is being built 
        # and the project might be in the production environment. This will help to 
        # ensure that the project can live on a prod environment, but not
        # be world accessible.
        
        # Coming Soon...
        # Comment out the line below once you begin working
        # @import "coming_soon.ts"

        @import "html.ts"
      }
    }

    # Rewrite the xmlns nodes to restore them
    log("rewriting nodes")
    replace(/(\<(\/?)(\w+))_mwns_(\:\w+\>)/, "$1$4") 
    # replace(/(\<(\/?)(\w+))_mwns_(\:\w+\>)/, "$1$4") # revised regex
  }
  # with(/plain/i) {
  #   @import plain.ts
  # }
  # with(/javascript/) {
  #   @import "ajax.ts"
  # }
  else() {
    log(concat("Passing through ", $content_type, " unmodified"))
  }
}

log("--> Running plain.ts")

# Normal Ajax can be parsed simply using html_fragment()
# html_fragment("utf-8") {
#   
#   rewrite_links()
#   absolutize_srcs()
# 
#   # Needed to begin mobilizing
#   remove_all_styles()
# 
#   match($path) {
#     # with(/foo/) {
#     #   log("--> Importing ajax/foo.ts in plain.ts")
#     #   @import ajax/foo.ts
#     # }
#   }
# }

#############
#############
#############

# The following section is required for when dealing with .NET Ajax
# The content length is encoded and requires extra special handling
# by calculating said length. 

# Aspx for multiple different parts per response
# replace(/(\s*?\|?)(\d+)(\|[^\|]*\|[^\|]*\|)(.*?)\|(?=((\d+\|)|$))|/m) {
#   $first = $1
#   $second = $2    # content length
#   $third = $3     # parent container
#   $fourth = $4    # actual content
#   $fourth {
#     $charset_determined = "utf-8" # force encoding for proper length
#     html_fragment("utf-8") {
#       
#       rewrite_links()
#       absolutize_srcs()
# 
#       # Needed to begin mobilizing
#       remove_all_styles()
# 
#       match($path) {
#         # with(/foo/) {
#         #   log("--> Importing ajax/foo.ts in plain.ts")
#         #   @import ajax/foo.ts
#         # }
#       }
#     }
#     replace(/&amp;/, "&")
#     replace(/%20/, " ")
#     replace(/%22/, "\"")
#   }
#   log("changed")
#   
#   # log(concat("=>  $first:  ", $first))
#   # log(concat("=>  $second:  ", $second))
#   # log(concat("=>  $third:  ", $third))
#   # log(concat("=>  $fourth:  ", $fourth))
#   
#   match($second) {
#     with(/^0$/) {
#       log("!!!! $second is 0")
#       $second = length($fourth)
#       $collection = concat($collection, $first, $second, $third, $fourth, "|")      
#     }
#     with(/^$/) {
#       log("!!!! $second is null")
#       $collection = concat($collection, $first, $second, $third, $fourth)            
#     }
#     not(/^0$/) {
#       $second = length($fourth)
#       log("!!!! $second is just something else")
#       $collection = concat($collection, $first, $second, $third, $fourth, "|")      
#     }
#   }
#   # Error => You've probably broken the AJAX somehow
#   match($third) {
#     with(/\|error\|/) {
#       log("!!!! Error Ajax")
#       $collection = concat($collection, $first, $second, $third, $fourth, "|")      
#     }
#   }
#   
#   # log(concat("=>  $collection:  ", $collection))
#   
#   # log("--> ===================================")
# }
# set($collection)

# HTML Transformations go here

$("/html") {

  @import perfect_proxy.ts

  match ($perfect_proxy) {
    with(/false/) {
      rewrite_links()
      absolutize_srcs()

        
      # Add the mobile meta tags 
      clean_mobile_meta_tags()

        
      # Needed to begin mobilizing

      # Late load all the images on the site
      # lateload()
        
      # Remove all script tags not marked with "data-keep" attribute
      @import "optimization.ts"
      remove_desktop_js();
      
      # HSUS-344
      # https://mlocal.secure.humanesociety.org/site/UserLogin
      # social popup will broken
      match($path, /^\/site\/UserLogin/) {
        $(".//link[@rel='stylesheet'][contains(@id, 'yui_marker_loader_css')]") {
          attribute("data-mw-keep", "true")
        }
      }
      # end of HSUS-344
      remove_all_styles()
      remove_html_comments()

      add_assets()

      # @import "sections/header.ts"
      # @import "sections/footer.ts"

      match($tablet) {
        with(/true/) {
          log("==> tablet mappings")
            log("--> Importing _base_tablet.ts in html.ts")
          @import "_base_tablet.ts"
          @import "sections/header_tablet.ts"
          @import "sections/footer_tablet.ts"
          @import "mappings_tablet.ts"
        }

        else() {
          log("==> mobile mappings")
          log("--> Importing base.ts in html.ts")
          @import "base.ts"
          @import "sections/header.ts"
          @import "sections/footer.ts"
          @import "mappings.ts"
        }
      }
      # @import "mappings.ts"

      # Include mw_analytics file to track the mobile site
      @import "mw_analytics.ts"
    }

    else() {
      rewrite_links()
      absolutize_srcs()

      # fix any images with extra /'s
      fixImages()

      # Remove the redirect script
      $(".//script") {
        %source = fetch("text()")

        match(%source, /mw_mobile_site/) {
          log("found the redirect script")
          remove()
        }
      }
      # Their cookie.js script caused infinite redirection loops (to 404 pages sometimes) when perfect-proxying some pages.
      remove(".//script[contains(@src, 'cookie')]")
      # HSUS-425 to prevent redirection loop
      remove(".//script[contains(@src, 'session-status')]")
    }
  }
#   rewrite_links()
#   absolutize_srcs()
# 
#     
#   # Add the mobile meta tags 
#   clean_mobile_meta_tags()
# 
#     
#   # Needed to begin mobilizing
#   remove_all_styles()
#   remove_html_comments()
# 
#   # Late load all the images on the site
#   # lateload()
#     
#   # Remove all script tags not marked with "data-keep" attribute
#   @import "optimization.ts"
#   remove_desktop_js();
# 
#   # Include mw_analytics file to track the mobile site
#   @import "mw_analytics.ts"
# 
# 
# 
#   add_assets()
# 
#   @import "sections/header.ts"
#   @import "sections/footer.ts"
# 
#   @import "mappings.ts"
}


log("--> Running ajax.ts")

# match($path) {
#   # Match the Ajax path
#   with(/foo/) {
#     html_fragment() {
#       log("--> Importing ajax/foo.ts in ajax.ts")
#       @import ajax/foo.ts
#     }
#   }
# }

# needed for product images
# replace("%24", "$")
# replace("&amp;", "&")
$perfect_proxy = 'false'

# Do only for mobile
# match_not($tablet, /true/) {

#Match a meta tag for desktop passthrough
match(fetch("/html/head/meta[@name='desktopView']/@content"), /true/) {
  log("meta tag passthrough")
  $perfect_proxy = "true"

  # match_not($host, /m\.(secure|video|slideshows|legacy|action)?\.?humanesociety\.org/) {
  #   log("disabling perfect_proxy for testing environmetns")
  #   $perfect_proxy = "false"
  # }
}

# Match hardcoded URLs
match($path) {
  with(/\/site\/SPageServer\?.*pagename\=drtv\_splashb\_MSI/) {
    log("url specific passthrough")
    $perfect_proxy = 'false'
  }
  with(/\/site\/SPageServer\?pagename\=drtv\_/){
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }
  with(/\/site\/SPageServer\?pagename\=seals\_2013video\&s\_src\=web\_hp\_bb1040213/) {
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }
  with(/\/forms\/virginia\-dogs\-against\-fox\-pens\.html/) {
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }
  # HSUS-425
  with(/\/your\_best\_shot\.html/) {
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }
  # HSUS - 480
  with(/\/you-are-a-hero-for-animals/) {
    log("url specific passthrough")
    $perfect_proxy = 'true'
  }

}
# }

# Or, Match a URL argument
match($path) {
  with(/(\?|\&)mw\=d/) {
    log("url argument passthrough")
    $perfect_proxy = 'true'
  } 
}

# remove this when the tablet site goes live!
# match($host) {
#   with(/m\.[secure\.|action\.|slideshows\.|video\.]*humanesociety\.org/) {
#     match($tablet, /true/) {
#       $perfect_proxy = 'true'
# 
#       $(".//script[not(@type)]") {
#         %source = fetch("text()")
# 
#         match(%source, /mw_mobile_site/) {
#           log("found the redirect script")
#           remove()
#         }
#       }
#       
#     }
#   }
# }
# HSUS-273 The form on this page is mostly hidden.
match($path) {
  with(/forms\/virginia-dogs-against-fox-pens.html/) {
    log("url argument passthrough")
    $perfect_proxy = 'true'
  }
}
# end HSUS-273

# This file is meant to block out the site while underconstruction
# Make this active when first pushing to production to ensure 
# its not world visible.
$("/html") {
  $("./head") {
    $("./*") {
      remove()
    }
    insert("script", data-mw_keep: "true", type: "text/javascript", src: asset("javascript/main.js"))
    insert_bottom("style", "body {background-color: #eee;} div {padding:10px;} #coming-soon {font-size: 30px;} #explanation {font-size: 15px;} #mw_desktop_link {text-align:center;display:block;}")
  }
  $("./body") {
    $("./*") {
      remove()
    }
    insert_bottom("div", concat("Mobile ", $source_host, " Coming Soon!"), id: "coming-soon")
    insert_bottom("div", "We're currently in the process of building an <b>amazing</b> mobile experience. Please check back soon.", id: "explanation")
    $cookie_domain = concat($source_host, "")
    $cookie_domain {
      replace(/^(w+\d+\.)?/, ".")
    }
    # desktop link
     insert_bottom("div", class: "mw_footer_link_box", id: "mw_desktop_link_config"){
       attribute("matcher", $rewrite_incoming_matcher)
       attribute("replacement", $rewrite_incoming_replacement)
       attribute("cookie_hours", "0")
       attribute("cookie_domain", $cookie_domain)
       # adding desktop site link
       insert_top("a", class: "mw_desktop_link", id: "mw_desktop_link"){
         attribute("href", "http://" + $source_host)
         text("Visit our Desktop Site")
       }
     }
  }
}

$("./body") {
  add_class("mw_drtv_splash")
  $(".//div[@id='ga-content']//div[./script[contains(@src, 'jquery.js')]]") {
    $(".//div[contains(@class, 'mw_was_table')]") {
      $("./div[contains(@class, 'mw_was_tr')]/div[contains(@class, 'mw_was_td')][./p]") {
        add_class("mw_ps_wrap")
      }
      $("./div[contains(@class, 'mw_was_tr')][./div[contains(@class, 'mw_was_td')][./a/img][2]]") {
        add_class("mw_buttons_wrap mw_flex_box")
        $("./div[contains(@class, 'mw_was_td')]") {
          $temp_text=fetch("./a/img/@alt")
          remove("./a/img")
          $("./a") {
            text($temp_text)
          }
          add_class("mw_btn2 mw_flex_box_item_1")
        }
      }
      $("./div[contains(@class, 'mw_was_tr')]/div[contains(@class, 'mw_was_td')][./object]") {
        add_class("mw_movie_wrap")
      }
      $("./div[contains(@class, 'mw_was_td')][./img[contains(@src, 'gift_header')]]") {
        add_class("mw_gift_title")
        $("following-sibling::div[contains(@class, 'mw_was_tr')][1]/div[contains(@class, 'mw_was_td')]") {
          add_class("mw_gift_img")
        }
      }
    }
  }
  $(".//div[@id='ga-content']/div[contains(@class, 'mw_was_table')]") {
    add_class("mw_hide")
  }
  $("./div[@id='ga-container']") {
    insert_before("div", class: "mw_main") {
      copy_here("following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_buttons_wrap')]")
      copy_here("following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_movie_wrap')]")
      copy_here("following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_ps_wrap')]")
      insert("div", class: "mw_gift_wrap") {
        copy_here("ancestor::div[contains(@class, 'mw_main')]/following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_gift_title')]")
        copy_here("ancestor::div[contains(@class, 'mw_main')]/following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_gift_img')]")
      }  
      copy_here("following-sibling::div[@id='ga-container']//div[contains(@class, 'mw_buttons_wrap')]")
    }
  }
}
$("./body") {
  add_class("mw_drtv_donation")
  $(".//select") {
    wrap("div", class:"mw_select_box")
    insert("div", class:"mw_arrows")
  }
  $("./div[contains(@class, 'mw_was_table')]") {
    insert_before("div", class:"mw_box2") {
      move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//div[@id='monthlytabs' or @id='onetimetabs']", "top") {
        attribute("class", "mw_flex_box")
        move_here(".//a", "bottom") {
          $("./self::a[./img[contains(@id, 'slices')]]") {
            attribute("class", "mw_slices_tab mw_flex_box_item_1")
          }
          $("./self::a[./img[contains(@id, 'table')]]") {
            attribute("class", "mw_table_tab mw_flex_box_item_1")
          }
          inner(fetch("./img/@alt")) {
            replace(/\s/, "-")
          }
          inner(fetch("./text()")+" Gift")
        }
        remove("./div[contains(@class, 'mw_was_tr')]")
      }
      move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//form[./input[@id='donor_email_opt_in'][@type='checkbox']]", "bottom") {
        move_here("../following-sibling::div[contains(@class, 'mw_was_table')]//div[contains(@class, 'mw_was_td')]/div[@class='ErrorMessage'][./span[@id='api-errorMessages-headline']]", "top") {
        }
        add_class("mw_gray_box")
        $("./input[@id='donor_email_opt_in']") {
          add_class("mw_hide2")
        }
        $("./fieldset/div[contains(@class, 'mw_was_table')]") {
          insert_before("div", class:"mw_donate_amount") {
            move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//span[not(./a)]", "top")
            move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//div[@id='amounts']", "bottom") {
              $("./input[@type='radio'][not(@id='level_other')]") {
                wrap("div", class:"mw_amount_num")
              }
              $("./input[@type='radio'][@id='level_other']") {
                wrap("div", class:"mw_amount_num mw_other_amount")
              }
              $("./label | ./input[@type='text']") {
                move_to("./preceding-sibling::div[contains(@class, 'mw_amount_num')][1]", "bottom")
              }
            }
          }
          remove()
        }
        $("./div[contains(@class, 'mw_was_table')]") {
          attribute("class", "mw_personal_detail")
          remove("./div[contains(@class, 'mw_was_tr')][.//img[contains(@src, 'divider')]]")
          $("./div[contains(@class, 'mw_was_tr')][1]/div[contains(@class, 'mw_was_td')][./span]") {
            %temp_class = fetch("./span/text()") {
              replace(/\s/, "_")
            }
            attribute("class", "mw_"+%temp_class)
            inner_wrap("div", class:"mw_information_title") {
              $("./self::div[./img]") {
                add_class("mw_credit")
              }
            }
            move_to("./ancestor::div[contains(@class, 'mw_was_tr')][1]", "before")
          }
          # billing information
          $("./div[@class='mw_Billing_Information']") {
            move_here("./following-sibling::div[contains(@class, 'mw_was_tr')][(*)][1]/div[contains(@class, 'mw_was_td')][1]", "bottom") {
              $("./div[@id='billinginfo']") {
                $("./div[contains(@class, 'mw_was_tr')]") {
                  add_class("mw_label_box")
                  $("./div[contains(@class, 'mw_was_td')][./label]") {
                    add_class("mw_label_title")
                    $("./label[@for='premium_id']") {
                      text() {
                        replace(/Please\ss/, "S")
                      }
                    }
                  }
                  $("./div[contains(@class, 'mw_was_td')]//select[./option[1][text()]]") {
                    insert_top("option")
                  }
                  $("./div[contains(@class, 'mw_was_td')]//select/option[@selected]") {
                    remove("./@selected")
                  }
                  $("./div[contains(@class, 'mw_was_td')][./input[@type='checkbox']]") {
                    add_class("mw_checkbox_content")
                  }
                }
              }
            }
          }
          # end billing information

          # payment information
          $("./div[@class='mw_Payment_Information']") {
            move_here("./following-sibling::div[contains(@class, 'mw_was_tr')][(*)][1]/div[contains(@class, 'mw_was_td')][1]", "bottom") {
              $("./div[@id='paymentinfo']") {
                $("./div[contains(@class, 'mw_was_tr')]") {
                  add_class("mw_label_box")
                  $("./div[contains(@class, 'mw_was_td')][./label]") {
                    add_class("mw_label_title")
                    $("./label[@for='card_cvv']") {
                      text() {
                        replace(/Card\sSecurity\sCode\/(CVV\:)/) {
                          set($1)
                        }
                      }
                    }
                    $("./label[@for='card_number']") {
                      text() {
                        replace(/Credit\s(Card\sNumber\:)/) {
                          set($1)
                        }
                      }
                    }
                  }
                }
              }
              $("./div[@id='security']") {
                move_here(".//input[@id='donate_button']", "top") {
                  insert_after("div", class:"mw_security") {
                    move_here("./following-sibling::div//a", "bottom")
                  }
                  btn_delegate() {
                    add_class("mw_btn2")
                  }
                }
                remove("./div[contains(@class, 'mw_was_tr')]")
              }
            }
          }
          # end # payment information

          remove("./div[contains(@class, 'mw_was_tr')]")
        }
      }
      # top content
      move_here("./following-sibling::div[contains(@class, 'mw_was_table')]//div[@id='formtop']", "top") {
        $("./div[contains(@class, 'mw_was_tr')]") {
          $("./div[contains(@class, 'mw_was_td')][./span]") {
            $("./span") {
              add_class("mw_top_title")
              remove("./br")
            }
            $("./img") {
              add_class("mw_check_img")
            }
          }
          $("./div[contains(@class, 'mw_was_td')][./img][not(./span)]") {
            add_class("mw_img_wrap")
          }
          $("./div[contains(@class, 'mw_was_td')][./p]") {
            add_class("mw_top_content")
          }
        }
      }
      # end top content
    }
    remove()
  }
  match_not($path, /error/) {
    $(".//div[@class='ErrorMessage']") {
      add_class("mw_hide")
    }
  }
}
$("./body") {
  add_class("mw_drtv_base")
  # footer
  $(".//div[@id='mw_footer']") {
    move_here("ancestor::body//div[@id='FAQsection']/..", "before") {
      move_here("./script", "before")
      move_here("./div[@id='FAQsection']", "before") {
        remove("./@style")
        $("./p[contains(@class, 'faqheadline')]") {
          add_class("mw_hide")
        }
        $("./p[contains(@class, 'question')]") {
          add_class("mw_flex_box")
          wrap_text_children("span", class: "mw_text_wrap mw_flex_box_item_1")
        }
        $("./div[contains(@id, 'answer')]") {
          $("./ul") {
            add_class("mw_list1")
          }
        }
        inner_wrap("div", class: "mw_box2")
      }
      remove()
    }
    $(".//li[contains(@class, 'mw_link_center')]/a") {
      text() {
        replace("»", " »")
      }
    }
    remove(".//ul/br")
  }
  # end of footer
  $(".//p[./img and ./br]/br") {
    add_class("mw_keep_br")
  }
  remove(".//br[not(contanis(@class, 'mw_keep_br'))]")
  $(".//table") {
    remove(".//@style")
  }
  table_dump(".//table")
  remove(".//table/@style")
  # header
  $("./div[contains(@class, 'mw_header')]") {
    remove("./div[contains(@class, 'mw_donate_bar')]")
    remove("./div[contains(@class, 'mw_header_menu')]")
    insert_after("img", src: "http://www.humanesociety.org/assets/images/mobile-mastheads/drtv-2013-m.jpg", class: "mw_header_img")
  }
  $(".//div[@id='ga-header']") {
    add_class("mw_hide")
  }
  # end of header
  $("./div[@id='mw_drtv_footer']/div[@id='mw_footer']") {
    remove(".//img")
    remove(".//li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
  }
  $(".//div[./a[contains(@href, 'convio')][./img]]") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_drtv_thank")
  $("./div[contains(@class, 'mw_was_table')]/div[contains(@class, 'mw_was_tr')][./div[contains(@class, 'mw_was_td')]/img]") {
    add_class("mw_hide")
  }
  $(".//div[@id='body']") {
    move_here("./div/div/div[@id='rightCol-main-content']", "top")
    $("./div[not(@id='rightCol-main-content')]") {
      add_class("mw_hide")
    }
    $(".//a/strong[contains(text(), 'Click here')]") {
      text() {
        replace(/Click/, "Tap")
      }
    }
  }
  $("./div[@id='mw_drtv_footer']/div[@id='FAQsection']") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_flickr")
  attributes(id:"mw_flick_iframe")
  remove("./div[@class='mw_header'] | .//tr[./td[contains(@class, 'shimCell')]]")
  $(".//tr[./td[contains(@class, 'formLabelBottomLeft')]]") {
    wrap("div", class:"mw_label_box")
    add_class("mw_label")
  }
  $(".//table") {
    $(".//tr[not(contains(@class, 'mw_label'))]") {
      move_to("./preceding-sibling::div[@class='mw_label_box'][1]", "bottom")
    }
    table_dump(".")
  }
}
$("./body") {
  add_class("mw_maps_tablet")
  $("./div[@id='wrapper']") {
    $("./div[@id='page']") {
      remove("./div[@id='page-head']")
      add_class("mw_box2_tablet")
      $("./div[@id='contentDiv']") {
        remove("./div[@id='inside']/div[@id='head']")
        $("./div[@class='no-sidebar']/div[@id='cols']/div[@id='main']/div[contains(@class,'section')]") {
          $("./h2") {
            add_class("mw_h1")
          }
          $("./p") {
            text() {
              replace(/or use the scroll-down box/, "")
            }
          }
          $("./img[@usemap='#Map2']") {
            move_to("preceding-sibling::table/tbody/tr/td", "bottom")
          }
          $("./map[@id='Map2']") {
            move_to("preceding-sibling::table/tbody/tr/td", "bottom")
          }
          $(".//area") {
            attribute("href") {
              value() {
                rewrite("link")
              }
            }
          }
        }
        # Hide "Feral Cat Organizations" Page's "States" selection button
        $(".//div[contains(@class,'features')]") {
          add_class("mw_hide")
        }
      }
    }
  }
}
log("in video_home_tablet.ts")

$("./body") {
  add_class("mw_video_root_tablet mw_video_common_tablet")

  # remove(".//div[@id='masthead']") # or hide this with CSS?

  # adjust the header to accomidate the videos
  $(".//a[contains(@class, 'mw_header_spillover')]") {
    name("div")
    remove("./@href")
    move_here("./ancestor::body//div[@id='masthead']/a")

    $(".//img") {
      remove("./@width")
      remove("./@height")
    }
  }


  # video pages use a white logo.. which can't be seen on the white nav
  $(".//img[@id='HSUSLogo']") {
    # attribute("src", "http://www.humanesociety.org/assets/images/global/logo.png")
  }

  # Build the top nav

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content mw_bar6")
      }
    }

    # Turn the video link into an accordian
    $("./li[contains(@class, 'active')]") {
      # attribute("data-ur-set", "toggler")
      

      $("./a") {
        name("span")
        # attribute("data-ur-toggler-component", "button")
        attribute("onclick","return false;")
        
        # Clear out the 'Video' text
        text("")

        copy_here("./ancestor::div[@id='page']//td[@id='leftNav']/ul/li[@id='active']/a")
        text() {
          replace(/\xC2\xA0»/, "")
        }

      }

      move_here("./ancestor::div[@id='page']//td[@id='leftNav']/ul") {
        #name("div")
        remove("./li[@id='active']")
        # attribute("data-ur-toggler-component", "content")
        add_class("mw_menu_content")
      
        $("./li") {
          wrap_text_children("span")
          remove("./span")
          $("./a") {
            # add_class("mw_bar3")
          }
        }
      }
    }

    move_to("./ancestor::body//div[contains(@class, 'mw_header_spillover')]", "bottom")
  }

  $(".//div[@id='main']") {
    table_dump("./table")

    # Video carousel
    video_ajax()

  }

# This hopefully disables the injected CSS by the TubePress plugin without breaking the rest of TubePress
insert_bottom("script", "TubePressCss = {load : function(path){}}")

}
$("./body") {
  add_class("mw_video_page_tablet mw_video_common_tablet")

  # video pages use a white logo.. which can't be seen on the white nav
  $(".//img[@id='HSUSLogo']") {
    # attribute("src", "http://www.humanesociety.org/assets/images/global/logo.png")
    remove("./@width")
    remove("./@height")
  }

  # adjust the header to accomidate the videos
  $(".//a[contains(@class, 'mw_header_spillover')]") {
    name("div")
    move_here("./ancestor::body//div[@id='masthead']/a")
  }

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content mw_bar6")
      }
    }
    move_to("./ancestor::body//div[contains(@class, 'mw_header_spillover')]", "bottom")
  }

  table_dump(".//table")

  # Force the video player to fit nicely in the iPhone's portrait mode.
  # The video plays full screen so landscape should not be a matter.

  $(".//object[@id='myExperience']") {
    $("./param[@name='width']") {
      attribute("value", "500")
    }

    $("./param[@name='height']") {
      attribute("value", "280")
    }
  }

  # make the storyInfo a box2
  $(".//div[@id='storyInfo']") {
    add_class("mw_box2")

    # Remove the inline style of the story description (it added extra padding to the bottom)
    $("./div[@id='storyDescription']") {
      remove("./@style")
    }
  }

  

  # Carousel the videos
  $(".//div[@id='videos']") {
    attribute("data-ur-carousel-component","scroll_container")

    $("./div[@class='video']") {
      attribute("data-ur-carousel-component","item")
    }

    wrap("div", class:"mw_video_carousel", data-ur-set:"carousel", data-ur-carousel-component:"view_container", data-ur-infinite:"disabled", class:"mw_carousel_container")
  }
}
$("./body") {
  add_class("mw_video_page mw_video_common")

  $(".//ul[@id='topNav']") {
      #Remove the home link
      remove("./li[1]")

      $("./li") {
        add_class("mw_header_menu_item")
        $("./a") {
          add_class("mw_header_menu_item_content")
        }
      }
  }

  table_dump(".//table")

  # Force the video player to fit nicely in the iPhone's portrait mode.
  # The video plays full screen so landscape should not be a matter.

  $(".//object[@id='myExperience']") {
    $("./param[@name='width']") {
      attribute("value", "320")
    }

    $("./param[@name='height']") {
      attribute("value", "180")
    }
  }

  # make the storyInfo a box2
  $(".//div[@id='storyInfo']") {
    add_class("mw_box2")

    # Remove the inline style of the story description (it added extra padding to the bottom)
    $("./div[@id='storyDescription']") {
      remove("./@style")
    }
  }

  

  # Carousel the videos
  $(".//div[@id='videos']") {
    attribute("data-ur-carousel-component","scroll_container")

    $("./div[@class='video']") {
      attribute("data-ur-carousel-component","item")
    }

    wrap("div", class:"mw_video_carousel", data-ur-set:"carousel", data-ur-carousel-component:"view_container", data-ur-infinite:"disabled", class:"mw_carousel_container")
  }
}
$("./body") {
  add_class("mw_submit_success")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//ul[@id='tools']")
  remove(".//p[string-length(text())= 1]")
  remove("//img[@id='desktop_head']")
  
  # handle that empty div mess at the botom
  $(".//div[@id='contentDiv']/div") {
    remove("@style")
    wrap_text_children("span")
    remove("./span[string-length()<3]")
  }

  $(".//div[@id='cols']") {
    remove("./div[not(@id) and not(@class)]")
    remove("ancestor::div/following-sibling::br")
    $(".//div") {
      remove("@style")
    }
  }
}
$("./body") {
  add_class("mw_press_login")

  $(".//a[@class='mw_header_spillover']") {
    insert("img", src:"http://www.humanesociety.org/assets/images/global/logo.png")
  }

  # add a header 
  $(".//div[@id='wrapper']") {
    insert_top("div", class:"mw_head_spacer") {
      match($path) {
        with(/register/) {
          insert("div", class:"mw_head_spacer_text", "Register")
        }
        with(/login/) {
          insert("div", class:"mw_head_spacer_text", "Login")
        }
        with(/forgot\-password/) {
          insert("div", class:"mw_head_spacer_text_forgot", "Forgot Password")
        }
      }
      
    }
  }

  $(".//ul") {
    add_class('mw_box2 login_helper mw_flex_box')

    $("./li") {
      add_class("mw_flex_box_item_1 mw_account_button")
    }
    
  }

  $(".//div[@id='main']") {
    add_class("mw_box2_tablet")

    $('./h1') {
      add_class('mw_h1')
    }

    $(".//input[@type='submit']") {
      add_class("mw_btn2")
    }
  }
}
log("in video press root")
$("./body") {
  add_class("mw_video_press_root mw_video_common")

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content")
      }
    }


  }

  $(".//div[@id='main']") {

    table_dump("./table")

    $(".//div[@id='channelList']") {
      add_class("mw_box2")
      $(".//div[@class='thumb']") {
        $("./a") {
          attribute("class" ,"mw_channel_description")
        }
        $("./a[img]") {
          attribute("class", "mw_channel_image")
        }
      }
    }
  }

}
$("./body") {
  add_class("mw_slideshow_root_tablet mw_video_common_tablet")
  log("slideshows root")

  # slideshows pages use a white logo.. which can't be seen on the white nav
  $(".//img[@id='HSUSLogo']") {
    # attribute("src", "http://www.humanesociety.org/assets/images/global/logo.png")
    remove("./@width")
    remove("./@height")
  }

  # adjust the header to accomidate the videos
  $(".//a[contains(@class, 'mw_header_spillover')]") {
    name("div")
    remove("./@href")
    move_here("./ancestor::body//div[@id='masthead']/a")
  }

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content mw_bar6")
      }
    }

    # Turn the Slideshow nav into an accordion
    $("./li[contains(@class, 'active')]") {
        # attribute("data-ur-set", "toggler")
        

        $("./a") {
          name("span")
          # attribute("data-ur-toggler-component", "button")
          attribute("onclick","return false;")
        }

        move_here("./ancestor::div[@id='page']//div[@id='galleryNav']/ul") {
          remove("./li[@id='active']")
          # attribute("data-ur-toggler-component", "content")
          add_class("mw_menu_content")
        
          $("./li") {
            wrap_text_children("span")
            remove("./span")
          }
        }
      }
    move_to("./ancestor::body//div[contains(@class, 'mw_header_spillover')]", "bottom")
  }

  

  $(".//div[@id='shell']") {
    table_dump(".//table")

    remove(".//div[@id='galleryNav']")

    # deal with the slideshow
    $(".//div[@id='content']/script[not(@src)]") {
        text() {
          # replace('width: "650"', 'width: "320px"')
          replace('width: "650"', 'width: "500px"')
          # replace('height: "610"', 'height: "300px"')
          replace('height: "610"', 'height: "469px"')
        }
    }

    $(".//div[@id='share']") {
      add_class("mw_box2")
    }

    #turn playlist into carousel like the video page

    $(".//div[@id='playlist']") {
      add_class("mw_carousel_container")
      attributes(data-ur-carousel-component:"view_container", data-ur-set:"carousel", data-ur-infinite:"disabled")


      $("./div[@id='playlist_scroller']") {
        attributes(data-ur-carousel-component: "scroll_container", id:"mw_playlist_scroller")

        $("./div[@class='playlist_slideshow']") {
          attribute("data-ur-carousel-component", "item")
        }

      }
    }
  }

  

}
$("./body") {
  add_class("mw_individual_video")
  
  remove("./div[@class='mw_header']")
  
  $("./div[@id='shell']/div[@id='page']") {
    $("./div[@id='masthead']//img") {
      remove("./@width | ./@height")
    }

    $("./div[@id='main']//div[@id='player']") {      
      $(".//param[@name='width']") {
        match($tablet) {
          with(/true/) {
            attributes(value: "600")
          }
          else() {
            attributes(value: "300")
          }
        }
      }
      $(".//param[@name='height']") {
        match($tablet) {
          with(/true/) {
            attributes(value: "600")
          }
          else() {
            attributes(value: "300")
          }
        }
      }
    }
  }
  
  $(".//div[@id='footer']") {
    wrap_text_children("span") {
      $("self::span") {
        match(text(), (/\A\s+\Z/)) {
          remove()
        }
      }
    }
    $("./a") {
      move_here("following-sibling::span")
    }
  }

}
log("in video_home.ts")

$("./body") {
  add_class("mw_video_root mw_video_common")

  # remove(".//div[@id='masthead']") # or hide this with CSS?

  # Build the top nav

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content")
      }
    }

    # Turn the video link into an accordian
    $("./li[contains(@class, 'active')]") {
      attribute("data-ur-set", "toggler")
      

      $("./a") {
        name("span")
        attribute("data-ur-toggler-component", "button")
        attribute("onclick","return false;")
        
        # Clear out the 'Video' text
        text("")

        copy_here("./ancestor::div[@id='page']//td[@id='leftNav']/ul/li[@id='active']/a")
        text() {
          replace(/\xC2\xA0»/, "")
        }

      }

      move_here("./ancestor::div[@id='page']//td[@id='leftNav']/ul") {
        #add_class("mw_testing")
        #name("div")
        remove("./li[@id='active']")
        attribute("data-ur-toggler-component", "content")
        add_class("mw_menu_content")
      
        $("./li") {
          wrap_text_children("span")
          remove("./span")
        }
      }
    }


  }

  $(".//div[@id='main']") {
    table_dump("./table")

    # Video carousel
    video_ajax()
    
    $(".//div[@class='mw_box2'][./div[@id='shareContainer']]") {
      attributes(class: "mw_video_box")
      $("..") {
        add_class("mw_iframe_div")
      }
    }
    
    remove("./div/div[contains(@class, 'mw_was_tr')]/div[contains(@class, 'mw_was_td')][not(*)]")
  }

# This hopefully disables the injected CSS by the TubePress plugin without breaking the rest of TubePress
insert_bottom("script", "TubePressCss = {load : function(path){}}")

}
$("./body") {
  add_class("mw_slideshow_root mw_video_common")
  log("slideshows root")

  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content")
      }
    }

    # Turn the Slideshow nav into an accordion
    $("./li[contains(@class, 'active')]") {
        attribute("data-ur-set", "toggler")
        

        $("./a") {
          name("span")
          attribute("data-ur-toggler-component", "button")
          attribute("onclick","return false;")
        }

        move_here("./ancestor::div[@id='page']//div[@id='galleryNav']/ul") {
          remove("./li[@id='active']")
          attribute("data-ur-toggler-component", "content")
          add_class("mw_menu_content")
        
          $("./li") {
            wrap_text_children("span")
            remove("./span")
          }
        }
      }

  }

  

  $(".//div[@id='shell']") {
    table_dump(".//table")

    remove(".//div[@id='galleryNav']")

    # deal with the slideshow
    $(".//div[@id='content']/script[not(@src)]") {
        text() {
          replace('width: "650"', 'width: "320px"')
          replace('height: "610"', 'height: "300px"')
        }
    }

    $(".//div[@id='share']") {
      add_class("mw_box2")
    }

    #turn playlist into carousel like the video page

    $(".//div[@id='playlist']") {
      add_class("mw_carousel_container")
      attributes(data-ur-carousel-component:"view_container", data-ur-set:"carousel", data-ur-infinite:"disabled")


      $("./div[@id='playlist_scroller']") {
        attributes(data-ur-carousel-component: "scroll_container", id:"mw_playlist_scroller")

        $("./div[@class='playlist_slideshow']") {
          attribute("data-ur-carousel-component", "item")
        }

      }
    }
  }

  

}
log("in video press root")
$("./body") {
  add_class("mw_video_press_root_tablet mw_video_common_tablet")

  # press pages use a white logo.. which can't be seen on the white nav
  $(".//img[@id='HSUSLogo']") {
    # attribute("src", "http://www.humanesociety.org/assets/images/global/logo.png")
    remove("./@width")
    remove("./@height")
  }

  # adjust the header to accomidate the videos
  $(".//a[contains(@class, 'mw_header_spillover')]") {
    name("div")
    move_here("./ancestor::body//div[@id='masthead']/a")
  }
  
  $(".//ul[@id='topNav']") {
    #Remove the home link
    remove("./li[1]")

    $("./li") {
      add_class("mw_header_menu_item")
      $("./a") {
        add_class("mw_header_menu_item_content mw_bar6")
      }
    }


    move_to("./ancestor::body//div[contains(@class, 'mw_header_spillover')]", "bottom")
  }

  $(".//div[@id='main']") {

    table_dump("./table")

    $(".//div[@id='channelList']") {
      add_class("mw_box2")
      $(".//div[@class='thumb']") {
        $("./a") {
          attribute("class" ,"mw_channel_description")
        }
        $("./a[img]") {
          attribute("class", "mw_channel_image")
        }
      }
    }
  }

}
$("./body") {
  add_class("mw_animal_legacy_video")
  remove("./div[not(@id='shell')]")
  $("./div[@id='shell']/div[@id='page']/div[@id='main']/div[@id='video']/div[@class='tubepress_container']") {
    $("./div[@class='tubepress_normal_embedded_wrapper']") {
      remove("./@style")
      remove(".//iframe/@height")
    }
    $("./div[@class='tubepress_thumbnail_area']/div[@class='tubepress_thumbs']/div[@id='tubepress_thumbs_centerer']") {
      add_class("mw_flex_box")
      $("./div[@class='tubepress_thumb']") {
        add_class("mw_flex_box_item_1")
        $(".//img") {
          remove("./@width | ./@height")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_press_login")

  $(".//ul") {
    add_class('mw_box2 login_helper mw_flex_box')

    $("./li") {
      add_class("mw_flex_box_item_1 mw_account_button")
    }
    
  }

  $(".//div[@id='main']") {
    add_class("mw_box2")

    $('./h1') {
      add_class('mw_h1')
    }

    $(".//input[@type='submit']") {
      add_class("mw_btn2")
    }
  }
}
$("./body") {
  add_class("mw_animal_legacy")
  $("./div[@id='wrapper']/div[@id='page']/div[./table]") {
    move_here(".//td[./ul[@id='tools']]", "before") {
      add_class("mw_box")
      name("div")
      
      # share bar
      $("./ul[@id='tools']//ul[@id='share_bar']") {
        $("./li[./img[@class='share_image']]") {
          insert("span", fetch("./img/@alt"), class: "mw_share_text")
        }
        $("./li/like") {
          name("fb:like")
        }
        remove(".//img")
      }
      
      $("./div[@id='videoBox']/iframe") {
        remove("./@height")
        attribute("src") {
          value() {
            rewrite("link")
          }
        }
      }
      
      $("./div[@id='bottomBox']") {
        $(".//ul") {
          add_class("mw_list1")
        }
        $(".//div[@id='donateHead']/a") {
          wrap_text_children("span")
          insert_top("div", class: "addthis_button_facebook")
        }
      }
    }    
    remove()
  }
}
# state volunteer pages
# http://www.humanesociety.org/assets/maps/volunteer/volunteer_list.html?state=WA&state=National

$("./body") {
  add_class("mw_maplist_tablet")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//ul[@id='tools']/li[1]")

  # put the logo back in the spillover
  $(".//div[@class='mw_header']/a") {
    insert("img") {
      attribute("src", "/assets/images/global/logo.png")
    }
  }

  # main content
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//h2") {
      add_class("mw_h1")
    }
  }
}
# Main "Campaign" page
# http://www.humanesociety.org/issues/campaigns
#

# April 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_campaigns")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
  }

  $(".//div[@id='side']") {
    remove("./div") // what even is this
  }
  $(".//div[@id='main']/p[not(*)]") {
    match(fetch("./text()"), /\A[\s ]*\Z/) {
      remove()
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
  }
}
# Main "Action" page
# http://www.humanesociety.org/action
#

# Feb 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_action")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")

  # move section links up into a top bar
  $(".//ul[@id='action']//ul") {
    add_class("mw_flex_box")
    $("./li") {
      add_class("mw_flex_box_item_1")
      remove("@style")
      $("./a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    move_to("//div[@class=' mw_masthead']", "after")
    # make two rows
    insert_after("ul", class:"mw_flex_box") {
      move_here("preceding-sibling::ul/li[position()>4]")
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }

    $(".//div[@id='actnow']") {
      move_to("../div[@id='feature']", "after")
    }
    # $(".//ul[@id='featurette']") {
    #   add_class("mw_flex_box")
    #   $("./li") {
    #     add_class("mw_flex_box_item_1")
    #   }
    # }
    $(".//div[@id='profiles' or @id='toolkit']") {
      # $(".//p[@class='image']") {
      #   move_to("..", "top")
      # }
      
      $(".//p[not(@class)]") {
        add_class("mw_text")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $("./ul") {
      add_class("mw_sidebar1_h")
      move_here("./span/li") // de-nesting
      remove("./span")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
  }
}
# Main "Issues" page
# http://www.humanesociety.org/issues
#

# April 1 2013 Sarah LaFrance

$(".//body") {
  add_class("mw_issues")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
  }

  # HSUS-334 according
  $(".//ul[@id='issue-browser']") {
    attributes(data-ur-set:"tabs")
    $("./li") {
      %mw_tab_index = index()
      $("./a") {
        attributes(data-ur-tabs-component:"button", class:"mw_issue_button", data-ur-tab-id: "mw_tab_"+%mw_tab_index)
        remove("@href")
        insert("div", class:"mw_plusminus")
      }
      $("./ul") {
        attributes(data-ur-tabs-component:"content", class:"mw_sublist", data-ur-tab-id: "mw_tab_"+%mw_tab_index)
        $(".//a") {
          inject("  &raquo;  ")
        }
      }
    }
  }

  $(".//div[@id='side']") {
    remove("./div") // what even is this
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }
}
# Main "Issues" page
# http://www.humanesociety.org/issues/chimpanzee_research
#

# April 8 2013 Sarah LaFrance

$("./body") {
  add_class("mw_issue_cat")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//br")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[div[contains(@id, 'wayne')]]")

  # $(".//div[contains(@id, 'item-')]") {
  #   remove("@style")
  #   $(".//script") {
  #     inner() {
  #       replace(/width: "[\d]*"/, 'width: "100%"')
  #       replace(/height: "[\d]*"/, 'height: "300px"')
  #     }
  #   }
  # }
  
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    # HSUS-233
    # inner_wrap("div", class:"mw_contain_white")
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3 | .//p[@class='author' or @class='subhead']") {
    add_class("mw_h3")
  }

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  $(".//a[contains(@class, 'back')]") {
    inner() {
      prepend("  &laquo;  ")
    }
  }

  # main content
  $(".//div[@id='main']") {

    $(".//img") {
      remove("@align")
    }

    # apply a class to the youtube video
    $(".//div[iframe[contains(@src, 'youtube')]]") {
      add_class("mw_feature_video")
    }
    
    $(".//div[@id='feature']") {
      insert("div", class:"mw_save_seals") {
        move_here("../*[not(@id='images') and not(@id='tools')]")
        remove("./div[not([iframe])]") #remove child divs not containing an iframe
        $("./a[not(@class) and not(h2)]") { // the get app button
          add_class("mw_get_app")
          move_to("..", "bottom")
        }
      }
    }
    $(".//div[@class='video']") {
      $(".//h2") {
        text() {

        }
      }

      /*$(".//iframe)") {
        add_class("mw_testing")
        remove("./@width")
        remove("./@height")
      }*/
    }
    $(".//div[contains(@class, 'area-news')]") { // handle any bottom links
      wrap_together("./a", "div") {
        add_class("mw_news_links")
      }
    }
    $(".//div[contains(@class, 'area-news') or contains(@class, 'victories')]//li") { // news item
      insert_top("div", class:"mw_news_title") {
        move_here("../p[@class='image']")
        move_here("../p[@class='date']")
        move_here("../h3")
        move_here("../p[@class='excerpt']")
      }
    }
    # different news section format:
    $(".//div[contains(@class, 'area-news')]") {
      wrap_text_children("span")
      remove("./span")
      $(".//div[contains(@id, 'templatelist') and not(ul)]") {
        remove("@style")
        remove(".//hr")
        $(".//p[@class='image']") {
          wrap("div") {
            attribute("class", "mw_news_title")
            move_here("following-sibling::p[@class='date'][1]")
            move_here("following-sibling::h4[1]") {
              add_class("mw_h3")
            }
            move_here("following-sibling::p[1]")
          }
        }
      }
    }
    # HSUS-98: Paragraph breaks
    # URL: http://www.humanesociety.org/issues/cosmetic_testing/index.html
    $("./div[contains(@class, 'section-lead')]") {
      $("./ul") {
        remove("./@style")
        add_class("mw_list1")
      }
      $("./h2/following-sibling::p[1]") {
        wrap_text_children("span")
        $("./span[1]") {
          add_class("mw_break_p")
          move_here("./following-sibling::span[1] | ./following-sibling::span[2]", "bottom")
        }
      }
    }
    
    # HSUS-105
    # URL: http://www.humanesociety.org/issues/cosmetic_testing/becrueltyfree/
    $("./div[@id='pledgeform']") {
      # remove extra img and donate btn
      remove("./img[contains(@alt, 'Pledge')] | ./img[contains(@alt, 'pledge')] | .//div[@class='pledge-donate-btn']")
      $("./div[@class='pledge-form']") {
        insert_top("div", class: "mw_pledge_title", "Global Pledge to Be Cruelty-Free")
        $(".//form[@id='actionform']") {
          $("./input[@class='pledge-submit-btn']") {
            attributes(alt: fetch("./@alt"), onclick: "window.scrollTo(0,1);")
            btn_delegate() {
              add_class("mw_pledge_btn")
            }
          }
        }
        $(".//div[@id='thankyou']") {
          remove(".//a/text()")
        }
      }
      $("./following-sibling::div[@id='features']/ul/li") {
        add_class("mw_pledge_list")
        $("./p[@class='image']") {
          move_here("./preceding-sibling::h3", "after")
        }
      }
    }
    # end of HSUS-105
    
    $("./div[contains(@class, 's_borderless') or contains(@class, 'section')]") {
      # desktop site hide
      remove("./div[@class='video-player']")
      $("./p[./span[not(.//a)]]") {
        add_class("mw_h3")
      }
      $("./div[contains(@class, 'section')]/p") {
        add_class("mw_issue_p")
        $(".//strong[not(a)]") {
          add_class("mw_block_link")
        }
      }
      $("./p[not(@class)]") {
        add_class("mw_issue_p")
        $("./a[starts-with(text(), '»')]") {
          add_class("mw_arrow_link")
        }
        $("./a") {
          match(text(), /^\W\s$/) {
            $("./following-sibling::a[1]") {
              add_class("mw_arrow_link")
            }
            remove()
          }
          text() {
            replace(/^\W\s/, "")
          }
        }
      }
    }
    $("./div[@id='features']/ul/li") {
      inner_wrap("div", class:"mw_feature_article") {
        move_here("./p[@class='image']", "before")
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    # trying something out here
    $("./ul") {
      add_class("mw_sidebar1_h")
      # Fix for HSUS-526
      insert_after("div", class: "mw_flex") {
        move_here("./following-sibling::div") {
          add_class("mw_flex_box_item_1")
        }
        $(".//ul/li") {
          $(".//a") {
            add_class("mw_more")
            inject("  &raquo;  ")
          }
        }
      }
    }

    $("./div[@id='seals-app']") {
      $(".//a[contains(@class, 'more')]") {
        add_class("mw_get_app")
      }
    }

    $(".//div[@id='relatedissues-promo' or @id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
    }
    $(".//div[@id='resources-promo']") {
      // Fix for HSUS-526
      add_class("mw_sidebar9")
      $(".//h2|.//h3") {
        attribute("class", "mw_h2")
      }
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%; height: 300px")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  $(".//a[contains(text(),'AltTox.org')]") {
    add_class("mw_alttox")
  }
  # hide bread crumb
  $(".//div[@id='contentDiv']/div[@class='no-banner']//div[@id='feature']/div[@class='mw_save_seals']") {
    add_class("mw_hide")
  }
}
## HSUS - 443

$("./body") {
  add_class("mw_actform_mconnect")
  $(".//div[@id='container']") {
    remove("parent::div/@style")
    $("./table[@id='title-text']//p") {
      name("h1")
      add_class("mw_h1")
    }
    $("./table[@id='target']") {
      remove("@style|@height|@align|@width") 
      $(".//td") {
        remove("@align")
      }  
      $(".//p") {
        name("h2")
        add_class("mw_h2 mw_center")
      }
    }
    $("./table[@id='main-text']") {
      remove("@style|@height|@align|@width")
      $(".//td") {
        remove("@align")
      }
    }
    $("./table[@id='gray-text']") {
      remove("@width|@align|@height")
      $(".//td") {
        remove("@align")
      }
      move_to("./following-sibling::div[@id='form']", "top")
    }
    $(".//form/table[@id='mconnect-phoneandzip' or @id='basic']") {
      remove("@width|@align")
      $(".//input") {
        remove("@style")
      }
      $(".//input[@id='submit-button']") {
        attribute("value", "CALL NOW")
        $("..") {
          add_class("mw_center")
        }
      }
    }
    $(".//table[contains(@id,'logo')]") {
      $(".//img") {
        attribute("src") {
          value() {
            replace(/\s*$/,"")
          }
        }
      }
      remove("@style") {
        $(".//td") {
          remove("@align")
        }
      }
      move_to("./ancestor::div[@id='form']", "after")
    }
  }

  # Remove style attributes and other attributes that mess up styles
  $("./div[@id='ga-container']") {
    $(".//div[@id='form']") {
      remove(".//input/@style")
      remove(".//table[@id='mconnect-phoneandzip']/@width")
    }
    $(".//table") {
      remove("./@bgcolor | ./@style")
    }
    $(".//div[@id='ga-header']") {
      remove()
    }
  }
  # Remove the "powered by convio"
  $("./div[a[contains(@href, 'convio')]]") {
    remove()
  }
  
  $jsRemove = "$('form').submit(function() { $('#logo1').remove();$('#logo2').remove(); })"
  insert_javascript_at(position("bottom"),$jsRemove)

}
# http://action.humanesociety.org/site/PageNavigator/hsus_yearend2012_humaneheroes.html?utm_source=vanitybillyslegacy&utm_medium=hsusweb&utm_campaign=billyslegacy13
# http://action.humanesociety.org/site/PageServer?pagename=textsignup
# action subdomain forms

# April 11 2013 - Sarah LaFrance

# note there's currently no mobile mapping for these urls.

$("./body") {
  add_class("mw_actform")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//@style")
  remove(".//div[@id='wrapper']/br")

  # see if we have a top header already
  $("self::body[//div[@id='ga-header']]") {
    add_class("mw_has_header")
  }
  $(".//form[@id='findrepcomponent']") {
    remove(".//ul/li[@class='findreps-sidetab']")
  }
  
  # http://action.humanesociety.org/site/PageServer?pagename=textsignup
  $(".//form[contains(@action, 'profiles\/join')]/table") {
    remove(".//td/div/br")
    $(".//td[./input[@id='person_first_name' or @id='person_city']]") {
      wrap_together("./input", "div", class: "mw_merge_input mw_flex_box") {
        $("./input") {
          wrap("div", class: "mw_flex_box_item_1")
        }
      }
    }
  }
  
  # insert masthead section if we don't have one
  $(".//div[@id='wrapper' and not(.//div[contains(@class, 'mw_masthead')])]") {
    insert_top("div") {
      add_class("mw_masthead")
    }
  }

  # if we imported a desktop header image, pull it in
  $(".//div[@class=' mw_masthead']") {
    
    # HSUS-367 fixed masthead
    remove("//img[@id='desktop_head']")
    # move_here("//img[@id='desktop_head']") {
    #   
    #   $("preceding-sibling::img") {
    #     remove()
    #   }
    # }
  }

  # fix images
  $(".//img") {
    $img_src = fetch("@src")
    $img_src {
      replace(/\/site/, '')
    }
    attribute("src", $img_src)
  }

  # grab main div
  $(".//div[@id='ga-container' or @id='page']") {
    remove("./br") # weird little gap
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    $("./div[2]|./div[@id='contentDiv']") {
      add_class("mw_main mw_box2_tablet")
    }

    $(".//iframe") {
      attribute("height", '500px')
    }

    $(".//td[@class='findreps-split-or-content']/table/tr/td[@class='findreps-large-td'][1]//td[contains(text(), '+')]") {
      add_class("mw_plus")
    }

    match($path,/^\/site\/Survey/) {
      $(".//div[@class='appArea']") {
        remove(".//@width | .//@align")
      }
    }
    # hide spam control text
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_hide")
    }

    $(".//div[@class='appArea' and .//input[@class='Button']]") {
      add_class("mw_buttonBar")
    }
  }
  $(".//td") {
    $("./p[not(*)]") {
      text() {
        replace(/&nbsp/, "")
        replace(/^[\s\u00a0]+/, "")
        replace(/[\s\u00a0]+\|$/, "")
      }
    }
  }

}
# secure welcome page
# http://action.humanesociety.org/site/PageServer?pagename=humane_welcome_page&JServSessionIdr004=8w797fvbu1.app305b
#

# April 11 2013 Sarah LaFrance

$("./body") {
  add_class("mw_welcome")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//br")

  $(".//div[@id='main']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='contentDiv']") {
    remove("./div[not(@id)]")
    $(".//div[@id='wrapper-body']") {
      $("./p") {
        $("./a[not(*)]") {
          add_class("mw_more")
        }
      }
      remove("@style")
      $(".//*") {
        remove("@style")
      }
      $(".//iframe") {
        remove("@width")
        remove("@height")
      }
    }
  }

}
#  "Action" subsection page
# http://www.humanesociety.org/action/now
# http://www.humanesociety.org/action/fed_bill
# http://www.humanesociety.org/action/toolkit
#

# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press mw_news_base")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']") 
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[div[@id='wayne']]")
  remove(".//div[@class='toolsSpacer']")

  $(".//li[@class='more']//a|.//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='list-nav']") {
    remove("@id") // fix my styling screwup
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_no_display")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//p[@class='related']") {
    wrap_text_children("span")
  }

  # pagination stuff taken from press
  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
      remove(".//li[@class='expanded']/ul")
      move_here("./span/li")
      remove("./span")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
  }

}
# http://www.humanesociety.org/action/alerts/maryland/
# action alerts

$("./body") {
  add_class("mw_action_alerts")
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//div[@id='page-bottom-spacer']") {
      add_class("mw_hide")
      remove("@style")
    }
    remove("./div[@id='page-head']")
    $("./div[@id='contentDiv']") {
      remove("./div[@id='head']")
      $("./div[@id='cols']") {

        # content section
        $("./div[@id='main']") {
          $(".//h2") {
            add_class("mw_h2")
          }
          $(".//div[@id='top-pagination']"){
            add_class("mw_search1")
            $(".//label") {
              wrap_text_children("span")
            }
            $(".//button[@type='submit']") {
              add_class("mw_btn5")
              text("")
            }
          }
        }

        # right-nav
        $("./div[@id='side']/ul") {
          add_class("mw_sidebar1_h")
        }
      }
    }
  }
}
# Spay Day issue page
# http://www.humanesociety.org/issues/spay_day
# modified version of issue_subject.ts

# March 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_issue_cat mw_spay_day")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//br")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[contains(@id, 'item-')]") {
    remove("@style")
    $(".//script") {
      inner() {
        replace(/width: "[\d]*"/, 'width: "100%"')
        replace(/height: "[\d]*"/, 'height: "300px"')
      }
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3 | .//p[@class='author' or @class='subhead']") {
      add_class("mw_h3")
    }

    $(".//a[contains(@class, 'more')]") {
      inject("  &raquo;  ")
    }

    $(".//a[contains(@class, 'back')]") {
      inner() {
        prepend("  &laquo;  ")
      }
    }
    $("./div[@id='side']") {
      $("./ul[@id='action']") {
        add_class("mw_sidebar1_h")
      }
      $("./div[@id='relatedissues-promo']") {
        wrap("div", class:"mw_flex_box") {
          move_here("following-sibling::div[@id='resources-promo']")
          $("./div[contains(@class,'promo')]") {
            add_class("mw_flex_box_item_1")
            $("./ul/li") {
              $(".//a") {
                add_class("mw_more")
                inject("  &raquo;  ")
              }
            }
          }
        }
      }
    }
  }

  $(".//div[@id='main']") {

    $(".//div[contains(@class, 'section-lead')]") {
      $("./p[count(.//a)=3]") {
        add_class("mw_spay_p")
      }
    }
    $(".//div[contains(@class, 'area-news')]") { // handle any bottom links
      wrap_together("./a", "div") {
        add_class("mw_news_links")
      }
    }
    $(".//div[contains(@class, 'area-news') or contains(@class, 'victories')]//li") { // news item
      insert_top("div", class:"mw_news_title") {
        move_here("../p[@class='image']")
        move_here("../p[@class='date']")
        move_here("../h3")
        move_here("../p[@class='excerpt']")
      }
    }
    $("./div[contains(@class, 's_borderless') or contains(@class, 'section')]") {
      # desktop site hide
      remove("./div[@class='video-player']")
      $("./p[./span[not(.//a)]]") {
        add_class("mw_h3")
      }
      # $("./div[contains(@class, 'section')]/p") {
      #   add_class("mw_spay_p")
      # }
      # $("./p[not(@class)]") {
      #   add_class("mw_spay_p")
      # }
    }
    $("./div[@id='features']/ul/li") {
      inner_wrap("div", class:"mw_feature_article") {
        move_here("./p[@class='image']", "before")
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    $("./div[@id='seals-app']") {
      $(".//a[contains(@class, 'more')]") {
        add_class("mw_get_app")
      }
    }

    $(".//div[@id='relatedissues-promo' or @id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
    }
    $(".//div[@id='resources-promo']") {
      add_class("mw_sidebar2")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%; height: 300px")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  $(".//a[contains(text(),'AltTox.org')]") {
    add_class("mw_alttox")
  }

}
$("./body") {
  add_class("mw_protect_seals_pledge_tablet")

  # Remove header
  remove("./div[@class='mw_header']")
  # Remove the the powered by convio
  remove("./div[a[contains(@href, 'convio')]]")

  $("div[@id='ga-container']/div[@id='ga-content']/table") {
    remove("@style")
  }

  $(".//div[@id='wrapper']") {
    remove("./br")
  }

  $(".//div[@id='page']") {
    remove(".//div[@id='page-head']")
  }
}
# current url - http://www.humanesociety.org/testing/hsus_testing/editorial/protect_seals_1.html
# future url - http://www.humanesociety.org/issues/seal_hunt/2013_hunt/home.html

# when this file is moved to live, uncomment it's mapping in mappings.ts in the work section
# seal splash action action page

# March 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_sealsplat")

  # hide unneeded sections
  $(".//iframe[@id='hiddenframe']") {
    add_class("mw_hide")
  }
  # Fix for HSUS-525
  $(".//div[@id='infographiccontents']|.//div[@id='head']/div[@id='top_band']") {
    add_class("mw_hide")
  }
  $(".//div[@id='head']") {
    remove("./@style")
  }
  # End HSUS-525
  # Header logo
  $(".//div[@id='mw_slider_overlay']") {
    insert_after("div", class:"mw_header_logo") {
      move_here("//div[@class='logo']") {
        $("./a") {
          insert("img") {
            attribute("src", asset("images/headband.png"))
          }
        }
      }
    }
  }

  # main content
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//p[@class='author' or @class='subhead']") {
      add_class("mw_h3")
    }
    # HSUS-525
    remove(".//div[@id='page-head']")
    # no top headline
    $(".//div[@id='main']") {
      $(".//div[contains(@class,'section-lead')]") {
        move_here("following-sibling::div[@id='feature']")
      }
    }
    $(".//p") {
      inner() {
        replace(/\s+/, " ")
      }
    }
    # HSUS-525 - End
    # video and leadin; number links rotate carousel
    $(".//div[@id='billboard']") {
      attributes(data-ur-carousel-component:"view_container", data-ur-set:"carousel", data-ur-infinite:"disabled", data-ur-fill:1, data-ur-autoscroll:"disabled")
      insert_bottom("span", id:"mw_carousel_dots", data-ur-carousel-component:"dots" )

      wrap_together("./div", "div") {
        attributes(data-ur-carousel-component:"scroll_container")

        $("./div") {
          remove("./@style")
          attributes(data-ur-carousel-component:"item")
          $("./self::div[not(./iframe)]") {
            remove("./a[@id='infographicimagelink']/text() | ./div[@id='appstoretext']/a")
          }
        }

        $("./div[@id='page2']/div[@id='appstoreimagelink']") {
          insert_top("img", src:"https://secure3.convio.net/humane/images/content/pagebuilder/seals2012-qr2.gif")
          wrap_text_children("span", class:"mw_app_text")
        }

        $("./div[@id='page3']") {
          $("./a[@id='infographicimagelink']") {
            insert_top("img", src:"http://www.humanesociety.org/assets/images/logos_odd_sizes/seal_bb_infographic.jpg")
          }
          
          # replace their JS popup with a link to the image
          $(".//a[contains(@href,'popupInfographic')]") {
            attribute("href", "http://www.humanesociety.org/assets/images/logos_odd_sizes/seals_infograph_2012.jpg")
          }
        }
      }
    }

    # share bar
    $(".//div[@id='sharethispage']") {
      move_to("..", "top")

      # Adding a label
      insert_top("div", class:"share_label", "Share: ")

      # Just wrap the text children so we can hide them. Good idea Sarah!
      $("./a") {
        wrap_text_children("span")
      }
    }

    # form to pledge
    $(".//div[@id='sidebar']") {
      move_here("../a") // grab donate now button
      $("./a") {
        wrap("div", id:"mw_donate_btn")
      }
    }
    # twitter feeds and links
    $(".//div[@id='lowercontent']") {
      # twitter feed
      # a lot of this content isn't being pulled in
      # the javascript to grab other tweets isn't loading
      $("./div[@id='twitterfeeds']") {
        $(".//div[@id='livefromtheice']") {
          move_here(".//span[@class='twuser']", "top")
          move_here("./a[@id='followrebecca']", "top")
        }
        $(".//a[@id='mortweets']") {
          inject("  &raquo;  ")
        }
      }
      # news and get the app
      $("./div[@id='contentstories']") {
        $(".//div[@class='story']") {
          move_here(".//div[@class='storytext']/a")
          inner_wrap("div")
          move_here(".//a[./img]", "top")
          $("./self::div[not(./a)]") {
            move_here(".//img", "top")
          }
        }

        remove(".//br")
        # add raquos to the more links that need them
        $(".//a[@class='storymainlink' or @id='mediacontacts' or @id='morenews']") {
          inject("  &raquo;  ")
        }
      }
    }

    # side bar
    $(".//div[@id='side']") {
      $("./ul[@id='action']") {
        add_class("mw_sidebar1_h")
      }
    }

    # empty div
    $(".//div[@id='page-bottom-spacer']") {
      remove("@style")
    }
  } // close main

  # footer
  $(".//div[@id='contentDiv']") {
    # Fix for HSUS-525 and 526 moblie footer dislpayed
    #insert_bottom("div", class: "_footer mw_box1") {

    move_here("//div[@id='footer']") {
      remove("./div[./img]")
      attribute("id") {
        value() {
          replace("er", "")
        }
      }
    #}

    #manually styled footers
    move_here("//ul/li/a[contains(@href,'privacy')]/ancestor::div[1]") {
      remove("@style | ./img | ./div[@id='footerseals']")
      $("./div[@id='fineprint']") {
        name("li")
        add_class("mw_footer_info")
        move_to("./preceding-sibling::ul", "bottom")
      }
      $(".//*[@style]") {
        remove("@style")
      }
      $("./ul/li[1]") {
        add_class('mw_footer_copyright')
        wrap_text_children("span")
        $("./span[1]") {
          inner(fetch("./text()")+fetch("./following-sibling::a/text()"))
        }
        inner(fetch("./span[1]/text()"))
      }
      $(".//li[./a]") {
        add_class("mw_links_inline")
        remove("./self::li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
      }
    }

    insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
      insert("span", class:"footer-strong", "Moovweb")
    }
  }
  # footer

    #prep the footer for styling - no actually I just broke it never mind
    # $("./div[contains(@class, '_footer')]") {
    #   move_to("//div[@id='contentDiv']")
    #   $(".//div[@id='footer']") {
    #     attribute("id", "foot")
    #     $("./ul/li[1]") {
    #       add_class('mw_footer_copyright')
    #       wrap_text_children("span")
    #       remove("span[2]")
    #       text() {

    #       }
    #     }
    #     $(".//li[./a and position()>1]") {
    #       add_class("mw_link_center")
    #       $("./a") {
    #         add_class("mw_bar2")
    #         remove("@style")
    #       }
    #     }
    #   }
    # }
  }
  # Fix for HSUS-525
  $(".//div[contains(@id,'relatedissues-promo')]") {
    add_class("mw_sidebar3")
  }
  $(".//div[@id='resources-promo']") {
    add_class("mw_sidebar9")
  }
}
# Main "Our Work" page
# http://www.humanesociety.org/work
#

# April 1 2013 Sarah LaFrance

$(".//body") {
  add_class("mw_work")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $("./li") {
        add_class("mw_flex_box_item_1")
        $("./a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//div[@id='animalaccord']") { //main topic togglers
      remove(".//div[@class='clear']")
      $(".//div[@class='menu_head']/p") {
        move_to("../following-sibling::div[1]", "top") // text needs to go in content
      }

      $(".//div[@class='menu_head']") {
        add_class("mw_flex_box")
        wrap("div", class:"mw_animal_accord") {
          attributes(data-ur-set:"toggler")
          move_here("./following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content") {
              # fix double column in that one section
              $(".//div[@class='wildcolumn2']/a") {
                move_to("../preceding-sibling::div")
              }
              $(".//a") {
                add_class("mw_animal_button")
              }
            }
          }
        }
        attributes(data-ur-toggler-component:"button") {
          $("./img") {
            insert_after("div", class:"mw_plusminus")
            $("following-sibling::span") {
              add_class("mw_flex_box_item_1")
            }
          }
        }
      }
    }
  }
  
  #  HSUS-251 Resources boxes - width
  $(".//div[@id='side']") {
    $("./ul[@id='action']") {
      add_class("mw_flex_box mw_sidebar1_h")
      $("./li") {
        add_class("mw_flex_box_item_1")
      }
    }
    $(".//div[@id='bluenav']") {
      add_class("mw_sidebar6")
      $(".//a") {
        add_class("mw_more")
        inject("  &raquo;  ")
      }
      $("./ul") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
      move_to("following-sibling::ul[@id='action']","after")
    }
  }
  # END HSUS-251 Resources boxes - width
}
# faqs under issues
#

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_qanda")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")


  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
  }

  # main content
  $(".//div[@id='main']") {
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//div[@id='feature']") {
      move_here("..//ul[@id='tools']", "top")
      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    $(".//div[contains(@class, 's_borderless')]") {
      match($path) {
        with(/issues\/cloning\/qa/) {
          #HSUS-451: workaround for this url since it is on a different format than the others
          # dont remove the ul
        }
        else() {
          remove("./ul[1]")
        }
      }     
      remove(".//hr")
      # remove back to top button
      remove("./p[./a[contains(text(),'back to top')]]")
      $("./strong") {
        wrap("p", class:"mw_question")
      }
      $("./p[./strong]") { // question
        add_class("mw_question")
      }
      # remove the p without any content in it
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
      $("./p[@class='author']") {
        add_class("mw_hide")
      }
      $("./ul/preceding-sibling::p[1]") {
        add_class("mw_question_ul")
      }
      # HSUS-120
      # http://www.humanesociety.org/animal_community/resources/qa/common_questions_on_shelters.html#How_many_animals_enter_animal_shelters_e
      $("./h3[contains(@class,'mw_h3')]") {
        wrap("div", class:"mw_qa_content")
      }
      $("./p") {
        move_to("preceding-sibling::div[@class='mw_qa_content'][1]")
      }
    }
  }


  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
  }

}
 $(".//form") { 
 #HSUS-426 adding in convio source tracking
  log("HSUS-426")
  log($path)
  # %s_src = $path
  log("----")
  $path {
    capture(/(s\_src\=[^&]+)/)
    {
      $s_src = $1
    }
  }
  # %s_src = $1
  match($s_src) {
    with($1) {
      log("$s_src matches $1")
      $1 = ""
    }
    else() {
      $1 = concat("&",$1)
    }
  }
  # hardcoding it as requested
  %s_subsource = "s_subsrc=tablet"
  log(concat("s_src: ", $s_src))
  log(concat("s_subsource: ", %s_subsource))

  # Construct a new form post action
  %post_action = fetch("./@action")
  
  # To avoid adding the source/subsource multiple times
  match_not(%post_action, %s_subsource) {
    log("applying s_src & s_subsrc")
    %post_action {
      replace($s_src, "")
    }
    # attributes(action: concat(%post_action, %s_src, "&", %s_subsource))
    log("-- post_action --")
    log(%post_action)
    match(%post_action) {
     # if there are no other post arguments, make the $s_src first
     with(/\?/) {
       log("s_src is not the first variable")
       attributes(action: concat(%post_action,"&", $s_src, "&", %s_subsource))
     }
     else() {
       
       log("s_src is the first variable")
       attributes(action: concat(%post_action,"?", $s_src, "&", %s_subsource))
     }
    }

  }
  
}
# "Campaign" subcat page
# http://www.humanesociety.org/issues/campaigns/factory_farming
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_campaign_cat")

  # remove
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='petfinder-promo']")

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul[li[@class='current']]") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      remove("./li[1]")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[@id='mw_masthead']", "top")
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//div[@class='off-lead']/p") {
      add_class("mw_h3")
    }

    $(".//a[contains(@class, 'more')]") {
      inject("  &raquo;  ")
    }
  }

  # main content
  $(".//div[@id='main']") {
    remove("./div[@id='feature']")
    $(".//iframe") {
      remove("@width")
      remove("@height")
    }
    $(".//div[@id='features']") {
      $(".//li") {
        move_here("./p[@class='image']", "top")
      }
      $(".//p") {
        inner() {
          replace(/\xC2\xA0/, "")
        }
      }
    }
    
    $("./div[contains(@class, 's_borderless')]") {
      $("./h1") {
        add_class("mw_h1")
      }
      $("./p") {
        add_class("mw_campaign_p")
        $("./self::p[contains(@class, 'subhead')]") {
          add_class("mw_campaign_subtitle")
          move_here("./preceding-sibling::p[contains(@class, 'date')]", "after")
        }
      }
    }
  }


  # sidebar
  $(".//div[@id='side']") {
    # remove("./div")
    $("./ul") {
      add_class("mw_sidebar1_h")
      ##HSUS - 442 - repeated donate button - one is styled with give-bttn class
      remove("./li[@id='donate']/a[@class='give-bttn']") 
    }
  }

}
# secure join a pledge page
# https://mlocal.secure.humanesociety.org/site/Advocacy?cmd=display&page=UserAction&id=2823&autologin=yes&s_src=website&s_subsrc=campaigns
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_pledge_tablet")
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }
  $("./div[@id='wrapper']") {
    remove("./div[@id='page-head']")
    $("./div[@id='page']") {
      add_class("mw_box2_tablet")
    }
    remove(".//div[@id='head'] | .//div[@id='wrapper-body']/@style")
    $(".//input[@id='button']") {
      add_class("mw_btn4")
    }
    
  }
  # remove
  # remove("./div[not(@id)]")
  # Remove the the powered by convio
  $("./div[a[contains(@href, 'convio')]]") {
    remove()
  }

  fixImages()

  #not sure what this was fixing...
  # this was fixed on their end --SL
  # HSUS-518 Content repeated
  remove(".//div[@class='showondesktop']")
  # HSUS-518 Content repeated

  # remove inline styling
  $(".//table") {
    remove("@style")
    remove("@bgcolor")
  }
  $(".//img") {
    remove("@align")
    remove("@width")
    remove("@height")
  }
  $(".//input") {
    remove("@size")
  }

  $(".//h1") {
    add_class("mw_h1")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//h3|.//span[@class='AlertListName']") {
    add_class("mw_h3")
  }

  $(".//div[@id='ga-content']/table/tbody") {
    # remove("./tr[.//div[@id='ga-header']]")
    $(".//div[@id='ga-header']") {
      # %home = fetch("//a[@class='mw_header_spillover']/@href")
      wrap("a", href:fetch("//a[@class='mw_header_spillover']/@href"), class:"mw_header_full_width")

      $("./ancestor::td[1]") {
        add_class("mw_header_full_width")
      }
    }
    remove("./tr[./td[not(*)]]")
    $(".//table") {
      add_class("mw_level_2")
      remove(".//@width | .//@height | .//@align | .//img/@style") 
      $("./tbody/tr/td") {
        add_class("mw_holder")
        $("./self::td[./img]") {
          add_class("mw_img_td")
        }
        #remove("./div[img]")
      }
      $("./self::table[.//td[contains(@class, 'mw_img_td')]]") {
        add_class("mw_img_table")
      }
    }
    $(".//div[@id='action-alert'] | .//div[@class='appArea']") { # everything's in here  
      
      insert_top("div", class:"mw_share_buttons") {
        insert("p") {
          text() {
            set("Share")
          }
        }
        move_here("..//div[@id='share_bar']")

        # For when they don't wrap their share buttons in a div#share
        move_here("..//a[contains(@href, 'addthis')] | ..//a[contains(@href, 'on.fb')]") {
          $("./img[contains(@src,'facebook')]/..") {
            add_class("addthis_button_facebook")
          }
          $("./img[contains(@src,'twitter')]/..") {
            add_class("addthis_button_twitter")
          }
        }

        # Checks to see if the div#share_bar already exists, if not, moves in the share buttons
        $("../div[@class='mw_share_buttons'][not(div)]") {
          insert("div", id:"share_bar") {
            move_here("../a")
            move_here("./div[@class='mw_share_buttons']/a")
          }
        }

        # insert("div", id:"share_bar") {
        #   move_here("../a")
        # }

        # check if the share bar is empty
        $("./div[not(node())]") {
          $("..") {
            attribute("style", "display: none;")
          }
        }

      }

      $(".//form") {
        # remove white space
        $("./p[not(*)][text()]") {
          text() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
        }
        # Make phone number fields bring up the number keypad by default
        $("./div[contains(@id, 'column')]/fieldset[@id='info']/table[contains(@class, 'mw_level_2')]//span[@class='NetscapeFix']/input | ./div[contains(@id, 'column')]/fieldset[@id='info']//input[@id='phone']") {
          attribute("type", "tel")
        }
        
        #HSUS-426 adding in convio source tracking
        # This has been moved to convio_tablet.ts
        # log("HSUS-426")
        # log($path)
        # # %s_src = $path
        # log("----")
        # $path {
        #   replace(/(s\_src\=[^&]+)/)
        # }
        # %s_src = $1
        # match(%s_src) {
        #   with($1) {
        #     log("%s_src matches $1")
        #     $1 = ""
        #   }
        #   else() {
        #     $1 = concat("&",$1)
        #   }
        # }
        # # hardcoding it as requested
        # %s_subsource = "s_subsrc=tablet"
        # log(concat("s_src: ", %s_src))
        # log(concat("s_subsource: ", %s_subsource))
      
        # Construct a new form post action
        # %post_action = fetch("./@action")
        # attributes(action: concat(%post_action, "&", %s_src, "&", %s_subsource))
        
      }
      
      $(".//p[img]") {
        add_class("mw_top_image")
        $("./img") {
          remove("@style")
          remove("@height")
          remove("@width")
          remove("@hspace")
        }
      }

      #HSUS-495 20131204 Start
      $(".//form/p[img]") {
        add_class('mw_read_more')
        $("./img") {
          move_to("../a")
        }
      }
      #HSUS-495 20131204 End

      $("./form/img") {
        wrap("div", style:"text-align:center;") {
          #For HSUS-429 :Removed style attribute from the below code for  [Tablet] Increase Padding on Action Alert Images
          add_class("mw_img_pad")
          #End of HSUS-429
        }
      }
      $(".//div[@id='mobileheadlinetext']") {
        wrap_text_children("h1") {
          add_class("mw_h1")
        }

      }
      # Move the 'message' into column1
      $("./form/fieldset[@id='message']") {
        move_to("../div[@id='column1']", "top")
      }
      # Move the intro text to the top of the form
      $(".//div[@id='column1']/*[not(@id='message')]") {
        move_to("../..")
      }

      $(".//div[@id='column2']") {
        move_to("..", "bottom")
      }

      $(".//div[@id='column1']") {
        move_to("..", "bottom")

        $(".//div[@class='field-wrap']/textarea[@id='middle']") {
          remove("./@cols")
        }
      }

      # Wrap the columns into... columns haha
      # refine the page style
      # https://.secure.humanesociety.org/site/Advocacy?cmd=display&page=UserAction&id=6045
      $(".//form[@id='beanForm']") {
        wrap_together(".//div[contains(@id, 'column')]", "div", class:"mw_flex_box mw_form_column") {
          $("./div") {
            add_class("mw_flex_box_item_1")
          }
          # HSUS-295 (Tablet) Action Alert Submit Button & Form Position
          move_here("./div[@id='column2']") {
            move_here("ancestor::form[@id='beanForm']//script")
            move_here("ancestor::form[@id='beanForm']//div[contains(@class, 'bottom')]") {
              add_class("mw_bottom")
            }
          }
        }
        $(".//table[@id='survey-questions']//tr[@class='old-school']") {
          remove("./td[@class='req']")
          $(".//span[@class='NetscapeFix']/ancestor::td[1]") {
            add_class("mw_netscapeFix")
          }
        }
        # END HSUS-295 (Tablet) Action Alert Submit Button & Form Position
      }
    }
    # HSUS-495 (Tablet) Reduced padding above "Here's how to find the right dog for you:" by hiding the empty div.
    $(".//div[@id='action-alert']/form") {
      $("./div[count(*)=0]") {
        add_class("mw_hide");
      }
    }
    # HSUS-495 Ends
  }

  # youtube video fixes

  $(".//iframe[contains(@src, 'youtube')]") {
    remove("./@height | ./@width")
    attribute("style", "width: 100%;")

  }

  #prep to add in the footer
  $(".//ul[@style]/ancestor::div[@style]") {
    add_class("mw_pledge_footer")
    attribute("id", "foot")
    remove("@style")

    $(".//*[@style]") {
      remove("@style")
    }
    $(".//li") {
      add_class("mw_link_center")
      $("./a") {
        # attribute("style", "color: #a7a7a7;")
      }
      
    }
    remove(".//img")
  }

  $("//div[@class='_footer mw_box1']") {
    move_here("//div[@class=' mw_pledge_footer']", "top")
  }

  $(".//td[@class=' mw_holder'][p]/p[@style]") {
    add_class("mw_advocacy_suggestion")
    remove("@style")
  }

  # Use our <select> element identifiers
  $(".//select/..") {
    add_class("mw_select_arrows")
  }

  # custom keyboards
  $(".//input[contains(@name, 'email')]") {
    keyboard("email")
  }
  $(".//input[contains(@name, 'zip')]") {
    keyboard("numeric")
  }
  $(".//input[contains(@name, 'phone')]") {
    keyboard("tel")
  }

  # Hide the old share table.. with just the donation link
  $(".//a[contains(@href, 'donation')]") {
    add_class("mw_hide")
  }

  # Hide the first "send your message" not necessary for the tablet?
  $(".//div[@class='submit-wrap']") {
    add_class("mw_hide")
  }

  # Make the textarea taller
  $(".//textarea[@id='middle']") {
    attribute("rows","15")
  }

  # HSUS-379 Webform Submission for Alerts page
  $(".//form[@id='WebformInput']/div[@class='appArea']") {
    remove("./br | ./table//td/br | ./ancestor::div[@id='wrapper'][1]/br")
    $("./div[./img[contains(@src, 'webform.puzzle')]]") {
      add_class("mw_puzzle_img")
      wrap("div", class:"mw_puzzle_box mw_flex_box") {
        move_here("./following-sibling::div", "bottom")
        inner_wrap("div", class:"mw_puzzle_input mw_flex_box_item_1")
      }
      move_to("..", "before")
      $("./img") {
        attribute("src") {
          value() {
            replace(/(\/|\w|\.)+org\//, "")
          }
        }
      }
    }
    $("./p[./input[@class='Button']]") {
      remove("./text()")
      $("./input[@type='submit']") {
        add_class("mw_puzzle_button")
        $("./self::input[@id='CNV_submit']") {
          add_class("mw_btn2")
        }
        $("./self::input[@id='CNV_cancel']") {
          add_class("mw_btn4")
        }
      }
    }
  }
  
}
# Main recipe page
# http://www.humanesociety.org/issues/eating/recipes
# this is a lot like an issue subject landing but the recipe pages have tons of lists 
# for ingredients &c and I want those to look nice

# March 8 2013 Sarah LaFrance

$("./body") {
  add_class("mw_recipe_main")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2|.//p[@class='subhead' and string-length(text())>1]") {
      add_class("mw_h2")
    }
  }

  # main content
  $(".//div[@id='main']") {

    $(".//h3|.//p[@class='author' and string-length(text())>1]") {
      add_class("mw_h3")
    }
    $(".//table") {
      $("following-sibling::*") {
        add_class("mw_after_tbl")
      }
    }

    $(".//div[div[@id='images']]") {
      remove("@style") // unfloat this
    }
    # shuffle everything around into 2 sections
    insert("div", class:"mw_recipes") {
      move_here("..//table")
      move_here("..//*[contains(@class, 'mw_after_tbl')]")
    }
    insert("div", class:"mw_top_section") {
      remove("preceding-sibling::div[@id='feature']")
      move_here("//ul[@id='tools']")
      move_here("//div[contains(@class, 's_borderless')]/*")
      move_to("..", "top")
    }
    remove(".//div[contains(@class, 's_borderless')]")

    $(".//div[@class='mw_recipes' and not(table)]") {
      remove()
    }
    $(".//div[@class='mw_recipes']") {
      $(".//table") {
        $(".//tr") {
          $(".//td") {
            name("div")
            attributes(class:"mw_td")
          }
          name("div")
          attributes(class:"mw_tr")
        }
      }
      insert_top("div", class:"mw_recipe_list") {
        move_here("//div[@class='mw_tr']")
        $(".//div[@class='mw_td' and ./a[@name]]") {
          attributes(data-ur-set:"toggler")
          $("./a") {
            attributes(data-ur-toggler-component:"button", class:"mw_bar3")
            insert("div", class:"mw_plusminus")
          }
          move_here("../following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content", class:"mw_recipe_bar")
          }
          remove("following-sibling::div") // spacer
        }
        remove("./div[@class='mw_tr' and not(div[@align])]") // more spacers
        $(".//*") {
          remove("@align")
          remove("@valign")
          remove(".//br")
        }
      }
      remove(".//table")
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
      $("./p[1]") {
        wrap("div", class:"mw_flex_box") {
          move_here("following-sibling::p")
          $("./p") {
            add_class("mw_flex_box_item_1")
          }
        }
      }
    }
  }
}
# News main page
# http://www.humanesociety.org/news/
#

# Jan 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_news")

  # removing
  remove(".//div[@id='side']") // take out for now
  remove(".//div[@id='list-nav']")

  $(".//h2") {
    attribute("class","mw_h1")
  }


  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") {
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove("./div")
    remove("./ul[@id='site-nav']")
    remove("./h1")
  }

  $(".//div[@id='contentDiv']") {
    remove("./div[not(@id)]")
    $(".//div[@class='pagination']") { // search bar
      add_class("mw_search1")
      $(".//button") {
        add_class("mw_btn5")
        text() {
          clear()
        }
      }
    }

    $(".//li") { // news item
      add_class("mw_newsItem")
      insert("div") {
        move_here("../p[@class='date']")
        move_here("../h3")
      }
      move_here(".//img", "top")
      remove(".//p[@class='image']")
    }

    $(".//a[@class='more']") {
      wrap("div", class:"more-link")
    }

  }

}
$("./body") {
  add_class("mw_off_duty")

  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
  }
}
# News articles
# http://mlocal.humanesociety.org/news/press_releases/2013/01/wy-ag-gag-hb0126-opposition-011513.html
#

# Sarah LaFrance Jan 29 2013

$("./body") {
  add_class("mw_article")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//li[@id='pdf']")
  remove(".//div[@id='petfinder-promo']")

  table_dump(".//table")

  $(".//div[not(contains(@class,'mw_masthead'))]") {
    remove("@style")
  }

  $(".//div[@id='feature' and a[@class='back']]") {
    remove()
  }

  # clear sidebar in faith articles
  $(".//div[@id='side']") {
    remove("./style")
    remove("./div[contains(@id, '-promo')]")
    remove("./iframe")
  }

  $(".//div[contains(@class, 's_borderless')]") {

    # move_here("./p[contains(@class, 'author')]", "top")
    # move_here("./p[contains(@class, 'subhead')]", "top")
    # move_here("./h1[1]", "top")
    # move date to below author and subhead

    # social media buttons
    move_here(".//ul[@id='tools']", "top")
    $(".//ul[@id='share_bar']") {
      $("./li[1]") { // "Share"
        remove("./*")
        insert("h3", class:"mw_share") {
          inject("Share")
        }
      }
    }

    $(".//iframe|.//embed") {
      remove("@height")
      remove("@width")
    }

    # Kevin's telephone script from the seagate project

    inner() {
      replace(/((\d)*[ ()\-.\d]+\d)/) {
        %orig = %1
        %1 {
          replace(/\s/, "")
        }
        %stripped = %1
        %stripped {
          replace(/\D/, "")
        }
        # ignore access codes
        match_not(length(%stripped), /^[1-8]$/) {
          set("<a href='tel:" + %stripped + "'>" + %orig + "</a>")
        }
      }
    }

    # what is this even for? it's breaking pigeons problem solver
    # This is for HSUS-361,381,428 When there has a carousel in the accordion

    $("./div[@class='image-scroller']") {
      $carousel_ans = "false"
      $("./ul/li[position() > 1][./p[@class='image']]") {
        $carousel_ans = "true"
      }
      match($carousel_ans, /true/) {
        inner_wrap("div", data-ur-set:"carousel", data-ur-carousel-component:"view_container", data-ur-fill:"1") {
          $("./ul") {
            name("div")
            attributes(data-ur-carousel-component:"scroll_container")
            $("./li") {
              name("div")
              attributes(data-ur-carousel-component:"item")
            }
          }
          insert_bottom("div", data-ur-carousel-component: "dots")
          $("ancestor::div[contains(@id,'answer')][1]") {
            add_class("mw_carousel_ans")
          }
        }
      }
      $(".//p[@class='image']") {
        wrap("div", class:"mw_ans_img")
      }
    }
    # HSUS-369 Correct styling on Animal Tips pages
    $("./ul[@class='item-list']/li[@class='image']") {
      $("./p[@class='image']") {
        move_to("preceding-sibling::p[1]","before")
      }
      $("./p[@class='related']") {
        move_to("preceding-sibling::p[1]","after")
      }
      $("./ul//a") {
        inject("  &raquo;  ")
      }
    }
    # HSUS-370 [Mobile] Decrease line spacing in FAQ
    $("./p[./span[contains(@id,'question')]]") {
      add_class("mw_question_p")
    }
    $("./p[not(*)]") {
      match(fetch("./text()"), /\A[\s ]*\Z/) {
        remove()
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {

      }
      $(".//div[@class='module']/h3/a") {
        inner() {
          append("  &raquo;  ")
        }
      }
    }
  }
  

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_youtube_height_fix")
    attributes(width:"100%")
  }

  # handling forms
  $(".//form[@method='POST']") {
    add_class("mw_form_area")
    remove(".//br")

    # re-hide spam control
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_hide")
    }
  }

  # HSUS-34 Survey table, only restyle it for mobile because the table breaks the viewport.
  match($tablet) {
    with(/false/) {
      $("./div[@id='wrapper']//div[contains(@class,'s_borderless')][./h1/span[contains(text(),'SURVEY')]]") {
        $("./div[contains(@class,'mw_was_table')]") {
          $(".//div[contains(@class,'mw_was_tr')][position() > 1]/div[contains(@class,'mw_was_td')][1]") {
            var("mw_sub_header"+index(), fetch("./text()"))
            add_class(var("mw_sub_header"+index()))
            remove()
          }
          $(".//div[contains(@class,'mw_was_td')][not(*)]") {
            match(text(), (/\A\s+\Z/)) {
              remove()
            }
          }
          $(".//div[contains(@class,'mw_was_tr')][1]/div[contains(@class,'mw_was_td')]") {
            $("./ancestor::div[contains(@class,'mw_was_table')]") {
              insert("div",class:"mw_survey_item") {
                move_here("..//div[contains(@class,'mw_was_tr')]/div[contains(@class,'mw_was_td')][1]")
                $("./div[contains(@class,'mw_was_td')][position() > 1]") {
                  $mw_sub_header_index = index()
                  insert_top("span", var("mw_sub_header"+$mw_sub_header_index) + ":", class: "mw_title")
                }
              }
            }
          }
        }
        # remove &nbsp; , white space
        $(".//p[not(*)] | ./p[./br]") {
          inner() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
          remove("./br")
        }
        # end remove &nbsp; , white space
        remove(".//@style")
      }
    }
  }
  # end of HSUS-34
}
# common news tritium
# imported into article, news, press pages

# Sarah LaFrance Jan 31 2013

$("./body") {
  add_class("mw_news_base")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  # HSUS-366 Missing Portion of Body on Page
  # remove(".//p[string-length(text())= 1][not(./a)][not(@class='image')]")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='side']/div[@class='simple']")
  # remove(".//br")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h2")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='feature']/a") {
    inject_before("  &laquo;  ")
  }

  $(".//div[contains(@class, 's_borderless')]") {
    $(".//h3") {
      add_class("mw_h3")
    }
    $("./div[./p/strong[position() = 1]]") {
      add_class("mw_misc_content")
    }
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }


  # remove the width and height of the youtube video
  $(".//iframe[contains(@src, 'youtube')]") {
    attributes(width:"100%", height:"")
  }
  # for brightcove experiences
  $(".//object[@class='BrightcoveExperience']") {
    remove("param[@name='width']")
  }
  
  # For HSUS-469:(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
  }
  #END Of HSUS-469
}

# News main page
# http://www.humanesociety.org/news/
# 

# Jan 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
    }
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
        # check for base cases and remove surrounding numbers
        # match($previous) {
        #   with("false") { // we're on the first page of results
        #     remove("./div[position() > 4]")
        #   }
        #   with("true") {
        #     match($next) { // we're on the last page
        #       with("false") {
        #         remove("./div[position() < (("+$current+" mod 10)-3)]")
        #       }
        #       with("true") { // general case
        #         remove("./div[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
        #       }
        #     }
        #   }
        # }
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
  }
  
  # HSUS-261 Update styling for Baby Animal togglers
  $(".//div[contains(@class,'s_borderless')]") {
    $("./h2[not(contains(@class,'space'))]/preceding-sibling::h2[contains(@id,'question')][1]") {
      add_class("mw_news_question")
    }
    $(".//h2[contains(@id,'question')]") {
     wrap("div", class:"mw_question_block")
    }
  }
  # End HSUS-261 Update styling for Baby Animal togglers

}

$("./body") {
  add_class("mw_news_briefs")

  # removing
  remove(".//div[@id='side']") // take out for now
  remove(".//div[@id='list-nav']")

  $(".//h2") {
    attribute("class","mw_h1")
  }


  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") {
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove("./div")
    remove("./ul[@id='site-nav']")
    remove("./h1")
  }

  $(".//div[@id='contentDiv']") {
    remove("./div[not(@id)]")
    $(".//div[@class='pagination']") { // search bar
      add_class("mw_search1")
      $(".//button") {
        add_class("mw_btn5")
        text() {
          clear()
        }
      }
    }

    $(".//li") { // news item
      add_class("mw_newsItem")
      insert("div") {
        move_here("../p[@class='date']")
        move_here("../h3")
      }
      move_here(".//img", "top")
      remove(".//p[@class='image']")
    }

    $(".//a[@class='more']") {
      wrap("div", class:"more-link")
    }

  }

}
# interview article pages
# http://www.humanesociety.org/news/interview/2012/m-r-wells-090512.html
#

# March 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_interview")

  # removing
  

}
$("./body") {
  add_class("mw_whitepapers")

  $(".//div[@id='page-head'] | .//div[@id='head'] | .//div[@id='page-bottom-spacer']") {
    add_class("mw_hide")
  }

  #Add the box2 to the wrapper
  $(".//div[@id='page']") {
    add_class("mw_box2")
  }

  # The first h3 is an exception.. it is not in a li
  $(".//div[contains(@class, 'section')]/h3") {
    add_class("mw_whitepaper_header mw_bar5")
    attributes(data-ur-toggler-component:"button")
    wrap("div",class: "mw_whitepaper_container", data-ur-set:"toggler") {
      $("./following-sibling::p[1]") {
        #add_class("mw_clean_me_up_scotty")
        remove()
      }
    }
  } 

  $(".//div[contains(@class, 'section')]/li[h3]") {
    move_here("./h3", "after") {
      add_class("mw_whitepaper_header mw_bar5")
      attributes(data-ur-toggler-component:"button")
      wrap("div",class: "mw_whitepaper_container", data-ur-set:"toggler")
    }
  }
  $(".//div[contains(@class, 'section')]/li[a]") {
    add_class("mw_whitepaper_content ")
    move_to("./preceding-sibling::div[contains(@class, 'mw_whitepaper_container')][1]")
  }

  $(".//div[contains(@class, 'mw_whitepaper_container')]") {
    wrap_together("./li", "div", data-ur-toggler-component:"content")
    $("./div/li") {
      name("div")
      $("./a") {
        add_class('mw_bar2')
      }
      
    }
  }

  # Remove the extra <p>'s
  $(".//div[contains(@class, 'mw_whitepaper_container')]") {
    remove(".//p")
  }

  # Move the div#side outside the div#page
  $(".//div[@id='side']") {
    move_to("./ancestor::div[@id='page']", "after")
  }

}
# main news QA page
# http://www.humanesociety.org/news/resources/qa
# 

# Mar 4 2013 Sarah LaFrance
# only real change is to top pagination to fix the weird sorting issue

$("./body") {
  add_class("mw_press")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") { // this section is hidden with styles but we need to re-hide it
    add_class("mw_no_display")
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
        # check for base cases and remove surrounding numbers
        match($previous) {
          with("false") { // we're on the first page of results
            remove("./div[position() > 4]")
          }
          with("true") {
            match($next) { // we're on the last page
              with("false") {
                remove("./div[position() < (("+$current+" mod 10)-3)]")
              }
              with("true") { // general case
                remove("./div[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
              }
            }
          }
        }
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='state']") {
    add_class("mw_sidebar5")
  }

  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
  }

}
# Animal browse page
# http://www.humanesociety.org/animals/browse_animals.html
# 

# March 27 2013 Sarah LaFrance

$("./body") {
  add_class("mw_atoz") 

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//br")

  # main animal list

  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[1]", "top")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }
  $(".//div[@id='browseanimals']") {
    $("./h2") {
      add_class("mw_h1")
    }
    $("./p") {
      add_class("mw_h3")
    }
    $(".//li/a") {
      add_class("mw_animal_button")
    }
    $(".//li/a[contains(text(), ')') or contains(text(), 'Aquarium')]") {
      add_class("mw_parenth")
    }
  }

  $(".//div[@id='side']") {
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }

}
# subcategories of the animal page
# http://www.humanesociety.org/animals/pets
# http://www.humanesociety.org/animals/rabbits

# April 9 2013 Sarah LaFrance

$("./body") {
  add_class("mw_pets")

  #removals
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")

  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[@class='mw_masthead']", "top")
  }

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  # main content
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")

    # general classes
    $(".//h2") { // fix this so it doesn't mess up boxes
      add_class("mw_h1")
      text() { }
    }
    $(".//h3") {
      add_class("mw_h2")
    }

    # pull the pet selector into lead
    $(".//div[@id='main']/div[1]") {
      move_here("following-sibling::div/div[@class='headline']")
    }

    # ignore this for now
    $(".//object") {
      $("./param[@name='linkBaseURL']") {
        $val_var = fetch("@value")
      }
      name("iframe")
      attribute("src", $val_var)
    }
    $(".//iframe") {
      remove("@style")
    }

    $(".//select[@name='fieldname']") {
      remove("@style")
      $selected = fetch("./option[@selected]/text()")
      wrap("div", class: "mw_select1") {
        insert_bottom("span", class: "mw_select_content", $selected)
      }
    }
  }


  $(".//div[contains(@class, 's_borderless')]") {
    $(".//a[@class='more']") {
      $destination = fetch("@href")
      $destination {
        replace(/\s$/, "") //chop off the occasional trailing spaces
      }
      attribute("href", $destination)
    }
    $(".//h2") {
      move_to("..", "top")
    }
    $(".//div[@id='images']") {
      $(".//*") {
        remove("@style") // remove padding
      }
      move_here(".//p[@class='image']")
      remove("./ul")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//p[@class='image']//img") {
      add_class("mw_img_box")
    }
  }

  $(".//div[@id='moreabout']") { // link section with background image
    $(".//li/a") {
      inject("  &raquo;  ")
    }
  }

  $(".//div[contains(@class, 'area-news')]") { // news headings section
    $(".//li") { // news item
      add_class("mw_newsItem")
      insert("div") {
        move_here("../p[@class='date']")
        move_here("../h3")
      }
      move_here(".//img", "top")
      remove(".//p[@class='image']")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
      wrap("div", class:"more-link")
    }
  }

  # sidebars
  $(".//div[@id='side']") {
    remove("./div[not(@class)][not(contains(@id, 'magazine-promo'))]")
    $("./div[@class='resources-promo' or @id='relatedissues-promo']") { // blue boxes
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
    # resources on pets sidebar
    $(".//div[@class='resources-promo']") {
      add_class("mw_sidebar2")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
      $("./ul") {
        name("div")
        $("./li[./a[@class='more']]") {
          name("div")
        }
        $("./li[position() mod 4 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./li") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/li") {
          name("div")
          add_class("mw_flex_box_item_1")
        }
      }
    }
    # donate sidebar
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
      move_to("preceding-sibling::div","before")
    }
    
    $(".//div[@id='relatedissues-promo']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
      $("./ul") {
        name("div")
        $("./li[./a[@class='more']]") {
          name("div")
        }
        $("./li[position() mod 5 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./li") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/li") {
          name("div")
          add_class("mw_flex_box_item_1")
        }
      }
      $("./a[@class='more']") {
        wrap("div",class:"mw_view_more")
      }
    }
   $("./div[@id='magazine-promo']") {
     add_class("mw_sidebar7")
     $(".//a[contains(@class, 'more')]") {
       inject("  &raquo;  ")
     }
   }
  }
}
# Animal main page
# http://www.humanesociety.org/animals/


$("./body") {
  add_class("mw_animal_main")
  
  # # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='petfinder-promo']")
  
  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[1]", "top")
  }
  
  # HSUS-344
  # http://humanesociety.org/testing/cd-test2.html
  $(".//div[@id='cols']") {
    move_to("./following-sibling::div[@id='page']", "top")
  }
  # end of HSUS-344
  
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    remove("./div[not(@id)]") // empty
  
    # top navigation
    $(".//div[@id='page-head']") {
      move_here(".//ul//ul") { // grab the subcategory list from the main nav
        add_class("mw_flex_box")
        $(".//li") {
          add_class("mw_flex_box_item_1")
          $(".//a") {
            add_class("mw_bar3 mw_h3")
          }
        }
      }
      remove("./h1")
      remove("./ul[@id='site-nav']")
      remove("./div")
      move_to("//div[@class=' mw_masthead']", "after")
    }
   
    $(".//div[@id='main']") {
      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//h2") {
        add_class("mw_h2")
      }
      $(".//h3") {
        add_class("mw_h3")
      }
      remove(".//div[@class='toolsSpacer']")
    }
  
    $(".//div[@id='animalaccord']") { //main topic togglers
      remove(".//div[@class='clear']")
      $(".//div[@class='menu_head']") {
        wrap("div", class:"mw_animal_accord") {
          attributes(data-ur-set:"toggler")
          move_here("./following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content") {
              $(".//a") {
                add_class("mw_animal_button")
              }
            }
          }
        }
        attributes(data-ur-toggler-component:"button") {
          add_class("mw_flex_box")
          $(".//span") {
            add_class("mw_h1")
          }
          $("./img") {
            insert_after("div", class:"mw_plusminus")
            insert_after("div", class:"mw_ani_title")
          }
          $("./div[contains(@class, 'mw_ani_title')]") {
            add_class("mw_flex_box_item_1")
            move_here("../div")
            move_here("../span")
            move_here("../p")
          }
        }
      }
    }
  }
  #  HSUS-229 [Tablet] Visual Design Discrepancies from Mockup on Animal Page
  $(".//div[@id='side']") {
    $("./ul[@id='action']") {
      add_class("mw_flex_box mw_sidebar1_h")
      $("./li") {
        add_class("mw_flex_box_item_1")
      }
    }
    $(".//div[@id='bluenav']") {
      add_class("mw_sidebar6")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//a") {
        add_class("mw_more")
        inject("  &raquo;  ")
      }
      $("./ul") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
      move_to("following-sibling::ul[@id='action']","after")
    }
  }
  # END HSUS-229 [Tablet] Visual Design Discrepancies from Mockup on Animal Page
}


# cat problem solving section
# animals/cats/cat_problem_solver

# April 15 2013

$("./body") {
  add_class("mw_cat_problems")
  
  # this script is not used since we use moovweb accordion
  $("//script[contains(text(),'var jq191 = jQuery.noConflict();')]") {
    remove()
  }  

  # remove
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")

  # main content 
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    remove("./br")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h1")
      remove("./br")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    # back arrow on the go back link
    $("./p/a") {
      inner() {
        prepend("  &laquo;  ")
      }
      $("parent::p") {
        remove("@style")
      }
    }

    # only on main page
    $(".//div[@id='feature']") {
      $(".//a[@class='more']") {
        inject("  &raquo;  ")
      }
    }
    $(".//div[@id='features']") {
      $(".//li") {
        add_class("mw_problem")
        $("./p[@class='image']") {
          move_to("..", "top")
          remove(".//br")
        }
        $(".//a[@class='more']") {
          inject("  &raquo;  ")
        }
      }
    }

    # find and tag togglers
    $(".//div[@id='accordion']") {
      # remove the aria attributes that pull in jquery scripts
      attribute("id", "mw_accordion")
      $("./div") {
        attributes(data-ur-toggler-component:"content")
        $(".//img") {
          add_class("mw_img_box")
          wrap("div", class:"mw_image")
        }
        # HSUS-374 fixed two white box issue
        #$("./form[@class='checkboxes'][last()][./preceding-sibling::form[@class='checkboxes']]") {
        #  wrap("div", class:"mw_checkboxes") {
        #    move_here("./preceding-sibling::form[@class='checkboxes'] | ./preceding-sibling::p[./preceding-sibling::form[@class='checkboxes']] | ./preceding-sibling::ul[./preceding-sibling::form[@class='checkboxes']]", "bottom")
        #    $("./form[@class='checkboxes']") {
        #      remove("./@class")
        #    }
        #  }
        #  move_to("..", "bottom")
        #}
        wrap("div") {
          attributes(data-ur-set:"toggler")
          move_here("preceding-sibling::h3", "top")
          $("./h3") {
            wrap("div") {
              attributes(data-ur-toggler-component:"button")
              insert("div", class:"mw_plusminus")
            }
          }
        }
      }
    }
  }

        # # try expanding the carousel toggler to fix resizing
        # $(".//div[@data-ur-id='4']") {
        #   add_class("touch_carousel")
        #   $("./div") {
        #     attribute("data-ur-state", "enabled")
        #   }
        # }
        
  # side bar
  $(".//div[@id='side']") {
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }

}
# Search Results page
# http://www.humanesociety.org/search/search.jsp?query=rats
# using mockup 05-search-results.png

# Feb 11 2013 Sarah LaFrance

$("./body") {
  add_class("mw_search_results")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")

  # Repair the google custom search
  $(".//div[@id='main']") {
    wrap_text_children("span", class:"mw_hide")
    insert("gcse:search")
  }

  $(".//div[@id='page' and ./div[@id='sortby']]") {
    add_class("mw_no_main")
  }

  # search again and filter
  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
      $(".//label[@for='sortbytype']/span") {
        text() {
          replace("Content ", "")
        }
      }
    }
  }

  # results

  $(".//h2[@class='suggestions' or @class='results']") {
    add_class("mw_h2")
    inject("  :  ")
  }

  $(".//div[@id='featuredSearch']") {
    remove("@style")
  }

  $(".//ul[@class='item-list']") {
    $(".//h2") {
      add_class("mw_h3")
    }
    $(".//p[@class='related']") {
      wrap_text_children("span") {
        text() {
          replace("Related", "Related  :  ")
        }
      }
    }
  }

  # page numbers, adapted from press.ts
  $(".//div[contains(@class, 'pagination') and contains(@class, 'section')]") {
    attribute("id", "mw_pages")
    $(".//li[not(a)]") {
      add_class("mw_current")
    }
    $current = fetch(".//li[contains(@class, 'mw_current')]/text()")
    $previous = "false"
    $next = "false"
    $(".//li/a[@class='prev']") {
      $previous = "true"
      inner() {
        prepend("  &laquo;  ")
      }
    }
    $(".//li/a[@class='next']") {
      $next = "true"
      inner() {
        append("  &raquo;  ")
      }
    }

    $(".//li[contains(@class, 'mw_current')]") { 
      insert_before("div", class:"mw_pages") {
        move_here("../li[not(a[@class='prev']) and not(a[@class='next'])]")
        # check for base cases and remove surrounding numbers
        match($previous) {
          with("false") { // we're on the first page of results
            remove("./li[position() > 4]")
          }
          with("true") {
            match($next) { // we're on the last page
              with("false") {
                remove("./li[position() < (("+$current+" mod 10)-3)]")
              }
              with("true") { // general case
                remove("./li[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
              }
            }
          }
        }
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    remove("./div")
  }
}
# All fact sheets
# http://mlocal.humanesociety.org/issues/fisheries/facts/right_whale_extinction.html
# http://mlocal.humanesociety.org/animals/cats/facts/cat_wildlife.html
# http://mlocal.humanesociety.org/issues/campaigns/factory_farming/fact-sheets/ag_gag.html
# http://mlocal.humanesociety.org/issues/puppy_mills/facts/
# http://mlocal.humanesociety.org/issues/exotic_pets/facts/fact_fiction_monkeys_apes_pets.html

# Feb 21 2013 Sarah LaFrance

$("./body") {
    add_class("mw_fact_sheet")

    #removing
    remove(".//div[@id='head']")
    remove(".//div[@id='page-head']")
    remove(".//div[@id='page-bottom-spacer']")
    remove(".//p[string-length()<=1 and not(*)]")

    $(".//div[@id='cols']") {
      add_class("mw_box2_tablet")
    }

    # main content
    $(".//div[@id='main']") {

      # social media buttons
      move_here(".//ul[@id='tools']", "top")

      $(".//div[@id='feature']") {
        move_to("..", "top")
        $(".//a") {
          inner() {
            prepend("  &laquo;  ")
          }
        }
      }
      
      $(".//div[@id='feature'][./a]") {
        add_class("mw_borderwithback")
      }

      $(".//div[contains(@class, 's_borderless')]") { // actual article content
        # move date to below author and subhead
        move_here("./p[contains(@class, 'author')]", "top")
        move_here("./p[contains(@class, 'subhead')]", "top")
        move_here("./h1[1]", "top")

        $(".//p[string-length()<=1 and not(*)]") {
          match_not($path, /^\/apps\/protectseals\//) {
            remove()
          }
        }
        
        $(".//div[contains(@id,'image-')]") {
          remove("@style")
        }
        
        $(".//h1") {
          add_class("mw_h1")
        }
        $(".//h2") {
          add_class("mw_h2")
        }
        $(".//h3") {
          add_class("mw_h3")
          $("./following-sibling::*[1][self::p][not(@class)]") {
            add_class("mw_fact_p")
            remove("./br")
          }
        }
        
        # ticket 146, handling the table
        $(".//table") {
          $(".//tr") { // no ths in this table
            $(".//td") {
              name("div")
              attributes(class:"mw_datum")
              remove("@style")
            }
            name("div")
            attributes(class:"mw_test_row")
          }
          name("div")
          attributes(class:"mw_cos_table")
          move_here(".//div[contains(@class, 'mw_test_row')]")
          remove("./tbody")
        }
        
        # scope into the untabled table
        # Fix for HSUS-470
        match_not($path, /fur_fashion\/tips/) {
          $(".//div[@class='mw_cos_table']") {
            
            # HSUS-383
            # http://www.humanesociety.org/apps/protectseals/recommend.html
            match_not($path, /^\/apps\/protectseals\/recommend/) {
              # grab the headings for the data
              $("./div[1]") {
                $("./div[1]") {
                  remove() // first column label, not needed
                }
                $("./div[@class='mw_datum']") {
                  %index = index()
                  $(".//p") {
                    var("heading_" + %index, fetch(".//text()"))
                  }
                  remove()
                }
              }
            }
            # tweak test titles
            $("./div[@class='mw_test_row']") {
              # trim nbsps at the beginning of strings
              $(".//p|.//strong|.//div") {
                inner() {
                  replace(/^[\s]*/, '')
                }
              }
              $("./div[@class='mw_datum']") {
                remove("@align")
              }
              $("./div[1]") {
                remove(".//br")
                add_class("mw_h2")
                text() { }
                wrap_text_children("strong")
                
                # HSUS-383
                match($path, /^\/apps\/protectseals\//) {
                  # div/p , div/strong
                  $("self::div/*") {
                    match(text(), /^\*/) {
                      $("ancestor::div[1]/following-sibling::div[1]//label") {
                        add_class("mw_Required")
                      }
                    }
                  }
                  remove()
                }
              }
              $("./div[@class='mw_datum' and .//img]") {
                add_class("mw_animals")
                remove(".//br")
                insert("div", class:"mw_animal_imgs") {
                  move_here("..//img")
                  move_to("..", "top")
                }
              }
              insert("div", class:"mw_test_text") {
                move_here("../div[not(contains(@class, 'mw_h2'))]")
                $("./div[contains(@class, 'mw_datum')]") {
                  %index = index()
                  insert_top("strong") {
                    inject(var("heading_" + %index))
                  }
                }
              }
            }
          }
        }
        # End of HSUS-470  
        $(".//iframe") {
          remove("@height")
          remove("@width")
        }
        
        # forms are on protect seals app pages
        $(".//form") {
          add_class("mw_appform")
          $(".//*") {
            remove("@cols")
          }
          $(".//td[label[@for='cons_email_opt_in']]") {
            add_class("mw_checkboxrow")
          }
          $(".//p[input[@class='Button']]") {
            add_class("mw_buttonrow")
            $("./input") {
              wrap("span", class:"mw_button")
            }
            
            # HSUS-383
            match($path, /^\/apps\/protectseals\//) {
              add_class("mw_flex_box")
              $("./span") {
                add_class("mw_flex_box_item_1")
              }
            }
          }
        }
      }
    }
    # HSUS-317 Horizontal styling to boxes in bottom of page
    # side bar
    $(".//div[@id='side']") {
      remove("./br")
      $(".//a[@class='more']") {
        inject("  &raquo;  ")
      }
      $(".//div[@id='related-content']") {
        add_class("mw_sidebar3")
        $(".//h2") {
          add_class("mw_h2")
        }
        $("./div[@class='module'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./div[@class='module']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/div[@class='module']") {
          add_class("mw_flex_box_item_1")
          $("./h3/a") {
            inject("  &raquo;  ")
          }
        }
      }
      $(".//div[@id='magazine-promo']") {
        add_class("mw_sidebar7")
      }
      $("./ul[@id='action'][./li[@id='donate']]") {
        add_class("mw_sidebar1_h")
      }
    }
}
$("./body") {
  add_class("mw_drtv_splash")
  $("./div[@id='ga-container']/div[@id='ga-content']") {
    $("./table") {
      remove(".//@style | .//@align |.//hr | .//tr[./td[not(*)]]")
      # header
      move_here(".//div[@id='ga-header']", "before")
      $(".//table[./tr/td/table[@id='formtop']]") {
        $("./tr/td/table[@id='formtop']") {
          add_class("mw_box2")
          $("./tr/td") {
            remove("./br")
            $("./p[1]") {
              add_class("mw_title")
            }
          }
          $("./tr[./td/a]") {
            add_class("mw_left_content")
            $("./td[1]") {
              move_here("./ancestor::table[@id='formtop']/tr/td/p[position() > 3]","before")
            }
            # donate button
            $("./td/a[./img]") {
              inner(fetch("./img/@alt"))
              add_class("mw_btn2")
            }
          }
          # donate monthly box
          move_here("./ancestor::tr[1]/td[last()]/table", "bottom") {
            add_class("mw_right_video")
            $("./tr/td[./img[not(@border)]]") {
              inner(fetch("./img/@alt"))
              add_class("mw_img_alt")
            }
            $('./td[./img]') {
              inner("Your gift as a monthly donor")
              add_class("mw_img_alt")
            }
            # donate button
            $("./tr/td[./a]") {
              add_class("mw_donate_btn")
              $("./a") {
                inner(fetch("./img/@alt"))
                add_class("mw_btn2")
              }
            }
          }
        }
        $(".//div[@id='FAQsection']") {
          add_class("mw_box2")
        }
      }
      
    }
    table_dump("//table")
  }
  $("./div[@style]") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_drtv_donation")
  $(".//select") {
    wrap("div", class:"mw_select_box")
    insert("div", class:"mw_arrows")
  }
  $("./table") {
    insert_after("div", class:"mw_content")
    $(".//table[@id='body']/tr") {
      # top section
      $("./td[./table[@id='formtop']]") {
        name("div")
        remove(".//@style | .//@width")
        add_class("mw_formtop")
        move_here(".//td", "bottom") {
          name("div")
        }
        $("./div[./img[@alt='check']]") {
          add_class("mw_check")
        }
        $("./div[./p]") {
          add_class("mw_text_wrap")
        }
        $("./div[not(@class)][./img]") {
          add_class("mw_img_wrap")
        }
        remove("./table")
        move_to("./ancestor::body[1]/div[@class='mw_content']", "bottom")
      }
      # end of top section

      # donate form
      $("./td[./form]") {
        name("div")
        remove("./@style")
        add_class("mw_form")
        # monthly and one time button
        insert_top("div", class:"mw_gift_button") {
          $temp_type=fetch("./ancestor::table[@id='body']//table[@id='monthlytabs']/@id | ./ancestor::table[@id='body']//table[@id='onetimetabs']/@id")
          add_class("mw_" + $temp_type)
          move_here("./ancestor::table[@id='body']//table[@id='monthlytabs']//a | ./ancestor::table[@id='body']//table[@id='onetimetabs']//a", "bottom") {
            text(fetch("./img/@alt")+" Gift")
            remove("./img")
          }
        }
        # end of monthly and one time button

        # main form
        $("./form") {
          $("./table") {
            add_class("mw_main")
          }
          $("./fieldset") {
            add_class("mw_amount")
            remove(".//@style")
          }
          # remove the extra border
          remove("./table/tr[./td/img[not(@alt)]]")
          $("./table/tr[1]/td") {
            remove("./span/@style | ./@style")
            add_class("mw_main_title")
            # Payment Information
            $("./self::td[./img[@alt='Payment methods']]") {
              add_class("mw_payment")
            }
            # end of Payment Information
          }
          $(".//td[./input[@type='checkbox']]") {
            add_class("mw_check_address")
          }
          # for Card Security Code/CVV:
          $(".//table[@id='paymentinfo']//td[./span]") {
            add_class("mw_label")
          }
          # end of Card Security Code/CVV:
          $(".//table[@id='shippingaddressfields']/tr/td[./span]") {
            add_class("mw_main_title")
            remove("./span/@style | ./@style")
          }
          $(".//input[@id='donate_button']") {
            btn_delegate()
            $("./preceding-sibling::div[1]") {
              add_class("mw_btn2")
            }
          }
        }
        move_to("./ancestor::body[1]/div[@class='mw_content']", "bottom")
      }
      # "Know more" & "Other Ways"
      $("./td[./table//div[@id='FAQsection']]") {
        name("div")
        remove("./@style")
        add_class("mw_bottom_section mw_flex_box")
        insert_bottom("div", class:"mw_other mw_flex_box_item_1") {
          move_here("./preceding-sibling::table[1]//table/tr/td", "bottom") {
            name("div")
            remove(".//@style")
            $("./self::*[./img]") {
              add_class("mw_h3")
              text(fetch("./img/@alt"))
              remove("./img")
            }
          }
        }
        move_here(".//div[@id='FAQsection']", "botttom") {
          add_class("mw_flex_box_item_1")
        }
        remove("./table")
        move_to("./ancestor::body[1]/div[@class='mw_content']", "after")
      }
    }
    remove()
  }
}
$("./body") {
  add_class("mw_drtv_base")
  # header
  $("./table") {
    move_here("./tr/td[./img]", "before") {
      name("div")
      remove("./@width")
      add_class("mw_drtv_header")
    }
  }
  $(".//div[@id='ga-header'] | ./div[contains(@class, 'mw_drtv_header')]") {
    $("./img") {
      attributes(src: "http://www.humanesociety.org/assets/images/1024x256-tablet-mastheads/drtv-2013-tblt.jpg")
    }
  }
  # end of header

  # FAQ section
  $(".//div[@id='FAQsection']") {
    remove("./@style")
    $("./p[@class='faqheadline']") {
      add_class("mw_h3")
    }
    $("./p[@class='question']") {
      add_class("mw_bar6")
      remove("./img")
      attributes(data-ur-toggler-component:"button", id:"")
      wrap("div", data-ur-set:"toggler") {
        move_here("./following-sibling::*[contains(@id, 'answer')][1]", "bottom") {
          add_class("mw_answer")
          attributes(data-ur-toggler-component:"content", style:"")
          $("./ul") {
            add_class("mw_list1")
          }
        }
      }
    }
  }
  # end of FAQ section
}
$("./body") {
  add_class("mw_drtv_thank")
  # move table section
  $("./table") {
    insert_after("div", class:"mw_content")
    $(".//table[@id='body']/tr") {
      $("./td") {
        inner_wrap("div", class:"mw_section") {
          move_to("./ancestor::body/div[@class='mw_content']")
        }
      }
    }
    remove()
  }

  $("./div[@class='mw_content']") {
    remove("./div/table[@id='formtop']/..")
    remove("./div/table[@id='monthlytabs']/..")
    remove("./div/span[@class='Apple-style-span']/..")
    # content
    $("./div/div[@id='rightCol-main-content']") {
      remove(".//@style | .//@valign")
    }

    # "Know more" & "Other Ways"
    $("./div[./table//div[@id='FAQsection']]") {
      remove("./@style")
      add_class("mw_bottom_section mw_flex_box")
      insert_bottom("div", class:"mw_other mw_flex_box_item_1") {
        move_here("./preceding-sibling::table[1]//table/tr/td", "bottom") {
          name("div")
          remove(".//@style")
          $("./self::*[./img]") {
            add_class("mw_h3")
            text(fetch("./img/@alt"))
            remove("./img")
          }
        }
      }
      move_here(".//div[@id='FAQsection']", "botttom") {
        add_class("mw_flex_box_item_1")
      }
      remove("./table")
    }
  }
}
# Main "Campaign" page
# http://www.humanesociety.org/issues/campaigns
#

# Feb 8 2013 Sarah LaFrance

$("./body") {
  add_class("mw_campaigns")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")
  # remove(".//p[string-length(text())= 1]")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }


  $(".//div[@id='side']") {
    remove("./div") // what even is this
  }
  $(".//div[@id='main']/p[not(*)]") {
    match(fetch("./text()"), /\A[\s ]*\Z/) {
      remove()
    }
  }
}
# Main "Action" page
# http://www.humanesociety.org/action
#

# Feb 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_action")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")

  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='main']") {
    # grab the action items out of the action box
    # This is an action page!
    move_here("..//ul[@id='action']//ul", "top") {
      remove("@style")
      add_class("mw_top_menu")
      $("./li") {
        remove("@style")
        $("./a") {
          add_class("mw_bar3")
        }
      }
    }
    insert("div", class:"mw_container") { // let's consolidate
      move_here("../ul[@id='tools']")
      move_here("../div[contains(@class, 'section')]")
    }

    $("./ul[@id='featurette']") {
      move_to("..", "bottom")
    }
  }

  $(".//div[@id='side']") {
    $("./ul") {
      move_here("./span/li") // de-nesting
      remove("./span")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
  }
}
# Main "Issues" page
# http://www.humanesociety.org/issues
#

# Feb 8 2013 Sarah LaFrance

$(".//body") {
  add_class("mw_issues")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//ul[@id='issue-browser']") {
    $("./li") {
      attributes(data-ur-set:"toggler")
      $("./a") {
        attributes(data-ur-toggler-component:"button", class:"mw_issue_button")
        remove("@href")
        insert("div", class:"mw_plusminus")
      }
      $("./ul") {
        attributes(data-ur-toggler-component:"content", class:"mw_sublist")
        $(".//a") {
          inject("  &raquo;  ")
        }
      }
    }
  }

  $(".//div[@id='side']") {
    remove("./div") // what even is this
  }
}
# Main "Issues" page
# http://www.humanesociety.org/issues/chimpanzee_research
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_issue_cat")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  # remove(".//br")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[contains(@id, 'item-')]") {
    remove("@style")
    $(".//script") {
      inner() {
        replace(/width: "[\d]*"/, 'width: "100%"')
        replace(/height: "[\d]*"/, 'height: "300px"')
      }
    }
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3 | .//p[@class='author' or @class='subhead']") {
    add_class("mw_h3")
  }

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  $(".//a[contains(@class, 'back')]") {
    inner() {
      prepend("  &laquo;  ")
    }
  }

  # main content
  $(".//div[@id='main']") {
    $(".//img") {
      remove("@align")
    }

    # apply a class to the youtube video
    $(".//div[iframe[contains(@src, 'youtube')]]") {
      add_class("mw_feature_video")
    }
    
    $(".//div[@id='feature']") {
      insert("div", class:"mw_save_seals") {
        move_here("../*[not(@id='images') and not(@id='tools')]")
        remove("./div[not([iframe])]") #remove child divs not containing an iframe
        $("./a[not(@class) and not(h2)]") { // the get app button
          add_class("mw_get_app")
          move_to("..", "bottom")
        }
      }
    }
    # HSUS-270 Image not pulling on Issues page
    $(".//div[@class='video']") {
      $("./div[@class='video-player']/h2//div[@id='images']/ancestor::div[contains(@id,'image')][1]") {
        add_class("mw_video_image")
        remove("./@style")
      }
      # $(".//h2") {
      #         text() {
      # 
      #         }
      #       }

      /*$(".//iframe)") {
        add_class("mw_testing")
        remove("./@width")
        remove("./@height")
      }*/
    }
    $(".//div[contains(@class, 'area-news')]") { // handle any bottom links
      wrap_together("./a", "div") {
        add_class("mw_news_links")
      }
    }
    $(".//div[contains(@class, 'area-news') or contains(@class, 'victories')]//li") { // news item
      insert_top("div", class:"mw_news_title") {
        move_here("../p[@class='image']")
        move_here("../p[@class='date']")
        move_here("../h3")
        move_here("../p[@class='excerpt']")
      }
    }
    # different news section format:
    $(".//div[contains(@class, 'area-news')]") {
      wrap_text_children("span")
      remove("./span")
      $(".//div[contains(@id, 'templatelist') and not(ul)]") {
        remove("@style")
        remove(".//hr")
        $(".//p[@class='image']") {
          wrap("div") {
            attribute("class", "mw_news_title")
            move_here("following-sibling::p[@class='date'][1]")
            move_here("following-sibling::h4[1]") {
              add_class("mw_h3")
            }
            move_here("following-sibling::p[1]")
          }
        }
      }
    }
    # HSUS-98: Paragraph breaks
    # URL: http://www.humanesociety.org/issues/cosmetic_testing/index.html
    $("./div[contains(@class, 'section-lead')]") {
      $("./ul") {
        remove("./@style")
        add_class("mw_list1")
      }
      $("./h2/following-sibling::p[1]") {
        wrap_text_children("span")
        $("./span[1]") {
          add_class("mw_break_p")
          move_here("./following-sibling::span[1] | ./following-sibling::span[2]", "bottom")
        }
      }
    }
    
    # HSUS-105
    # URL: http://www.humanesociety.org/issues/cosmetic_testing/becrueltyfree/
    $("./div[@id='pledgeform']") {
      # remove extra img and donate btn
      remove("./img[contains(@alt, 'Pledge')] | ./img[contains(@alt, 'pledge')] | .//div[@class='pledge-donate-btn']")
      $("./div[@class='pledge-form']") {
        insert_top("div", class: "mw_pledge_title", "Global Pledge to Be Cruelty-Free")
        $(".//form[@id='actionform']") {
          $("./input[@class='pledge-submit-btn']") {
            attributes(alt: fetch("./@alt"), onclick: "window.scrollTo(0,1);")
            btn_delegate() {
              add_class("mw_pledge_btn")
            }
          }
        }
        $(".//div[@id='thankyou']") {
          remove(".//a/text()")
        }
      }
      $("./following-sibling::div[@id='features']/ul/li") {
        add_class("mw_pledge_list")
        $("./p[@class='image']") {
          move_here("./preceding-sibling::h3", "after")
        }
      }
    }
    # end of HSUS-105
    
    $("./div[contains(@class, 's_borderless') or contains(@class, 'section')]") {
      # desktop site hide
      remove("./div[@class='video-player']")
      $("./p[./span[not(.//a)]]") {
        add_class("mw_h3")
      }
      $("./div[contains(@class, 'section')]/p") {
        add_class("mw_issue_p")
      }
      $("./p[not(@class)]") {
        add_class("mw_issue_p")
        $("./a[starts-with(text(), '»')]") {
          add_class("mw_arrow_link")
        }
        $("./a") {
          match(text(), /^\W\s$/) {
            $("./following-sibling::a[1]") {
              add_class("mw_arrow_link")
            }
            remove()
          }
          text() {
            replace(/^\W\s/, "")
          }
        }
      }
    }
    $("./div[@id='features']/ul/li") {
      inner_wrap("div", class:"mw_feature_article") {
        move_here("./p[@class='image']", "before")
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    $("./div[@id='seals-app']") {
      $(".//a[contains(@class, 'more')]") {
        add_class("mw_get_app")
      }
    }

    $(".//div[@id='relatedissues-promo' or @id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h1")
      }
    }
    $(".//div[@id='resources-promo']") {
      add_class("mw_sidebar9")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%; height: 300px")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  $(".//a[contains(text(),'AltTox.org')]") {
    add_class("mw_alttox")
  }
  # hide bread crumb
  $(".//div[@id='contentDiv']/div[@class='no-banner']//div[@id='feature']/div[@class='mw_save_seals']") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_gigyalogin")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//br")

  $(".//div[@id='contentDiv']") {
    remove(".//@style")
    $("./div[not(*)]") {
      match(fetch("./self::text()"), /\A[\s ]*\Z/) {
        remove()
      }
    }
  }
}
## HSUS - 443

$("./body") {
  add_class("mw_actform_mconnect")
  $("./div[@id='container']") {
    $("./table[@id='title-text']//p") {
      name("h1")
      add_class("mw_h1")
    }
    $("./table[@id='target']") {
      remove("@style|@height|@align|@width") 
      $(".//td") {
        remove("@align")
      }  
      $(".//p") {
        name("h2")
        add_class("mw_h2 mw_center")
      }
    }
    $("./table[@id='main-text']") {
      remove("@style|@height|@align|@width")
      $(".//td") {
        remove("@align")
      }
    }
    $("./table[@id='gray-text']") {
      remove("@width|@align|@height")
      $(".//td") {
        remove("@align")
      }
      move_to("./following-sibling::div[@id='form']", "top")
    }
    $(".//form/table[@id='mconnect-phoneandzip' or @id='basic']") {
      remove("@width|@align")
      $(".//input") {
        remove("@style")
      }
      $(".//input[@id='submit-button']") {
        attribute("value", "CALL NOW")
        $("..") {
          add_class("mw_center")
        }
      }
    }
    $(".//table[contains(@id,'logo')]") {
      remove("@style") {
        $(".//td") {
          remove("@align")
        }
      }
      move_to("./ancestor::div[@id='form']", "after")
    }
  }
  
  $jsRemove = "$('form').submit(function() { $('#logo1').remove();$('#logo2').remove(); })"
  insert_javascript_at(position("bottom"),$jsRemove)

}
$("./body") {
  add_class("mw_protect_seals_pledge")
  
  # Remove the the powered by convio
  remove("./div[a[contains(@href, 'convio')]]")
  
  $("./div[@id='ga-container']/div[@id='ga-content']/table") {
    move_here(".//div[@id='ga-header']", "before")
    move_here(".//form[contains(@action, 'Survey')]", "before") {
      add_class("mw_box2")
      
      # page title
      $("./div[@class='appArea']/h3") {
        add_class("mw_h3")
      }
      
      # form table
      $("./div[@class='appArea']/table") {
        remove("./tr[1]")
        # remove empty td
        $(".//td[not(*)]") {
          match(text(), (/\A\s+\Z/)) {
            remove()
          }
        }
        $(".//p[not(*)]") {
          match(text(), (/\A\s+\Z/)) {
            remove()
          }
        }
        
        # dump table
        $(".//table | .//tr | .//td") {
          name("div")
        }
        
        $(".//div[@class='old-school']/div/div[@cellpadding='0']") {
          add_class("mw_was_table")
          $("./div[./div[position() > 2]]") {
            insert_top("div", class:"mw_input_title") {
              move_here("following-sibling::div[position() < 3]")
            }
          }
          $(".//select") {
            wrap("div", class: "mw_select_arrows")
          }
          
          
          $("ancestor::div[@class='old-school'][1]") {
            add_class("mw_form mw_box3")
            move_here(" following-sibling::div[@class='old-school']")
            
            insert("div", class: "mw_phone_box") {
              move_here("preceding-sibling::div[@class='old-school'][.//img[contains(@src, 'pagebuilder')]]") {
                $("./div/p") {
                  name("div")
                  add_class("mw_phone_text")
                  wrap_text_children("span")
                }
              }
              move_here("preceding-sibling::div[@class='old-school'][./div/label/span[contains(text(), 'Mobile')]]")
            }
          }
        }
        
      }
      
      # button
      $("./div[@class='appArea']/p") {
        name("div")
        remove_text_nodes()
        $("./input") {
          add_class("mw_btn1")
        }
        insert_top("div", class: "mw_input_button") {
          move_here("following-sibling::input[not(contains(@value, 'Thanks'))]")
        }
      }
    }
    remove()
  }
}
# secure welcome page
# http://action.humanesociety.org/site/PageServer?pagename=humane_welcome_page&JServSessionIdr004=8w797fvbu1.app305b
#

# Feb 14 2013 Sarah LaFrance

$("./body") {
  add_class("mw_welcome")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//br")

  $(".//div[@id='contentDiv']") {
    remove("./div[not(@id)]")
    $(".//div[@id='wrapper-body']") {
      $("./p") {
        $("./a[not(*)]") {
          add_class("mw_more")
        }
      }
      remove("@style")
      $(".//*") {
        remove("@style")
      }
      $(".//iframe") {
        remove("@width")
        remove("@height")
      }
    }
  }

}
#  "Action" subsection page
# http://www.humanesociety.org/action/now
# http://www.humanesociety.org/action/fed_bill
# http://www.humanesociety.org/action/toolkit
#

# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press mw_news_base")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']") 
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[div[@id='wayne']]")

  $(".//li[@class='more']//a") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_no_display")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//p[@class='related']") {
    wrap_text_children("span")
  }

  # pagination stuff taken from press
  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
        # check for base cases and remove surrounding numbers
        match($previous) {
          with("false") { // we're on the first page of results
            remove("./div[position() > 4]")
          }
          with("true") {
            match($next) { // we're on the last page
              with("false") {
                remove("./div[position() < (("+$current+" mod 10)-3)]")
              }
              with("true") { // general case
                remove("./div[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
              }
            }
          }
        }
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//ul[@id='action']") {
      remove(".//li[@class='expanded']/ul")
      move_here("./span/li")
      remove("./span")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
  }

}
$(".//form") {
  #HSUS-426 adding in convio source tracking
  log("HSUS-426")
  log($path)
  # %s_src = $path
  log("----")
  $path {
    capture(/(s\_src\=[^&]+)/)
    {
      $s_src = $1
    }
  }
  # %s_src = $1
  match($s_src) {
    with($1) {
      log("$s_src matches $1")
      $1 = ""
    }
    else() {
      $1 = concat("&",$1)
    }
  }
  # hardcoding it as requested
  %s_subsource = "s_subsrc=mobile"
  log(concat("s_src: ", $s_src))
  log(concat("s_subsource: ", %s_subsource))

  # Construct a new form post action
  %post_action = fetch("./@action")
  # To avoid adding the source/subsource multiple times
  match_not(%post_action, %s_subsource) {
    log("applying s_src & s_subsrc")
     %post_action {
       replace($s_src, "")
     }
     log("-- post_action --")
     log(%post_action)
     match(%post_action) {
      # if there are no other post arguments, make the $s_src first
      with(/\?/) {
        log("s_src is not the first variable")
        attributes(action: concat(%post_action,"&", $s_src, "&", %s_subsource))
      }
      else() {
        
        log("s_src is the first variable")
        attributes(action: concat(%post_action,"?", $s_src, "&", %s_subsource))
      }
     }
    
  }
   
}
# http://www.humanesociety.org/action/alerts/maryland/
# action alerts

$("./body") {
  add_class("mw_action_alerts")
  $(".//div[@id='page']") {
    add_class("mw_box2")
    $(".//div[@id='page-bottom-spacer']") {
      add_class("mw_hide")
      remove("@style")
    }
    remove("./div[@id='page-head']")
    $("./div[@id='contentDiv']") {
      remove("./div[@id='head']")
      $("./div[@id='cols']") {

        # content section
        $("./div[@id='main']") {
          $(".//h2") {
            add_class("mw_h2")
          }
          $(".//div[@id='top-pagination']"){
            add_class("mw_search1")
            $(".//label") {
              wrap_text_children("span")
              add_class("mw_flex_box")
            }
            $(".//input") {
              add_class("mw_flex_box_item_2")
            }
            $(".//button[@type='submit']") {
              add_class("mw_btn5")
              text("")
            }
          }
        }

        # right-nav
        $("./div[@id='side']/ul") {
          add_class("mw_sidebar1_h")
        }
      }
    }
  }
}
# Spay Day issue page
# http://www.humanesociety.org/issues/spay_day
# modified version of issue_subject.ts

# March 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_issue_cat")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//br")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[contains(@id, 'item-')]") {
    remove("@style")
    $(".//script") {
      inner() {
        replace(/width: "[\d]*"/, 'width: "100%"')
        replace(/height: "[\d]*"/, 'height: "300px"')
      }
    }
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3 | .//p[@class='author' or @class='subhead']") {
    add_class("mw_h3")
  }

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  $(".//a[contains(@class, 'back')]") {
    inner() {
      prepend("  &laquo;  ")
    }
  }

  $(".//div[@id='main']") {
    $(".//div[contains(@class, 'section-lead')]") {
      $("./p[count(.//a)=3]") {
        add_class("mw_spay_p")
      }
    }
    $(".//div[contains(@class, 'area-news')]") { // handle any bottom links
      wrap_together("./a", "div") {
        add_class("mw_news_links")
      }
    }
    $(".//div[contains(@class, 'area-news') or contains(@class, 'victories')]//li") { // news item
      insert_top("div", class:"mw_news_title") {
        move_here("../p[@class='image']")
        move_here("../p[@class='date']")
        move_here("../h3")
        move_here("../p[@class='excerpt']")
      }
    }
    $("./div[contains(@class, 's_borderless') or contains(@class, 'section')]") {
      # desktop site hide
      remove("./div[@class='video-player']")
      $("./p[./span[not(.//a)]]") {
        add_class("mw_h3")
      }
      # $("./div[contains(@class, 'section')]/p") {
      #   add_class("mw_spay_p")
      # }
      # $("./p[not(@class)]") {
      #   add_class("mw_spay_p")
      # }
    }
    $("./div[@id='features']/ul/li") {
      inner_wrap("div", class:"mw_feature_article") {
        move_here("./p[@class='image']", "before")
      }
    }
  }

  # sidebar
  $(".//div[@id='side']") {
    $("./div[@id='seals-app']") {
      $(".//a[contains(@class, 'more')]") {
        add_class("mw_get_app")
      }
    }

    $(".//div[@id='relatedissues-promo' or @id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h1")
      }
    }
    $(".//div[@id='resources-promo']") {
      add_class("mw_sidebar2")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%; height: 300px")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  $(".//a[contains(text(),'AltTox.org')]") {
    add_class("mw_alttox")
  }

}
# current url - http://www.humanesociety.org/testing/hsus_testing/editorial/protect_seals_1.html
# future url - http://www.humanesociety.org/issues/seal_hunt/2013_hunt/home.html

# when this file is moved to live, uncomment it's mapping in mappings.ts in the work section
# seal splash action action page

# March 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_sealsplat")

  # hide unneeded sections
  $(".//iframe[@id='hiddenframe']") {
    add_class("mw_hide")
  }
  # HSUS-525- Start
  $(".//div[@id='infographiccontents']|.//div[@id='top_band']") {
    add_class("mw_hide")
  }
  $(".//div[@id='head']") {
    remove("./@style")
  }
  # End HSUS-525
  # main content
  $(".//div[@id='page']") {
    $(".//div[@id='puppy-mills']") {
      add_class("mw_box2")
    }
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//div[@id='cols']/div[@id='side']/div[@id='related-content']") {
      add_class("mw_sidebar2 mw_relate_content")
    }
    remove(".//div[@id='page-head']")
    # no top headline
    $(".//div[@id='main']") {
      $(".//div[contains(@class,'section-lead')]") {
        move_here("following-sibling::div[@id='feature']")
      }
    }
    $(".//p") {
      inner() {
        replace(/\s+/, " ")
      }
    }
    # HSUS-525 - End
    # video and leadin; number links rotate carousel
    $(".//div[@id='billboard']") {
      attributes(data-ur-carousel-component:"view_container", data-ur-set:"carousel", data-ur-infinite:"disabled", data-ur-fill:1, data-ur-autoscroll:"disabled" )
      insert_bottom("span", id:"mw_carousel_dots", data-ur-carousel-component:"dots" )

      wrap_together("./div", "div") {
        attributes(data-ur-carousel-component:"scroll_container")

        $("./div") {
          remove("./@style")
          attributes(data-ur-carousel-component:"item")
          $("./self::div[not(./iframe)]") {
            remove("./a[@id='infographicimagelink']/text() | ./div[@id='appstoretext']/a")
          }
        }

        $("./div[@id='page2']/div[@id='appstoreimagelink']") {
          insert_top("img", src:"https://secure3.convio.net/humane/images/content/pagebuilder/seals2012-qr2.gif")
          wrap_text_children("span", class:"mw_app_text")
        }

        $("./div[@id='page3']") {
          $("./a[@id='infographicimagelink']") {
            insert_top("img", src:"http://www.humanesociety.org/assets/images/logos_odd_sizes/seal_bb_infographic.jpg")
          }
          
          # replace their JS popup with a link to the image
          $(".//a[contains(@href,'popupInfographic')]") {
            attribute("href", "http://www.humanesociety.org/assets/images/logos_odd_sizes/seals_infograph_2012.jpg")
          }
        }
      }
    }

    # share bar
    $(".//div[@id='sharethispage']") {
      move_to("..", "top")

      # Adding a label
      insert_top("div", class:"share_label", "Share: ")

      # Just wrap the text children so we can hide them. Good idea Sarah!
      $("./a") {
        wrap_text_children("span")
      }
    }




    # form to pledge
    $(".//div[@id='sidebar']") {
      move_here("../a") // grab donate now button
      $("./a") {
        wrap("div", id:"mw_donate_btn")
      }
    }
    # twitter feeds and links
    $(".//div[@id='lowercontent']") {
      # twitter feed
      # a lot of this content isn't being pulled in
      # the javascript to grab other tweets isn't loading
      $("./div[@id='twitterfeeds']") {
        $(".//div[@id='livefromtheice']") {
          move_here(".//span[@class='twuser']", "top")
          move_here("./a[@id='followrebecca']", "top")
        }
        $(".//a[@id='mortweets']") {
          inject("  &raquo;  ")
        }
      }
      # news and get the app
      $("./div[@id='contentstories']") {
        $(".//div[@class='story']") {
          move_here(".//div[@class='storytext']/a")
          $(".//a[./img]") {
            attribute("class", "mw_border_img")
          }
          $(".//img[not(./ancestor::a[contains(@class, 'mw_border_img')][1])]") {
            wrap("div", class:"mw_border_img")
          }
          $(".//a[@class='mw_border_img'] | .//div[@class='mw_border_img']") {
            wrap("div", class:"mw_center_img")
          }
        }

        remove(".//br")
        # add raquos to the more links that need them
        $(".//a[@class='storymainlink' or @id='mediacontacts' or @id='morenews']") {
          inject("  &raquo;  ")
        }
      }
    }

    #prep the footer for styling
    $("./div[contains(@class, '_footer')]") {
      move_to("//div[@id='contentDiv']")
      $(".//div[@id='footer']") {
        attribute("id", "foot")
        remove("./div[@id='footerseals']")
        $("./ul/li[1]") {
          add_class('mw_footer_copyright')
          wrap_text_children("span")
          remove("span[2]")
          text() {

          }
        }
        $(".//li[./a and position()>1]") {
          add_class("mw_link_center")
          $("./a") {
            add_class("mw_bar2")
            remove("@style")
          }
        }
      }
    }
  }
  # Fix for HSUS-525
  $(".//div[@id='relatedissues-promo']") {
    add_class("mw_sidebar3")
  }
  $(".//div[@id='resources-promo']") {
    add_class("mw_sidebar9")
  }
  # Fix for HSUS-525
  $(".//p[@class='image']") {
    wrap("div") {
      attribute("class", "mw_news_title")
      move_here("following-sibling::p[@class='date'][1]")
      move_here("following-sibling::h4[1]") {
        add_class("mw_h3")
      }
      move_here("following-sibling::p[1]")
    }
  }
 # Fix for HSUS-525
}
# Main "Our Work" page
# http://www.humanesociety.org/work
#

# Feb 8 2013 Sarah LaFrance

$(".//body") {
  add_class("mw_work")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='clear']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
  }

  $(".//div[@id='main']") {

    $(".//div[@id='animalaccord']") { //main topic togglers
      remove(".//div[@class='clear']")
      $(".//div[@class='menu_head']/p") {
        move_to("../following-sibling::div[1]", "top") // text needs to go in content
      }

      $(".//div[@class='menu_head']") {
        add_class("mw_flex_box")
        wrap("div", class:"mw_animal_accord") {
          attributes(data-ur-set:"toggler")
          move_here("./following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content") {
              $(".//a") {
                add_class("mw_animal_button")
              }
            }
          }
        }
        attributes(data-ur-toggler-component:"button") {
          $("./img") {
            insert_after("div", class:"mw_plusminus")
            $("following-sibling::span") {
              add_class("mw_flex_box_item_1")
            }
          }
        }
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='bluenav']") {
      add_class("mw_box8")
      $(".//a") {
        add_class("mw_more")
        inject("  &raquo;  ")
      }
    }
  }
}
# faqs under issues
#

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_qanda")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  # main content
  $(".//div[@id='main']") {
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//div[@id='feature']") {
      move_here("..//ul[@id='tools']", "top")
      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    $(".//div[contains(@class, 's_borderless')]") {
      match($path) {
        with(/issues\/cloning\/qa/) {
          #HSUS-451: workaround for this url since it is on a different format than the others
          # dont remove the ul
        }
        else() {
          remove("./ul[1]")
        }
      }
      remove(".//hr")
      # remove back to top button
      remove("./p[./a[contains(text(),'back to top')]]")
      $("./strong") {
        wrap("p", class:"mw_question")
      }
      $("./p[./strong]") { // question
        add_class("mw_question")
      }
      # remove the p without any content in it
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
      $("./p[@class='author']") {
        add_class("mw_hide")
      }
      $("./ul/preceding-sibling::p[1]") {
        add_class("mw_question_ul")
      }
      # HSUS-120
      # http://www.humanesociety.org/animal_community/resources/qa/common_questions_on_shelters.html#How_many_animals_enter_animal_shelters_e
      $("./h3[contains(@class,'mw_h3')]") {
        wrap("div", class:"mw_qa_content")
      }
      $("./p") {
        move_to("preceding-sibling::div[@class='mw_qa_content'][1]")
      }
    }
  }


  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
  }

}
# secure join a pledge page
# https://mlocal.secure.humanesociety.org/site/Advocacy?cmd=display&page=UserAction&id=2823&autologin=yes&s_src=website&s_subsrc=campaigns
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_pledge")

  # remove
  # remove("./div[not(@id)]")
  # Remove the the powered by convio
  $("./div[a[contains(@href, 'convio')]]") {
    remove()
  }

  fixImages()

  #not sure what this was fixing...
  # HSUS-518 Content repeated
  remove(".//div[@class='showondesktop']")
  # HSUS-518 Content repeated

  # remove inline styling
  $(".//table") {
    remove("@style")
    remove("@bgcolor")
  }
  $(".//img") {
    remove("@align")
    remove("@width")
    remove("@height")
  }
  $(".//input") {
    remove("@size")
  }

  $(".//h1") {
    add_class("mw_h1")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//h3|.//span[@class='AlertListName']") {
    add_class("mw_h3")
  }

  $(".//div[@id='ga-content']/table/tbody") {
    remove("./tr[.//div[@id='ga-header']]")
    remove("./tr[./td[not(*)]]")
    $(".//table") {
      add_class("mw_level_2")
      #For HSUS-429 :Removed style attribute from the below code for  [Mobile] Increase Padding on Action Alert Images
      remove(".//@width | .//@height | .//@align")
      #End of HSUS-429 
      $("./tbody/tr/td") {
        add_class("mw_holder")
        $("./self::td[./img]") {
          add_class("mw_img_td")
        }
        #remove("./div[img]")
      }
    }
    $(".//div[@id='action-alert'] | .//div[@class='appArea']") { # everything's in here  
      
      insert_top("div", class:"mw_share_buttons") {
        insert("p") {
          text() {
            set("Share")
          }
        }
        move_here("..//div[@id='share_bar']")

        # For when they don't wrap their share buttons in a div#share
        move_here("..//a[contains(@href, 'addthis')] | ..//a[contains(@href, 'on.fb')]") {
          $("./img[contains(@src,'facebook')]/..") {
            add_class("addthis_button_facebook")
          }
          $("./img[contains(@src,'twitter')]/..") {
            add_class("addthis_button_twitter")
          }
        }

        # Checks to see if the div#share_bar already exists, if not, moves in the share buttons
        $("../div[@class='mw_share_buttons'][not(div)]") {
          insert("div", id:"share_bar") {
            move_here("../a")
            move_here("./div[@class='mw_share_buttons']/a")
          }
        }

        # insert("div", id:"share_bar") {
        #   move_here("../a")
        # }

        # check if the share bar is empty
        $("./div[not(node())]") {
          $("..") {
            attribute("style", "display: none;")
          }
        }

      }

      $(".//form") {
        # remove white space
        $("./p[not(*)][text()]") {
          text() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
        }
        # Make phone number fields bring up the number keypad by default
        $("./div[contains(@id, 'column')]/fieldset[@id='info']/table[contains(@class, 'mw_level_2')]//span[@class='NetscapeFix']/input | ./div[contains(@id, 'column')]/fieldset[@id='info']//input[@id='phone']") {
          attribute("type", "tel")
        }

        #HSUS-426 adding in convio source tracking
        # This has been moved to convio.ts
        # log("HSUS-426")
        # log($path)
        # # %s_src = $path
        # log("----")
        # $path {
        #   replace(/(s\_src\=[^&]+)/)
        # }
        # %s_src = $1
        # match(%s_src) {
        #   with($1) {
        #     log("%s_src matches $1")
        #     $1 = ""
        #   }
        #   else() {
        #     $1 = concat("&",$1)
        #   }
        # }
        # # hardcoding it as requested
        # %s_subsource = "s_subsrc=mobile"
        # log(concat("s_src: ", %s_src))
        # log(concat("s_subsource: ", %s_subsource))

        # Construct a new form post action
        # %post_action = fetch("./@action")
        # attributes(action: concat(%post_action, "&", %s_src, "&", %s_subsource))
      }


      $(".//p[img]") {
        add_class("mw_top_image")
        $("./img") {
          remove("@style")
          remove("@height")
          remove("@width")
          remove("@hspace")
        }
      }

      #HSUS-495 20131204 Start
      $(".//form/p[img]") {
        add_class('mw_read_more')
        $("./img") {
          move_to("../a")
        }
      }
      #HSUS-495 20131204 End

      $("./form/img") {
        wrap("div", style:"text-align:center;") {
          #For HSUS-429 :Removed style attribute from the below code for  [Tablet] Increase Padding on Action Alert Images
          add_class("mw_img_pad")
          #End of HSUS-429
        }
      }
      $(".//div[@id='mobileheadlinetext']") {
        wrap_text_children("h1") {
          add_class("mw_h1")
        }

      }
      # Move the 'message' into column1
      $("./form/fieldset[@id='message']") {
        move_to("../div[@id='column1']", "top")
      }
      # Move the intro text to the top of the form
      $(".//div[@id='column1']/*[not(@id='message')]") {
        move_to("../..")
      }

      $(".//div[@id='column2']") {
        move_to("..", "bottom")
      }

      $(".//div[@id='column1']") {
        move_to("..", "bottom")

        $(".//div[@class='field-wrap']/textarea[@id='middle']") {
          remove("./@cols")
        }
      }      

      $(".//div[contains(@class, 'bottom')]") {
        move_to("..", "bottom")
      }

      $(".//div[contains(@class, 'submit-wrap')]") {

      }
    }
  }

  # youtube video fixes

  $(".//iframe[contains(@src, 'youtube')]") {
    remove("./@height | ./@width")
    attribute("style", "width: 100%;")

  }

  #prep to add in the footer
  $(".//ul[@style]/ancestor::div[@style]") {
    add_class("mw_pledge_footer")
    attribute("id", "foot")
    remove("@style")

    $(".//*[@style]") {
      remove("@style")
    }
    $(".//li") {
      add_class("mw_link_center")
      $("./a") {
        attribute("style", "color: #a7a7a7;")
      }
      
    }
    remove(".//img")
  }

  $("//div[@class='_footer mw_box1']") {
    move_here("//div[@class=' mw_pledge_footer']", "top")
  }

  $(".//td[@class=' mw_holder'][p]/p[@style]") {
    add_class("mw_advocacy_suggestion")
    remove("@style")
  }

  # Use our <select> element identifiers
  $(".//select/..") {
    add_class("mw_select_arrows")
  }

  # custom keyboards
  $(".//input[contains(@name, 'email')]") {
    keyboard("email")
  }
  $(".//input[contains(@name, 'zip')]") {
    keyboard("numeric")
  }
  $(".//input[contains(@name, 'phone')]") {
    keyboard("tel")
  }

  # Hide the old share table.. with just the donation link
  $(".//a[contains(@href, 'donation')]") {
    add_class("mw_hide")
  }

  # HSUS-379 Webform Submission for Alerts page
  $("./div[@id='wrapper'][//form[@id='WebformInput']/div[@class='appArea']]/div[@id='page']") {
    remove("./div[@id='page-head']")
    $("./div[@id='contentDiv']") {
      remove("./div[not(@id='cols')]")
      $("./div[@id='cols']/div[@id='main']/div[@id='wrapper-body']") {
        remove("./@style")
        $("./form[@id='WebformInput']/div[@class='appArea']") {
          remove("./br | ./table//td/br | ./ancestor::div[@id='wrapper'][1]/br")
          $("./table//td/p") {
            %text_top = fetch("./text()") {
              replace(/\(\d+\)(\s|\d|\-)+(\w|\s|\.)+/, "")
            }
            %phone1 = fetch("./text()") {
              replace(%text_top, "")
              replace(/\s\D+\s.+/, "")
            }
            %phone1_value = %phone1
            %phone1_value {
              replace(/\D/, "")
            }
            %phone2 = fetch("./text()") {
              replace(%text_top, "")
              replace(/\(\d+\)(\s|\d|\-)+\w+\s/, "")
              replace(/\./, "")
            }
            %phone2_value = %phone2
            %phone2_value {
              replace(/\D/, "")
            }
            inner(%text_top+"<a href= tel:"+%phone1_value+">"+%phone1+"</a> or <a href= tel:"+%phone2_value+">"+%phone2+"</a>.")
          }
          $("./div[./img[contains(@src, 'webform.puzzle')]]") {
            add_class("mw_puzzle_img")
            wrap("div", class:"mw_puzzle_box") {
              move_here("./following-sibling::div", "bottom")
              inner_wrap("div", class:"mw_puzzle_input")
            }
            move_to("..", "before")
            $("./img") {
              attribute("src") {
                value() {
                  replace(/(\/|\w|\.)+org\//, "")
                }
              }
            }
          }
          $("./p[./input[@class='Button']]") {
            remove("./text()")
            $("./input[@type='submit']") {
              add_class("mw_puzzle_button")
              $("./self::input[@id='CNV_submit']") {
                add_class("mw_btn2")
              }
              $("./self::input[@id='CNV_cancel']") {
                add_class("mw_btn4")
              }
            }
          }
        }
      }
    }
  }
  # HSUS-495 - start
  $(".//form[@id='beanForm']") {
    remove(".//@style")
    $(".//iframe[contains(@src,'youtube')]") {
      $("..") {
        add_class("videoArea")
      }
    }
  }
  # HSUS-495 - end
}
# "Campaign" subcat page
# http://www.humanesociety.org/issues/campaigns/factory_farming
#

# Feb 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_campaign_cat")

  # remove
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='petfinder-promo']")

  $(".//h2") {
    add_class("mw_h2")
    text() {

    }
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//div[@class='off-lead']/p") {
    add_class("mw_h3")
  }

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  # main content
  $(".//div[@id='main']") {
    remove("./div[@id='feature']")
    $(".//iframe") {
      remove("@width")
      remove("@height")
    }
    $(".//div[@id='features']") {
      $(".//li") {
        move_here("./p[@class='image']", "top")
      }
      $(".//p") {
        inner() {
          replace(/\xC2\xA0/, "")
        }
      }
    }
    
    $("./div[contains(@class, 's_borderless')]") {
      $("./h1") {
        add_class("mw_h1")
      }
      $("./p") {
        add_class("mw_campaign_p")
        $("./self::p[contains(@class, 'subhead')]") {
          add_class("mw_campaign_subtitle")
          move_here("./preceding-sibling::p[contains(@class, 'date')]", "after")
        }
      }
    }
  }


  # sidebar
  $(".//div[@id='side']") {
    remove("./div")
    ##HSUS - 442 - repeated donate button - one is styled with give-bttn class
    remove(".//li[@id='donate']/a[@class='give-bttn']")
  }

}
# Main recipe page
# http://www.humanesociety.org/issues/eating/recipes
# this is a lot like an issue subject landing but the recipe pages have tons of lists 
# for ingredients &c and I want those to look nice

# March 8 2013 Sarah LaFrance

$("./body") {
  add_class("mw_recipe_main")

  #remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//p[string-length()=1 and not(*)]")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2|.//p[@class='subhead' and string-length(text())>1]") {
    add_class("mw_h2")
  }

  # main content
  $(".//div[@id='main']") {

    $(".//h3|.//p[@class='author' and string-length(text())>1]") {
      add_class("mw_h3")
    }
    $(".//table") {
      $("following-sibling::*") {
        add_class("mw_after_tbl")
      }
    }

    $(".//div[div[@id='images']]") {
      remove("@style") // unfloat this
    }
    # shuffle everything around into 2 sections
    insert("div", class:"mw_recipes") {
      move_here("..//table")
      move_here("..//*[contains(@class, 'mw_after_tbl')]")
    }
    insert("div", class:"mw_top_section") {
      remove("preceding-sibling::div[@id='feature']")
      move_here("//ul[@id='tools']")
      move_here("//div[contains(@class, 's_borderless')]/*")
      move_to("..", "top")
    }
    remove(".//div[contains(@class, 's_borderless')]")

    $(".//div[@class='mw_recipes' and not(table)]") {
      remove()
    }
    $(".//div[@class='mw_recipes']") {
      $(".//table") {
        $(".//tr") {
          $(".//td") {
            name("div")
            attributes(class:"mw_td")
          }
          name("div")
          attributes(class:"mw_tr")
        }
      }
      insert_top("div", class:"mw_recipe_list") {
        move_here("//div[@class='mw_tr']")
        $(".//div[@class='mw_td' and ./a[@name]]") {
          attributes(data-ur-set:"toggler")
          $("./a") {
            attributes(data-ur-toggler-component:"button", class:"mw_bar3")
            insert("div", class:"mw_plusminus")
          }
          move_here("../following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content", class:"mw_recipe_bar")
          }
          remove("following-sibling::div") // spacer
        }
        remove("./div[@class='mw_tr' and not(div[@align])]") // more spacers
        $(".//*") {
          remove("@align")
          remove("@valign")
          remove(".//br")
        }
      }
      remove(".//table")
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7") // style this
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
    }
  }
}
$("./body") {
  add_class("mw_action_elected")
  # remove top image
  remove("//img[@id='desktop_head']")
  $("./div[@id='wrapper']/div[@id='page']") {
    remove("./div[@id='page-head']")
    $("./div[@id='contentDiv']") {
      add_class("mw_box2")
      move_here(".//div[@class='section'] | .//form[@id='findrepcomponent'] | .//script[contains(@src, 'findreps.js')]", "bottom")
      remove("./div[@id='head'] | ./div[@style][not(*)] | ./div[@id='cols']")
      $("./div[@class='section']") {
        $("./h2") {
          add_class("mw_h2")
        }
      }
      $("./form[@id='findrepcomponent']") {
        add_class("mw_light_gray_box")
        remove(".//br")
        move_here("./div[@id='findreps_top']/div[@id='findreps_top_text']", "before") {
          add_class("mw_h2")
        }
        $("./table[@class='findrepZipEntry'] | ./div[@id='findreps_top']/table[@class='findrepComponent']") {
          $("./tr[./td/input[@id='zip']]/td") {
            remove("./text()")
            $("./label[@for='zip']") {
              add_class("mw_block")
            }
          }
          $(".//input[@id='zip'][@type='text']") {
            add_class("mw_input")
            move_here("../following-sibling::td/input[@class='Button' or @class='findreps-button'][@type='submit']", "after")
          }
          $(".//input[@class='Button' or @class='findreps-button'][@type='submit']") {
            add_class("mw_btn4")
          }
          $("./tr[./td[@align='center']]") {
            add_class("mw_center")
            remove("./td/@align")
            move_here("./td/a", "bottom")
            remove("./td")
          }
        }
        $("./div[@id='findreps_top']/table[@class='findrepComponent']//table[@class='findreps-outer-table']") {
          $(".//td[not(*)][text()] | .//p[not(*)][text()]") {
            match(text(), (/\A\s+\Z/)) {
              remove()
            }
          }
          $(".//div[@class='findreps-inner-div']//tr[./td/input[not(./preceding-sibling::label)]]") {
            add_class("mw_zip_box")
            $("./td") {
              $name = fetch("./input/@name")
              move_here("../preceding-sibling::tr/td/label[@for='"+$name+"']", "top")
            }
          }
          $(".//input[@type='text']") {
            add_class("mw_input")
          }
        }
        # search zip
        move_here("./table[@class='findrepComponent']", "after") {
          insert_before("div", class:"mw_search_top") {
            move_here("./following-sibling::table[@class='findrepComponent']//div[contains(@class, 'float') or @class='findreps-bar']", "bottom")
            $("./div[@class='float-left']") {
              add_class("mw_flex_box")
              $("./ul[@class='findreps-tab']") {
                add_class("mw_flex_box_item_1")
                remove("./li[@class='findreps-sidetab']")
              }
            }
            remove("./div[@class='findreps-bar']")
          }
          $(".//div[@class='rep-info']/div/div[@class='content-node']") {
            $("./div[@class='basic-contact-info']/div/div[contains(@id, 'findreps')]") {
              add_class("mw_flex_box")
              $("./self::div[contains(@id, 'findreps_phone_info')]/div[@class='right-node']/p[@class='findreps-repInfo']") {
                name("a")
                attribute("href", "tel:"+fetch("./text()")) {
                  value() {
                    replace(/(\-|\s|\(|\))/, "")
                  }
                }
              }
              $("./div[@class='right-node']") {
                add_class("mw_flex_box_item_1")
              }
            }
            $("./div[@class='findreps_more_contact_info']") {
              $(".//nobr") {
                name("span")
                add_class("mw_block")
              }
              $(".//label[@class='label-node'][contains(text(), 'Phone')]/following-sibling::span") {
                name("a")
                attribute("href", "tel:"+fetch("./text()")) {
                  value() {
                    replace(/(\-|\s|\(|\))/, "")
                  }
                }
              }
            }
          }
        }
      }
      table_dump(".//table")
    }
  }
}
# restaurant locator form, and anything else that looks the same
# http://www.humanesociety.org/restaurant_locator

# Sarah LaFrance March 9, 2013

$("./body") {
  add_class("mw_rest_form_tablet")
  # HSUS-284 map
  attributes(onload:"initialize()")
  # end of HSUS-284 map

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length()<=1 and not(*)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class("mw_gray_inner")

      $("./div[contains(@class, 'section simple')]/h2") {
        add_class("mw_h3")
      }
      $("./div[.//input]") {
        add_class("mw_form")
        remove("@style")
        remove(".//br")
        $(".//p") {
          remove("@style")
        }
        $(".//input[contains(@value, 'Search')]") {
          wrap("div", class:"mw_btn_wrapper mw_flex_box") {
            $("./input[contains(@value, 'Search')]") {
              btn_delegate() {
                add_class("mw_btn1 mw_flex_box_item_1")
                text("FIND")
              }
            }
            move_here("following-sibling::input[contains(@value, 'Reset')]", "bottom") {
              btn_delegate() {
                add_class("mw_btn2 mw_flex_box_item_1")
                text("RESET")
              }
            }
          }
        }
      }
    }
  }
}
# 404 Page Not Found

# Sarah LaFrance Feb 22 2013

$("./body") {
  add_class("mw_not_found")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//ul[@id='tools']") // sorry if anyone wanted to share the 404
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//p[string-length(text())= 1]")
  remove("//img[@id='desktop_head']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }

  # main content
  $(".//div[@id='main']") {
    $(".//div[@id='feature']") {
      remove(".//br")
      # $(".//a[@class='more']") {
      #   inject("  &raquo;  ")
      # }
      $("./p") {
        add_class("mw_links")
      }
    }
  }

  # handle that empty div mess at the botom
  $(".//div[@id='contentDiv']/div") {
    remove("@style")
    wrap_text_children("span")
    remove("./span[string-length()<3]")
  }

  $(".//div[@id='cols']") {
    remove("./div[not(@id) and not(@class)]")
    remove("ancestor::div/following-sibling::br")
    $(".//div") {
      remove("@style")
    }
  }

}
# Animal browse page
# http://www.humanesociety.org/animals/browse_animals.html
# 

# Feb 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_atoz") 

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//br")

  # main animal list
  $(".//div[@id='browseanimals']") {
    $("./h2") {
      add_class("mw_h1")
    }
    $("./p") {
      add_class("mw_h3")
    }
    $(".//li/a") {
      add_class("mw_animal_button")
    }
  }

}
# subcategories of the animal page
# http://www.humanesociety.org/animals/pets
# http://www.humanesociety.org/animals/rabbits

# Feb 5, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_pets")

  #removals
  # remove("./script") // just trash all the javascript for now
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='simple']")

  $(".//h2") { // fix this so it doesn't mess up boxes
    add_class("mw_h1")
    text() { }
  }
  $(".//h3") {
    add_class("mw_h2")
  }

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul//ul") { // grab the subcategory list from the main nav
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
  }

  $(".//div[@id='main']") {

    $(".//object") {
      $("./param[@name='linkBaseURL']") {
        $val_var = fetch("@value")
      }
      name("iframe")
      attribute("src", $val_var)
    }
    $(".//iframe") {
      remove("@style")
    }

    $("./div[@class='section'][1]") { // combine top divs
      move_here("../div[@class='section']/div[@class='headline']")
      move_here("../div[contains(@class, 's_borderless')]")
    }
    remove("./div[@class='section'][2]")
    $(".//select[@name='fieldname']") {
      remove("@style")
      $selected = fetch("./option[@selected]/text()")
      wrap("div", class: "mw_select1") {
        insert_bottom("span", class: "mw_select_content", $selected)
      }
    }
  }

  $(".//div[contains(@class, 's_borderless')]") {
    $(".//a[@class='more']") {
      $destination = fetch("@href")
      $destination {
        replace(/\s$/, "") //chop off the occasional trailing spaces
      }
      attribute("href", $destination)
    }
    $(".//h2") {
      move_to("..", "top")
    }
    $(".//div[@id='images']") {
      move_here(".//p[@class='image']")
      remove("./ul")
    }

  }

  $(".//div[@id='moreabout']") { // get rid of the background image
    remove("@style")
    $(".//li/a") {
      add_class("mw_bar3 mw_h3")
    }
  }

  $(".//div[contains(@class, 'area-news')]") { // news headings section
    $(".//li") { // news item
      add_class("mw_newsItem")
      insert("div") {
        move_here("../p[@class='date']")
        move_here("../h3")
      }
      move_here(".//img", "top")
      remove(".//p[@class='image']")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
      wrap("div", class:"more-link")
    }
  }

  $(".//div[@id='side']") {
    remove("./div[not(@class)][not(contains(@id, 'magazine-promo'))]")
    $("./div[@class='resources-promo' or @id='relatedissues-promo']") { // blue boxes
      $(".//li/a") {
        inject("  &raquo;  ")
      }
    }
    $(".//div[@class='resources-promo']") {
      add_class("mw_sidebar2")
      $(".//h2") {
        add_class("mw_h2")
      }
    }
    $(".//div[@id='relatedissues-promo']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        attribute("class", "mw_h1")
      }
    }
    $("./div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
    }
  }
}
# DEPRECATED AS OF MARCH 28 SEE COMMENT
# # press sections of animal
# # this page is not currently used, since qa.ts covers these pages fine.

# # Feb 5, 2013 Sarah LaFrance

# $("./body") {
#   add_class("mw_press mw_news_base")

#   # removals
#   remove(".//div[@id='head']")
#   remove(".//div[@id='page-head']")
#   remove(".//div[@class='toolsSpacer']")

#   $(".//h2") {
#     add_class("mw_h1")
#   }
#   $(".//h3") {
#     add_class("mw_h2")
#   }

#   # wild has sorting and searching, pets does not
#   $(".//div[@id='top-pagination']") {
#     add_class("mw_search2")
#     $(".//label") {
#       add_class("mw_flex_box")
#       wrap_text_children("span")
#     }
#     $(".//input") {
#       add_class("mw_flex_box_item_2")
#     }
#     $(".//button") {
#       add_class("mw_btn5")
#       text() {
#         clear()
#       }
#     }
#   }

#   $(".//div[@id='sortby']") {
#     add_class("mw_sort1")
#     attributes(data-ur-set:"toggler")
#     $(".//legend") {
#       wrap("div"){
#         attributes(data-ur-toggler-component:"button")
#         insert_top("div", class:"mw_plusminus")
#       }
#     }
#     wrap_together(".//p", "div") {
#       attributes(data-ur-toggler-component:"content")
#       $(".//label") {
#         wrap_text_children("span") {
#           inner() {
#             append("  :  ")
#           }
#         }
#       }
#     }
#   }

#   $(".//div[@id='contentDiv']") {
#     remove("./div[not(@id)]")
#     $(".//div[@class='pagination']") { // search bar
#       add_class("mw_search")
#       $(".//button") {
#         add_class("mw_btn5")
#         text() {
#           clear()
#         }
#       }
#     }
#   }

#   $(".//ul[@class='item-list']/li") { // news entry

#     $(".//p[@class='related']") {
#       wrap_text_children("span")
#     }
#     $(".//p[@class='image']") {
#       move_to("../p[contains(@class, 'author')]", "after")
#     }
#     $(".//ul") { // more link
#       move_to("..", "bottom")
#       $(".//a") {
#         inject("  &raquo;  ")
#       }
#     }
#   }

#   $(".//ul[@id='action']") {
#     add_class("mw_box5")
#     $(".//li") {
#       remove("./p")
#       remove("./form")
#     }
#     remove(".//li[not(@id)]")
#   }

#   $(".//div[@id='bottom-pagination']") { // next page etc.
#     $(".//table") {
#       $(".//td") {
#         name("div")
#       }
#     }
#     move_here(".//table//div")
#     remove(".//table")
#     remove(".//div[@class='pg-items']")
#     # test for presence of previous and next arrows to determine end cases
#     # then remove the surrounding page numbers to save room
#     $current = fetch(".//div[@class='pg-curr']/text()")
#     $previous = "false"
#     $next = "false"
#     $(".//div[@class='pg-prev']") {
#       $previous = "true"
#     }
#     $(".//div[@class='pg-next']") {
#       $next = "true"
#     }

#     $("./div[@class='pg-curr']") { 
#       insert_before("div", class:"mw_pages") {
#         move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
#         # check for base cases and remove surrounding numbers
#         match($previous) {
#           with("false") { // we're on the first page of results
#             remove("./div[position() > 4]")
#           }
#           with("true") {
#             match($next) { // we're on the last page
#               with("false") {
#                 remove("./div[position() < (("+$current+" mod 10)-3)]")
#               }
#               with("true") { // general case
#                 remove("./div[position() < (("+$current+"mod 10)-1) or position() > (("+$current+" mod 10)+2)]")
#               }
#             }
#           }
#         }
#       }
#     }

#     $(".//div[@class='pg-prev']/a") {
#       inner() {
#         prepend("  &laquo;  ")
#         replace("ious", "")
#       }
#     }
#     $(".//div[@class='pg-next']/a") {
#       inner() {
#         append("  &raquo;  ")
#       }
#     }
#   }

# }
# Animal main page
# http://www.humanesociety.org/animals/
# mockup #02-animals_kk
# km cY7 Rmd
# Feb 5 2013 Sarah LaFrancenj

$("./body") {
  add_class("mw_animals_main")
  # large chunks of this are copy-pasted from about_main.ts

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='petfinder-promo']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//div[@id='page']") {
    # remove("./div[not(@id)]") // empty

    # top navigation
    $(".//div[@id='page-head']") {
      move_here(".//ul//ul") { // grab the subcategory list from the main nav
        $("./li/a") {
          add_class("mw_bar3 mw_h3")
        }
      }
      remove("./h1")
      remove("./div")
      remove("./ul[@id='site-nav']")
    }

    $(".//div[@id='animalaccord']") { //main topic togglers
      remove(".//div[@class='clear']")
      $(".//div[@class='menu_head']/p") {
        move_to("../following-sibling::div[1]", "top") // text needs to go in content
      }
      $(".//div[@class='menu_head']") {
        wrap("div", class:"mw_animal_accord") {
          attributes(data-ur-set:"toggler")
          move_here("./following-sibling::div[1]") {
            attributes(data-ur-toggler-component:"content") {
              $(".//a") {
                add_class("mw_animal_button")
              }
            }
          }
        }
        attributes(data-ur-toggler-component:"button") {
          $("./img") {
            insert_after("div", class:"mw_plusminus")
          }
          $("./span[1]") {
            add_class("mw_ani_title")
          }
        }
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='bluenav']") {
      add_class("mw_sidebar6") // new universal class
      $(".//a") {
        add_class("mw_more")
        inject("  &raquo;  ")
      }
    }
  }
}
# cat problem solving section
# animals/cats/cat_problem_solver

# April 15 2013

$("./body") {
  add_class("mw_cat_problems")

  # remove
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//script[not(contains(@src, 'jquery'))]")
  remove(".//div[@id='petfinder-promo']")
     

  # main content 
  $(".//div[@id='main']") {
    remove("./br")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h1")
      remove("./br")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    # back arrow on the go back link
    $("./p/a") {
      inner() {
        prepend("  &laquo;  ")
      }
      $("parent::p") {
        remove("@style")
      }
    }

    # only on main page
    $(".//div[@id='feature']") {
      $(".//a[@class='more']") {
        inject("  &raquo;  ")
      }
    }
    $(".//div[@id='features']") {
      $(".//li") {
        add_class("mw_problem")
        $("./p[@class='image']") {
          move_to("..", "top")
          remove(".//br")
        }
        $(".//a[@class='more']") {
          inject("  &raquo;  ")
        }
      }
    }

    # find and tag togglers
    $(".//div[@id='accordion']") {
      $("./div") {
        attributes(data-ur-toggler-component:"content")
        $(".//img") {
          add_class("mw_img_box")
          wrap("div", class:"mw_image")
        }
        wrap("div") {
          attributes(data-ur-set:"toggler")
          move_here("preceding-sibling::h3", "top")
          $("./h3") {
            wrap("div") {
              attributes(data-ur-toggler-component:"button")
              insert("div", class:"mw_plusholder") {
                insert("div", class:"mw_plusminus")
              }
            }
          }
        }
      }
    }

  }
}
# Animal tips pages
# http://mlocal.humanesociety.org/animals/cats/tips/feline_vaccine_related_sarcoma.html
# 

# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_tips mw_article") 

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

}
$("./body") {
  add_class("mw_magazine_tablet")

  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
      $("./div[contains(@class,'s_borderless')]") {
        wrap_text_children("span")
        $("./span[contains(text(),'Have a great photo of an animal? ')]") {
          add_class("mw_h2")
        }
        $("./h3[not(*)] |./p[not(*)] |./span[not(*)] ") {
          match(fetch("./text()"), /\A[\s ]*\Z/) {
            remove()
          }
        }
        $(".//div[@id='images']//p[@class='image']/img") {
          add_class("mw_img_box")
        }
      }
      $("./div[@id='feature']/a[@class='back']") {
        wrap("div", class:"mw_back")
      }
      # HSUS-406
      $(".//div[contains(@id, 'aa_article')]/p[./span[contains(@class, 'dropcap')]]") {
        add_class("mw_first_p")
      }
    }
  }

  # Move the header here, beacuse of the upper nav
  $(".//div[@id='page']") {
    move_here(".//div[@class=' mw_masthead']", "top")
  }

  $(".//div[@id='page']//h1") {
    add_class("mw_h1")
  }
  $(".//div[@id='page']//h2") {
    add_class("mw_h2")
  }
  $(".//div[@id='page']//h3") {
    add_class("mw_h3")
  }

  $(".//div[@id='feature']") {
    # Wrap the text node in a span so I can move it around
    wrap_text_children("span", class:"feature_desc")

    # add mw_bar1 to the links
    $(".//a[@class='more']") {
      add_class("mw_bar1")
    }

    $(".//p[@class='image']//img") {
      add_class("mw_img_box")
    }
  }
  $(".//div[@id='features']") {
    $("./ul/li") {
      $("./p[./a]") {
        name("div")
        add_class("mw_flex_box_item_1")
        move_here("ancestor::li[1]/h3", "top")
      }
      $("./p[contains(@class, 'image')]") {
        wrap("div", class: "mw_flex_box") {
          move_here("ancestor::li/div")
        }
      }
    }
  }

  # images box

  
  $(".//div[@id='pubs']/ul/li") {
    add_class('mw_magazine_pub')

    $("./p[@class='date']") {
      wrap("div", class:"pub_float") {
        move_here("../h3")
      }
    }
  }

  $("./div[@id='wrapper']/div[@id='page']/div[@id='page-head']") {
    move_here("./ul[@id='site-nav']/li[contains(@class, 'expanded')]/ul", "top") {
      add_class("mw_flex_box")
      $("./li") {
        add_class("mw_flex_box_item_1")
      }
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
        # ticket 168, removing any stray whitespace from the links
        $url_text = fetch("@href")
        $url_text {
          replace(/[\s]*$/, '')
        }
        attribute("href", $url_text)
      }
    }
    remove("./ul[@id='site-nav'] | ./h1 | ./div[contains(@id, 'item')]")
  }

  # Fix the iFrame youtube video
  $(".//iframe") {
    remove("./@width | ./@height")
  }

  # Assign a page to the story pagination
  $(".//blockquote/p") {
    add_class("mw_pagination")
  }

  # For the multi-page stories.. wanted to call out the farm descriptions
  # example: http://mlocal.humanesociety.org/news/magazines/2012/07-08/back_to_the_land_page_5.html

  $(".//p[strong]") {
    add_class("mw_photo_caption_callout")
  }

  $(".//div[@id='page-bottom-spacer']") {
    remove()
  }
  # side bar
  $(".//div[@id='side']") {
    remove("./div[not(@class) and not(@id)]")
    # add_class("mw_flex_box")

    # Wrapp all the sidebar stuff except the yellow action
    # wrap_together("./div[not(@id='action')]", "div", class:"mw_flex_box") {
    #   move_to("..", "bottom")
    # }

    # Give the action sidebar the horizontal look
    # donate sidebar
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    # resources side bar
    $(".//div[@id='resources-promo']") {
      add_class("mw_sidebar3")
      $("./a[position() mod 4 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./a") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/a") {
          inject("  &raquo;  ")
          add_class("mw_flex_box_item_1")
        }
      }
      # end resources side bar
      # relate content side bar
      $(".//div[@id='related-content']") {
        add_class("mw_sidebar3")
        $(".//h2") {
          add_class("mw_h2")
        }
        $("./div[@class='module'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./div[@class='module']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/div[@class='module']") {
          add_class("mw_flex_box_item_1")
          $("./h3/a") {
            inject("  &raquo;  ")
          }
        }
        $("./p[@class='more-link']") {
          inject("  &raquo;  ")
        }
      }
      # end relate content sidebar

    $("./div[@id='resources' or @id='magazine-promo']") { // blue boxes
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//li/a | .//p/a") {
        inject("  &raquo;  ")
      }
    }

    # Give some of the other things the flexbox stuff
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
      $(".//h2") {
        attribute("class", "mw_h2")
      }
      $("./ul") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
    }
    
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
       $("./p[@class='allanimalsinclude'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./p[@class='allanimalsinclude']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/p[@class='allanimalsinclude']") {
          add_class("mw_flex_box_item_1")
          $("./a") {
            attributes(class:"more")
          }
        }
        $("./p[@class='more-link']") {
          inject("  &raquo;  ")
        }
        $("./h2") {
          wrap_text_children("span", class:"mw_h2_span")
          remove("./br")
        }
    }

    # move_to("./ancestor::div[@id='contentDiv']")
  }
  
  # HSUS-437
  $(".//div[@id='main']/div[contains(@class, 's_borderless')]//form[@class='checkboxes']/ul") {
    add_class("mw_checklist")
  }
}
# HSUS-424 : About events page
# http://www.humanesociety.org/about/events

$("./body") {
  add_class("mw_events")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//hr")

  $(".//div[contains(@class, 'section s_borderless')]") {
    remove("..//div[@id='feature'][./a[@class='back']]")
    # for the top jump links
    $("./p[./a[contains(@href, 'about/events/#')]]") {
      add_class("mw_jump_links_wrapper")
      $("./a[contains(@href, 'about/events/#')]") {
        add_class("mw_jump_links")
        $("self::a[contains(@href, 'Lobby_101_Seminars')]") {
          add_class("mw_learn_more")
        }
      }
      remove("./a[contains(@href, 'Lobby_101_Seminars')][position() > 1]")
      wrap_text_children("span") {
        match(inner(), (/\A\s*\Z/)) {
           remove()
        }
      }
    }

    # for the bottom events contents
    $("./h2[./a]") {
      add_class("mw_events_title")
      # replace the space behind the h2
      inner() {
        replace(/\s+\Z/, "")
      }
    }
    $("./p[not(contains(@class, 'mw_jump_links_wrapper') or contains(@class, 'date'))]") {
      add_class("mw_events_contents")
    }
    $("./p[./strong]") {
      add_class("mw_events_details_wrapper")
      inner() {
        replace(/^<strong>/,"<span class='mw_events_details'><strong>")
        replace(/\s<strong>/,"</span><span class='mw_events_details'><strong>")
        replace(/$/, "</span>")
      }
    }
  }
}
# end of HSUS-424
# In Your State page, only using the News section
# http://mlocal.humanesociety.org/about/state/

# January 27 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state")


  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='page']") { // fix nesting
    move_here(".//div[@id='main']/*")
    remove("./div[@id='contentDiv']")

    move_here(".//p[@class='lead']") {
      inner() {
        replace(/Click on a state below/, "Select a state") // map was removed
      }
      remove("./a[1]") // link leads to this page
      $(".//a") {
        attribute("class", "mw_bar3")
        inner() {
          replace( /\s.\s/, "") // remove extra raquo
        }
      }
    }

    $(".//div[@id='feature']") {
      # changing this entire map into a select menu
      add_class("mw_select1")
      remove("./img")
      insert("select") {
        # javascriptin it up to activate the links
        attribute("onchange", "if(this.options[this.selectedIndex].value != ''){window.top.location.href=this.options[this.selectedIndex].value}")
        insert("option", "Select a state")
        move_here("..//area") {
          inject(fetch("@alt"))
          name("option")
          remove("@coords")
          remove("@shape")
          $url = fetch("@href")
          $url{
            # strip the front of the href url so it doesn't redirect to desktop
            replace(/http:\/\/www\.humanesociety\.org/, "")
          }
          attribute("value", $url)
        }
      }
      remove("./map")
    }

    move_here(".//div[contains(@class, 'area-news')]/*")

    $(".//ul[not(@id='tools')and not(@id='share_bar')]") {
      add_class("mw_news_items")
      $(".//li") {
        insert("div", class:"mw_title") {
          move_here("../p[@class='date']")
          move_here("../h3")
        }
      }
    }

    $(".//h2/strong") {
      text() { }
      add_class("mw_h1")
    }
    $(".//h3/a") {
      add_class("mw_h3")
    }

    remove("./div[not(@id)]")
  }
}
# Department main page
# http://www.humanesociety.org/about/departments/
#

# Jan 30 2013 Sarah LaFrance

$("./body") {
  add_class("mw_dept")

  # removing
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//link")
  remove(".//div[@class='toolsSpacer']")
  remove(".//ul[@id='tools']")

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//div[@id='main']") {
    remove(".//br")
    $(".//h2") {
      attributes(data-ur-toggler-component:"button")
      insert("div") {
        add_class("mw_plusminus")
      }
      add_class("mw_bar3")
      wrap("div", class:"mw_deptItem", data-ur-set:"toggler") {
        move_here("following-sibling::*[1]")
        move_here(".//div[contains(@class, 'linksetMenu')]") {
          attributes(data-ur-toggler-component:"content")
        }
        $("./p") {
          attributes(data-ur-toggler-component:"content")
          add_class("navigationItem")
        }
        remove("./div[not(@class)]")
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
    move_here(".//div[@id='news']") {
      add_class("mw_sidebar4")
    }
  }

}
# Subcategory faith landing
# http://www.humanesociety.org/about/faith
#

# Mar 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faith")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='toolsSpacer']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//div[@class='section' and not(@id)]") { // lead section
    add_class("mw_lead")
    move_here("../ul[@id='tools']", "top")
    move_here(".//a[@class='more']")
  }

  $(".//div[@id='feature']") { // top heading
    $("./h2") { // page title
      move_to("..", "top")
      attribute("class", "mw_h1")
    }
  }

  $(".//div[@id='features']") {
    remove("./br")
    $(".//ul") {
      $("./li") {
        move_here("./p[@class='image']", "top")
        $(".//p") {
          remove(".//a[@class='more']")
        }
      }
    }
  }

  $(".//ul[@id='issue-browser']") { // list of faiths
    $("./li") {
      attributes(class:"mw_faith_toggle", data-ur-set:"toggler")
      $("./a") {
        attributes(class:"mw_bar3", data-ur-toggler-component:"button")
        remove("@href")
        insert("div", class:"mw_plusminus")
      }
      $("./ul") {
        attributes(class:"mw_faith_bar", data-ur-toggler-component:"content")
        $("./li/a[not(@class)]") {
          add_class("more")
        }
      }
    }
  }

  $(".//div[@id='main']") {
    remove(".//a[@class='back']")

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    $(".//h3|.//p[@class='author']") {
      add_class("mw_h3")
    }
    $(".//h4") {
      add_class("mw_h4")
    }
    insert("div", class:"mw_main") { // wrap all the main divs
      move_here("../div[not(contains(@class, 'mw_lead'))]")
      move_here("preceding-sibling::ul[@id='tools']", "top") // if there's no lead, grab share stuff
    }

    $(".//div[contains(@class, 's_borderless')]/ul[not(@id)]") {
      add_class("mw_article_list")
    }
  }

  $(".//div[@id='side']") { // sidebar links
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    remove(".//div[./div[@id='wayne']]")
    # need to replace that br with a space
    $(".//p") {
      remove("@style")
    }
    $("./div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $("./div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
    # For HSUS-483
    $("./div[(@id='wsd-promo') or (@id='wsd-promo2')]") {
      add_class("mw_sidebar8")
    }
    # End of HSUS-483
  }
  
}
# About employment page
# http://www.humanesociety.org/about/employment
# 

# January 25, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_employ")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")

  $(".//div[@id='main']") { // main content
    $(".//div[contains(@class, 's_borderless')]") {
      remove("..//div[@id='feature'] | ./h3/br")
      move_here("..//div[@id='feature']/a")

      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
        wrap("div", class:"mw_back")
      }

      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//p[./strong]") {
        add_class("mw_h2")
        inject("  :  ")
      }
    }
  }

  $(".//div[@id='side']") { // bottom donate box
    $("./div") {
      remove()
    }
  }
}
# About leadership page
# http://www.humanesociety.org/about/leadership
# all subpages
# http://mlocal.humanesociety.org/about/leadership/executive_staff/wayne_pacelle.html
# http://mlocal.humanesociety.org/about/leadership/board/hsus_board_directors.html

# January 23, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_leadership")

  remove(".//li/form")
  remove(".//li[@id='signup']/p")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@id='sortby']") // suppressed on the desktop
  remove(".//em[not(node())]")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='main']") {
    remove(".//div[@class='toolsSpacer']")

    $(".//h1") {
      attribute("class", "mw_h1")
    }
    $(".//h2") {
      attribute("class", "mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//div[@class='pagination']") { // search box
      add_class("mw_search1")
      $(".//label") {
        add_class("mw_flex_box")
        wrap_text_children("span")
      }
      $(".//input") {
        add_class("mw_flex_box_item_2")
      }
      $(".//button") {
        add_class("mw_btn5")
        text() {
         clear()
        }
      }
    }

    $(".//div[contains(@class, 's_borderless')]") {
      $("./p[position() mod 2=0]") { // get all the names so we can remove brs
        wrap_text_children("span")
      }
      # ticket HSUS-172
      # http://humanesociety.org/about/leadership/board/hsus_board_directors.html
      match($path, /^\/about\/leadership\/board\/hsus_board_directors/) {
        $("./p/br") {
          add_class("mw_keep")
        }
      }
      $(".//em") {
        move_to("preceding-sibling::span[1]")
      }
      $("./p/span[@style]") {
        remove(".//@style")
      }
    }

    $(".//li[@class='image']") { // person entry
      insert_top("div") {
        move_here("..//p[@class='image']//img")
        move_here("..//h2")
      }
      remove(".//p[@class='image']")
      $("./ul") {
        add_class("item-list") // ticket HSUS-172
      }
      $(".//li[@class='more']/a") {
        inject("  &raquo;  ")
      }
    }
  }

  remove(".//br[not(contains(@class, 'mw_keep'))]")
}
# State page
# http://mlocal.humanesociety.org/about/state/connecticut

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_page")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  $(".//div[@id='main']") {
    $("./div[@class='section']") {
      remove("./br")
      $("./p") {
        add_class("mw_section_p")
      }
      $("./div[@id='images']") {
        $(".//p[@class='image']") {
          wrap("div", class:"mw_image")
        }
        $(".//p[@class='caption']") {
          move_to("preceding-sibling::div[@class='mw_image']")
        }
      }
    }
    $("./div[@id='features']") {
      $(".//p[@class='image']") {
        wrap("div", class:"mw_flex_box") {
          move_here("following-sibling::p")
        }
      }
    }
  }
  # sidebar
  $(".//div[@id='side']") {
    # In your state
    $("./div[@id='state']") {
      add_class("mw_sidebar5")
    }
    $("./div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
    text() {

    }
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//iframe") {
    remove("@style")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

}
# Subcategory base page so we can detatch from the employ page
# http://www.humanesociety.org/about/*
#

# Feb 4 2013 Sarah LaFrance

$("./body") {
  add_class("mw_about")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h3")
  }
  $(".//h4") {
    add_class("mw_h4")
  }
  $(".//div[@id='images']/ul") {
    name("div")
    $("./li") {
      name("div")
    }
  }
  $(".//ul[not(@id)]") {
    add_class("mw_list1")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[@class='simple']")
  }
  
}
# Apodcast main page
# http://www.humanesociety.org/about/podcast
# 

# March 12, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_podcast")

  # remove unneeded section
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  # iframes for episodes
  $(".//iframe") {
    attribute("height", "480px")
  }

}
# individual event page
# http://www.humanesociety.org/about/events/humane_lobby_days_2013.html
# 

# March 5, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_event_page")
    # fixing up the masthead text for these pages - HSUS-516
  $(".//img[@class='mw_mobile_masthead_image']") {
    match(fetch("@src")) {
      with(/two_lines/) {
        $("following-sibling::div[@class='mw_masthead_title_text']") {
          add_class("mw_taller_text")
        }
      }
    }
  }
   # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length()<=1 and not(*)]")

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
      remove(".//br")
    }

  $(".//div[@id='main']") { // main content
    #For HSUS-434 : Add class for fixing the alignment issue
    add_class('mw_box2')
    #End of HSUS-434
    # top section with lead text and map
    $(".//ul[@id='tools']") {
      wrap("div", class:"mw_lead") {
        move_here("following-sibling::div[@class='section']")
        move_here("following-sibling::div[@id='feature' and .//iframe]")
        $(".//small") {
          wrap("div", class:"mw_caption")
          name("p")
          $(".//a") {
            remove("@style")
          }
        }
      }
    }    

    # a google maps iframe whee
    $(".//iframe") {
      $map_url = fetch("@src")
      $map_url {
        replace(/https/, "http") // fix itttttt
      }
      attribute("src", $map_url)
    }

    # wrap remaining sections into one
    # this is pretty sloppy, I'll clean it up later, need to tag more specifically -- SL
    $("./div[@class='mw_lead']") {
      insert_after("div", class:"mw_main") {
        move_here("following-sibling::div[contains(@class, 'section')]")
        $(".//div[not(@id)]") { // the faq section
          remove(".//img[contains(@id, 'question')]")
          # remove(".//br[following-sibling::br]")
          $(".//*") {
            remove("@style")
          }
          $(".//span[contains(@id, 'question')]") {
            name("h3")
            attributes(class:"mw_bar3", data-ur-toggler-component:"button")
            insert("div", class:"mw_plusminus")
            wrap("div", class:"mw_question") {
              attributes(data-ur-set:"toggler")
              move_here("following-sibling::div[1]") {
                attributes(data-ur-toggler-component:"content")
              }
            }
          }
        }
        $(".//div[table]") {
          move_here(".//td//a")
          remove(".//table")
          $("./div") {
            move_to("..", "bottom")
          }
          $("./a") {
            wrap("div") {
              add_class("mw_sponsor")
            }
          }
        }
        # $(".//div[not(//div[@class='mw_question'])]//p[count(a)=count(*) and count(a)>2]") {
        #   add_class("mw_links")
        #   $("./a") {
        #     add_class("mw_bar3")
        #   }
        #   wrap_text_children("span")
        #   remove("./span")
        # }
        $(".//div[contains(@class, 'question')]") {
          $("following-sibling::p") {
            attribute("class", "mw_get_faq")
          }
        }
        $(".//a[@class='more']") {
          inject("  &raquo;  ")
        }

        # try to grab nominee films for genesis
        $(".//div[contains(@class, 'simple')]") {
          $(".//p[preceding-sibling::h3[strong] or following-sibling::h3[strong]]") {
            add_class("mw_nominees")
            wrap_text_children("span") {
              match_not(inner(), /\S/) {
                remove()
              }
            }
            # remove("./span")
            remove(".//br")
            $("preceding-sibling::h3[strong]") {
              add_class("mw_h3_nom")
            }
            $("following-sibling::h3[strong]") {
              add_class("mw_h3_nom")
            }
             # for HSUS-516 - changing styling to be .mw_nominees > a to .mw_nominees > .mw_nominee_elements 
            inner_wrap("span", class: "mw_nominee_elements")
          } 
        }
        # HSUS-516 - making this not include nominees, moved after nominees designation
        $(".//div[not(//div[@class='mw_question'])]") {
          $(".//p[not(contains(@class, 'mw_nominees')) and (count(a)=count(*) and count(a)>2)]") {
            add_class("mw_links")
            $("./a") {
              add_class("mw_bar3")
            }
            wrap_text_children("span")
            remove("./span")
          }
        }
      } // close mw_main
    }

    # grab the bottom section of genesis pages
    $("./div[not(@class)]") {
      add_class("mw_genes")
      # presenter list
      $(".//p[a[contains(@href, 'imdb')]]") {
        add_class("mw_links")
        remove(".//br")
      }
      $("./div") {
        wrap_text_children("span")
        remove("./span")
      }
    }

    # remove any empty sections
    $(".//div[not(node())]") {
      remove()
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//span") {
        remove("@style")
      }
    }
    # HSUS-399 Looking for a pet side bar
    $("./div[@id='petfinder-promo']") {
      add_class("mw_pet_box")
      $("./p[@class='up']") {
        wrap("div", class:"mw_find_pet") {
          move_here("preceding-sibling::p", "top")
        }
      }
      $("./div[@class='mw_find_pet']") {
        move_to("following-sibling::img[1]", "after")
      }
    }
    # HSUS-413 : magazine-promo style
    $("./div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
    }
    # end of HSUS-413
    # relate content side bar
  #For  HSUS-434 : Added class for styling
  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")  
  }
  #End of HSUS-434
  # end relate content sidebar
  }
}
# About FAQ page
# http://www.humanesociety.org/about/contact/frequently_asked_questions.html
# http://www.humanesociety.org/about/contact/

# January 24, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faq")

  $(".//li") {
    inner() {
      replace(/\xC2\xA0/, "")
    }
  }

  $(".//div[@id='contentDiv']") {
    remove(".//div[@id='head']")
    $(".//div[contains(@class, 's_borderless')]") {
      move_here("preceding-sibling::div/a")
      remove(".//ul[@id='tools']")
      remove(".//p[@class='author']")

      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
      }

      $(".//p[.//strong]") {
        add_class("mw_subcats")
      }

      remove("preceding-sibling::div")

      $(".//p[contains(@class, 'subhead')]") {
        add_class("mw_h2")
        insert_after("div", class:"mw_blubox") {
          move_here("../h3/following-sibling::p[1]")
          move_here("../h3")
          $("./h3[1]") {
            move_to("..", "top")
          }
          $("./p[2]") {
            move_to("..", "bottom")
          }
        }
      }

      remove(".//div[@class='mw_blubox' and not(node())]") // remove the top box if empty

      # pull up misplaced ps
      move_here(".//div[contains(@class, 'last')]/p")

      $("./p[./a[@name]]") {
        wrap("div", class:"mw_answer")
      }

      $("./*[not(@class='mw_answer') and not(@class='back')]") {
        move_to("./preceding-sibling::div[@class='mw_answer']")
      }

      # set up accordions
      $("./ul") { // link togglers
        $("./li") {
          attributes(data-ur-set:"toggler")
          $("./a") {
            name("div")
            attributes(data-ur-toggler-component:"button", class:"mw_bart")
          }
          insert("div") {
            attributes(data-ur-toggler-component:"content")
            move_here("../../following-sibling::div[@class='mw_answer'][1]")
            $(".//p[./a[@name]]") {
              remove() // the restating of the question is redundant now
            }
          }
        }
      }
    }
  }

  $(".//div[@id='page-head']/ul") {
    remove(".//li")
    move_here("//p[@class=' mw_subcats']/a")
    remove("//p[@class=' mw_subcats']")
    $(".//a") {
      wrap("li")
      add_class("mw_bar3")
    }
  }

  $(".//div[@id='side']") {

    remove("./div[@id='related-content']")
  }
}
# About overview page
# http://www.humanesociety.org/about/overview
# 

# January 22, 2013 Sarah LaFrance

# this is going to be broken out into an about subcategory base if needed.

$("//body") {
  add_class("mw_overview")

  # remove unneeded section

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  remove(".//div[@id='page-head']")
  # remove(".//div[@class='section']")  // For HSUS-519
  remove(".//div[@class='simple']")
  remove(".//p[@class='author']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='contentDiv']") {
    copy_here("//ul//ul//ul", "top") { // sub-subcategory link list 
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    remove(".//div[@id='head']")
    
    # http://www.humanesociety.org/about/overview/
    # remove one br
    remove(".//div[contains(@class, 's_borderless')]/h1[contains(text(), 'Us:')]/following-sibling::p/br")
    
    # remove empty p
    $(".//div[contains(@class, 's_borderless')]//p[not(*)]") {
      match(text(), (/\A\s+\Z/)) {
        remove()
      }
      match_not(text(), (/.+/)) {
        remove()
      }
    }
    $(".//p[contains(@class, 'subhead')]") {
      add_class("mw_h3")
    }
    
    $(".//p[img[contains(@class, 'asset-image')]]") {
      remove("./@style")
      add_class("mw_img_p")
    }

    $(".//blockquote[not(.//blockquote)]") {
      add_class("mw_light_blue")
    }

    $(".//iframe") {
      remove("@style")
      remove("@width")
      remove("@height")
    }

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }

    $(".//div[@id='content']") {
      $(".//h3[@class='spacing']") {
        remove("./@class | ./@id")
        remove("./img")
        attributes(data-ur-set:"toggler")
        wrap_text_children("div", class:"mw_accomplish") {
          match(text(), (/\A\s+\Z/)) {
            remove()
          }
          attributes(class:"mw_acco_btn", data-ur-toggler-component:"button")
        }
        $("./div[contains(@id, 'answer')]") {
          remove("./@id | ./@style")
          attributes(class:"mw_acco_content", data-ur-toggler-component:"content")
        }
      }
    }

    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }

    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      move_to("..", "top") // place above the take action box
    }
    # HSUS-144 Update styling on Annual Report 2011
    $("./div[@id='cols']/div[@id='main']/div[.//div[@id='images']/ul/li/p[@class='image']]") {
      add_class("mw_image_section")
      remove("./p//br | following-sibling::div[contains(@class,'simple')]//strong//br")
      $("following-sibling::div[contains(@class,'simple')]/h2") {
        add_class("mw_h3")
      }
    }
    # End HSUS-144 Update styling on Annual Report 2011
  }

}
# About main page
# http://www.humanesociety.org/about
# using mockup 02-animals_kk

# January 22, 2013 Sarah LaFrance

# About section still needs some tweaks, tritium and styling needs to be
# combined and streamlined into better files

$("./body") {
  add_class("mw_about")

  # remove unneeded sections
  remove("./script") // just trash all the javascript for now
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }
  $(".//p[contains(@class, 'subhead') and not(node())]") {
    remove()
  }

  $(".//br") {
    inject_after(" ")
    remove()
  }
  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1 and not(*)]") { // this may be overpowered, keep an eye on it
    # it's ONLY intended to remove whitespace-only p tags
    remove()
  }

  $(".//div[@id='page']") {
    remove("./div[not(@id)]") // empty

    # top navigation
    $(".//div[@id='page-head']") {
      move_here(".//ul//ul") { // grab the subcategory list from the main nav
        $("./li/a") {
          add_class("mw_bar3 mw_h3")
        }
      }
      remove("./h1")
      remove("./ul[@id='site-nav']")
      remove("./div")
    }

    # main content
    $("./div[@id='contentDiv']") {
      $("./div[@id='head']") { // top big image
        remove(".//div[@id='top_band']")
        name("img")
        # attribute("src", "http://www.humanesociety.org/assets/images/page-head/about_us.jpg")
      }

      remove(".//img[@id='head']")

      $(".//p[@class='subhead']") {
        add_class("mw_h2")
      }
      $(".//h2") {
        add_class("mw_h3")
      }
      $(".//h4") {
        add_class("mw_h4")
      }

      $(".//div[@id='main']") {
        remove("./div[not(@class)]")
      }

      $("./div[@id='cols']") { // main content

        $(".//div[@class='section']") {
          move_here("//ul[@id='tools']", "top") {
            # HSUS 117 - align social share icons
            match($path, /^\/about\/contact\//) {
              add_class("mw_faq_share")
            }
          }
        }

        remove(".//div[@class='toolsSpacer']")
        $(".//div[@id='features']") { // list of articles
          $(".//h3") {
            text() { } // strip a tags
            add_class("mw_h2")
          }
        }

        $("./div[@id='side']") { // sidebar links
          remove(".//div[./div[@id='wayne']]")
          remove(".//div[@id='state']")
          remove(".//div[@class='simple']")
        }
      }
    }
  }
}
# Subcategory faith forms
# http://www.humanesociety.org/about/faith
#

# Mar 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faith_form mw_faith")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h2")
  }
  $(".//h4") {
    add_class("mw_h4")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='main']") {
    $("./div[@id='feature']") { // top heading
      $("./h2[1]") { // page title
        move_to("..", "top")
        attribute("class", "mw_h1")
      }
    }
    $(".//table") {
      $(".//td") {
        name("div")
        remove(".//br")
      }
      $(".//tr") {
        name("div")
        remove(".//br")
        move_to("../..")
      }
      remove()
    }
    $(".//div") {
      remove("@style")
      remove("@valign")
      remove("@width")
    }
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_spam")
    }
    $(".//input[@type='submit']") {
      $buttonText = fetch("@value")
      $buttonText {
        replace(/\./, "")
      }
      attribute("value", $buttonText)
    }
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[contains(@id, '-promo')]")
  }
  
}
# State ranking page
# http://mlocal.humanesociety.org/about/state/humane_state_ranking_2011.html

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_rank")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='options']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
    text() {

    }
  }
  $(".//h3") {
    add_class("mw_h3")
    remove("@style")
  }

  $(".//iframe") {
    remove("@style")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  # main content
  $(".//div[@id='main']") {

    $(".//p[@class='lead']") {
      inner() {
        # fixing instructions
        replace(/Hover over .* tier/, "Click on a tier to see state rankings, and click the name of a state")
      }
    }

    # the map section
    $("./p") {
      remove("./img")
      $("./map/area") {
        $state_name = fetch("@alt")
        $state_name {
          replace(/(\s|:)\s(\s)?.*/, '') // clip off the state name
        }
        attribute("id", $state_name)
      }
    }

    # the key box
    $("./div[not(@class) and ./img]") {
      add_class("mw_key")
      remove("@style")
      remove(".//br")
    }

    # tables with rankings
    $(".//div[./ul[@id='acc']]") {
      add_class("mw_rank_tables")
      remove("@style")
      $(".//li") {
        attributes(data-ur-set:"toggler")
        $("./h3") {
          attributes(data-ur-toggler-component:"button")
          #For HSUS-501: 2013 State Ranking page - remove map and have stacked percentages like example
          inner() {
            replace(/(.*)(-)(.*)/,"$1 - $3")
          }
          #End of HSUS-501
        }
        $("./div") {
          attributes(data-ur-toggler-component:"content")
          $(".//div[@class='acc-content']") {
            $(".//td") {
              add_class("mw_was_td")
              name("div")
              remove("@style")
            }
            $(".//tr") {
              name("div")
              add_class("mw_was_tr")
              remove("@style")
              remove("./div[1]")
              remove("./div[2]")
            }
            $(".//div[contains(@class, 'head')]") {
              remove()
            }
            $(".//div[@class=' mw_was_tr']") { // class is not header
              attributes(data-ur-set:"toggler")
              wrap_together("./div", "div") {
                attributes(data-ur-toggler-component:"button")
                $(".//div[@class=' mw_was_td']") {
                  $state_head = upcase(fetch("text()"))
                }
              }
              insert("div", data-ur-toggler-component:"content") {

                move_here("//map/area[@id='"+$state_head+"']") {
                  name("p")
                  inject(fetch("@alt"))
                  inject(fetch("@title"))
                  remove("@alt")
                  remove("@title")
                  remove("@shape")
                  remove("@coords")
                  remove(".//br")
                  #For HSUS-501: 2013 State Ranking page - remove map and have stacked percentages like example
                  wrap_text_children("span") {
                    attribute("class","mw_temp")
                  }
                  $(".//span[@class='mw_temp']") {
                    inner() {
                      replace(/(.*Score:\s[\d \%]*)(.*)/, "<span class='mw_bold'>$1</span>")
                    }
                  }
                  #End of HSUS-501
                }
              }
            }
          }
        }
      }
    }

    $(".//img") {
      $source = fetch("@src")
      $source {
        replace(/png.*/, "png")
      }
      attribute("src", $source)
    }

    $("./p") {
      remove()
    }
  }

  $(".//p[@class='lead'][last()]"){
    wrap_text_children("span"){
      text(){
        replace("Hover over a state for a summary, c", "C")
      }
    }
  }

}
# Department subpages
# http://www.humanesociety.org/about/departments/*
#

# Feb 21 2013 Sarah LaFrance

$("./body") {
  add_class("mw_department")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1 and not(*)]") {
    remove()
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
    text() {
      
    }
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//p[@class='lead']") {
    remove(".//br")
  }

  $(".//div[@id='features']") {
    $(".//li/p[@class='image']") {
      move_to("..", "top")
    }
  }

  $(".//div[contains(@class, 'area-news')]/a[@class='more']") {
    wrap("div", class:"more-link")
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[@id='state']")
    remove(".//div[@class='simple']")
    remove("./iframe")
    remove(".//br")
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%;")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  
  $(".//div[@id='main']/div[contains(@class, 's_borderless')]") {
    $("./p[@class='subhead']") {
      add_class("mw_h3")
    }
    $("./p[not(@class)]") {
      add_class("mw_part_p")
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//div[@id='petfinder-promo']") {
      add_class("mw_sidebar7")
    }
  }
  $(".//ul[@id='action']") {
    ## HSUS - 442
    remove("./li[@id='donate']/a[@class='give-bttn']")
  }
}
# All fact sheets
# http://mlocal.humanesociety.org/issues/fisheries/facts/right_whale_extinction.html
# http://mlocal.humanesociety.org/animals/cats/facts/cat_wildlife.html
# http://mlocal.humanesociety.org/issues/campaigns/factory_farming/fact-sheets/ag_gag.html
# http://mlocal.humanesociety.org/issues/puppy_mills/facts/
# http://mlocal.humanesociety.org/issues/exotic_pets/facts/fact_fiction_monkeys_apes_pets.html

# Feb 21 2013 Sarah LaFrance

$("./body") {
    add_class("mw_fact_sheet")

    #removing
    remove(".//div[@id='head']")
    remove(".//div[@id='page-head']")
    remove(".//div[@id='page-bottom-spacer']")
    remove(".//p[string-length()<=1 and not(*)]")

    # main content
    $(".//div[@id='main']") {

      # social media buttons
      move_here(".//ul[@id='tools']", "top")

      $(".//div[@id='feature']") {
        move_to("..", "top")
        $(".//a") {
          inner() {
            prepend("  &laquo;  ")
          }
        }
      }
      
      $(".//div[@id='feature'][./a]") {
        add_class("mw_borderwithback")
      }

      $(".//div[contains(@class, 's_borderless')]") { // actual article content
        # move date to below author and subhead
        move_here("./p[contains(@class, 'author')]", "top")
        move_here("./p[contains(@class, 'subhead')]", "top")
        move_here("./h1[1]", "top")

        $(".//p[string-length()<=1 and not(*)]") {
          remove()
        }

        # $("./p/br") {
        #   remove()
        # }

        $(".//div[contains(@id,'image-')]") {
          remove("@style")
        }

        $(".//h1") {
          add_class("mw_h1")
        }
        $(".//h2") {
          add_class("mw_h2")
        }
        $(".//h3") {
          add_class("mw_h3")
          $("./following-sibling::*[1][self::p][not(@class)]") {
            add_class("mw_fact_p")
            remove("./br")
          }
        }

        # ticket 146, handling the table
        $(".//table") {
          $(".//tr") { // no ths in this table
            $(".//td") {
              name("div")
              attributes(class:"mw_datum")
              remove("@style")
            }
            name("div")
            attributes(class:"mw_test_row")
          }
          name("div")
          attributes(class:"mw_cos_table")
          move_here(".//div[contains(@class, 'mw_test_row')]")
          remove("./tbody")
        }
        # Fix for HSUS-470
        match_not($path, /fur_fashion\/tips/) {
          # scope into the untabled table
          $(".//div[@class='mw_cos_table']") {
            # grab the headings for the data
            $("./div[1]") {
              $("./div[1]") {
                remove() // first column label, not needed
              }
              $("./div[@class='mw_datum']") {
                %index = index()
                log("############### AT "+ %index)
                $(".//p") {
                  var("heading_" + %index, fetch(".//text()"))
                }
                remove()
              }
            }
            # tweak test titles
            $("./div[@class='mw_test_row']") {
              # trim nbsps at the beginning of strings
              $(".//p|.//strong|.//div") {
                inner() {
                  replace(/^[\s]*/, '')
                }
              }
              $("./div[@class='mw_datum']") {
                remove("@align")
              }
              $("./div[1]") {
                remove(".//br")
                add_class("mw_h2")
                text() { }
                wrap_text_children("strong")
              }
              $("./div[@class='mw_datum' and .//img]") {
                add_class("mw_animals")
                remove(".//br")
                insert("div", class:"mw_animal_imgs") {
                  move_here("..//img")
                  move_to("..", "top")
                }
              }
              insert("div", class:"mw_test_text") {
                move_here("../div[not(contains(@class, 'mw_h2'))]")
                $("./div[contains(@class, 'mw_datum')]") {
                  %index = index()
                  insert_top("strong") {
                    inject(var("heading_" + %index))
                  }
                }
              }
            }
          }
        }
        # End of HSUS-470

        $(".//iframe") {
          remove("@height")
          remove("@width")
        }

        # forms are on protect seals app pages
        $(".//form") {
          add_class("mw_appform")
          $(".//*") {
            remove("@cols")
          }
          $(".//td[label[@for='cons_email_opt_in']]") {
            add_class("mw_checkboxrow")
          }
          $(".//p[input[@class='Button']]") {
            add_class("mw_buttonrow")
            $("./input") {
              wrap("div", class:"mw_button")
            }
          }
        }
      }
    }

    # side bar
    $(".//div[@id='side']") {
      remove("./br")
      $(".//a[@class='more']") {
        inject("  &raquo;  ")
      }
      $(".//div[@id='related-content']") {
        add_class("mw_sidebar3")
        $(".//h2") {
          add_class("mw_h2")
        }
      }
      $(".//div[@id='magazine-promo']") {
        add_class("mw_sidebar7")
      }
    }
}
$("./body") {
  add_class("mw_message_viewer")
  $(".//table") {
    remove("@style")
    remove("@bgcolor")
    remove("@width")
  }
  $("./table[.//link[contains(@href, 'sealpup_alert.jpg')]]") {
    wrap("div", class:"mw_viewer_container") {
      move_here("..//div[contains(@class, '_footer')]", "bottom")
      $(".//div[./h1]") {
        $(".//a[./img[contains(@src, 'submit_button_smaller')]]") {
          btn_delegate() {
            add_class("mw_submit_button")
            text("Submit")
          }
        }
      }
    }
    $(".//table[.//span[contains(text(), 'The Humane Society of the United States')]]") {
      move_to("ancestor::div[@class='mw_viewer_container']/div[contains(@class, '_footer')]", "top")
    }
    $(".//table[.//span[contains(text(), 'Trouble with links or images')]]") {
      add_class("mw_hide")
      $("following-sibling::table") {
        $(".//tr[./td/a/img[contains(@alt, 'Share on Facebook')]]") {
          $("self::tr | ./td") {
            name("div")
          }
          inner_wrap("div", class:"mw_share_buttons") {
            inner_wrap("div", class:"share_bar") {
              remove(".//@style")
              $("./div") {
                remove("@align")
              }
              $(".//img[contains(@src,'facebook')]/..") {
                add_class("addthis_button_facebook")
              }
              $(".//img[contains(@src,'twitter')]/..") {
                add_class("addthis_button_twitter")
              }
              $(".//img[contains(@src,'email')]/..") {
                add_class("addthis_button_email")
              }
              $("./div[not(./*)]") {
                add_class("mw_testing")
              }
              $(".//a") {
                text() {  
                  replace("")
                }
                $("./img") {
                  btn_delegate()
                }
              }
            }
            move_here(".//div[contains(@valign, 'bottom')]", "after") {
              add_class("mw_date_wrapper")
            }
            insert_top("p") {
              text() {
                set("Share")
              }
            }
          }
        }
      }
    }
  }
  $(".//div[contains(@class, '_footer')]") {
    remove(".//@style")
    $("./table//tr//span[contains(text(), ' All rights reserved')]") {
      inner_wrap("div", class:"mw_footer_copyright") {
        wrap_text_children("span")
        $("./span[contains(text(), 'All rights reserved')]") {
          add_class("mw_copyright_head")
        }
      }
    }
  }
  $(".//img") {
    remove("@align")
    remove("@width")
    remove("@height")
  }
  remove("./div[@id='cv-poweredBy']")
  remove(".//img[contains(@alt, 'Humane Action')]")
}
$("./body") {
  add_class("mw_shop")

  $(".//div[@id='main']") {
    add_class('mw_box2')
  }

  # make the corporate supporters big
  $(".//div[@id='feature']/h2") {
    add_class("mw_h1")
  }

  # Shop our corporate supporters
  $(".//div[@id='features']") { #Note the ID difference- feature vs features
    $('./h2') {
      add_class("mw_h3")
    }

    # Flexbox the image and description
    $("./ul/li") {
      add_class("mw_corporate_supporters")
    }
  }
  
  # Remove the spacer between the body content and footer
  $(".//div[@id='page-bottom-spacer']") {
    remove()
  }


}
$("./body") {
  add_class("mw_flickr")
  attributes(id:"mw_flick_iframe", onload:"resizeIframe('mw_flick_iframe')")
  remove("./div[@class='mw_header'] | .//tr[./td[contains(@class, 'shimCell')]]")
  $(".//tr[./td[contains(@class, 'formLabelBottomLeft')]]") {
    wrap("div", class:"mw_label_box")
    add_class("mw_label")
  }
  $(".//table") {
    $(".//tr[not(contains(@class, 'mw_label'))]") {
      move_to("./preceding-sibling::div[@class='mw_label_box'][1]", "bottom")
    }
    table_dump(".")
  }
}
$("./body") {
  add_class("mw_shop")

  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
    }
  }

  # make the corporate supporters big
  $(".//div[@id='feature']/h2") {
    add_class("mw_h1")
  }

  # Shop our corporate supporters
  $(".//div[@id='features']") { #Note the ID difference- feature vs features
    $('./h2') {
      add_class("mw_h3")
    }

    # Flexbox the image and description
    $("./ul/li") {
      add_class("mw_corporate_supporters")
    }
  }
  
  # Remove the spacer between the body content and footer
  $(".//div[@id='page-bottom-spacer']") {
    remove()
  }


}
$("./body") {
  add_class("mw_maplist")

  $(".//div[@id='inside']") {
    add_class("mw_box2")
  }

  # Hide stuff
  $(".//div[@id='head']") {
    add_class("mw_hide")
  }

  $(".//div[@class='section s_borderless']") {
    remove("./br")
  }

  # Fix the tools and hide the breadcrumb
  $(".//ul[@id='tools']/li[not(@id)]") {
    #remove("@style")
    add_class("mw_hide")
  }

  # $(".//div[contains(@class, 'section-lead')]/table//tr") {
  #   add_class("")
  # }

  # Trying out the table dump
  $(".//div[contains(@class,'section-lead')]") {
    $("./h2") {
      add_class("mw_h1")
      $("./strong") {
        inner() {
          replace(/^.*A/, 'A')
        }
      }
      $("following-sibling::p[1]") {
        remove()
      }
    }
    remove("./br")
    table_dump("./table")

    # remove the <th> row
    remove(".//div[contains(@class, 'mw_was_th')]")
  }

  # paginator
  table_dump(".//table[@class='paginator']")

  $(".//div[contains(@class, 'paginator')]") {

    # giving the number of items special treatment
    $(".//div[b]") {
      add_class("mw_pagination_items")
    }

    $(".//div[contains(@class, 'mw_was_tr')]") {
      remove(".//div[contains(@class, 'pg-items')]")

      $current = fetch(".//div[contains(@class, 'pg-curr')]/text()")
      $previous = "false"
      $next = "false"
      $(".//div[contains(@class, 'pg-prev')]") {
        $previous = "true"
      }
      $(".//div[contains(@class, 'pg-next')]") {
        $next = "true"
      }
      log(concat("current: ",$current," $next: ", $next," $previous: ", $previous))

      # check for base cases and remove surrounding numbers
      match($previous) {
        with("false") { // we're on the first page of results
          remove("./div[contains(@class, 'pg-page') and position() > 4]")
        }
        with("true") {
          match($next) { // we're on the last page
            with("false") {
              remove("./div[contains(@class, 'pg-page') and position() < (("+$current+" mod 10)-3)]")
            }
            with("true") { // general case
              remove("./div[contains(@class, 'pg-page') and position() < (("+$current+"mod 10)-1) or contains(@class, 'pg-page') and position() > (("+$current+" mod 10)+2)]")
            }
          } 
        }
      }
      # End check for base cases
    }
  }

  # remove useless back link
  $(".//div[@class='pagination']/following-sibling::p") {
    remove()
  }

  # remove the bottom spacer
  remove(".//div[@id='page-bottom-spacer']")
}
# Chimpanzee art contest

$("./body") {
  add_class("mw_chimp_art_contest_mobile")
  
  #Remove fancybox script
  # remove(".//script[contains(@src, 'fancybox')]")

  $(".//div[@id='contentDiv']") {
    add_class("mw_box2")

    $(".//form[contains(@id, 'survey')]") {
      add_class("mw_main_form")

      # Chimp blocks
      $(".//div[@class='finalist-blocks']") {
        remove("./a[@class='fancybox-thumb']/img/@style")
        # attributes(class:"mw-fancybox-thumb")

        # repalce the image placeholder with the actual image
        # Break out the chimp's painting into a separate carousel item
        $("./a[./img[contains(@src, 'mobile')]]") {
          %painting = fetch("@href")
          insert_after("a", class:"fancybox-thumb") {
            insert("img", src: %painting)
          }
        }

        $("./a[@class='fancybox-thumb']") {
          remove("@rel | @ data-fancybox-group")
          attributes(class:"mw-fancybox-thumb")
          name("div")
          attributes(data-ur-carousel-component:"item")
        }

        wrap_together("./div[@class='mw-fancybox-thumb']", "div") {
          attributes(data-ur-carousel-component:"scroll_container")
          wrap("div", data-ur-set:"carousel", data-ur-fill:"1", data-ur-autoscroll:"disabled", data-ur-carousel-component:"view_container", class:"chimp-carousel") {
            insert("div", data-ur-carousel-component:"dots")
          }
        }

        # Style the 'inline' paragraph
        $("./p[@style='display:inline;']") {
          remove("@style")
          add_class("mw-chimp-body-text")
        }
      }
    }

    # Voting form
    $(".//div[@id='chimps-fields-input-boxes']") {

      # Remove the fixed length of the fields
      $(".//input[@type='text']") {
        remove("@size")
        add_class("mw_input")
      }
    }

    contextual_keyboard(".//input[@name='cons_email']", "email") 
    contextual_keyboard(".//input[@name='cons_zip_code']", "numeric") 

    # make the button nice and big
    $(".//input[@class='chimps-submit-button']") {
      add_class("mw_btn1")
      wrap("div", class:"mw_submit_btn")
    }
  }

  # Move the bottom element back into the form
  $(".//div[@id='chimps-bottom-elements']") {
    move_to("./ancestor::div[@id='main']//form[contains(@id, 'survey')]", "bottom")
  }
  $(".//div[@id='main']/input[@type='hidden']") {
    move_to("./ancestor::div[@id='main']//form[contains(@id, 'survey')]", "bottom")
  }

  # change the footer
  $(".//div[@id='footer']") {
    attributes(id:'foot')
  }

}
$("./body") {
  add_class("mw_chimp_art_contest_tablet ")
  #Remove fancybox script
  # remove(".//script[contains(@src, 'fancybox')]")

  # header logo img
  $("./div[@class='mw_header']/a[@class='mw_header_spillover']/img") {
    attribute("src") {
      value() {
        replace(/[\/|\w|\.]+(\.\..*)/) {
          set($1)
        }
      }
    }
  }
  # end header logo img
  remove("./div[@id='wrapper']/br")
  $("./div[@id='wrapper']") {
    # insert_top("div", class: "mw_masthead") {
    #   insert("img", src: "http://www.humanesociety.org/assets/images/1024x256-tablet-mastheads/tablet_masthead_default.png", class: "mw_tablet_masthead_image")
    # }
    $("./div[@id='page']") {
      remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style] | ./br")
      $("./div[@id='contentDiv']/div[@id='cols']") {
        add_class("mw_box2_tablet")
        $("./div[@id='main']/div[@id='wrapper-body']") {
          remove("./@style")
          # share
          $("./ul[@id='share_bar']/li/img[@class='share_image']") {
            name("span")
            insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
            remove()
          }

          # Chimp blocks
          $(".//div[@class='finalist-blocks']") {
            remove("./a[@class='fancybox-thumb']/img/@style")

            # repalce the image placeholder with the actual image
            # Break out the chimp's painting into a separate carousel item
            $("./a[./img[contains(@src, 'mobile')]]") {
              %painting = fetch("@href")
              insert_after("a", class:"fancybox-thumb") {
                insert("img", src: %painting)
              }
            }

            $("./a[@class='fancybox-thumb']") {
              remove("@rel | @ data-fancybox-group")
              name("div")
              attributes(data-ur-carousel-component:"item", class:"mw-fancybox-thumb")
            }

            wrap_together("./div[@class='mw-fancybox-thumb']", "div") {
              attributes(data-ur-carousel-component:"scroll_container")
              wrap("div", data-ur-set:"carousel", data-ur-fill:"1", data-ur-autoscroll:"disabled", data-ur-carousel-component:"view_container", class:"chimp-carousel") {
                insert("div", data-ur-carousel-component:"dots")
              }
            }

            # Style the 'inline' paragraph
            $("./p[@style='display:inline;']") {
              remove("@style")
              add_class("mw-chimp-body-text")
            }
            
            # Move the title to the top above the carousel
            move_here("./p[@class='chimp-titles']", "top")

            # insert("div", class:"chimp-info") {
            #   move_here("../p[@class='chimp-titles']")
            #   move_here("../p[@class='mw-chimp-body-text']")
            #   move_here("../div[@class='chimp-label']")
            # }
          }

          # end share
          # $("./div[contains(@id, 'pov-col')]") {
          #   $(".//h3") {
          #     add_class("mw_h3")
          #   }
          #   $("./div[@class='pov-text']") {
          #     $("./h2") {
          #       add_class("mw_h2")
          #       remove("./br")
          #     }
          #     $("./p") {
          #       name("div")
          #       wrap_text_children("span")
          #       $("./br/following-sibling::span[1]") {
          #         wrap("div", class:"mw_wrap_div")
          #       }
          #       $("./a | ./span | ./strong") {
          #         move_to("preceding-sibling::div[1]", "bottom")
          #       }
          #       remove("./br")
          #     }
          #   }
          #   $(".//div[@class='pov']") {
          #     remove(".//@style | .//@width")
          #     $("./img") {
          #       add_class("mw_img")
          #     }
          #     $("./div[@id='pov-radio-error']") {
          #       move_to("./preceding-sibling::label[@class='pov-label']", "bottom")
          #     }
          #     $("./p[not(*)]") {
          #       text() {
          #         replace(/^[\s\u00a0]+/, "")
          #         replace(/[\s\u00a0]+\|$/, "")
          #       }
          #     }
          #   }
          #   # cast your vote area
          #   # $(".//div[@id='pov-fields-input-boxes']") {
          #   #   remove("./p/@style | ./div[@id='bogotext']//img/@style")
          #   #   $("./div/input") {
          #   #     add_class("mw_input")
          #   #   }
          #   #   $("./label[./input[@class='radio']]") {
          #   #     add_class("mw_radio")
          #   #     move_here("./following-sibling::div[@id='pov-radio-area-legal' or @id='pov-radio-error-legal']", "bottom")
          #   #   }
          #   #   $("./input[@class='pov-submit-button']") {
          #   #     add_class("mw_btn1")
          #   #     wrap("div", class: "mw_submit_btn")
          #   #   }
          #   # }
          #   # end cast your vote area
          # }
        }

        # Voting form
        $(".//div[@id='chimps-fields-input-boxes']") {

          # Remove the fixed length of the fields
          $(".//input[@type='text']") {
            remove("@size")
            add_class("mw_input")
          }
        }

        contextual_keyboard(".//input[@name='cons_email']", "email") 
        contextual_keyboard(".//input[@name='cons_zip_code']", "numeric") 

        # make the button nice and big
        $(".//input[@class='chimps-submit-button']") {
          add_class("mw_btn1")
          wrap("div", class:"mw_submit_btn")
        }
      }
    }
  }
  # Move the bottom element back into the form
  $(".//div[@id='chimps-bottom-elements']") {
    move_to("./ancestor::div[@id='main']//form[contains(@id, 'survey')]", "bottom")
  }
  $(".//div[@id='main']/input[@type='hidden']") {
    move_to("./ancestor::div[@id='main']//form[contains(@id, 'survey')]", "bottom")
  }
}
# reus_hsus_donation_2013 page

$("./body") {
  add_class("mw_reus_hsus_tablet")

  # Remove fixed with on table
  $(".//div[@id='ga-content']/table") {
    remove("@style")
    add_class("mw_reus_table")
  }

  $(".//div[@id='splash_container']") {
    add_class("mw_gray_inner")
    wrap("div", class:"mw_box2_tablet") 
  }

  # Remove the br's in the top_button
  $(".//div[@id='top_button']") {
    remove(".//br")
  }


  fixImages()
  # how the image URLS should look:
  # https://secure.humanesociety.org/images/content/pagebuilder/donate_monthly_red.png
  # how they turn out:
  # https://secure.humanesociety.org//site/images/content/pagebuilder/donate_now_red.png
  $(".//img") {
    %new_url = fetch("@src")
    %new_url {
      replace(/\/site/, "")
    }
    set("src", %new_url)

    log(fetch("@src"))

    wrap("div", class:"mw_donation_image_center")
  }
}
# reus_hsus_donation_2013 page

$("./body") {
  add_class("mw_reus_hsus_mobile")

  # Remove fixed with on table
  $(".//div[@id='ga-content']/table") {
    remove("@style")
    add_class("mw_reus_table")
  }

  # Remove kitty header
  remove(".//div[@id='ga-header']/img")

  $(".//div[@id='splash_container']") {
    move_here("./div[@id='column2']/img[contains(@src, 'splash_quote_seals')]", "top")
  }

  # Remove the br's in the top_button
  $(".//div[@id='top_button']") {
    remove(".//br")
  }



  fixImages()
  # how the image URLS should look:
  # https://secure.humanesociety.org/images/content/pagebuilder/donate_monthly_red.png
  # how they turn out:
  # https://secure.humanesociety.org//site/images/content/pagebuilder/donate_now_red.png
  $(".//img") {
    %new_url = fetch("@src")
    %new_url {
      replace(/\/site/, "")
    }
    set("src", %new_url)

    log(fetch("@src"))

    wrap("div", class:"mw_donation_image_center")
  }
}
# fewer modifications than mobile since we have more space
# http://mlocal.action.humanesociety.org/site/Calendar/888008295?view=DayList&Day=6,4,2013

# April 4, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_grid_day")

  ### fixing some inline js for HSUS-484
  $(".//script[contains(text(), 'jQuery')]") {
    inner() {
      replace("jQuery", "x$")
      replace("var theId=x$(this).attr('id')", "var theId=x$(this).attr('id')[0]")
      replace("removeAttr('onclick')", "attr('onclick', '')")
    }
   
  }
  $(".//script[contains(text(), 'YAHOO')]") {
   // remove()
  }

  # Hide no wrapper page header
  $("./self::body[not(./div[@id='wrapper'])]/div[@class='mw_header']") {
    add_class("mw_hide")
  }

  $(".//a[./img[contains(@src, 'share_on_twitter_small')]]") {
    add_class("mw_share_align")
    $("following-sibling::p[1]") {
      wrap_text_children("div", class: "mw_left_align")      
    }
  }

  $(".//a[./img[contains(@src, 'share_on_facebook_small')]]") {
    add_class("mw_share_align")
  }

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  # HSUS-504 Start
  # remove(".//br")
  # HSUS-504 End
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  fixImages()

#  repair the masthead
  $(".//div[@class=' mw_masthead']") {
    move_here("//img[@id='desktop_head']") {
      $("preceding-sibling::img") {
        add_class("mw_hide")
      }
    }
  }

  # main content
  $(".//div[@id='main' or @id='ga-content']") {
    add_class("mw_box2_tablet")
  }

  # fix tables
  //table_dump dump_table
  $(".//table") {
    $(".//tr") {
      $("./td|./th") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }

  # top box with go to date
  $(".//div[@id='main']") {
    $(".//*") {
      remove("@width")
      remove("@align")
    }
    $(".//*[not(contains(@class, 'mw_was_td'))]") {
      remove("@style")
    }
    $(".//div[contains(@class, 'mw_was_td') and .//strong/a]") { // top line
      add_class("mw_today")
    }
    $(".//form[@id='cal_form_3']") { 
      $(".//div[contains(@class, 'mw_today')]") {
        $(".//span") { // trim whitespace
          inner() {
            replace(/\s*$/, "")
            replace(/^\s*/, "")
          }
        }
      }
      # $(".//fieldset[@id='_date']") { 
      #   move_here(".//div[contains(@class, 'mw_was_td')]")
      #   name("div")
      # }

      # wrap the stuff for the gray box
      # $(".//div[@valign='middle']") {
      #   insert("div", class:"mw_graybox") {
      #     move_here("../div[not(contains(@class, 'mw_today'))]")
      #     $(".//div[@bgcolor]") {
      #       add_class("mw_gobutton")
      #       remove("@bgcolor")
      #     }
      #   }
      # }
    }

    ########## HSUS - 484 ##############
    $(".//div[@id='cal_event_calendar']") {
      add_class("mw_calendar")
      $(".//div[contains(@class, 'notInMonth')]") {

      }
    }
    $(".//div[@id='orgevent_filters']") {
      add_class("mw_hide")
    }
    $(".//form[div[@id='oedatepicker']]") {
      add_class("mw_graybox")
      $(".//div[img]") {
        add_class("mw_hide")
      }
      $(".//div[input[@type='submit']]") {
        add_class("Button")
      }
    }
    $(".//div[@class='monthNavigator' or @class='weekNavigator']") {
      add_class("mw_month_row")
      $("./span[2]") {
        add_class("mw_month")
      }

    }   
    $(".//div[contains(@class, 'daysOfWeekHeader')]") {
      add_class("mw_days_of_week_header ")
      $(".//span[contains(@id, 'dayOfWeek')]") {
        text() {
          replace(/(\S{3})\S*/, "$1")
        }
      }

    }   
    $(".//div[contains(@class, 'TabTable')]") {
      move_to("ancestor::div[contains(@class, 'mw_calendar')]", "before")
    }
    $(".//div[contains(@class, 'eventDetailPopupBox')]") {
      add_class("mw_hide")
    }
    $(".//div[contains(@class, 'notInMonth')]") {
      add_class("mw_yellow")
    }

    $(".//div[contains(@class, 'dayOfEventsHeader')]") {
      add_class("mw_hide")
    }

    ########## HSUS - 484 end ##############

    # bottom section with calendar
    # $(".//div[@class='appArea' and ./div]") {
    #   add_class("mw_calendar")

    # }
  }

  # main calendar
  $(".//div[contains(@class, 'mw_calendar')]") {
    remove("./p")
   # move_here(".//div[contains(@class, 'Backed')]") // fix nesting issues
    # two tables here, top one's buttons and month name
    # $("./div[1]") {
    #   add_class("mw_month_row")
    #   $(".//div[contains(@class, 'mw_was_td')][2]") {
    #     add_class("mw_month")
    #     move_to("..", "bottom")
    #     # remove(".//a")

    #   }
    # }
    # second one's the calendar
    $(".//div[contains(@class, 'Backed')]") {
      # weeks are trs
      $(".//div[contains(@class, 'mw_was_tr')]") {
        add_class("mw_flex_box")
      }
      # days are tds
      $(".//div[contains(@class, 'mw_was_td')]") {
        add_class("mw_flex_box_item_1")
        # get rid of that stupid whitespace
        $("./p") {
          inner() {
            replace(/[\s]*$/, '')
          }
        }
        # is it yellow?
        $("self::*[contains(@style, 'FFCC')]") {
          add_class("mw_yellow")
        }
        remove("@style")
      }
    }
  }


  ############################################

  # sign up for event page instead of calendar

  $(".//div[@id='ga-container']") {
    add_class("mw_signup")
    $(".//h1|.//*[contains(@class, 'ObjTitle')]") {
      add_class("mw_h1")
    }

    # remove stuff
    remove("following-sibling::div[//img[@alt='Powered By Convio']]")

    # deal with some table nesting
    move_here(".//div[contains(@class, '_footer')]")
    # grab the spillover link
    move_here("//a[@class='mw_header_spillover']", "top") {
      remove("@style")
      move_here("//div[@id='ga-header']") {
        # fix images in header
        $img_src = fetch(".//img/@src")
        $img_src {
          replace(/org\/\//, 'org\/')
          replace(/\/site/, '')
        }
        $(".//img") {
          attribute("src", $img_src)
        }
      }
    }



    $(".//div[@id='ga-content']") {
      move_here(".//div[@id='ga-header']")
      move_here(".//div[div[@class='appArea']]") { // can I assume there's only one of these?
        add_class("mw_signup_form")
      }
      # get empty tables
      # remove("./div[not(contains(@class, 'mw_signup_form'))]")
    }

    # main form content
    $(".//div[contains(@class, 'mw_signup_form')]") {
      $(".//p[input[@type='submit']]") {
        add_class("mw_buttonRow")
        name("div")
      }
      # fix tables in tables in tables
      $(".//div[contains(@class, 'mw_was_tr')]") {
        move_here(".//div[contains(@class, 'mw_was_tr')]")
        remove(".//div[contains(@class, 'mw_was_tbl')]")
      }
    }
    
    $("./div[@id='ga-content']/div[contains(@class, 'mw_signup_form')]/form/div[@class='appArea']") {
      $("./div[contains(@class, 'mw_was_tbl')]") {
        $("./div[contains(@class, 'mw_was_tr')][./div[contains(@class, 'mw_was_td')][./p[contains(text(), 'Name')]]]") {
          $("./div[contains(@class, 'mw_was_tr')]") {
            add_class("mw_row_width")
          }
          insert_bottom("div", class:"mw_row_align") {
            move_here("./preceding-sibling::div[contains(@class, 'mw_row_width')]", "bottom") {
              remove("./div[contains(@class, 'mw_was_td')]/text()")
            }
          }
        }
        # remove extra space
        $("./div[contains(@class, 'mw_was_tr')]") {
          $("./div[contains(@class, 'mw_was_td')]/p[not(*)][text()] | ./div[contains(@class, 'req')][not(*)][text()]") {
            inner() {
              replace(/^[\s\u00a0]+/, "")
              replace(/[\s\u00a0]+\|$/, "")
            }
          }
        }
        $("./div[contains(@class, 'mw_was_tr')][.//span[@class='Explicit'][contains(text(), 'number')]]//input[@type='text']") {
          attribute("type", "tel")
        }
        # Fix for HSUS-505
        $(".//span[contains(., 'Phone number')]"){
          text(){prepend("1. ")}
        }
        $(".//span[contains(., 'Mobile number')]"){
          text(){prepend("2. ")}
        }
        # Fix for HSUS-505
      }
      $("./p[./strong]") {
        add_class("mw_padding_space")
      }
      # HSUS-504 Start
      $("./br") {
        add_class("no_remove")
      }
      # HSUS-504 End
    }
    $(".//select[@id='days']") {
      wrap("div", class:"mw_days") {
        insert_bottom("span", class:"mw_days_icon")
        insert_bottom("span", class:"mw_days_border")
      }
    }
  }

  # Fixed img src
  $(".//img") {
    attribute("src") {
      value() {
        replace(/(org\/).*(\.\.)/) {
          set($1+$2)
        }
      }
    }
  }
  # HSUS-504 Start
  $(".//br[not(contains(@class,'no_remove'))]") {
  #  remove()
  }
  # HSUS-505
  $(".//br") {
    remove("./@class")
  }
  # HSUS-504 End

  //HSUS-505
  $(".//img[@class='ga-headerImgAlign']"){
  #  move_to("//div[@id='ga-container']", "before")
  }

}
#http://mlocal.action.humanesociety.org/site/Calendar?id=109422&view=Detail&autologin=true

$("./body") {
  add_class("mw_calendar_page") 

 
  $("./div[@id='ga-container']") {
    add_class("mw_main")
  }  
  $("./div[@id='ga-container']/div[@id='ga-content']") {
    add_class("mw_box2_tablet")    
  }
  
  $(".//div[@id='ga-container']") {
    move_here(".//div[contains(@class, '_footer')]")
    move_here(".//div[@id='ga-header']", "top") {
      wrap("a", href:fetch("//a[@class='mw_header_spillover']/@href"), class:"mw_header_full_width")
      $("./ancestor::td[1]") {
        add_class("mw_header_full_width")
      }
    }
  }
  # fix tables
  $(".//table") {
    $(".//tr") {
      $("./td|./th") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }
  $(".//div") {
    remove("@style")
  }
  $(".//div[@id='ga-content']") {
    # remove whitespace chunks
    $(".//div[contains(@class, 'mw_was_td')]") {
      wrap_text_children("span")
      $("./span") {
        inner() {
          replace(/\s\s[\s]*/, "")
        }
      }
      remove("./span[string-length(text)<2 and not(*)]")
    }

    # wrap the image element into a class
    $(".//span[@class='Explicit']/p") {
      $("following-sibling::div[contains(@class,'mw_was_tbl')]") {
        $(".//img") {
          wrap("div", class:"mw_main_img")
        }
      }
    }

    #removed calendar 
    remove(".//div[contains(@class, 'WrapperBack')]/preceding-sibling::p")      
    remove(".//div[contains(@class, 'WrapperBack')]")
    remove(".//a[contains(text(), 'Return to Calendar')]")

    #add class to the buy tickets button
    $(".//form[@name='UserDetail']/input[@id='buytickets']") {
      add_class("mw_signup_btn")
    }
  }  
 
}
# list of events for the day
# http://mlocal.action.humanesociety.org/site/Calendar/888008295?view=DayList&Day=6,4,2013

# March 6, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_cal_day")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//br")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  $(".//div") {
    remove("@style")
  }
  fixImages()

  # fix tables
  $(".//table") {
    $(".//th") {
      remove()
    }
    $(".//tr") {
      $("./td") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }

  # # ditch the weekly arrows
  # $(".//div[@valign='middle' and count(*)=1]") {
  #   remove()
  # }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    $(".//*") {
      remove("@style")
      remove("@width")
      remove("@align")
    }
    # top box with go to date
    $(".//div[@class='appArea'][2]") {
      add_class("mw_topbox")
      $(".//div[contains(@class, 'mw_was_td') and .//strong/a]") { // top line
        add_class("mw_today")
        $(".//strong") {
          wrap_text_children("span")
        }
      }
      # wrap stuff into gray box
      $(".//div[@valign='middle']") {
        insert("div", class:"mw_graybox") {
          move_here("../div[not(contains(@class, 'mw_today'))]")
          $(".//div[@bgcolor]") {
            add_class("mw_gobutton")
            remove("@bgcolor")
            wrap_text_children("span")
            remove("span")
          }
        }
      }
      $(".//form[@id='cal_form_3']//div[contains(@class, 'mw_today')]") {
        $(".//span") { // trim whitespace
          text() {
            replace(/\s*$/, "")
            replace(/^\s*/, " ")
          }
        }
      }
      $(".//label[@class='wrapable']") {
        remove()
      }

      $(".//div[@valign='middle']") 
    }
  }

  # bottom section with calendar
  $(".//div[@class='appArea' and ./div]") {
    add_class("mw_calendar")
    $("./div[1]") {
      add_class("mw_cal_head")
      move_here(".//div[contains(@class, 'mw_was_td')]")
      # remove("./div[@valign='middle']")
      # tag month name
      # $("./div[2]") {
      #   add_class("mw_month")
      #   remove(".//a")
      #   move_to("..", "bottom")
      # }
    }
    # tidy up dates
    $(".//div[@valign='top' and contains(@class, 'mw_was_td')]") {
      add_class("mw_date")
      # trim whitespace on number
      $("./p[not(a)]") {
        inner() {
          replace(/[\s]*$/, '')
        }
      }
    }
    $(".//img") {
      remove("@height")
      # fixing bad image src
      $image_src = fetch("@src")
      $image_src {
        replace(/site\/Calendar\//, '')
      }
      attribute("src", $image_src)
    }
  }

  # $(".//p[@class='callist']") {
  #   $(".//span[@class='callistevent']") {
  #     wrap_text_children("span", class: "mw_remove")
  #     remove(".//span[@class='mw_remove']")
  #   }
  # }

  $("./div[@id='wrapper']/div[contains(@class, 'mw_masthead')]") {
    move_here("./ancestor::html[1]/head/img[@id='desktop_head']", "bottom") {
      attribute("class", fetch("./preceding-sibling::img[1]/@class"))
    }
    remove("./img[not(@id='desktop_head')][@class='mw_tablet_masthead_image']")
  }
}
# event detail pages
# http://action.humanesociety.org/site/Calendar/1679217372?view=Detail&id=108621

# April 11, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_cal_event")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//br")
  remove(".//div[.//img[@alt='Powered By Convio']]") # dat sum convio? gtfo
  remove(".//p[./a/img[contains(@src, 'rsvp')]]")
  # remove(".//div[@id='contentDiv']/div[not(@id)]")
  $(".//div") {
    remove("@style")
  }

  # fix tables
  $(".//table") {
    $(".//tr") {
      $("./td") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
  }

  #remove more stuff
  # remove(".//div[@id='ga-header']")

  $(".//div[@id='ga-container']") {
    move_here(".//div[contains(@class, '_footer')]")
    move_here(".//div[@id='ga-header']", "top") {
      # %home = fetch("//a[@class='mw_header_spillover']/@href")
      wrap("a", href:fetch("//a[@class='mw_header_spillover']/@href"), class:"mw_header_full_width")

      $("./ancestor::td[1]") {
        add_class("mw_header_full_width")
      }
    }
  }

  $(".//div[@id='ga-content']") {
    add_class("mw_box2_tablet")
    move_here(".//div[@class=' mw_was_tr']")
    $(".//div[contains(@class, 'footer')]") {
      move_to("..", "bottom")
    }
    remove(".//table")
    remove("./div[contains(@class, 'mw_was_tr') and .//div[contains(@class, 'minical')]]")

    # remove whitespace chunks
    $(".//div[contains(@class, 'mw_was_td')]") {
      wrap_text_children("span")
      $("./span") {
        inner() {
          replace(/\s\s[\s]*/, "")
        }
      }
      remove("./span[string-length(text)<2 and not(*)]")
    }

    # locate and tag stuff
    $(".//a[contains(text(), 'Facebook')]") {
      add_class("mw_facebook_link")
    }
    $(".//div[.//li[contains(@style, '#a7a7a7')] and not(@class)]") { //footer stuff
      add_class("mw_event_foot")
      move_to("//div[contains(@class, '_footer')]")
    }
    # back link
    $(".//div[.//a[contains(text(), 'Return to Calendar')] and contains(@class, 'mw_was_tr')]") {
      add_class("mw_back")
      move_here(".//a") // aggghhhh nesting
      remove("./div")
      $("./a") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    # grab the main image
    $(".//div[@valign='top']") {
      # HSUS-412 : (Mobile & Tablet) Element not appearing on Calendar event
      move_here("//img[@align='bottom']/ancestor::div[contains(@class, 'mw_was_tr')]/following-sibling::div", "top")
      move_here("//img[@align='bottom']", "top")
      $("./img") {
        wrap("div", class:"mw_main_img")
      }
    }
  }
  # HSUS-479 - hiding the "Powered by blackbaud" image/link at bottom of pages
  $(".//div[a[contains(@href, 'convio.com/poweredby')]]") {
    add_class("mw_hide")
  }

  //HSUS-505
  $(".//span[@class='Explicit']"){
    insert_after("br", class:"mw-br")
  }

}


$("./body") {
  add_class("mw_legacy_article_tablet")

  remove("./div[@id='wrapper']/br")

  # Hide the empty spacer at the bottom
  $(".//div[@id='contentDiv']") {
    $("./div[@style]") {
      remove()
    }
  }

  # change the forced width of the tables
  $(".//table[@width]") {
    attribute("width", "70%")
  }

  # Make the main the white box
  $(".//div[@id='main']") {
    add_class("mw_box2_tablet")

    $("./div[@id='give']") {
      add_class("mw_gray_inner")
    }

    $(".//span[@class='headlineFont']") {
      add_class("mw_h2")
      # Make the title one line
      remove("./br")
    }

    $(".//span[@class='stelterArticleTitle']") {
      add_class("mw_h3")
    }

    # remove the left padding of the toolkit
    $(".//div[@id='toolkit']") {
      # Remove the Styling
      remove("./@style")
    }

    # HSUS-390
    # ref url: http://legacy.humanesociety.org/index.php?article=424&featured=true
    # Apparently some tables are stuffed in the cga_chart
    $(".//div[@id='cga_chart']/table[@class='giftsBody']/..") {
      # this will override the default hiding of the chart.
      # hopefully this does not break other things
      add_class("table")
    }

    # Remove the background image of the moreabout
    $(".//div[@id='moreabout']") {
      remove("@style")
    }

    # HSUS-386 Stelter Copyright Information
    $(".//span[@class='legalBodyFont']/p[contains(text(), 'Copyright')]") {
      add_class("mw_legal_copyright")
    }

  }

  #change the <span type="text/css"> back into style
  $(".//span[@type='text/css']") {
    name("style")
  }

  # Sidebar stuff
  $(".//div[@id='side']") {

    # Move the Explore links inside main
    $(".//span[@class='includeDocument']") {
      name("div")
      $("./li") {
        name("div")

        move_here(".//a")
        $("./a") {
          add_class("mw_bar3")
        }
        # HSUS-439 remove 'explore'
        remove(".//a[contains(@class,'explore')]")
        $("./a[1] | ./a[2]") {
          add_class("mw-half-width")
        }

        remove("./ul")
      }
      move_to("./ancestor::div[@id='cols']/div[@id='main']", "bottom")
    }

    # Make the action sidebar
    $(".//ul[@id='action']") {
      add_class('mw_sidebar1 mw_sidebar1_h')
      move_to("./ancestor::div[@id='cols']/div[@id='main']", "bottom")
    }
  }

  # For forms, make the submit button big
  $(".//input[@type='submit']") {
    add_class("mw_btn1")
  }

  # Make any input contextual
  contextual_keyboard(".//input[@name='email']", 'email')
  contextual_keyboard(".//input[@name='phone']", 'tel')

}
$("./body") {
  add_class("mw_legacy_root")

  remove("./div[@id='wrapper']/br")

  # Hide the empty spacer at the bottom
  $(".//div[@id='contentDiv']") {
    $("./div[@style]") {
      remove()
    }
  }

  # Make the main the white box
  $(".//div[@id='main']") {
    add_class("mw_box2")
    #For HSUS-388 : (Mobile & Tablet) Improvements to Legacy Landing Page
    $("./div[@id='give']") {
      add_class("mw_gray_inner")
      $("./div[contains(@class, 'stlfeature')]") {
        $("./h2") {
          add_class("mw_brown")
        }
      }  
      $("./div[contains(@class, 'area-news')]") {
        $("./h2") {
          add_class("mw_brown")
        }
        $("./div[contains(@class, 'sgrouplast')]"){
         add_class("noBorder")
        }
      }
    }
    #End of HSUS-388
    $(".//h2") {
      add_class("mw_h2")
      # Make the title one line
      remove("./br")
    }

    $(".//h3") {
      add_class("mw_h3")
    }

    # remove the left padding of the toolkit
    $(".//div[@id='toolkit']") {
      # Remove the Styling
      remove("./@style")
    }

    # Remove the background image of the moreabout
    $(".//div[@id='moreabout']") {
      remove("@style | ./ul/li/br")
      $("./ul/li/a") {
        inner(" "+fetch("./text()"))
      }
    }
  }

  # Sidebar stuff
  $(".//div[@id='side']") {

    # Move the Explore links inside main
    $(".//span[@class='includeDocument']") {
      name("div")
      $("./li") {
        name("div")
        # HSUS-439 remove 'explore'
        remove(".//a[contains(@class,'explore')]")
        $(".//a") {
          add_class("mw_bar3")
        }
      }
      move_to("./ancestor::div[@id='cols']/div[@id='main']//div[@id='give']", "bottom")
    }

    # Make the action sidebar
    $(".//ul[@id='action']") {
      add_class('mw_box5')
    }
  }
}
$("./body") {
  add_class("mw_legacy_root_tablet")

  # Hide the empty spacer at the bottom
  $(".//div[@id='contentDiv']") {
    $("./div[@style]") {
      remove()
    }
  }

  # remove extra space
  remove("./div[@id='wrapper']/br")

  # Make the main the white box
  $(".//div[@id='main']") {
    add_class("mw_box2_tablet")
    #For HSUS-388 : (Mobile & Tablet) Improvements to Legacy Landing Page
    $("./div[@id='give']") {
      add_class("mw_gray_inner")
      $("./div[contains(@class, 'stlfeature')]") {
        $("./h2") {
          add_class("mw_brown")
        }
      }
      $("./div[contains(@class, 'area-news')]") {
        $("./h2") {
          add_class("mw_brown")
        }
        $("./div[contains(@class, 'sgrouplast')]"){
          add_class("noBorder")
        }
      }
    }
    #End of HSUS-388 
    $(".//h2") {
      add_class("mw_h2")
      # Make the title one line
      remove("./br")
    }

    $(".//h3") {
      add_class("mw_h3")
    }

    # remove the left padding of the toolkit
    $(".//div[@id='toolkit']") {
      # Remove the Styling
      remove("./@style")
    }
     # remove the left padding of the toolkit

    # Remove the background image of the moreabout
    $(".//div[@id='moreabout']") {
      remove("@style | ./ul/li/br")
      $("./ul/li/a") {
        inner(" "+fetch("./text()"))
      }
    }
  }

  # Sidebar stuff
  $(".//div[@id='side']") {

    # Move the Explore links inside main
    $(".//span[@class='includeDocument']") {
      name("div")
      $("./li") {
        name("div")

        move_here(".//a")
        $("./a") {
          add_class("mw_bar3")
        }

        # HSUS-439 remove 'explore'
        remove(".//a[contains(@class,'explore')]")
        $("./a[1] | ./a[2]") {
          add_class("mw-half-width")
        }

        remove("./ul")
      }
      move_to("./ancestor::div[@id='cols']/div[@id='main']//div[@id='give']", "bottom")
    }

    # Make the action sidebar
    $(".//ul[@id='action']") {
      add_class('mw_sidebar1 mw_sidebar1_h')
      move_to("./ancestor::div[@id='cols']/div[@id='main']", "bottom")
    }
  }
}
$("./body") {
  add_class("mw_legacy_contact")
  $("./div[@id='wrapper']/div[@id='page']") {
    remove("./following-sibling::br")
    $("./div[@id='contentDiv']/div[@id='cols']") {
      remove("./following-sibling::div[contains(@style, 'height')][not(@id)]")
      $("./div[@id='main']") {
        add_class("mw_box2")
        $("./div[@id='give']") {
          $("./div[@id='stl_content']/div[@id='contactUsPage']") {
            $("./div[@id='pageTitle']/span[@class='pageTitle']") {
              add_class("mw_h2")
            }
            $("./div[@id='organizationInfo']/span[@class='orgTitle']") {
              add_class("mw_h3")
            }
            $("./div[@class='contactInfo']") {
              wrap_text_children("span")
              $("./span[@class='contactPhone']/following-sibling::span[1]") {
                name("a")
                attribute("href", "tel:"+fetch("./text()")) {
                  value() {
                    replace(/-/, "")
                  }
                }
              }
            }
            $(".//td[@class='cuSubmit']/input[@class='stelterbutton'][@type='submit']") {
              add_class("mw_btn1")
            }
          }
          $("./div[@id='stl_content']/p/span[@class='headlineFont']") {
            add_class("mw_h2")
          }
        }
        move_here("./following-sibling::div[@id='side']/ul[@id='action']/span[@class='includeDocument']/li[@class='expanded_landing']", "bottom") {
          name("div")
          remove(".//a[contains(@class,'explore')]")
          move_here("./ul/li/a", "bottom")
          remove("./ul | ./text()")
          $("./a") {
            add_class("mw_bar3")
          }
        }
      }
      $("./div[@id='side']/ul[@id='action']") {
        add_class("mw_box5")
        remove("./span[@class='includeDocument']")
      }
    }
  }
}
$("./body") {
  add_class("mw_legacy_article")

  remove("./div[@id='wrapper']/br")

  # Hide the empty spacer at the bottom
  $(".//div[@id='contentDiv']") {
    $("./div[@style]") {
      remove()
    }
  }

  # Some LIs are outside

  # change the forced width of the tables
  $(".//table[@width]") {
    # remove("./@width")
  }
  $(".//td/table/..") {
    remove("./@width")
    add_class("mw_td_contains_table")
  }

  # Make the main the white box
  $(".//div[@id='main']") {
    add_class("mw_box2")

    $(".//span[@class='headlineFont']") {
      add_class("mw_h2")
      # Make the title one line
      remove("./br")
    }

    $(".//span[@class='stelterArticleTitle']") {
      add_class("mw_h3")
    }

    # remove the left padding of the toolkit
    $(".//div[@id='toolkit']") {
      # Remove the Styling
      remove("./@style")
    }

    # HSUS-390
    # ref url: http://legacy.humanesociety.org/index.php?article=424&featured=true
    # Apparently some tables are stuffed in the cga_chart
    $(".//div[@id='cga_chart']/table[@class='giftsBody']/..") {
      # this will override the default hiding of the chart.
      # hopefully this does not break other things
      add_class("table")
    }

    # Remove the background image of the moreabout
    $(".//div[@id='moreabout']") {
      remove("@style")
    }
    # HSUS-386 Stelter Copyright Information
    $(".//span[@class='legalBodyFont']/p[contains(text(), 'Copyright')]") {
      add_class("mw_legal_copyright")
    }
  }

  # Next Steps.. trying to turn this into a list
  $(".//div[contains(@id, 'scroll_box')]") {
    wrap_text_children("span", class:"mw_hide")

    $("./span[a]") {
      wrap_text_children("span", class:"mw_hide")
    }

  }

  #change the <span type="text/css"> back into style
  $(".//span[@type='text/css']") {
    name("style")
  }

  # Sidebar stuff
  $(".//div[@id='side']") {

    # Move the Explore links inside main
    $(".//span[@class='includeDocument']") {
      name("div")
      $("./li") {
        name("div")
        remove(".//a[contains(@class,'explore')]")
        $(".//a") {
          add_class("mw_bar3")
        }
      }
      move_to("./ancestor::div[@id='cols']/div[@id='main']", "bottom")
    }

    # Make the action sidebar
    $(".//ul[@id='action']") {
      add_class('mw_box5')
    }
  }

  # For forms, make the submit button big
  $(".//input[@type='submit']") {
    add_class("mw_btn1")
  }

  # Remove any fixed sizes on the textboxes
  $(".//input") {
    remove("@size")
  }

  # Make any input contextual
  contextual_keyboard(".//input[contains(@name, 'email')]", 'email')
  contextual_keyboard(".//input[contains(@name, 'phone')] | .//input[contains(@id, 'phone')]", 'tel')
  contextual_keyboard(".//input[contains(@id, 'postal')]", "numeric")
}
$("./body") {
  add_class("mw_legacy_contact_tablet")
  $("./div[@id='wrapper']/div[@id='page']") {
    remove("./following-sibling::br")
    $("./div[@id='contentDiv']/div[@id='cols']") {
      remove("./following-sibling::div[contains(@style, 'height')][not(@id)]")
      $("./div[@id='main']") {
        add_class("mw_box2_tablet")
        $("./div[@id='give']") {
          add_class("mw_gray_inner")
          $("./div[@id='stl_content']/div[@id='contactUsPage']") {
            $("./div[@id='pageTitle']/span[@class='pageTitle']") {
              add_class("mw_h2")
            }
            $("./div[@id='organizationInfo']/span[@class='orgTitle']") {
              add_class("mw_h3")
            }
            $(".//td[@class='cuSubmit']/input[@class='stelterbutton'][@type='submit']") {
              add_class("mw_btn1")
            }
          }
          $("./div[@id='stl_content']/p/span[@class='headlineFont']") {
            add_class("mw_h2")
          }
        }
        move_here("./following-sibling::div[@id='side']/ul[@id='action']/span[@class='includeDocument']/li[@class='expanded_landing']", "bottom") {
          name("div")
          move_here("./ul/li/a", "bottom")
          remove("./ul | ./text()")
          $("./a") {
            add_class("mw_bar3")
          }
          # HSUS-439 remove 'explore'
          remove(".//a[contains(@class,'explore')]")
          $("./a[1] | ./a[2]") {
            add_class("mw-half-width")
          }
        }
        move_here("./following-sibling::div[@id='side']/ul[@id='action']", "bottom") {
          add_class("mw_sidebar1_h")
          remove("./span[@class='includeDocument']")
        }
      }
    }
  }
}
# Animal main page
# http://www.humanesociety.org/animal_community/
# 
# km cY7 Rmd
# Feb 13 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='resources']") {
    add_class("mw_sidebar2")
    $("./h2") {
      inject("Resources for <strong> the Animal Care Community</strong>")
      add_class("mw_h2")
    }
    $(".//a") {
      inject("  &raquo;  ")
    }
  }

}
# similar to main animals and action
# http://www.humanesociety.org/parents_educators/
# 
# km cY7 Rmd
# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_parents")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  # main content
  $(".//div[@id='main']") {

    $(".//div[@id='features']") { // swap stuff in the resources section
      $(".//li") {
        $("./p[@class='image']") {
          move_to("..", "top")
        }
        $(".//a[@class='more']") {
          inner() {
            replace(/\xC2\xA0/, "")
          }
        }
      }
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//li") {
        add_class("mw_newsItem")
      }
      $(".//a[@class='more']") {
        wrap("div", class:"more-link")
      }
    }
  }

  # side bar
  $(".//div[@id='resources']") {
    add_class("mw_sidebar2")
    $(".//a") {
      inject("  &raquo;  ")
    }
  }

}
# social media stuff!
# http://www.humanesociety.org/community/connect.html
# 
# March 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community mw_connect") // use the same styling as the main page

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//br")
  remove(".//hr")
  remove(".//div[@id='fb_likebox']")
  remove(".//div[@id='twitter_feed']")
  remove(".//div[@id='wayne_feed']")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3|.//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }
  $(".//a[@class='back']") {
    inner() {
      prepend("  &laquo;  ")
    }
  }

  # social networks
  $(".//div[@id='button_container']") {
    $(".//p") {
      add_class("mw_social_button")
    }
  }

  # form to get texts
  $(".//div[@id='mobile']") {
    $("./div[@id='mobile_text']") {
      $("./form") {
        add_class("mw_text_signup")
        $(".//input[@type='text' or type='submit']") {
          wrap("div") {
            add_class("mw_text_input")
          }
        }
      }
      $("./a") {
        remove("@style")
        wrap("p")
      }
    }
    $("./div[@id='humane_tv_app']") {
      $("./span") {
        remove("@style")
        $(".//img") {
          remove("@width")
        }
        $(".//img[contains(@src, 'tv_')]") {
          add_class("mw_tv_app")
        }
      }
      remove("./strong")
    }
  }

  # causes and youtube
  $(".//div[@id='social_feeds']") {
    $(".//iframe[1]") {
      attribute("height", "250px")
    }
    $(".//iframe[2]") {
      attribute("height", "100px")
    }
  }

  # bottom two iframes need to be 250 and 100px tall


}
# animal care centers and shelters
# http://www.humanesociety.org/animal_community/shelters/cape.html
# 
# km cY7 Rmd
# Feb 14 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community") // use the same styling as the main page


  # remove the odd text nodes that are adding strange text
  wrap_text_children("span", class:"mw_hide")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  # remove(".//div[@id='feature']") //v c
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//br")
  remove(".//div[@id='related-content']/h2/@class")
  remove(".//div[@id='related-content']/h3/@class")
  
  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3|.//p[@class='author' or @class='subhead']") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='main']") {
    $(".//div[contains(@class, 'area-news')]") {
      $(".//li") {
        add_class("mw_news_item")
      }
      $(".//iframe") {
        remove("@style")
      }
    }
    $(".//ul[not(@id)]") {
      add_class("mw_ul")
    }
    # HSUS-148 South Florida Wildlife Center page styling
    $("./div[@id='feature']") {
      $("./h3[contains(@class,'mw_h3')]/following-sibling::p[1]") {
        name("div")
        wrap_text_children("span")
        $("./a") {
          wrap("div", class:"mw_feature_link")
        }
        $("./span") {
          move_to("preceding-sibling::div[@class='mw_feature_link']", "bottom")
        }
      }
    }
    $("./div[@id='feature' and not(*)]") {
      remove() // empty feature go byebye
    }
    $(".//blockquote//h2") {
      remove("@class")
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='resources']") {
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//h2[string-length()<1]") {
        inject("Resources for <strong> the Animal Care Community</strong>")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  $("./div[@id='related-content']") {
    add_class("mw_box8")
    $("./div/h3/a") {
      inject("  &raquo;  ")
    }
    $("./div/h3"){
      attributes(class:"")
    }
  }
  }

  # remove ads
  $(".//a[contains(@href, 'ads')]/..") {
    log("found an Ad")
    add_class("mw_hide")
  }
}
# resources for volunteers
# http://www.humanesociety.org/community/volunteers
# 
# km cY7 Rmd
# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_vols") // use the same styling as the main page

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  # HSUS-149 Join Us as Volunteer: Missing section
 
  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='features']") {
    $(".//li") {
      move_here("./p[@class='image']", "top")
    }
    $("./p[not(*)]") {
      match(fetch("./text()"), /\A[\s ]*\Z/) {
        remove()
      }
    }
  }

  # HSUS-314 US maps
  $(".//div[@id='main']") {
    $("./div[contains(@class, 'section-lead')]/table[.//map[@id='Map']]") {
      insert_before("div", class:"mw_map_locations", id:"us_map", data-ur-set:"toggler") {
        insert("div", "United States", class:"mw_location_header mw_bar5", data-ur-toggler-component:"button") {
          insert("span", " Tap to ", class: "mw_tap")
        }
        copy_here("../table//area")
        wrap_together("./area", "div", data-ur-toggler-component: "content") {
          $("./area") {
            %location = fetch("@alt")
            name("a")
            add_class("mw_bar4 mw_state")
            remove("@coords")
            text(%location)
            rewrite_links()
          }
        }
        attribute("data-ur-state", "enabled")
        $("./div") {
          attribute("data-ur-state", "enabled")
        }
      }
      $("following-sibling::div[.//select[@name='states']][1]") {
        add_class("mw_hide")
      }
      remove()
    }
    $(".//div[contains(@class, 's_borderless')]") {
      # HSUS-340 Styling Tweaks to Faith Volunteering Page
      # URL: http://www.humanesociety.org/community/volunteers/volunteer_leader_faith_outreach.html
      match($path, /volunteer_leader_faith_outreach/) {
        add_class("mw_faith")
        $(".//ul[not(@id)]") {
          add_class("mw_list1")
        }
        $("./p[./br][./strong]") {
          $("./br/preceding-sibling::strong[1]") {
            add_class("mw_break_line")
          }
        }
        $("./p[./strong]") {
          add_class("mw_p_title")
        }
      }
    }
    # HSUS-314 add line break
    $(".//div[@id='feature']/blockquote/p[@class='image']/following-sibling::span[1]") {
      name("div")
    }
  }
  # end of HSUS-314

  # for URL:http://www.humanesociety.org/community/volunteers/volunteer_leader_faith_outreach.html
  $(".//div[@id='side']/div[@id='related-content']") {
    add_class("mw_sidebar3")
  }
  # remove(".//div[@id='feature']") //v c
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//br")
}
# resources main
# http://www.humanesociety.org/animal_community/resources/
# 
# km cY7 Rmd
# Feb 14 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press mw_news_base")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//div[@id='bottom-pagination']")
  remove(".//br")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
    }
  }

  $(".//div[@id^='templatelist']") {
    insert("div") {
      move_here("../div[@id='list-nav']")
      move_here("../div[@id='sortby']")
    }
  }

  $(".//div[contains(@class, 's_borderless') and not(@id)]") {
    add_class("mw_content") // css selectors would be too cumbersome
    move_here("../../ul[@id='tools']", "top")
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
      $("./h2") {
        inject("Resources for <strong> the Animal Care Community</strong>")
        add_class("mw_h2")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

}
$("./body") {
  add_class("mw_email_preferences_tablet")
  remove(".//img[@id='desktop_head'] | .//div[@id='page-head']")
  $(".//div[@id='contentDiv']") {
    remove("./div[@id='head'] | ./div/@style")
    $("./div[not(*)]") {
      match(text(), /\A\s+\Z/) {
        remove()
      }
    }
    $("./div[@id='cols']") {
      add_class("mw_box2_tablet")
      $("./div[@id='main']") {
        add_class("mw_gray_inner")
        remove(".//div[@id='wrapper-body']/@style")
        $(".//h3[@class='ObjTitle']") {
          add_class("mw_h1")
        }
        $(".//input[@class='Button']") {
          add_class("mw_btn2")
        }
      }
    }
    # For "Unsubscribe Request" page
    $(".//label[@for='first_name']/ancestor::table[1]") {
      add_class("mw_URtable")
    }
  }
}
# Search Results page
# http://www.humanesociety.org/search/search.jsp?query=rats
# using mockup 05-search-results.png

# March 27 2013 Sarah LaFrance

$("./body") {
  add_class("mw_search_results")

  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")

  # Repair the google custom search
  $(".//div[@id='main']") {
    wrap_text_children("span", class:"mw_hide")
    insert("gcse:search")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  # search again and filter
  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//label") {
      wrap_text_children("span")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//p[not(button)]") {
        add_class("mw_sort_select")
      }
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
      $(".//label[@for='sortbytype']/span") {
        text() {
          replace("Content ", "")
        }
      }
    }
  }

  # results

  $(".//div[@id='main']/div[ul[@class='item-list' and ./*]]") {
    attribute("id", "mw_main_results")
    $(".//h2[@class='suggestions' or @class='results']") {
      add_class("mw_h2")
      inject("  :  ")
    }

    $(".//div[@id='featuredSearch']") {
      remove("@style")
    }

    $(".//ul[@class='item-list']") {
      $(".//h2") {
        add_class("mw_h3")
      }
      $(".//p[@class='related']") {
        wrap_text_children("span") {
          text() {
            replace("Related", "Related  :  ")
          }
        }
      }
    }
  }

  # page numbers, adapted from press.ts
  $(".//div[contains(@class, 'pagination') and contains(@class, 'section')]") {
    attribute("id", "mw_pages")
    $(".//li[not(a)]") {
      add_class("mw_current")
    }
    $current = fetch(".//li[contains(@class, 'mw_current')]/text()")
    $previous = "false"
    $next = "false"
    $(".//li/a[@class='prev']") {
      $previous = "true"
      inner() {
        prepend("  &laquo;  ")
      }
    }
    $(".//li/a[@class='next']") {
      $next = "true"
      inner() {
        append("  &raquo;  ")
      }
    }

    $(".//li[contains(@class, 'mw_current')]") { 
      insert_before("div", class:"mw_pages") {
        move_here("../li[not(a[@class='prev']) and not(a[@class='next'])]")
        # tablets are pretty wide so I'm leaving all ten numbers in.
      }
    }
  }

  # check if there's only this one page of results
  $(".//div[@id='main' and not(div[@id='mw_pages'])]") {
    add_class("mw_one_page")
  }

  # sidebar
  $(".//div[@id='side']") {
    remove("./div")
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }
}
# list of events for the day
# http://mlocal.action.humanesociety.org/site/Calendar/888008295?view=DayList&Day=6,4,2013

# March 6, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_grid_day")

    ### fixing some inline js for HSUS-484
    $(".//script[contains(text(), 'jQuery')]") {
      inner() {
       replace("jQuery", "x$")
       replace("var theId=x$(this).attr('id')", "var theId=x$(this).attr('id')[0]")
       replace("removeAttr('onclick')", "attr('onclick', '')")
     }

   }

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//br")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  fixImages()

  # fix tables
  $(".//table") {
    $(".//tr") {
      $("./td|./th") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }

  # top box with go to date
  $(".//div[@id='main']") {
    $(".//*") {
      remove("@width")
      remove("@align")
    }
    $(".//*[not(contains(@class, 'mw_was_td'))]") {
      remove("@style")
    }
    $(".//div[contains(@class, 'mw_was_td') and .//strong/a]") { // top line
      add_class("mw_today")
      $(".//strong") {
        wrap_text_children("span")
        $("./a") {
          $today_link = fetch("@href")
          $today_link {
            replace(/List/, 'Grid')
          }
        }
      }
    }
    # $(".//div[@bgcolor]") {
    #   add_class("mw_gobutton")
    #   remove("@bgcolor")
    #   wrap_text_children("span")
    #   remove("span")
    # }
    $(".//form[@id='cal_form_3']") {
      # $(".//div[contains(@class, 'mw_today')]") {
      #   $(".//span") { // trim whitespace
      #     text() {
      #       replace(/\s*$/, "")
      #       replace(/^\s*/, " ")
      #     }
      #   }
      # }
      # $(".//label[@class='wrapable']") {
      #   remove()
      # }
      # $(".//fieldset[@id='_date']") {
      #   move_here(".//div[contains(@class, 'mw_was_td')]")
      #   name("div")
      # }

      # wrap the stuff for the gray box
      # $(".//div[@valign='middle']") {
      #   insert("div", class:"mw_graybox") {
      #     move_here("../div[not(contains(@class, 'mw_today'))]")
      #   }
      # }
    }
  }

      ########## HSUS - 484 ##############
      $(".//div[@id='cal_event_calendar']") {
        add_class("mw_calendar")
        $(".//div[contains(@class, 'notInMonth')]") {

        }
      }
      $(".//div[@id='orgevent_filters']") {
        add_class("mw_hide")
      }
      $(".//form[div[@id='oedatepicker']]") {
        add_class("mw_graybox")
        $(".//div[img]") {
          add_class("mw_hide")
        }
        $(".//div[input[@type='submit']]") {
          add_class("Button")
        }
      }


      $(".//div[contains(@class, 'month') or contains(@class, 'week')]/div[contains(@class, 'daysOfWeekHeader')]") {
        add_class("mw_days_of_week_header ")
        $(".//span[contains(@id, 'dayOfWeek')]") {
          inner() {
            replace(/(\S{3})\S*/, "$1")
          }
        }

      }   
      $(".//div[contains(@class, 'TabTable')]") {
        move_to("ancestor::div[contains(@class, 'mw_calendar')]", "before")
      }
      $(".//div[contains(@class, 'eventDetailPopupBox')]") {
        add_class("mw_hide")
      }
      $(".//div[contains(@class, 'notInMonth')]") {
        add_class("mw_yellow")
      }
      $(".//p[@class='eventTypeLegend']") {
        add_class("mw_hide")
      }
      $(".//div[contains(@class, 'mw_was_tbl')]/div[contains(@class, 'Header')]") {
        add_class("mw_header_row")
      }
      $(".//div[contains(@class, 'dayOfEventsHeader')]") {
        add_class("mw_hide")
      }
      $(".//div[contains(@class, 'month')]/div[contains(@class, 'daysOfWeekHeader') or contains(@class, 'weekOfMonth')]/div[contains(@class, 'mw_was_td')][1]") {
        add_class("mw_hide")
      }
      $(".//div[contains(@class, 'Navigator') or @class='listHeader']") {
        $("./span") {
          add_class("mw_month")
        }
        $(".//a/img[contains(@src, 'left')]") {
          insert_before("span", class: "mw_left_arrow")
          add_class("mw_hide")
        }
        $(".//a/img[contains(@src, 'right')]") {
          insert_before("span", class: "mw_right_arrow")
          add_class("mw_hide")
        }
      }
      $(".//div[contains(@class, 'dayOfMonth') or contains(@class, 'dayOfWeek')]") {
        $("./div[contains(@class, 'Month') or contains(@class, 'Week')]/a") {
          inner() {
            replace(/[^\d]/, "")
          }
        }
        $("./div[@class='dayEvents'][div]") {
          add_class("mw_hide")
          insert_before("div", class: "mw_event_dot")
        }
      }

    # tagging today's date
    $(".//div[contains(@class, 'currentDay')]/div[contains(@class, 'dayEvents')]") {
      add_class("mw_today_date")
    }

    ########## HSUS - 484 end ##############

  # bottom section with calendar
  # $(".//div[@class='appArea' and ./div]") {
  #   add_class("mw_calendar")
  #   # tag today's date
  #   $(".//div[contains(@class, 'mw_was_td') and ./p[@class='PaddedEntrySmall']/a[@href='"+$today_link+"']]") {
  #     add_class("mw_today_date")
  #   }
  # }


  # grab today's events and pull them into the bottom
  $(".//div[@id='wrapper-body']") {
    insert("div", class:"mw_today_events") {
      copy_here("//div[contains(@class, 'mw_today_date')]")
      $(".//p/a") {
        add_class("mw_head_link")
        text() {
          clear()
        }
        inject("Today's Events  :")
      }
    }
  }

  # main calendar
  $(".//div[contains(@class, 'mw_calendar')]") {
    remove("./p")
    move_here(".//div[contains(@class, 'Backed')]") // fix nesting issues
    # two tables here, top one's buttons and month name
    $("./div[1]") {
      add_class("mw_month_row")
      $(".//div[contains(@class, 'mw_was_td')][2]") {
     #   add_class("mw_month")
        # move_to("..", "bottom") # taken out HSUS-484
        # remove(".//a") # taken out HSUS-484

      }
    }
    # second one's the calendar
    $("./div[contains(@class, 'Backed')]") {
      remove(".//img")
      # remove arrows
      $(".//div[@valign='middle']") {
        remove()
      }
      # weeks are trs
      # days are tds
      $(".//div[contains(@class, 'mw_was_td')]") {
        $("./div") {
          remove() // get rid of events
        }
        # get rid of that stupid whitespace
        $("./p") {
          inner() {
            replace(/[\s]*$/, '')
          }
        }
        # does it have any events?
        $("self::*[p/a]") {
          add_class("mw_has_event")
          $(".//a") {
            $dot_link = fetch("@href")
            name("span")
          }
          wrap("a") {
            attributes(href:$dot_link)
          }
          insert("div", class:"mw_event_dot")
        }
        # is it yellow?
        $("self::*[contains(@style, 'FFCC')]") {
          add_class("mw_yellow")
          $("parent::a") {
            add_class("mw_yellow")
          }
        }
        remove("@style")
      }
    }
  }

  $(".//div[contains(@class, 'dayOfMonth')] | .//div[contains(@class, 'dayOfWeek')]"){
    %href = fetch(".//a/@href")
    attributes(href:%href)
    //name("span")
  }

}
$("./body") {
  add_class("mw_calendar_page")

  # removals
  remove(".//div[@id='ga-header']")
  remove(".//br")
  $(".//div") {
    remove("@style")
  }

  # fix tables
  table_dump(".//table")

  $(".//div[@id='ga-container']") {
    move_here(".//div[contains(@class, '_footer')]")
  }

  $(".//div[@id='ga-content']") {
    move_here(".//div[@class=' mw_was_tr']")
    $(".//div[contains(@class, 'footer')]") {
      move_to("..", "bottom")
    }
    remove(".//table")
    remove("./div[contains(@class, 'mw_was_tr') and .//div[contains(@class, 'minical')]]")

    # remove whitespace chunks
    $(".//div[contains(@class, 'mw_was_td')]") {
      wrap_text_children("span")
      $("./span") {
        inner() {
          replace(/\s\s[\s]*/, "")
        }
      }
      remove("./span[string-length(text)<2 and not(*)]")
    }

    # locate and tag stuff
    # back link
    $(".//div[.//a[contains(text(), 'Return to Calendar')] and contains(@class, 'mw_was_tr')]") {
      add_class("mw_back")
      move_here(".//a")
      remove("./div")
      $("./a") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    # grab the main image
    $(".//div[@valign='top']") {
      move_here("//img[@align='bottom']", "top")
      $("./img") {
        wrap("div", class:"mw_main_img")
      }
    }
  }
  # for http://action.humanesociety.org/site/Calendar?view=Detail&id=109422 header
  $("./div[@id='ga-container'][.//input[@id='buytickets']]/preceding-sibling::div[@class='mw_header']") {
    add_class("mw_single_header")
  }
  # HSUS-375 [Mobile & Tablet] Sacramento events page
  # Remove the the powered by convio
  remove("./div[a[contains(@href, 'convio')]]")  
  # end of HSUS-375
}  

# list of events for the day
# http://mlocal.action.humanesociety.org/site/Calendar/888008295?view=DayList&Day=6,4,2013

# March 6, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_cal_day")
  $(".//a[./img[contains(@src, 'share_on_twitter_small')]]") {
    add_class("mw_share_align")
    $("following-sibling::p[1]") {
      wrap_text_children("div", class: "mw_left_align")      
    }
  }

  $(".//a[./img[contains(@src, 'share_on_facebook_small')]]") {
    add_class("mw_share_align")
  }
  
  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  # HSUS-504 Start
  # remove(".//br")
  # HSUS-504 Start
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  $(".//div") {
    remove("@style")
  }
  fixImages()

  # fix tables
  $(".//table") {
    $(".//th") {
      remove()
    }
    $(".//tr") {
      $("./td") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
    name("div")
    add_class("mw_was_tbl")
  }

  # ditch the weekly arrows
  $(".//div[@valign='middle' and count(*)=1]") {
    remove()
  }


  $(".//div[@id='main']") {
    $(".//*") {
      remove("@style")
      remove("@width")
      remove("@align")
    }
    # top box with go to date
    $(".//div[@class='appArea'][2]") {
      add_class("mw_topbox")
      $(".//div[contains(@class, 'mw_was_td') and .//strong/a]") { // top line
        add_class("mw_today")
        $(".//strong") {
          wrap_text_children("span")
        }
      }
      # wrap stuff into gray box
      $(".//div[@valign='middle']") {
        insert("div", class:"mw_graybox") {
          move_here("../div[not(contains(@class, 'mw_today'))]")
          $(".//div[@bgcolor]") {
            add_class("mw_gobutton")
            remove("@bgcolor")
            wrap_text_children("span")
            remove("span")
          }
        }
      }
      $(".//form[@id='cal_form_3']//div[contains(@class, 'mw_today')]") {
        $(".//span") { // trim whitespace
          text() {
            replace(/\s*$/, "")
            replace(/^\s*/, " ")
          }
        }
      }
      $(".//label[@class='wrapable']") {
        remove()
      }

      $(".//div[@valign='middle']") 
    }
  }

  # bottom section with calendar
  $(".//div[@class='appArea' and ./div]") {
    add_class("mw_calendar")
    $("./div[1]") {
      add_class("mw_cal_head")
      move_here(".//div[contains(@class, 'mw_was_td')]")
      remove("./div[@valign='middle']")
      # tag month name
      $("./div[2]") {
        add_class("mw_month")
        remove(".//a")
        move_to("..", "bottom")
      }
    }
    # tidy up dates
    $(".//div[@valign='top' and contains(@class, 'mw_was_td')]") {
      add_class("mw_date")
      # trim whitespace on number
      $("./p[not(a)]") {
        inner() {
          replace(/[\s]*$/, '')
        }
      }
    }
    $(".//img") {
      remove("@height")
      # fixing bad image src
      $image_src = fetch("@src")
      $image_src {
        replace(/site\/Calendar\//, '')
      }
      attribute("src", $image_src)
    }
  }

  $(".//p[@class='callist']") {
    $(".//span[@class='callistevent']") {
      wrap_text_children("span", class: "mw_remove")
      remove(".//span[@class='mw_remove']")
    }
  }

  # event sign up page
  $(".//div[@id='ga-content']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
  }

  # HSUS-479 fix RSVP page styling
  $(".//div[contains (@class, 'mw_cal_head')]"){
    $("./div[contains(@class, 'mw_was_tr')]"){
      remove()
    }
    $(".//div[contains(@class, 'mw_was_tbl')]"){
      remove()
    }
    $("./div[contains(@class, 'mw_was_td')]"){
      add_class("mw_rsvp")
    }
    $("./div[contains(@class,'mw_rsvp')]/p[contains(., '*')]"){
      remove()
    }
    $("./div[contains(., 'Name:')]"){
      insert_top("p","*", class:"mw_required")
      add_class("mw_rsvp_name")
    }
    $(".//label[@for='cons_email']"){
      $(".."){
        insert_before("p","*", class:"mw_required")
      }
      $("./span"){
       remove()
      }
    }
    $(".//input[@id='cons_email']"){
      $(".."){add_class("mw_email_wrapper NetscapeFix")}
    }
    $("./div[contains(., 'Last')]"){
      move_to("//div[contains(@class, 'NetscapeFix')][1]", "after")
    }
  }
  $(".//label[@for='rsvp_num_guests']"){
    move_here("../input","bottom")
  }
  $(".//strong[contains(., 'Please answer the following')]"){
    add_class("mw_bold")
  }
  $(".//input[@id='cons_email_opt_in']"){
    move_to("following-sibling::label[@for='cons_email_opt_in']", "top")
  }
  $(".//span[@class='num'][.='1.']"){
    remove()
  }
  $(".//span[@class='num'][.='2.']"){
    remove()
  }
  $(".//div[@class='req mw_was_td']"){
    remove()
  }
  $(".//span[contains(., 'Phone number')]"){
    text(){prepend("1. ")}
  }
  $(".//span[contains(., 'Mobile number')]"){
    # HSUS-504 Start
    text(){prepend("2. ")}
    # HSUS-504 End
  }
  $(".//p[@class='ErrorMessage']"){
    move_to("//div[contains(@class, 'mw_rsvp_name')][1]", "before")
  }
  $(".//input[@id='rsvp_save']/.."){
    add_class("response_wrapper")
    wrap_text_children("span")
    remove("./span")
  }

  //HSUS-505 add some classes to make styling easier
  $(".//div[contains(@class, 'mw_calendar')]"){
    $("./br"){
      remove()
    }
    wrap_text_children("div")
    $("./a[contains(@class, 'mw_share_align')]/preceding-sibling::p[1]"){
      add_class("mw_last_description")
    }
  }


  //true when there's an error message complaining a field wasn't filled out during submission
  $unfilledFields = "false"
  $(".//span[@class='ErrorMessage']"){
    $unfilledFields = "true"
  }

  match($unfilledFields){
    with(/false/){
      $(".//p[@class='ErrorMessage']"){
        add_class("mw_hide")
      }
    }
  }
  
}
# event detail pages
# http://action.humanesociety.org/site/Calendar/1679217372?view=Detail&id=108621

# March 6, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_cal_event")

  # removals
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//br")
  remove(".//div[@id='contentDiv']/div[not(@id)]")
  remove("./div[./a[contains(@href, 'poweredby')]]")
  $(".//div") {
    remove("@style")
  }

  # fix tables
  $(".//table") {
    $(".//tr") {
      $("./td") {
        name("div")
        add_class("mw_was_td")
      }
      name("div")
      add_class("mw_was_tr")
    }
  }

  #remove more stuff
  //remove(".//div[@id='ga-header']")

  $(".//div[@id='ga-container']") {
    move_here(".//div[contains(@class, '_footer')]")
  }

  $(".//div[@id='ga-content']") {
    move_here(".//div[@class=' mw_was_tr']")
    $(".//div[contains(@class, 'footer')]") {
      move_to("..", "bottom")
    }
    //remove(".//table")
    //remove("./div[contains(@class, 'mw_was_tr') and .//div[contains(@class, 'minical')]]")

    # remove whitespace chunks
    $(".//div[contains(@class, 'mw_was_td')]") {
      wrap_text_children("span")
      $("./span") {
        inner() {
          replace(/\s\s[\s]*/, "")
        }
      }
      //remove("./span[string-length(text)<2 and not(*)]")
    }

    # locate and tag stuff
    $(".//a[contains(text(), 'Facebook')]") {
      add_class("mw_facebook_link")
    }
    $(".//div[.//li[contains(@style, '#a7a7a7')] and not(@class)]") { //footer stuff
      add_class("mw_event_foot")
      move_to("//div[contains(@class, '_footer')]")
    }
    # back link
    $(".//div[.//a[contains(text(), 'Return to Calendar')] and contains(@class, 'mw_was_tr')]") {
      add_class("mw_back")
      //commented this out because it was moving the "text alerts" link
      //move_here(".//a") // aggghhhh nesting
      //remove("./div")
      $("./a") {
        inner() {
          prepend("  &laquo;  ")
        }
      }
    }
    # grab the main image
    $(".//div[@valign='top']") {
      # HSUS-412 : (Mobile & Tablet) Element not appearing on Calendar event
      move_here("//img[@align='bottom']/ancestor::div[contains(@class, 'mw_was_tr')]/following-sibling::div", "top")
      move_here("//img[@align='bottom']", "top")
      $("./img") {
        wrap("div", class:"mw_main_img")
      }
    }
  }
  # for http://action.humanesociety.org/site/Calendar?view=Detail&id=109422 header
  $("./div[@id='ga-container'][.//input[@id='buytickets']]/preceding-sibling::div[@class='mw_header']") {
    add_class("mw_single_header")
  }
  # Fix for HSUS-481
  $(".//div[@align='center']") {
    add_class("mw_hide")
  }  
  # End of HSUS-481

  //HSUS-479: Repair RSVP page
  $(".//div[contains(@class, 'mw_back')]"){
    move_to("//div[@id='ga-content']")
  }

  $(".//div[@valign='bottom']/div/p[text()='*']"){
    add_class("mw_inline_block mw_name_header")
    move_to("//div[@valign='bottom']/div/p[text()='Name:']", "before"){
      add_class("mw_inline_block mw_name_header")
    }
  }

  $(".//label[@for='cons_first_name']"){
    $("./span"){
      add_class("mw_hide")
    }
    //add_class("mw_inline_block")
    move_to("//input[@name='cons_first_name']", "before")
  }

  $(".//label[@for='cons_last_name']"){
    $("./span"){
      add_class("mw_hide")
    }
    //add_class("mw_inline_block")
    move_to("//input[@name='cons_last_name']", "before")
  }

  $(".//label[@for='cons_email']"){
    add_class("mw_inline_block")
    move_to("//input[@name='cons_email']", "before")
  }

  $(".//div[@width='1%']/p[text()='*']"){
    add_class("mw_inline_block")
    move_to("//label[@for='cons_email']", "before")
  }

  $(".//label[@for='cons_email_opt_in']/span"){
    add_class("mw_inline")
    move_to("//input[@id='cons_email_opt_in']", "after")
  }

  $(".//*[contains(text(), ' ')]"){
    text(){
      replace(/\xC2\xA0/, "")
    }
  }

  $(".//h3[@class='ObjTitle']"){
    add_class("mw_padding_bottom")
    move_to("//div[@id='ga-header']")
  }

  $(".//div[@class='appArea']/p[position()<3]"){
    add_class("mw_padding_bottom")
    move_to("//div[@id='ga-header']")
  }

  $(".//span[@class='num'][contains(text(), '1')]"){
    add_class("mw_inline")
    move_to("//span[contains (text(), 'Phone number (optional):')]", "before"){
      add_class("mw_inline")
    }
  }

  $(".//span[@class='num'][contains(text(), '2')]"){
    add_class("mw_inline")  
    move_to("//span[contains (text(), 'Mobile number (optional):')]", "before")
  }

  $(".//span[contains (text(), 'Phone number (optional):')]"){
    add_class("mw_inline")
  }

  $(".//span[contains (text(), 'Mobile number (optional):')]"){
    add_class("mw_inline")
  }

  $(".//a[contains(text(), 'text alerts')]"){
    add_class("mw_text_alerts") 
    text(){
      replace(/«/, "")
    }
  }

  $(".//input[@value='Submit'] | .//input[@value='Reset'] | .//input[@value='Cancel']"){
    add_class("mw_btn6 mw_rsvp_btn")
  }



}

# Animal main page
# http://www.humanesociety.org/animal_community/
# 
# km cY7 Rmd
# April 2 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
  }

   # For HSUS-378 -(Tablet) Fix styling of Yellow Boxes
    # sidebar
  $(".//div[@id='side']") {
    # donate action sidebar
    $("./ul") {
      attributes(class:"mw_sidebar1_h")
    }
    # resourse sidebar
    $("./div[@id='resources']") {
      add_class("mw_sidebar2")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//h2[string-length()<1]") {
        inject("Resources for <strong> the Animal Care Community</strong>")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
      $("./ul") {
        name("div")
        $("./li[./a[@class='more']]") {
          name("div")
        }
        $("./li[position() mod 4 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./li") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/li") {
          name("div")
          add_class("mw_flex_box_item_1")
        }
      }
    }
    $("./div[@id='related-content']") {
      add_class("mw_sidebar3")
      $("./div/h3/a") {
        inject("  &raquo;  ")
      }
      $("./div/h3"){
        attributes(class:"")
      }
    }
  }
  # End of  HSUS-378 -(Tablet) Fix styling of Yellow Boxes
  # $(".//div[@id='resources']") {
  #   add_class("mw_sidebar2")
  #   $("./h2") {
  #     inject("Resources for <strong> the Animal Care Community</strong>")
  #     add_class("mw_h2")
  #   }
  #   $(".//a") {
  #     inject("  &raquo;  ")
  #   }
  # }

}
# similar to main animals and action
# http://www.humanesociety.org/parents_educators/
# 
# km cY7 Rmd
# Feb 18 2013 Sarah LaFrance

$("./body") {
  add_class("mw_parents")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='feature']") //v c 
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")

  # main content
  $(".//div[@id='page']") {
    $(".//div[@id='cols']") {
      add_class("mw_box2_tablet")
    }
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }

    $(".//div[@id='features']") { // swap stuff in the resources section
      $(".//li") {
        $("./p[@class='image']") {
          move_to("..", "top")
        }
        $(".//a[@class='more']") {
          inner() {
            replace(/\xC2\xA0/, "")
          }
        }
      }
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//li") {
        add_class("mw_newsItem")
      }
      $(".//a[@class='more']") {
        wrap("div", class:"more-link")
      }
    }
  }

  # side bar
  $(".//div[@id='resources']") {
    add_class("mw_sidebar2")
    $(".//a") {
      inject("  &raquo;  ")
    }
  }

}
# social media stuff!
# http://www.humanesociety.org/community/connect.html
# 
# April 2 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community mw_connect") // use the same styling as the main page

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//br")
  remove(".//hr")
  remove(".//div[@id='fb_likebox']")
  remove(".//div[@id='twitter_feed']")
  remove(".//div[@id='wayne_feed']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3|.//p[@class='author']") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//a[@class='back']") {
      inner() {
        prepend("  &laquo;  ")
      }
    }
  }

  # social networks
  $(".//div[@id='button_container']") {
    $(".//p") {
      add_class("mw_social_button")
    }
  }

  # form to get texts
  $(".//div[@id='mobile']") {
    $("./div[@id='mobile_text']") {
      $("./form") {
        add_class("mw_text_signup")
        $(".//input[@type='text' or type='submit']") {
          wrap("div") {
            add_class("mw_text_input")
          }
        }
      }
      $("./a") {
        remove("@style")
        wrap("p")
      }
    }
    $("./div[@id='humane_tv_app']") {
      $("./span") {
        remove("@style")
        $(".//img") {
          remove("@width")
        }
        $(".//img[contains(@src, 'tv_')]") {
          add_class("mw_tv_app")
        }
      }
      remove("./strong")
    }
  }

  # causes and youtube
  $(".//div[@id='social_feeds']") {
    add_class("mw_hide")
    # $(".//iframe[1]") {
    #   attribute("height", "250px")
      
    # }
    # $(".//iframe[2]") {
    #   attribute("height", "100px")
    # }
  }

  # side bar
  $(".//ul[@id='action']") {
    add_class("mw_sidebar1_h")
  }

}
# animal care centers and shelters
# http://www.humanesociety.org/animal_community/shelters/cape.html
# 
# km cY7 Rmd
# March 28 2013 Sarah LaFrance

$("./body") {
  add_class("mw_community") // use the same styling as the main page


  # remove the odd text nodes that are adding strange text
  wrap_text_children("span", class:"mw_hide")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@class='simple']")
  remove(".//br")
  remove(".//div[@id='related-content']/h2/@class")
  remove(".//div[@id='related-content']/h3/@class")
  
  $(".//div[@id='wrapper']") {
    move_here(".//div[@id='contentDiv']/div[1]", "top")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3|.//p[@class='author' or @class='subhead']") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//li") {
        add_class("mw_news_item")
      }
      $(".//iframe") {
        remove("@style")
      }
    }
    $(".//ul[not(@id)]") {
      add_class("mw_ul")
    }
    # HSUS-148 South Florida Wildlife Center page styling
    $("./div[@id='feature']") {
      $("./h3[contains(@class,'mw_h3')]/following-sibling::p[1]") {
        name("div")
        wrap_text_children("span")
        $("./a") {
          wrap("div", class:"mw_feature_link")
        }
        $("./span") {
          move_to("preceding-sibling::div[@class='mw_feature_link']", "bottom")
        }
      }
    }
    $("./div[@id='feature' and not(*)]") {
      remove() // empty feature go byebye
    }
    $(".//blockquote//h2") {
      remove("@class")
    }
  }
  # sidebar
  $(".//div[@id='side']") {
    # donate action sidebar
    $("./ul") {
      attributes(class:"mw_sidebar1_h")
    }
    # resourse sidebar
    $("./div[@id='resources']") {
      add_class("mw_sidebar2")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//h2[string-length()<1]") {
        inject("Resources for <strong> the Animal Care Community</strong>")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
      $("./ul") {
        name("div")
        $("./li[./a[@class='more']]") {
          name("div")
        }
        $("./li[position() mod 4 = 1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./li") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/li") {
          name("div")
          add_class("mw_flex_box_item_1")
        }
      }
    }
  $("./div[@id='related-content']") {
    add_class("mw_sidebar3")
    $("./div/h3/a") {
      inject("  &raquo;  ")
    }
    $("./div/h3"){
      attributes(class:"")
    }
  }
  }

  # remove ads
  $(".//a[contains(@href, 'ads')]/..") {
    log("found an Ad")
    add_class("mw_hide")
  }
}
# resources for volunteers
# http://www.humanesociety.org/community/volunteers
# http://www.humanesociety.org/community/volunteers/volunteer_hsi_fa.html
# 
# km cY7 Rmd
# April 2 2013 Sarah LaFrance

$("./body") {
  add_class("mw_vols") // use the same styling as the main page

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }

    # deal with select
    $(".//div[form[select]]") {
      remove("@style")
      add_class("mw_select_div")
      $(".//select") {
        add_class("mw_select1")
      }
    }

    # remove feature if it's just the back button
    $(".//div[@id='feature' and a[@class='back']]") {
      add_class("mw_hide")
    }

    $(".//div[@id='features']") {
      $(".//li") {
        move_here("./p[@class='image']", "top")
      }
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
    }
    $(".//div[contains(@class, 's_borderless')]") {
      # HSUS-340 Styling Tweaks to Faith Volunteering Page
      # URL: http://www.humanesociety.org/community/volunteers/volunteer_leader_faith_outreach.html
      match($path, /volunteer_leader_faith_outreach/) {
        add_class("mw_faith")
        $(".//ul[not(@id)]") {
          add_class("mw_list1")
        }
        $("./p[./br][./strong]") {
          $("./br/preceding-sibling::strong[1]") {
            add_class("mw_break_line")
          }
        }
      }
      # end HSUS-340 Styling Tweaks to Faith Volunteering Page
    }
    $(".//div[@id='side']") {
      $("./ul") {
        add_class("mw_sidebar1_h")
      }
      $("./div[@id='related-content']") {
        add_class("mw_sidebar3")
      }
    }
  }
  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//br")
}
# resources main
# http://www.humanesociety.org/animal_community/resources/
# 
# km cY7 Rmd
# Feb 14 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press mw_news_base")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@class='simple']")
  remove(".//div[@id='bottom-pagination']")
  remove(".//br")

  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
    }
  }

  $(".//div[@id^='templatelist']") {
    insert("div") {
      move_here("../div[@id='list-nav']")
      move_here("../div[@id='sortby']")
    }
  }

  $(".//div[contains(@class, 's_borderless') and not(@id)]") {
    add_class("mw_content") // css selectors would be too cumbersome
    move_here("../../ul[@id='tools']", "top")
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
      $("./h2") {
        inject("Resources for <strong> the Animal Care Community</strong>")
        add_class("mw_h2")
      }
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

}
$("./body") {
  add_class("mw_mapping_page")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
    remove("@style")
  }
  $(".//h3") {
    add_class("mw_h3")
  }

  # remove the #head and #page-head
  $(".//div[@id='page-head' or @id='head' or @id='page-bottom-spacer' or @class='toolsSpacer']") {
    remove()
  }
  remove(".//p[string-length()<2 and not(*)]")

  $(".//div[@id='main']") {
    add_class("mw_box2")

    # fix instructions
    $(".//p") {
      inner() {
        replace(/Click on a state.*-down box/, 'Click on the name of a state or province in the menus')
      }
    }

    # US Map
    $("./div[contains(@class,'section-lead')]/table") {
      insert_before("div", class:"mw_map_locations", id:"us_map", data-ur-set:"toggler") {
        insert("div", "United States", class:"mw_location_header mw_bar5", data-ur-toggler-component:"button") {
          insert("span", " Tap to ", class: "mw_tap")
        }
        copy_here("../table//area")
        wrap_together("./area", "div", data-ur-toggler-component: "content")
        # HSUS-196 hide USA map
        $("following-sibling::table[1]") {
          add_class("mw_hide")
          $("following-sibling::div[.//select[@name='states']][1]") {
            add_class("mw_hide")
          }
        }
        match($path,/volunteer_opportunities/) {
          $("self::div[@id='us_map']") {
            # add_class("mw_testing")
            attribute("data-ur-state", "enabled")
            $("./div") {
              attribute("data-ur-state", "enabled")
            }
          }
        }
        # End HSUS-196 hide USA map
      }

      # remove the special styling on the map
      $(".//img") {
        # remove("@style")
        remove("@width")
        remove("@height")
      }
    }

    $(".//div[@id='us_map']/div[not(@class)]/area") {
      %location = fetch("@alt")
      name("a")
      add_class("mw_bar4 mw_state")
      remove("@coords")
      text(%location)
      # rewrite_links()
    }

    # Canadian Map
    $(".//img[@usemap='#Map2']") {
      insert_before("div", class:"mw_map_locations", id:"canadian_map", data-ur-set:"toggler") {
        insert("div", "Canada", class:"mw_location_header mw_bar5", data-ur-toggler-component:"button") {
          insert("span", " Tap to ", class: "mw_tap")
        }
        copy_here("../map/area")

        wrap_together("./area", "div", data-ur-toggler-component: "content")
        # HSUS-196 hide Canada map
        $("following-sibling::img[1]") {
          add_class("mw_hide")
        }
      }

      remove("@style")
    }

    # Canadian <area> is different, it does not have an ALT thingy
    $(".//div[@id='canadian_map']/div[not(@class)]/area") {
      
      # Get the state identifier
      %location = fetch("@href")
      %location {
        replace(/^.+=/, "")
      }
      log(%location)

      #Look it up from the <select> menu
      $("./ancestor::div[contains(@class, 'section-lead')]//select/option[@value='"+%location+"']") {
        log("fetching state name")
        $state_name = fetch("text()")
        log($state_name)
      }

      name("a")
      add_class("mw_bar4 mw_state")
      remove("@coords")
      text($state_name)
    } #/ancestor::div[contains(@class, 'section-lead')]//select/option[@value='AB']

    remove(".//map")
  }
  rewrite_links()
}
# Department subpages
# http://www.humanesociety.org/about/departments/*
#

# Feb 21 2013 Sarah LaFrance

$("./body") {
  add_class("mw_department_tablet")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1 and not(*)]") {
    remove()
  }
  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
      text() {
        
      }
    }
    $(".//h3") {
      add_class("mw_h3")
    }
  }
  # HSUS-355 Ｒeduce spacing between title & content
  # http://humanesociety.org/about/departments/animal-rescue-team/animal_rescue_team.html
  $(".//div[@class='section']") {
    remove(".//br")
  }

  $(".//div[@id='features']") {
    $(".//li/p[@class='image']") {
      move_to("..", "top")
    }
  }

  $(".//div[contains(@class, 'area-news')]/a[@class='more']") {
    wrap("div", class:"more-link")
  }
  $(".//div[contains(@class, 'area-news')]") {
    $("./a") {
      wrap("div", class: "mw_news_links")
    }
  }
  # end of HSUS-355
  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')
    $("./div[@id='main']") {
      add_class("mw_gray_inner")
      # move_here("./ancestor::div[@id='cols']/div[@id='side']") {
      #   $("./*[@id='action']") {
      #     add_class("mw_sidebar1_h")
      #   }
      # }
    }
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
      ## HSUS - 442
      remove("./li[@id='donate']/a[@class='give-bttn']")
    }

  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    #    remove(".//div[@id='state']")
    remove(".//div[@class='simple']")
    remove("./iframe")
    remove(".//br")
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")

      $('.//li') {
        inner() {
          replace(/\xC2\xA0/, '')
        }
      }
    }
  }

  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_article_video")
    remove("@height")
    remove("@width")
    attributes(style:"width: 100%;")
    $("..") {
      attributes(style:"width: 100%;")

    }
  }
  
  $(".//div[@id='main']/div[contains(@class, 's_borderless')]") {
    $("./p[@class='subhead']") {
      add_class("mw_h3")
    }
    $("./p[not(@class)]") {
      add_class("mw_part_p")
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        add_class("mw_h2")
      }
      $("./div[@class='module'][position() mod 4=1]") {
        wrap("div", class:"mw_flex_box")
      }
      $("./div[@class='module']") {
        move_to("preceding-sibling::div[@class='mw_flex_box']")
      }
      $("./div[@class='mw_flex_box']/div[@class='module']") {
        add_class("mw_flex_box_item_1")
        $("./h3/a") {
          inject("  &raquo;  ")
        }
      }
    }
    $(".//div[@id='petfinder-promo']") {
      add_class("mw_sidebar7")
    }
  }

}
# Department main page
# http://www.humanesociety.org/about/departments/
#

# April 11 2013 Sarah LaFrance

$("./body") {
  add_class("mw_dept_tablet")

  # removing
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")

  $(".//h2") {
    add_class("mw_h2")
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='main']") {
    remove(".//br")
    $(".//h2") {
      add_class("mw_bar3")
      wrap("div", class:"mw_deptItem") {
        move_here("following-sibling::*[1]")
        move_here(".//div[contains(@class, 'linksetMenu')]")
        $("./p") {
          add_class("navigationItem")
        }
        remove("./div[not(@class)]")
      }
    }
    $(".//div[@id='features']") {
      insert("div", class:"mw_column_right") {
        move_here("preceding-sibling::div[contains(@class, 'mw_deptItem') and position()<4]")
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//a[@class='more']") {
      inject("  &raquo;  ")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
    move_here(".//div[@id='news']") {
      add_class("mw_sidebar4")
    }

    move_to("./preceding-sibling::div")
  }

  $(".//div[@id='side']") {
    $("./ul") {
      add_class("mw_sidebar1_h")
    }
  }

}
# About employment page
# http://www.humanesociety.org/about/employment
# 

# January 25, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_employ_tablet")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")

  $(".//div[@id='main']") { // main content
    add_class("mw_gray_inner")
    # wrap("div", class:"mw_box2_tablet")

    $(".//div[contains(@class, 's_borderless')]") {
      remove("..//div[@id='feature'] | ./h3/br")
      move_here("..//div[@id='feature']/a")

      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
        wrap("div", class:"mw_back")
      }

      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//p[./strong]") {
        add_class("mw_h2")
        inject("  :  ")
      }
    }
  }

  $(".//div[@id='side']") { // bottom donate box
    $("./div") {
      remove()
    }
    # $("./ul[@id='action']") {
    #   add_class("mw_sidebar1_h")
    # }
  }
}
# State ranking page
# http://mlocal.humanesociety.org/about/state/humane_state_ranking_2011.html

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_rank")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='options']")


  $(".//iframe") {
    remove("@style")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  # main content
  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    $(".//h3") {
      add_class("mw_h3")
      remove("@style")
    }

    $(".//p[@class='lead']") {
      inner() {
        # fixing instructions
        replace(/Hover over .* tier/, "Click on a tier to see state rankings, and click the name of a state")
      }
    }

    # the map section
    $("./p") {
      name("div")
      add_class("mw_map_holder")
      remove("./img/@style")
      # remove("./img")
      # $("./map/area") {
      #   $state_name = fetch("@alt")
      #   $state_name {
      #     replace(/(\s|:)\s(\s)?.*/, '') // clip off the state name
      #   }
      #   attribute("id", $state_name)
      # }
    }

    # the key box
    $("./div[not(@class) and ./img]") {
      add_class("mw_key")
      remove("@style")
      remove(".//br")
      # get rid of the blanks
      wrap_text_children("p")
      remove("p")
    }

    # tables with rankings
    $(".//div[./ul[@id='acc']]") {
      add_class("mw_rank_tables")
      remove("@style")
      # $(".//li") {
      #   attributes(data-ur-set:"toggler")
      #   $("./h3") {
      #     attributes(data-ur-toggler-component:"button")
      #   }
      #   $("./div") {
      #     attributes(data-ur-toggler-component:"content")
      #     $(".//div[@class='acc-content']") {
      #       $(".//td") {
      #         add_class("mw_was_td")
      #         name("div")
      #         remove("@style")
      #       }
      #       $(".//tr") {
      #         name("div")
      #         add_class("mw_was_tr")
      #         remove("@style")
      #         remove("./div[1]")
      #         remove("./div[2]")
      #       }
      #       $(".//div[contains(@class, 'head')]") {
      #         remove()
      #       }
      #       $(".//div[@class=' mw_was_tr']") { // class is not header
      #         attributes(data-ur-set:"toggler")
      #         wrap_together("./div", "div") {
      #           attributes(data-ur-toggler-component:"button")
      #           $(".//div[@class=' mw_was_td']") {
      #             $state_head = upcase(fetch("text()"))
      #           }
      #         }
      #         insert("div", data-ur-toggler-component:"content") {

      #           move_here("//map/area[@id='"+$state_head+"']") {
      #             name("p")
      #             inject(fetch("@alt"))
      #             inject(fetch("@title"))
      #             remove("@alt")
      #             remove("@title")
      #             remove("@shape")
      #             remove("@coords")
      #             remove(".//br")
      #             wrap_text_children("span")
      #           }
      #         }
      #       }
      #     }
      #   }
      # }
    }

    # $(".//img") {
    #   $source = fetch("@src")
    #   $source {
    #     replace(/png.*/, "png")
    #   }
    #   attribute("src", $source)
    # }

    # $("./p") {
    #   remove()
    # }
  }

}
# State page
# http://mlocal.humanesociety.org/about/state/connecticut

# Feb 25 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_page_tablet")

  # remove stuff
  # remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")

  # Move the masthead outside the page and wrap
  $(".//div[@class=' mw_masthead']") {
    move_to("./ancestor::div[@id='page']/div[@id='page-head']", "top")
  }
  $(".//div[@id='page-head']") {
    $("./*[not(@class=' mw_masthead')]") {
      add_class("mw_hide")
    }
    move_to("./ancestor::div[@id='wrapper']","top")
  }
  $(".//div[@id='page']") {
    add_class("mw_gray_inner mw_box2_tablet")
    $(".//div[@id='main']") {
      $("./div[@class='section']") {
        remove("./br")
        $("./p") {
          add_class("mw_section_p")
        }
        $("./div[@id='images']") {
          $(".//p[@class='image']") {
            wrap("div", class:"mw_image")
          }
          $(".//p[@class='caption']") {
            move_to("preceding-sibling::div[@class='mw_image']")
          }
          $("following-sibling::p[contains(@class,'mw_section_p')]") {
            move_here("following-sibling::a[@class='more']")
          }
          wrap("div", class:"mw_flex_box mw_article_section") {
            move_here("following-sibling::p[contains(@class,'mw_section_p')]") {
              add_class("mw_flex_box_item_1")
            }
          }
        }
      }
      $("./div[@id='features']") {
        $(".//p[@class='image']") {
          wrap("div", class:"mw_flex_box") {
            move_here("following-sibling::p")
          }
        }
      }
    }
    # sidebar
    $(".//div[@id='side']") {
      # In your state
      $("./div[@id='state']") {
        add_class("mw_sidebar5")
        $("./h2") {
          add_class("mw_h2")
        }
      }
      # related-content
      $(".//div[@id='related-content']") {
        add_class("mw_sidebar3")
        $(".//h2") {
          add_class("mw_h2")
        }
        $("./div[@class='module'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./div[@class='module']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/div[@class='module']") {
          add_class("mw_flex_box_item_1")
          $("./h3/a") {
            inject("  &raquo;  ")
          }
        }
      }
    }
  }

  $(".//div[@id='main']//h1") {
    add_class("mw_h1")
  }
  $(".//div[@id='main']//h2") {
    add_class("mw_h2")
    text() {

    }
  }
  $(".//div[@id='main']//h3") {
    add_class("mw_h3")
  }

  $(".//iframe") {
    remove("@style")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }

  $(".//ul[contains(@class,'mw_sidebar1')]") {
    add_class("mw_sidebar1_h")
  }

  $(".//div[@id='options']"){
    $(".."){
      add_class("mw_stateRanks")
      remove("./@style")

      $("./div[contains(@id, 'options')]"){
        $("./a[1]"){
          attributes(onclick:"$(\".mw_range[data-ur-state='disabled']\").click();")
        }
        $("./a[2]"){
          attributes(onclick:"$(\".mw_range[data-ur-state='enabled']\").click();")
        }
      }

      $("./ul"){
        $("./li"){
          attributes(data-ur-set:"toggler")
          $("./h3"){
            add_class("mw_range")
            attributes(data-ur-toggler-component:"button")
            #For HSUS-501: 2013 State Ranking page - remove map and have stacked percentages like example
            inner() {
              replace(/(.*)(-)(.*)/,"$1 - $3")
            }
            #End of HSUS-501
          }
          $("./div"){
            attributes(data-ur-toggler-component:"content")

          }
        }
      }
    }
  }

  $(".//p[contains(@class, 'lead')][last()]"){
    wrap_text_children("span"){
      text(){
        replace("Hover over a state for a summary, c", "C")
      }
    }
  }

}
# Subcategory faith landing
# http://www.humanesociety.org/about/faith
#

# Mar 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faith_tablet")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='toolsSpacer']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//div[@class='section' and not(@id)]") { // lead section
    add_class("mw_lead")
    move_here("../ul[@id='tools']", "top")
    move_here(".//a[@class='more']")
  }

  $(".//div[@id='feature']") { // top heading
    $("./h2") { // page title
      move_to("..", "top")
      attribute("class", "mw_h1")
    }
  }

  $(".//div[@id='features']") {
    remove("./br")
    $(".//ul") {
      $("./li") {
        move_here("./p[@class='image']", "top")
        $(".//p") {
          remove(".//a[@class='more']")
        }
      }
    }
  }

  $(".//ul[@id='issue-browser']") { // list of faiths
    $("./li") {
      attributes(class:"mw_faith_toggle", data-ur-set:"toggler")
      $("./a") {
        attributes(class:"mw_bar3", data-ur-toggler-component:"button")
        remove("@href")
        insert("div", class:"mw_plusminus")
      }
      $("./ul") {
        attributes(class:"mw_faith_bar", data-ur-toggler-component:"content")
        $("./li/a[not(@class)]") {
          add_class("more")
        }
      }
    }
  }

  $(".//div[@id='main']") {
    remove(".//a[@class='back']")
    add_class("mw_gray_inner")
    wrap("div", class:"mw_box2_tablet") {
      move_here("./ancestor::div[@id='cols']//div[@id='side']") {
      # $("./div[@id='side']") {
        # wrap_together("./*[not(@id='action')]", "div", class:"mw_flex_box")
        $("./*[@id='action']") {
          add_class("mw_sidebar1_h")
          # move_to("./ancestor::div[contains(@class, 'mw_gray_inner')]//div[@id='side']", "before")
          # move_to("..", "before")
        }
      }
    }
    

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    $(".//h3|.//p[@class='author']") {
      add_class("mw_h3")
    }
    $(".//h4") {
      add_class("mw_h4")
    }
    insert("div", class:"mw_main") { // wrap all the main divs
      move_here("../div[not(contains(@class, 'mw_lead'))]")
      move_here("preceding-sibling::ul[@id='tools']", "top") // if there's no lead, grab share stuff
    }

    $(".//div[contains(@class, 's_borderless')]/ul[not(@id)]") {
      add_class("mw_article_list")
    }
  }

  $(".//div[@id='side']") { // sidebar links
    $(".//h2") {
      add_class("mw_h2")
      text() {

      }
    }
    remove(".//div[./div[@id='wayne']]")
    # need to replace that br with a space
    $(".//p") {
      remove("@style")
    }
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
    }
    # For HSUS-483
    $(".//div[(@id='wsd-promo') or (@id='wsd-promo2')]") {
      add_class("mw_sidebar8")
      $("./p[./a[contains(@class, 'more')]]") {
        add_class("mw_more_button_wrapper")
      }
    }
    # End of HSUS-483
    # add_class("mw_flex_box")

    # $("./div[contains(@class,'mw_flex_box')]/*") {
    #   add_class("mw_flex_box_item_1")
    # }
  }
  
}
# Subcategory faith forms
# http://www.humanesociety.org/about/faith
#

# Mar 1 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faith_form mw_faith")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h2")
  }
  $(".//h4") {
    add_class("mw_h4")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='main']") {
    add_class("mw_gray_inner")

    wrap("div", class:"mw_box2_tablet")

    $("./div[@id='feature']") { // top heading
      $("./h2[1]") { // page title
        move_to("..", "top")
        attribute("class", "mw_h1")
      }
    }
    $(".//table") {
      $(".//td") {
        name("div")
        remove(".//br")
      }
      $(".//tr") {
        name("div")
        remove(".//br")
        move_to("../..")
      }
      remove()
    }
    $(".//div") {
      remove("@style")
      remove("@valign")
      remove("@width")
    }
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_spam")
    }
    $(".//input[@type='submit']") {
      $buttonText = fetch("@value")
      $buttonText {
        replace(/\./, "")
      }
      attribute("value", $buttonText)
    }
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[contains(@id, '-promo')]")
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
  }
  
}
# About overview page
# http://www.humanesociety.org/about/overview
# 

# April 8, 2013 Sarah LaFrance

$("//body") {
  add_class("mw_overview_tablet")

  # remove unneeded section
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='feature']/a[@class='back']")
  # remove(".//div[@class='section']")
  remove(".//div[@class='simple']")
  remove(".//p[@class='author']")
  remove(".//div[@id='page-bottom-spacer']")

  # general classes and tags
  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')
    $("./div[@id='main']") {
      add_class('mw_gray_inner')
    }
    $(".//p[contains(@class, 'subhead')]") {
      add_class("mw_h3")
    }
    
    $(".//p[img[contains(@class, 'asset-image')]]") {
      remove("./@style")
      add_class("mw_img_p")
    }

    $(".//blockquote[not(.//blockquote)]") {
      add_class("mw_light_blue")
    }

    $(".//iframe") {
      remove("@style")
      remove("@width")
      remove("@height")
    }

    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//a[contains(@class, 'more')]") {
      inject("  &raquo;  ")
    }
  }

  # Moving the charitynavigator into the content div
  $(".//a[contains(@href, 'charitynavigator')]/img[contains(@src, 'charity_navigator')]/ancestor::div[1]") {
    remove("./@class")
    add_class("mw_charity_rating")
    move_to("./ancestor::div[@id='contentDiv']//div[@id='main']", "bottom")
    remove("./@style")
    $("./span") {
      remove("./@style")
    }
  }

  # pull the subcat links under the masthead
  $(".//ul//ul//ul") {
    add_class("mw_flex_box")
    $("./li") {
      add_class("mw_flex_box_item_1")
      remove("@style")
      $("./a") {
        add_class("mw_bar3 mw_h3")
      }
    }
    move_to("//div[@class=' mw_masthead']", "after")
    # make two rows
    insert_after("ul", class:"mw_flex_box") {
      move_here("preceding-sibling::ul/li[position()>3]")
    }
  }

  # main content
  $(".//div[@id='contentDiv']") {

    # HSUS-144 Update styling on Annual Report 2011
    $(".//p[@class='image']]") {
      add_class("mw_image_section")
      remove("./p//br | following-sibling::div[contains(@class,'simple')]//strong//br")
      $("following-sibling::div[contains(@class,'simple')]/h2") {
        add_class("mw_h3")
      }
    }
    # End HSUS-144 Update styling on Annual Report 2011

    # remove one br
    remove(".//div[contains(@class, 's_borderless')]/h1[contains(text(), 'Us:')]/following-sibling::p/br")
    
    # remove empty p
    $(".//div[contains(@class, 's_borderless')]//p[not(*)]") {
      match(text(), (/\A\s+\Z/)) {
        remove()
      }
      match_not(text(), (/.+/)) {
        remove()
      }
    }

    $(".//div[@id='content']") {
      $(".//h3[@class='spacing']") {
        remove("./@class | ./@id")
        remove("./img")
        attributes(data-ur-set:"toggler")
        wrap_text_children("div", class:"mw_accomplish") {
          match(text(), (/\A\s+\Z/)) {
            remove()
          }
          attributes(class:"mw_acco_btn", data-ur-toggler-component:"button")
        }
        $("./div[contains(@id, 'answer')]") {
          remove("./@id | ./@style")
          attributes(class:"mw_acco_content", data-ur-toggler-component:"content")
        }
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }
    # HSUS-222
    $("./ul[@id='action']") {
      add_class("mw_was_ul mw_flex_box")
      name("div")
      $("./li") {
        add_class("mw_was_li mw_flex_box_item_1")
        name("div")
      }
    }
    $("./div[@id='related-content']") {
      $("./div[@class='module'][1]") {
        wrap("div", class:"mw_flex_box") {
          move_here("./following-sibling::div[@class='module']")
          $("./div[@class='module']") {
            add_class("mw_flex_box_item_1")
          }
        }
      }
    }
    # end HSUS-222  
  }
}
# Apodcast main page
# http://www.humanesociety.org/about/podcast
# 

# March 12, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_podcast")

  # remove unneeded section
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }

  # iframes for episodes
  $(".//iframe") {
    attribute("height", "480px")
  }

}
# individual event page
# http://www.humanesociety.org/about/events/humane_lobby_days_2013.html
# 

# March 5, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_event_page_tablet")
  #For HSUS-434 : Add class for fixing the alignment issue
  $(".//div[@id='cols']") {
    add_class('mw_box2_tablet')
  }
  #End of HSUS-434
  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length()<=1 and not(*)]")


  $(".//div[@id='main']") { // main content
    #For HSUS-434 : Add class for fixing the alignment issue
    add_class('mw_gray_inner')
    #End of HSUS-434
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
      remove(".//br")
    }

    # top section with lead text and map
    $(".//ul[@id='tools']") {
      wrap("div", class:"mw_lead") {
        move_here("following-sibling::div[@class='section']")
        move_here("following-sibling::div[@id='feature' and .//iframe]")
        $(".//small") {
          $(".//a") {
            remove("@style")
          }
        }
      }
    }    

    # a google maps iframe whee
    $(".//iframe") {
      $map_url = fetch("@src")
      $map_url {
        replace(/https/, "http") // fix itttttt
      }
      attribute("src", $map_url)
    }

    # wrap remaining sections into one
    # this is pretty sloppy, I'll clean it up later, need to tag more specifically -- SL
    $("./div[@class='mw_lead']") {
      insert_after("div", class:"mw_main") {
        move_here("following-sibling::div[contains(@class, 'section')]") {
          remove(".//br")
        }
        $(".//div[not(@id)]") { // the faq section
          remove(".//img[contains(@id, 'question')]")
          # remove(".//br[following-sibling::br]")
          $(".//*") {
            remove("@style")
          }
          $(".//span[contains(@id, 'question')]") {
            name("h3")
            attributes(class:"mw_bar3", data-ur-toggler-component:"button")
            insert("div", class:"mw_plusminus")
            wrap("div", class:"mw_question") {
              attributes(data-ur-set:"toggler")
              move_here("following-sibling::div[1]") {
                attributes(data-ur-toggler-component:"content")
              }
            }
          }
        }
        $(".//div[table]") {
          move_here(".//td//a")
          remove(".//table")
          $("./div") {
            move_to("..", "bottom")
          }
          $("./a") {
            wrap("div") {
              add_class("mw_sponsor")
            }
          }
        }

        $(".//div[contains(@class, 'question')]") {
          $("following-sibling::p") {
            attribute("class", "mw_get_faq")
          }
        }
        $(".//a[@class='more']") {
          inject("  &raquo;  ")
        }

        # try to grab nominee films for genesis
        $(".//div[contains(@class, 'simple')]") {
          $(".//p[preceding-sibling::h3[strong] or following-sibling::h3[strong]]") {
            add_class("mw_nominees")
            wrap_text_children("span") {
              # for HSUS-516 - keeping in text
              match_not(inner(), /\S/) {
                remove()
              }
            }
            # remove("./span")
            remove(".//br")
            $("preceding-sibling::h3[strong]") {
              add_class("mw_h3_nom")
            }
            $("following-sibling::h3[strong]") {
              add_class("mw_h3_nom")
            }
            # for HSUS-516 - changing styling to be .mw_nominees > a to .mw_nominees > .mw_nominee_elements 
            inner_wrap("span", class: "mw_nominee_elements")
          } 
        }

        # HSUS-516 - making this not include nominees, moved after nominees designation
        $(".//div[not(//div[@class='mw_question'])]") {
          $(".//p[not(contains(@class, 'mw_nominees')) and (count(a)=count(*) and count(a)>2)]") {
            add_class("mw_links")
            $("./a") {
              add_class("mw_bar3")
            }
            wrap_text_children("span")
            remove("./span")
          }
        }
      } // close mw_main
    }

    # grab the bottom section of genesis pages
    $("./div[not(@class)]") {
      add_class("mw_genes")
      # presenter list
      $(".//p[a[contains(@href, 'imdb')]]") {
        add_class("mw_links")
        remove(".//br")
      }
      $("./div") {
        wrap_text_children("span")
        remove("./span")
      }
    }

    # remove any empty sections
    $(".//div[not(node())]") {
      remove()
    }
  }

  $(".//div[@id='side']") {
    # Action side bar
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
    }
    $(".//div[contains(@class, 'area-news')]") {
      $(".//span") {
        remove("@style")
      }
    }
    # HSUS-413 : magazine-promo style
    $("./div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
      $("./p[1]") {
        wrap("div", class:"mw_flex_box") {
          move_here("following-sibling::p")
          $("./p") {
            add_class("mw_flex_box_item_1")
          }
        }
      }
    }
    # end of HSUS-413
    # HSUS-399 Looking for a pet side bar
    $("./div[@id='petfinder-promo']") {
      add_class("mw_pet_box")
      $("./p[@class='up']") {
        wrap("div", class:"mw_find_pet") {
          move_here("preceding-sibling::p", "top")
        }
      }
      $("./div[@class='mw_find_pet']") {
        move_to("following-sibling::img[1]", "after")
        move_here("preceding-sibling::h2", "top") {
          add_class("mw_h2")
        }
      }
    }
    $("./div[contains(@class, 'simple')][.//a[contains(@href, 'sponsors')]]") {
      add_class("mw_sponsors_wrapper")
      $("./h2") {
        add_class("mw_h3")
      }
    }
  }

  # Add in the slideshows
  $(".//div[@id='hsus_embedded_slideshow_container']") {
    insert_top("div", id:"slideshow")
  }
  # relate content side bar
  $(".//div[@id='related-content']") {
    add_class("mw_sidebar3")
    $(".//h2") {
      add_class("mw_h2")
    }
    $("./div[@class='module'][position() mod 4=1]") {
      wrap("div", class:"mw_flex_box")
    }
    $("./div[@class='module']") {
      move_to("preceding-sibling::div[@class='mw_flex_box']")
    }
    $("./div[@class='mw_flex_box']/div[@class='module']") {
      add_class("mw_flex_box_item_1")
      $("./h3/a") {
        inject("  &raquo;  ")
      }
    }
    $("./p[@class='more-link']") {
      inject("  &raquo;  ")
    }
  }
  # end relate content sidebar

}
# Subcategory base page so we can detatch from the employ page
# http://www.humanesociety.org/about/*
#

# Feb 4 2013 Sarah LaFrance

$("./body") {
  add_class("mw_about_tablet")

  # remove unneeded sections
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")

  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1]") {
    remove()
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class("mw_gray_inner")
    }
  }

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h3")
  }
  $(".//h4") {
    add_class("mw_h4")
  }
  $(".//div[@id='images']/ul") {
    name("div")
    $("./li") {
      name("div")
    }
  }
  $(".//div[@id='page']//ul[not(@id)]") {
    add_class("mw_list1")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='side']") { // sidebar links
    remove(".//div[./div[@id='wayne']]")
    remove(".//div[@class='simple']")
  }

  $about_multiple_sides = "false"
  $(".//div[@id='side'][position()>1]") {
    add_class("mw_testing")
    $about_multiple_sides = "true"
  }
  
  match($about_multiple_sides, /false/) {
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
  }
}
# HSUS-424 : About events page
# http://www.humanesociety.org/about/events

$("./body") {
  add_class("mw_events_tablet")

  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//hr")

  # Add the tablet box2 wrapper
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      remove("./div[@id='feature'][./a[@class='back']]")
      $("./div[contains(@class, 'section s_borderless')]") {
        # for the top jump links
        $("./p[./a[contains(@href, 'about/events/#')]]") {
          add_class("mw_jump_links_wrapper")
          $("./a[contains(@href, 'about/events/#')]") {
            add_class("mw_jump_links")
            $("self::a[contains(@href, 'Lobby_101_Seminars')]") {
              add_class("mw_learn_more")
            }
          }
          remove("./a[contains(@href, 'Lobby_101_Seminars')][position() > 1]")
          wrap_text_children("span") {
            match(inner(), (/\A\s*\Z/)) {
               remove()
            }
          }
        }
        
        # for the bottom events contents
        $("./h2[./a]") {
          add_class("mw_events_title")
          # replace the space behind the h2
          inner() {
            replace(/\s+\Z/, "")
          }
        }
        $("./p[not(contains(@class, 'mw_jump_links_wrapper') or contains(@class, 'date'))]") {
          add_class("mw_events_contents")
        }
        $("./p[./strong]") {
          add_class("mw_events_details_wrapper")
          inner() {
            replace(/^<strong>/,"<span class='mw_events_details'><strong>")
            replace(/\s<strong>/,"</span><span class='mw_events_details'><strong>")
            replace(/$/, "</span>")
          }
        }
      }
    }
    # side bar
    $(".//div[@id='side']") {
      $("./ul") {
        add_class("mw_sidebar1_h")
      }
    }
  }
  # Fix for HSUS-481
  $(".//form[@name='UserDetail']") {
   # add_class("mw_hide")
  } 
  # End of HSUS-481
}
# end of HSUS-424
# In Your State page, only using the News section
# http://mlocal.humanesociety.org/about/state/

# January 27 2013 Sarah LaFrance

$("./body") {
  add_class("mw_state_tablet")


  # remove stuff
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@class='simple']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")

  # Move the masthead outside the page and wrap
  $(".//div[@class=' mw_masthead']") {
    move_to("//div[@id='wrapper']", "top")
  }

  $(".//div[@id='page']") {

    $(".//h2/strong") {
      text() { }
      add_class("mw_h1")
    }
    $(".//h3/a") {
      add_class("mw_h3")
    }

    add_class("mw_gray_inner")
    wrap("div", class:"mw_box2_tablet")
    move_here(".//div[@id='main']/*")

    $(".//p[@class='lead']") {
      remove("./a[1]") // link leads to this page
      $(".//a") {
        attribute("class", "mw_bar3")
        inner() {
          replace( /\s.\s/, "") // remove extra raquo
        }
      }
    }

    $(".//div[@id='feature']") {
      insert("p") {
        move_here("../preceding-sibling::div/p/a")
      }
    }

    move_here(".//div[contains(@class, 'area-news')]/*")

    $(".//ul[not(@id='tools')and not(@id='share_bar')]") {
      add_class("mw_news_items")
      $(".//li") {
        insert("div", class:"mw_title") {
          move_here("../p[@class='date']")
          move_here("../h3")
        }
      }
    }
    remove(".//div[@id='contentDiv']")
  }
}
# About main page
# http://www.humanesociety.org/about
# using mockup 02-animals_kk

# January 22, 2013 Sarah LaFrance

# About section still needs some tweaks, tritium and styling needs to be
# combined and streamlined into better files

$("./body") {
  add_class("mw_about_tablet")

  # remove unneeded sections
  remove("./script") // just trash all the javascript for now
  remove("./link") // logos
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  $(".//p[contains(@class, 'subhead') and not(node())]") {
    remove()
  }

  $(".//br") {
    inject_after(" ")
    remove()
  }
  $(".//a[contains(@class, 'more')]") {
    inject("  &raquo;  ")
  }
  $(".//p[string-length(text())=1 and not(*)]") { // this may be overpowered, keep an eye on it
    # it's ONLY intended to remove whitespace-only p tags
    remove()
  }

  $(".//div[@id='page']") {
    remove("./div[not(@id)]") // empty
    move_here(".//div[@class=' mw_masthead']", "top")

    # top navigation
    $(".//div[@id='page-head']") {
      move_here(".//ul//ul") { // grab the subcategory list from the main nav
        $("./li/a") {
          add_class("mw_bar3 mw_h3")
        }
        add_class('mw_flex_box')
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
        insert_after("ul", class:"mw_flex_box") {
          move_here("preceding-sibling::ul[1]/li[position()>3]")
        }
      }
      remove("./h1")
      remove("./ul[@id='site-nav']")
      remove("./div")
    }

    # main content
    $("./div[@id='contentDiv']") {
      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//h2") {
        add_class("mw_h2")
      }
      $(".//h3") {
        add_class("mw_h3")
      }
      $("./div[@id='head']") { // top big image
        remove(".//div[@id='top_band']")
        name("img")
        # attribute("src", "http://www.humanesociety.org/assets/images/page-head/about_us.jpg")
      }

      remove(".//img[@id='head']")

      $(".//p[@class='subhead']") {
        add_class("mw_h2")
      }
      $(".//h2") {
        add_class("mw_h3")
      }
      $(".//h4") {
        add_class("mw_h4")
      }

      $(".//div[@id='main']") {
        remove("./div[not(@class)]")
        
        add_class("mw_gray_inner")
      }

      $("./div[@id='cols']") { // main content
        add_class("mw_box2_tablet")

        $(".//div[@class='section']") {
          move_here("//ul[@id='tools']", "top") {
            # HSUS 117 - align social share icons
            match($path, /^\/about\/contact\//) {
              add_class("mw_faq_share")
            }
          }
        }

        $(".//div[@id='features']") { // list of articles
          $(".//h3") {
            text() { } // strip a tags
            add_class("mw_h2")
          }
          $(".//li") {
            wrap_together("./p", "div") {
              add_class("mw_flex_box")
              $("./p[not(@class)]") {
                add_class("mw_flex_box_item_1")
              }
            }
          }
          
        }

        $("./div[@id='side']") { // sidebar links
          remove(".//div[./div[@id='wayne']]")
          remove(".//div[@id='state']")
          remove(".//div[@class='simple']")

          $(".//ul[@id='action']") {
            add_class("mw_sidebar1_h")
          }

          $("./ul") {
            add_class("mw_flex_box")
            $("./li") {
              add_class("mw_flex_box_item_1")
            }
          }
        }
      }
    }
  }
}
# About FAQ page
# http://www.humanesociety.org/about/contact/frequently_asked_questions.html
# http://www.humanesociety.org/about/contact/

# January 24, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_faq")

  $(".//li") {
    inner() {
      replace(/\xC2\xA0/, "")
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='contentDiv']") {
    remove(".//div[@id='head']")
  #   $(".//div[contains(@class, 's_borderless')]") {
  #     move_here("preceding-sibling::div/a")
      remove(".//ul[@id='tools']")
      remove(".//p[@class='author']")

      $(".//a[@class='back']") {
        inner() {
          prepend("  &laquo;  ")
        }
      }

      $(".//p[.//strong]") {
        add_class("mw_subcats")
      }

  #     remove("preceding-sibling::div")

  #     $(".//p[contains(@class, 'subhead')]") {
  #       add_class("mw_h2")
  #       insert_after("div", class:"mw_blubox") {
  #         move_here("../h3/following-sibling::p[1]")
  #         move_here("../h3")
  #         $("./h3[1]") {
  #           move_to("..", "top")
  #         }
  #         $("./p[2]") {
  #           move_to("..", "bottom")
  #         }
  #       }
      }

  #     remove(".//div[@class='mw_blubox' and not(node())]") // remove the top box if empty

  #     # pull up misplaced ps
  #     move_here(".//div[contains(@class, 'last')]/p")

  #     $("./p[./a[@name]]") {
  #       wrap("div", class:"mw_answer")
  #     }

  #     $("./*[not(@class='mw_answer') and not(@class='back')]") {
  #       move_to("./preceding-sibling::div[@class='mw_answer']")
  #     }

  #     # set up accordions
  #     $("./ul") { // link togglers
  #       $("./li") {
  #         attributes(data-ur-set:"toggler")
  #         $("./a") {
  #           name("div")
  #           attributes(data-ur-toggler-component:"button", class:"mw_bart")
  #         }
  #         insert("div") {
  #           attributes(data-ur-toggler-component:"content")
  #           move_here("../../following-sibling::div[@class='mw_answer'][1]")
  #           $(".//p[./a[@name]]") {
  #             remove() // the restating of the question is redundant now
  #           }
  #         }
  #       }
  #     }
  #   }
  # }

  $(".//div[@id='page-head']/ul") {
    remove(".//li")
    move_here("//p[@class=' mw_subcats']/a")
    remove("//p[@class=' mw_subcats']")
    $(".//a") {
      wrap("li", class:'mw_flex_box_item_1')
      add_class("mw_bar3")
    }
  }

  $(".//div[@id='side']") {
    $("./ul") {
      add_class("mw_sidebar1_h")
    }
    remove("./div[@id='related-content']")
  }
}
# About leadership page
# http://www.humanesociety.org/about/leadership
# all subpages
# http://mlocal.humanesociety.org/about/leadership/executive_staff/wayne_pacelle.html
# http://mlocal.humanesociety.org/about/leadership/board/hsus_board_directors.html

# April 8, 2013 Sarah LaFrance

$("./body") {
  add_class("mw_leadership")

  remove(".//li/form")
  remove(".//li[@id='signup']/p")
  remove(".//div[./div[@id='wayne']]")
  remove(".//div[@id='sortby']") // suppressed on the desktop
  remove(".//em[not(node())]")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='main']") {
    remove(".//div[@class='toolsSpacer']")

    $(".//h1") {
      attribute("class", "mw_h1")
    }
    $(".//h2") {
      attribute("class", "mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }

    $(".//div[@class='pagination']") { // search box
      add_class("mw_search1")
      $(".//label") {
        add_class("mw_flex_box")
        wrap_text_children("span")
      }
      $(".//input") {
        add_class("mw_flex_box_item_2")
      }
      $(".//button") {
        add_class("mw_btn5")
        text() {
         clear()
        }
      }
    }

    $(".//div[contains(@class, 's_borderless')]") {
      $("./p[position() mod 2=0]") { // get all the names so we can remove brs
        wrap_text_children("span")
      }
      # ticket HSUS-172
      # http://humanesociety.org/about/leadership/board/hsus_board_directors.html
      match($path, /^\/about\/leadership\/board\/hsus_board_directors/) {
        $("./p/br") {
          add_class("mw_keep")
        }
      }
      $(".//em") {
        move_to("preceding-sibling::span[1]")
      }
      $("./p/span[@style]") {
        remove(".//@style")
      }
    }

    $(".//li[@class='image']") { // person entry
      insert_top("div", class: "mw_flex_box") {
        move_here("..//p[@class='image']//img")
        move_here("..//h2") {
          wrap("div", class: "mw_text mw_flex_box_item_1") {
            move_here("ancestor::li[@class='image']//p")
          }
        }

      }
      remove(".//p[@class='image']")
      $("./ul") {
        add_class("item-list") // ticket HSUS-172
      }
      $(".//li[@class='more']/a") {
        inject("  &raquo;  ")
      }
    }
  }

  remove(".//br[not(contains(@class, 'mw_keep'))]")
}
# HSUS 167 popup to add to the home screen
$("./head") {
  insert_bottom("script", type:"text/javascript") {
    text("var addToHomeConfig = {touchIcon:true, expire:525600, message:'Add HumaneSociety.org to your <strong>iPhone&apos;s</strong> home screen. Tap the %icon button &amp; choose &apos;Add to Home Screen&apos;.'};")
  }
  insert_bottom("script", src:asset("javascript/add2home.js"))
  $("./title") {
    text("HSUS")
  }
}

# Place holder/example file
$("./body") {

  $(".//div[@id='page']") {

    # Flex box for the side-by-side content
    insert_top("div", class:"mw_flex_box") {
      move_here("..//li[@id='donate']", "top") {
        #wrap("div", class:"mw_two_col")
        name('div')
        add_class('mw_box5 mw_flex_box_item_1')

        $("./a[1]") {
          add_class("mw_donate_title")
        }


        $(".//form//label") {
          move_here("./input[@type='radio']", "top")
        }

        # contextual_keyboard(".//input[@type='text']", "numeric")
        contextual_keyboard(".//input[@type='text']", "number")

        $(".//input[@id='payment-other']") {
          attribute("size", "5")
        }
        $(".//button") {
          add_class("mw_btn3")
          text("Donate")
        }
        $(".//div[@id='give_another_way']/a") {
          add_class("mw_btn3")
          text("Give another way")
        }
      }

      move_here("..//ul[@id='site-nav']", "top") {
        #wrap("div", class:"mw_two_col")
        add_class("mw_box2 mw_flex_box_item_1")
        name("div")

        $('./li') {
          name("div")
          add_class("home_menu_nav_bar")
        }
      }
    }
    

    # remove("./div[@id='page-head']")
    
    # Carousel ? 
    # move_here(".//ul[@id='billboard']", "top") {
    #   wrap("div", data-ur-set:"carousel", data-ur-carousel-component:"view_container", class:"mw_masthead")
    #   attribute("data-ur-carousel-component", "scroll_container")
    #   name("div")
    # 
    #   $("./li") {
    #     name("div")
    #     attribute("data-ur-carousel-component", "item")
    #   }
    # }

    move_here(".//div[contains(@class, 'mw_carousel_content_mobile')]", "top") {
      wrap("div", data-ur-set:"carousel", data-ur-fill:"1", data-ur-autoscroll:"enabled", data-ur-autoscroll-delay:"5000", data-ur-autoscroll-dir:"next" ,data-ur-carousel-component:"view_container", class:"mw_masthead mw_carousel") {
        insert_bottom("span", data-ur-carousel-component:"dots")
      }
      
      attribute("data-ur-carousel-component", "scroll_container")

      $("./div") {
        attribute("data-ur-carousel-component", "item")
        
        $("./div | ./a") {
          add_class("mw_content_text")
        }
      }
    }

    # Main content articles

    $("./div[@id='contentDiv']/div[@id='cols']") {
      add_class("mw_box2")
      $(".//ol/li") {
        insert("div", class:"mw_article_content") {
          move_here("./parent::li/h2")
          move_here("./parent::li/p[not(@class='image')]") {
            $("./a") {
              add_class("mw_bar1")
            }
          }
          
        }
      }
      # HSUS-436-START:(Mobile & Tablet) Minor spacing issues on homepage
      $("./div[@id='main']/img") {
        add_class("mw_hide")
      }
    }
    $(".//div[contains(@class,'area-news')]/div[position() = 1]") {
      remove("./@style")
      add_class("mw_news_heading")
    }
    # HSUS-436-END
    # HSUS-430 News Feed
    $(".//div[@id='cols']") {
      # Twitter/Facebook left hand feed , also HSUS-430 News Feed / News Brief
      $(".//div[@class='section simple area-news'] | .//div[@class='section news-brief-home-page s_borderless']") {
        #section news-brief-home-page-inner s_borderless
        add_class("mw_box2")

        # Make the connect link a bar_1
        $("./a[@class='more']") {
          add_class("mw_bar1")
        }

        # Change the H3 to something else.. because it is getting globally styled
        $(".//h3") {
          name("p")
          attribute("class", "mw_community_content")
        }

        # Give the divs wrapping the feeds names so we can sort the facebook first
        $(".//a[contains(@href, 'facebook')]/ancestor::div[not(@id)][1]") {
          add_class("mw_facebook_feed")
        }
        $(".//a[contains(@href, 'twitter')]/ancestor::div[not(@id)][1]") {
          add_class("mw_twitter_feed")
        }
        $(".//div[@class=' mw_twitter_feed']") {
          # comment out for HSUS-216: on mock up twitter feeds comes first
          # move_to("..", "bottom")
        }

        # Move Connect to bottom
        $(".//a[@class='more mw_bar1']") {
          move_to("..", "bottom")
        }

        # Remove the image
        remove(".//p[@class='image']")

        # Move the social feed to the top of #main 
        move_to("./ancestor::div[@id='cols']", "after")
      } 
    }
    # Truncate any news posts beyond 3
    remove(".//div[contains(@class, 'area-news')]//li[position()>3]")
    remove(".//div[contains(@class, 'news-brief-home-page')]//li[position()>3]")

    # End HSUS-430
    
    $("./div[@id='contentDiv']") {
      insert("div", class: "mw_flex_box") {
        # Signup stuff
        move_here("..//ul[@id='action']") {
          name("div")
          add_class("mw_box3 mw_flex_box_item_1")
          $("./li") {
            name("div")

            $(".//button") {
              add_class("mw_btn3")
            }

            contextual_keyboard(".//input[@id='cons_email']", "email")
            contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")
          }
        }

        # Wayne's Blog
        move_here("..//div[@id='wayne']") {
          add_class("mw_box4 mw_flex_box_item_1")
          #HSUS-450
          #$("./a[@id='podcastbutton1a']") {
          #  insert("img", src: asset("images/waynes_podcast.png"),class: "images-waynes_podcast")
          #}
          #END HSUS-450
        }
      }
      $("./div[@id='cols']/div[@id='main']/ol[@id='headlines']/li") {
        add_class("mw_flex_box")
        $("./div[@class='mw_article_content']") {
          add_class("mw_flex_box_item_1")
        }
      }
    }

    $(".//div[@id='foot']") {
      remove("./@style")
    } 
  }
}
# common news tritium
# imported into article, news, press pages

# Sarah LaFrance March 25

$("./body") {
  add_class("mw_news_main")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length(text())= 1][not(./a)][not(@class='image')]")
  remove(".//div[@id='petfinder-promo']")
  # remove(".//div[@id='side']")


  $(".//div[@id='wrapper']") {
    # move_here(".//div[@id='contentDiv']/div[1]", "top")
  }

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//p[@class='subhead']") {
      add_class("mw_h2")
    }
    $(".//p[@class='author']") {
      add_class("mw_h3")
    }
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      wrap_text_children("span")
    }
    $(".//button") {
      add_class("mw_arrow_btn")
      text() {
        clear()
      }
    }
  }

  $(".//div[contains(@class, 's_borderless')]//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }


  # remove the width and height of the youtube video
  $(".//iframe[contains(@src, 'youtube')]") {
    attributes(width:"100%", height:"")
  }
  # for brightcove experiences
  $(".//object[@class='BrightcoveExperience']") {
    remove("param[@name='width']")
  }
  
  # For HSUS-469:(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//ul[@id='action']") {
    add_class("mw_sidebar1_h")
    $("./li[@id='donate']") {
      $("./a[position() = 1]") {
        remove()
      }
    }
  }
  $(".//div[@id='related-content']") {
    add_class('mw_sidebar3')
  }

  # For HSUS-469:(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//div[@id='wayneNews']") {
    add_class("mw_sidebar7")
    insert_top("h2",class:'mw_h2')
    $("./a[@class='more']") {
      text() {
        replace("»    »","»")
      }
    }
  }
  $(".//div[@id='related-content']") {
    $(".//p[@class='more-link']") {
      $("./a[@class='more']") {
        text () {
          replace("»    »","»")
        }
      }
    }
  }

  #Fixed for HSUS-469 :(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//blockquote") {
    $(".//a[@class='more']") {
      text () {
        replace("»    »","»")
      }
    }
  }
  # End of HSUS-469
  $(".//h2[@class='mw_h2']") {
    inner () {
      append("WAYNE'S BLOG")
    }
  }
  # End of HSUS-469

  #Fixed for HSUS-469 :(Mobile & Tablet) Style Page & Map pages in /news/blog
  $(".//div[contains(@class,'s_borderless')]") {
    $("./p[@class='date']") {
      add_class("mw_date")
    }
  }
}

# http://www.humanesociety.org/news/profile/off-duty/off_duty_series.html

$("./body") {
  add_class("mw_off_duty_tablet")
  $("./div[@id='wrapper']/div[@id='page']") {
    # top navigation
    $("./div[@id='page-head']") {
      move_here("./ul[@id='site-nav']/li/ul") {
        add_class("mw_flex_box")
        $(".//li") {
          add_class("mw_flex_box_item_1")
          $(".//a") {
            add_class("mw_bar3 mw_h3")
          }
        }
      }
      remove("./h1 | ./ul[@id='site-nav'] | ./div[.//img[contains(@src, 'mission_statement_text')]]")
      move_to("./ancestor::div[@id='wrapper']/div[contains(@class, ' mw_masthead')]", "after")
    }
    # end of top navigation
    add_class("mw_box2_tablet") 
    # main content
    $("./div[@id='contentDiv']/div[@id='cols']") {
      # more profiles section
      $("./div[@id='main']/div[contains(@class, 'area-news')]/div[contains(@id, 'templatelist')]") {
        $("./p[@class='image']") {
          wrap("div", class: "mw_list_wrap")
        }
        $("./h4") {
          add_class("mw_h4")
        }
        $("./p/a[contains(@class, 'more')]") {
          add_class("mw_bar1")
        }
        $("./p[@class='date'] | ./h4 | ./p[./a[contains(@class, 'more')]]") {
          move_to("./preceding-sibling::div[@class='mw_list_wrap'][1]")
        }
      }
      # end of more profiles section
      # end of donate bar 
    }
    # end of main content
  }
  # side bar
  $(".//div[@id='side']") {
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        add_class("mw_h2")
      }
      $("./div[@class='module'][position() mod 4=1]") {
        wrap("div", class:"mw_flex_box")
      }
      $("./div[@class='module']") {
        move_to("preceding-sibling::div[@class='mw_flex_box']")
      }
      $("./div[@class='mw_flex_box']/div[@class='module']") {
        add_class("mw_flex_box_item_1")
        $("./h3/a") {
          inject("  &raquo;  ")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_contact_us_info_tablet")
  $("./div[@id='wrapper']/div[@id='page']") {
    add_class("mw_box2_tablet")
    remove("./div[@id='page-head']")
    match($path, /forms\/contact\_us\/urban_wildlife\_sanctuary\_contact/) {
      $("./div[@id='contentDiv']/div[@id='inside']/div[@id='head']") {
        remove()
      }
    }
    $("./div[@id='contentDiv']/div[@id='cols']/div[@id='main']") {
      $("./div[contains(@class, 'section')]") {
        $("./h1") {
          add_class("mw_h1")
        }
        $("./h3") {
          add_class("mw_h3")
        }
        $("./p[not(*)][text()]") {
          text() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
        }
        $("./hr") {
          name("div")
          attribute("class", "mw_line")
        }
        $("./p/a[@name] | ./p/strong[./a[@name]]") {
          wrap("div", class:"mw_title") {
            move_here("./following-sibling::strong[1]", "bottom")
          }
        }
        remove("./br | ./h1/br | ./p/br")
        $("./ul") {
          add_class("mw_list1")
        }
      }
    }
    $(".//input[@id='cons_phone' or @id='cons_zip_code']") {
      attributes(type:"tel")
    }
  }
}
# News articles
# http://mlocal.humanesociety.org/news/press_releases/2013/01/wy-ag-gag-hb0126-opposition-011513.html
#

# Sarah LaFrance March 29 2013

$("./body") {
  add_class("mw_article")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//li[@id='pdf']")

  table_dump(".//table")
  
  # HSUS-348
  $(".//div[@id='images']") {
    attributes(data-ur-autoscroll: "disabled")
  }
  
  $(".//div[not(contains(@class,'mw_masthead'))]") {
    remove("@style")
  }

  $(".//div[@id='feature' and a[@class='back']]") {
    remove()
  }

  # clear sidebar in faith articles
  $(".//div[@id='side']") {
    remove("./style")
    remove("./div[contains(@id, '-promo')]")
    remove("./iframe")
    $(".//a[@id='media-contact']") {
      wrap("div", class:"mw_mediaBox")
      inner() {
        replace("2", "  &raquo;  ")
      }
    }
    # HSUS-233 Box styling
    $("./div[@id='related-content']") {
      add_class("mw_sidebar3")
      $("./h2") {
        insert_after("div", class: "mw_flex_box") {
          move_here("./following-sibling::div[@class='module']") {
            add_class("mw_flex_box_item_1")
          }
        }
      }
      $(".//div[contains(@class,'module')]/h3/a") {
        inner() {
          append("  &raquo;  ")
        }
      }
    }
    # end of HSUS-233
  }

  $(".//div[@id='page']/div[@id='contentDiv']//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[contains(@class, 's_borderless')]") {

    $(".//iframe|.//embed") {
      remove("@height")
      remove("@width")
    }
    # HSUS-369 Correct styling on Animal Tips pages
    $("./ul[@class='item-list']/li[@class='image']") {
      $("./p[@class='image']") {
        move_to("preceding-sibling::p[1]","before") {
          add_class("mw_img_content")
        }
      }
      $("./p[@class='related']") {
        move_to("preceding-sibling::p[1]","after")
      }
      $("./ul//a") {
        inject("  &raquo;  ")
      }
    }

    # Kevin's telephone script from the seagate project

    inner() {
      replace(/((\d)*[ ()\-.\d]+\d)/) {
        %orig = %1
        %1 {
          replace(/\s/, "")
        }
        %stripped = %1
        %stripped {
          replace(/\D/, "")
        }
        # ignore access codes
        match_not(length(%stripped), /^[1-8]$/) {
          set("<a href='tel:" + %stripped + "'>" + %orig + "</a>")
        }
      }
    }
    # below is breaking togglers on pigeon problem solver - ticket 381
    # This is for HSUS-361,381,428 When there has a carousel in the accordion
    $("./div[@class='image-scroller']") {
      $carousel_ans = "false"
      $("./ul/li[position() > 1][./p[@class='image']]") {
        $carousel_ans = "true"
      }
      match($carousel_ans, /true/) {
        inner_wrap("div", data-ur-set:"carousel", data-ur-carousel-component:"view_container", data-ur-fill:"1") {
          $("./ul") {
            name("div")
            attributes(data-ur-carousel-component:"scroll_container")
            $("./li") {
              name("div")
              attributes(data-ur-carousel-component:"item")
            }
          }
          insert_bottom("div", data-ur-carousel-component: "dots")
          $("ancestor::div[contains(@id,'answer')][1]") {
            add_class("mw_carousel_ans")
          }
        }
      }
    }
  }
  
  $(".//iframe[contains(@src, 'youtube')]") {
    add_class("mw_youtube_height_fix")
    attributes(width:"100%")
  }

  # handling forms
  $(".//form[@method='POST']") {
    add_class("mw_form_area")
    remove(".//br")

    # re-hide spam control
    $(".//div[label[@for='denySubmit']]") {
      add_class("mw_hide")
    }
  }

  # HSUS-34 Survey table, only restyle it for mobile because the table breaks the viewport.
  match($tablet) {
    with(/false/) {
      $("./div[@id='wrapper']//div[contains(@class,'s_borderless')][./h1/span[contains(text(),'SURVEY')]]") {
        $("./div[contains(@class,'mw_was_table')]") {
          $(".//div[contains(@class,'mw_was_tr')][position() > 1]/div[contains(@class,'mw_was_td')][1]") {
            var("mw_sub_header"+index(), fetch("./text()"))
            add_class(var("mw_sub_header"+index()))
            remove()
          }
          $(".//div[contains(@class,'mw_was_td')][not(*)]") {
            match(text(), (/\A\s+\Z/)) {
              remove()
            }
          }
          $(".//div[contains(@class,'mw_was_tr')][1]/div[contains(@class,'mw_was_td')]") {
            $("./ancestor::div[contains(@class,'mw_was_table')]") {
              insert("div",class:"mw_survey_item") {
                move_here("..//div[contains(@class,'mw_was_tr')]/div[contains(@class,'mw_was_td')][1]")
                $("./div[contains(@class,'mw_was_td')][position() > 1]") {
                  $mw_sub_header_index = index()
                  insert_top("span", var("mw_sub_header"+$mw_sub_header_index) + ":", class: "mw_title")
                }
              }
            }
          }
        }
        # remove &nbsp; , white space
        $(".//p[not(*)] | ./p[./br]") {
          inner() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
          remove("./br")
        }
        # end remove &nbsp; , white space
        remove(".//@style")
      }
    }
  }
  # end of HSUS-34

  $(".//div[@id='side']") {
    $(".//ul") {
      add_class("mw_sidebar1_h")
    }
  }
}
$("./body") {
  add_class("mw_forms_contact_tablet")

  $(".//div[@id='wrapper']") {
    $(".//div[@id='page']") {
      remove(".//div[@id='page-head']")
      remove("./div[@id='contentDiv']/div[@id='head']")
      add_class("mw_box2_tablet")
      $(".//input[@class='Button']") {
        btn_delegate() {
          add_class("mw_btn2 mw_SubmitButton")
          text("SUBMIT")
        }
      }
      $(".//h1") {
        add_class("mw_h1")
      }
      $(".//form") {
        add_class("mw_box5")
      }
    }
  }
}
# common news tritium
# imported into article, news, press pages

# Sarah LaFrance Jan 31 2013

$("./body") {
  add_class("mw_news_base")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  #HSUS-366 Missing Portion of Body on Page
  # remove(".//p[string-length(text())= 1][not(./a)][not(@class='image')]")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='side']/div[@class='simple']")
  # remove(".//br")

  $(".//h1") {
    add_class("mw_h1")
  }
  $(".//h2") {
    add_class("mw_h2")
  }
  $(".//p[@class='subhead']") {
    add_class("mw_h2")
  }
  $(".//p[@class='author']") {
    add_class("mw_h3")
  }

  $(".//div[@id='feature']/a") {
    inject_before("  &laquo;  ")
  }

  $(".//div[contains(@class, 's_borderless')]//h3") {
    add_class("mw_h3")
  }

  $(".//a[@class='more']") {
    inject("  &raquo;  ")
  }


  # remove the width and height of the youtube video
  $(".//iframe[contains(@src, 'youtube')]") {
    attributes(width:"100%", height:"")
  }
  # for brightcove experiences
  $(".//object[@class='BrightcoveExperience']") {
    remove("param[@name='width']")
  }
}

$("./body") {
  add_class("mw_forms_base_tablet")
  # replace * color
  $(".//td") {
    inner() {
      replace(/(\*)/, "<span class='mw_red'>$1</span>")
    }
  }
  # desk top site top nav no exist background
   $(".//div[@id='wrapper']") {
     $header_img = "false"
     $("./div[contains(@class, 'mw_masthead')]") {
       $header_img = "true"
     }
     match($header_img, "false") {
       insert_before("div", class:"mw_new_masthead")
     }
   }
  # end desk top site top nav

  $(".//div[@id='page']") {
    remove(".//div[@id='page-head']")
    remove("./div[@id='page-bottom-spacer']")
    $("./div[@id='contentDiv']") {
      remove("./div[@id='head']")
    }
  }
}
# lots of pages
# http://www.humanesociety.org/news/press
# 

# March 29 2013 Sarah LaFrance

$("./body") {
  add_class("mw_press_tablet")

  # removing
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//div[@id='page-bottom-spacer']")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    $(".//p[@class='subhead']") {
      add_class("mw_h2")
    }
    $(".//p[@class='author']") {
      add_class("mw_h3")
    }
  }

  $(".//div[@id='top-pagination']") {
    add_class("mw_search2")
    $(".//label") {
      add_class("mw_flex_box")
      wrap_text_children("span")
    }
    $(".//input") {
      add_class("mw_flex_box_item_2")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") {
    add_class("mw_sort1")
    attributes(data-ur-set:"toggler")
    $(".//legend") {
      wrap("div"){
        attributes(data-ur-toggler-component:"button")
        insert_top("div", class:"mw_plusminus")
      }
      name("span")
      inner() {
        set("SORT PAGE LISTING") // just hard code it
      }
    }
    wrap_together(".//p", "div") {
      attributes(data-ur-toggler-component:"content")
      $(".//label") {
        wrap_text_children("span") {
          inner() {
            append("  :  ")
          }
        }
      }
    }
  }

  $(".//ul[@class='item-list']/li") { // news entry

    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='side']") {
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
      $(".//h2") {
        add_class("mw_h2")
      }
      $("./div[@class='module'][position() mod 4=1]") {
        wrap("div", class:"mw_flex_box")
      }
      $("./div[@class='module']") {
        move_to("preceding-sibling::div[@class='mw_flex_box']")
      }
      $("./div[@class='mw_flex_box']/div[@class='module']") {
        add_class("mw_flex_box_item_1")
        $("./h3/a") {
          inject("  &raquo;  ")
        }
      }
    }
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
  }
  
}

$("./body") {
  add_class("mw_forms_tablet")
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    remove("./div[@id='contentDiv']/div[@id='article'or @id='inside']/div[@id='head']")
    remove(".//table/@style")
    $("./div[@id='contentDiv']/div[@id='inside']//div[@id='main']/div[@id='features']") {
      add_class("mw_form_features")
      remove("self::div[.//div[@id='flashcontent']]")
      $(".//h3") {
        add_class("mw_h3")
      }
      $(".//ul") {
        name("div")
        add_class("mw_ul")
        $("./li") {
          name("div")
          add_class("mw_li")
          wrap_text_children("span") {
            remove("self::span[contains(text(),'.')]")
          }
          $(".//p[@class='image']/following-sibling::p") {
            wrap("div",class:"mw_download_content") {
              move_here("following-sibling::a") {
                $("ancestor::div[1]") {
                  add_class("mw_download_section")
                }
              }
            }
          }
        }
      }
    }
    $(".//iframe") {
      attribute("src") {
        value() {
          rewrite("link")
        }
      }
      attributes(id:"mw_flick_wrapper", height:"")
    }
    $(".//form") {
      add_class("mw_box5")
    }
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//select/..") {
      add_class("mw_select_arrows")
    }
    $(".//input[@type='submit']") {
      btn_delegate() {
        add_class("mw_btn2 mw_SubmitButton")
        text("SUBMIT")
      }
    }
    $(".//input[@type='reset']") {
      btn_delegate() {
        add_class("mw_btn1 mw_SubmitButton")
        text("RESET")
      }
      $("./ancestor::div[1]") {
        add_class("mw_flex_box_item")
        $("./div") {
          add_class("mw_flex_box_item_1")
        }
      }
    }
    # HSUS-411 Share desktop URLs on Thank You page
    $(".//p[contains(@class, 'simple')]/a[contains(@href, 'facebook')]") {
      attribute("href") {
        value() {
          replace(/m(\w{5})?\./, "")
        }
      }
    }
    $(".//a[contains(@href, 'thankyou/mailto')]") {
      attribute("href") {
        value() {
          replace(/m(\w{5})?\./, "www.")
        }
      }
    }
    # right section
    $(".//div[@id='side']") {
      remove(".//h2")
      $("./ul") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
      $("./div[@id='resources']") {
        $("./ul") {
          add_class("mw_sidebar6")
          $("./li") {
            add_class("mw_flex_box_item_1")
            $("./a") {
              add_class("mw_more")
            }
          }
          $("./li[position() mod 4 = 0]") {
            wrap("ul", class:"mw_ul mw_flex_box") {
              move_here("./preceding-sibling::li")
            }
          }
        }
      }
      $("./div[@id='petfinder-promo']") {
        add_class("mw_hide")
      }
    }
    $(".//div[@id='magazine-promo']") {
      add_class("mw_sidebar7")
       $("./p[@class='allanimalsinclude'][position() mod 4=1]") {
          wrap("div", class:"mw_flex_box")
        }
        $("./p[@class='allanimalsinclude']") {
          move_to("preceding-sibling::div[@class='mw_flex_box']")
        }
        $("./div[@class='mw_flex_box']/p[@class='allanimalsinclude']") {
          add_class("mw_flex_box_item_1")
          $("./a") {
            attributes(class:"more")
          }
        }
        $("./p[@class='more-link']") {
          inject("  &raquo;  ")
        }
        $("./h2") {
          wrap_text_children("span", class:"mw_h2_span")
          remove("./br")
        }
    }
  }
}
$("./body") {
  add_class("mw_news_briefs_tablet")

  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length(text())= 1][not(./a)][not(@class='image')]")
  remove(".//div[@id='petfinder-promo']")
  remove(".//div[@id='side']")

  # top navigation
  $(".//div[@id='page-head']") {
    move_here(".//ul//ul") { // grab the subcategory list from the main nav
      add_class("mw_flex_box")
      $(".//li") {
        add_class("mw_flex_box_item_1")
        $(".//a") {
          add_class("mw_bar3 mw_h3")
        }
      }
    }
    remove("./h1")
    remove("./ul[@id='site-nav']")
    remove("./div")
    move_to("//div[@class=' mw_masthead']", "after")
  }

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

}

$("./body") {
  add_class("mw_whitepapers")

  $(".//div[@id='page-head'] | .//div[@id='head'] | .//div[@id='page-bottom-spacer']") {
    add_class("mw_hide")
  }

  #Add the box2 to the wrapper
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  # The first h3 is an exception.. it is not in a li
  $(".//div[contains(@class, 'section')]/h3") {
    add_class("mw_whitepaper_header mw_bar5")
    attributes(data-ur-toggler-component:"button")
    wrap("div",class: "mw_whitepaper_container", data-ur-set:"toggler") {
      $("./following-sibling::p[1]") {
        remove()
      }
    }
  } 

  $(".//div[contains(@class, 'section')]/li[h3]") {
    move_here("./h3", "after") {
      add_class("mw_whitepaper_header mw_bar5")
      attributes(data-ur-toggler-component:"button")
      wrap("div",class: "mw_whitepaper_container", data-ur-set:"toggler")
    }
  }
  $(".//div[contains(@class, 'section')]/li[a]") {
    add_class("mw_whitepaper_content ")
    move_to("./preceding-sibling::div[contains(@class, 'mw_whitepaper_container')][1]")
  }

  $(".//div[contains(@class, 'mw_whitepaper_container')]") {
    wrap_together("./li", "div", data-ur-toggler-component:"content")
    $("./div/li") {
      name("div")
      $("./a") {
        add_class('mw_bar2')
      }
      
    }
  }

  # Remove the extra <p>'s
  $(".//div[contains(@class, 'mw_whitepaper_container')]") {
    remove(".//p")
  }

}
# main news QA page
# http://www.humanesociety.org/news/resources/qa
# scss is using _press.scss

# April 2 2013 Sarah LaFrance
# only real change is to top pagination to fix the weird sorting issue

$("./body") {
  add_class("mw_press mw_qa")

  # removing
  remove(".//div[@id='page-head']")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='top-pagination']") {
    add_class("mw_search1")
    $(".//label") {
      wrap_text_children("span")
    }
    $(".//button") {
      add_class("mw_btn5")
      text() {
        clear()
      }
    }
  }

  $(".//div[@id='sortby']") { // this section is hidden with styles but we need to re-hide it
    add_class("mw_no_display")
  }

  $(".//ul[@class='item-list']/li") { // news entry
    match($path, /State_Directors/) {
      move_here("./p[contains(@class, 'image')]", "top") {
        name("div")
        attributes(class: "mw_image_p")
        wrap("div", class: "mw_flex_box")
      }
      $("./h2") {
        wrap("div", class: "mw_text mw_flex_box_item_1")
      }
      $("./div[contains(@class, 'mw_text')]") {
        move_here("following-sibling::p")
      }
      $("./div[contains(@class, 'mw_flex_box')]") {
        move_here("following-sibling::div[contains(@class, 'mw_text')]")
      }
    }
    $(".//p[@class='related']") {
      wrap_text_children("span")
    }
    $(".//p[@class='image']") {
      move_to("../p[contains(@class, 'author')]", "after")
    }
    $(".//ul") { // more link
      move_to("..", "bottom")
      $(".//a") {
        inject("  &raquo;  ")
      }
    }
  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  $(".//div[@id='bottom-pagination']") { // next page etc.
    $(".//table") {
      $(".//td") {
        name("div")
      }
    }
    move_here(".//table//div")
    remove(".//table")
    remove(".//div[@class='pg-items']")
    # test for presence of previous and next arrows to determine end cases
    # then remove the surrounding page numbers to save room
    $current = fetch(".//div[@class='pg-curr']/text()")
    $previous = "false"
    $next = "false"
    $(".//div[@class='pg-prev']") {
      $previous = "true"
    }
    $(".//div[@class='pg-next']") {
      $next = "true"
    }

    $("./div[@class='pg-curr']") { 
      insert_before("div", class:"mw_pages") {
        move_here("../div[not(@class='pg-prev') and not(@class='pg-next')]")
      }
    }

    $(".//div[@class='pg-prev']/a") {
      inner() {
        prepend("  &laquo;  ")
        replace("ious", "")
      }
    }
    $(".//div[@class='pg-next']/a") {
      inner() {
        append("  &raquo;  ")
      }
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $("./ul") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
    }

    $(".//div[@id='related-content']") {
      add_class("mw_sidebar3")
    }
  }
  # HSUS-305 Line breaks on Pets News Page
  # URL: http://www.humanesociety.org/animals/pets/news.html
  match($path,/^\/animals\/pets\/news\.html/) {
    $(".//div[contains(@class,'simple')]") {
      add_class("mw_pet_news")
      $("./ul/li[./p[@class='image']]") {
        add_class("mw_pet_news_li")
      }
    }
  }

}
$("./body") {
  add_class("mw_gigya_login_tablet")

  $(".//div[@id='contentDiv']") {
    add_class("mw_box2_tablet")
  }
}
$("./body") {
  add_class("mw_tellafriend_tablet")
  $("./div[@class='mw_header']") {
    add_class("mw_hide")
  }
  $("./div[@id='ga-container']/div[@id='ga-content']") {
    move_here(".//div[@id='ga-header']", "top") {
      move_here("./following-sibling::table[1]//div[@id='action-alert' or @class='appArea']", "after") {
        attribute("class", "mw_box2_tablet")
        remove(".//@style")
        remove("./div[@class='showondesktop']")
        $("./h2") {
          attribute("class", "mw_h2")
        }
        $("./h3") {
          attribute("class", "mw_h3")
        }
        $("./div[contains(@class, 'taf-share-container')]") {
          add_class("mw_flex_box")
          $("./a") {
            wrap("span", class: fetch("./@class")+" mw_flex_box_item_1")
            remove(".//textarea/@cols")
            insert_bottom("span", fetch("./@class"), class:"mw_share_text") {
              text() {
                replace(/\w+_/, "SHARE ON ")
                replace("facebook", "FACEBOOK")
                replace("twitter", "TWITTER")
                replace("ON email", "VIA EMAIL")
              }
            }
          }
        }
        $("./div[@class='supertaf-donate-section']/div[@class='supertaf-donate-form']/form[@id='taf-donate']") {
          $("./div[@class='supertaf-donate-text']") {
            insert_top("div", "DONATE NOW", class:"mw_donate_title")
            // Fix for HSUS-510 Tablet
            wrap_text_children("div") {
              add_class("mw_donate_details")
              move_to("ancestor::body//div[@class='mw_donate_title']","bottom")
            }
            // Fix for HSUS-510 Tablet
          }
          $("./div[@class='supertaf-donate-amounts']") {
            $("./input[contains(@id, 'supertaf-amount')]") {
              wrap("div", class:"mw_amount")
            }
            $("./label | ./input[@id='supertaf-box']") {
              move_to("./preceding-sibling::div[@class='mw_amount'][1]", "bottom")
              $("./self::input[@id='supertaf-box']") {
                attribute("onclick", "document.getElementById('supertaf-amount-other').checked = true;")
              }
            }
            $("./input[@class='supertaf-donate-button']") {
              btn_delegate() {
                attribute("class", "mw_btn2")
                inner("CONTINUE")
              }
            }
          }
        }
        # HSUS-373
        # $("./div[@id='share_bar']") {
        #   add_class("mw_new_tell_a_friend")
        #   $(".//a[./img[@alt='Donate now']]") {
        #     add_class("mw_donate_now")
        #   }
        #   $(".//a") {
        #     insert("span", fetch("./img/@alt"))
        #     remove("./img")
        #   }
        # }
        # share logos
        $(".//div[@id='share_bar']") {
          add_class("mw_share_logos")
          remove("@id")
          # move_here(".//a")
          # remove("./table")
        }
        
        $("./div[@class='custom-twitter-share-text']") {
          add_class("mw_hide2")
        }
        # HSUS-427 Remove Excess White Space on Alert 5699's Thank You Page
        $("./iframe[contains(@src, 'glitternetwork')]") {
          add_class("mw_hide2")
        }
      }
    }
    $("./div[contains(@class, '_footer')]") {
      move_here("./preceding-sibling::table[1]//div[contains(@class, '_footer')]/div[@id='foot']", "top") {
        $("./ul/li") {
          attribute("class") {
            value() {
              replace(/\w+\s/, "")
            }
          }
        }
      }
    }
    remove("./table")
  }
  remove("./div[.//img[@alt='Powered By Convio']]")
}
$("./body") {
  add_class("mw_st_francis_box")

  $("./div[@id='wrapper']") {
    $("./div[@id='page']") {
      remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style] | ./br")
      $("./div[@id='contentDiv']/div[@id='cols']") {
        add_class("mw_box2") 
        $("./div[@id='main']/div[@id='wrapper-body']") {
          remove("./@style")
          # share
          $("./ul[@id='share_bar']/li/img[@class='share_image']") {
            name("span")
            insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
            remove()
          }
          # end share
          
          # toptext
          $("./div[@id='francis-toptext']") {            
            # removing all toptext style
            $("./*") {
              remove("@style")
            }
            
            $("./div[@id='francis-title']/h1") {
              add_class("mw_h2")
            }
            
            $("./div[a]") {
              attribute("id","mw_topic_photo")
            }
            
            #form title
            $("./p[position() = last()]"){              
              add_class("mw_h3")
              move_to("../../form","top")
            }
            
            $("./ul") {
              wrap("div") {
                attribute("id","mw_topics")
                move_here("./preceding-sibling::p[1]","top")
              }  
            }
            insert("div") {
              attribute("class","mw_topic")
              move_here("../div[@id='mw_topic_photo' or @id='mw_topics']")              
            }
          }
          # end toptext
          #form
          $("./form") {
            attribute("class","mw_st_form")
            $("./div[@id='chimps-bottom-elements']//input | ./div[@id='chimps-bottom-elements']//textarea") {
              remove("@style")
            }            
            $(".//input[@type='text'] | .//select") {
              add_class("mw_input")
            }
            $(".//input[@class='francis-submit-button']") {
             add_class("mw_btn1")
             wrap("div") {
               attribute("class","mw_submit_btn")
             }
            }
            $(".//div[@id='fields-input-boxes']/label[@class='francis-text-label']") {
              insert_after("span") {
                attribute("class","mw_spacer")
              }
            }
          }
          #
          
          $(".//script[contains(text(),'validate(')]") {
            text() {
              replace(/insertBefore/,"insertAfter")
            }            
          }
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_splash_mobile")

  $(".//table"){
    add_class("mw_splash_table")
    remove("@style")
    table_dump(".")
  }

  $(".//div[contains(@class, 'mw_splash_table')]"){
    $("./div/div/div/div/h3"){
      add_class("mw_splash_header")
    }
  }

  $(".//p[contains(@class, 'mw_donate_info')][last()]"){
    insert_after("div", class:"mw_donateButtons_wrapper"){
      move_here("//a[contains(@class, 'mw_donate_link')]")
    }
  }

  $(".//div[@class='mw_donateButtons_wrapper']/a[2]/img[@alt='donate now']/.."){
    move_to("../../p[contains(@class, 'mw_donate_info')][1]", "before")
    wrap("p", class:"mw_donate_info")
  }

  $(".//param[@name='movie']/../.."){
    remove("@style")
    add_class("mw_video_container")
  }

}
$("./body") {
  add_class("mw_site_donate")

  # Remove the header image
  #remove(".//div[@id='ga-header']") #HSUS-482
  remove(".//div[@id='ga-header']/img") #HSUS-524


  $(".//*[contains(@style, 'padding')]") {
    remove("./@style")
  }

  # Main donate form
  $(".//div[@id='donate-form']") {
    add_class("mw_box2")

    
    

    # center the one time gift image
    $(".//img[contains(@alt, 'one time gift')]/ancestor::td") {
      add_class("mw_one_time_gift_center")
    }

    #HSUS-230, Remove thermometer image.
    remove(".//div[@id='seal-thermometer']")

    # This might fix the images not displaying on older devices
    # the src looked something like src="////secure.humanesociety.org///../images/content/pagebuilder/19930.png"
    fixImages()

    # HSUS-524
    # Placed after fixImages() so that the "Or Make a One-time Gift" on
    # secure.humanesociety.org/site/Donation2?df_id=2320&2320.donation=form1&s_src=web_topnav_monthly
    # does not look weird
    bm("moving #donation-top into #donation-form") {
      move_here("./ancestor::div[@id='page-content']/preceding-sibling::div[@id='ga-header']/div[@id='donation-top']", "top")
    }
  }

  $(".//h3[img]/ancestor::td[1]") {
    add_class("mw_donate_desc")
    remove("@width")
    remove("@height")
  }

  # Move the hero imge to after the h3 tag
  $(".//h3/img[contains(@src,'jpg')]") {
    add_class("mooved")
    move_to("..", "after")
    remove("@width")
    remove("@height")
  }
  
  $(".//td[img]/..") {
    remove("./td[@id='caption']")
    $("./td") {
      add_class("mw_monthly_donation_desc")


      #move_here("./img", "top")
      $("./img[contains(@alt,'PayPal')]") {
        # fix for HSUS-511
        remove("./@src")
        add_class("images-pp_c_mark")
        # move_to("../..", "top")
      }
    }
    # Merge the header stuff into one td
    $("./td[1]") {
      move_here("../td[2]/*")

      $("./table") {
        remove("./@style")
      }
    }

  }

  # for the monthly donation form, to move the image below the h3 tag
  $(".//td[h3]/img[contains(@src, 'jpg') and not(@class)]") {
    add_class("mw_image_pad")
    # move_to("../..", "top")
    move_to("../h3", "after")
    # $("./following-sibling::p[1]") {
    #   add_class("mw_testing")
    # }
  }

  $(".//td/img[contains(@src, 'jpg') and not(@class)]") {
    add_class("mw_image_pad_float")
    move_to("..", "top")
  }

  # For the puppy mill page and similar
  $(".//td/div[@style and img]") {
    # Remove styling on the Div
    add_class("mw_captioned_img_styling")
    remove("@style")
  }

  # Hide pixel tracking
  $(".//div[@class=' mw_captioned_img_styling'][./img[contains(@src, 'googleadservices')]]") {
    add_class("mw_hide")
  }

  # Match <p>'s that only have &nbsp;
  #$(".//p | .//td") {
    # inner(){
    #   replace(/\xC2\xA0/, "")
    # }
  #}
  # match($text) {
  #   with(/\xC2\xA0/) {
  #     add_class("mw_testing")
  #   }
  # }

  # Humane card form
  $(".//img[contains(@alt, 'humane') and contains(@alt, 'card')] | .//img[@alt=' ']") {
    # add_class("mw_testing")

    $("./ancestor::table[1]") {
      # add_class("mw_testing")
      attribute("align", "center")

      $("./parent::td") {
        add_class("mw_card_center")
      }
    }
  }

  $(".//form[@id='ProcessForm']") {
  # Fix for HSUS-482
    #add_class("mw_box5")

    $(".//tbody[contains(@id, 'level-standard')]") {
      #HSUS-457: Start;
      $("./tr[@class='donationRepeatRowBefore']") { 
        add_class("mw_repeat_payment")
      }
      $("./tr[@class='FormRow' and contains(@id, 'level_standardauto_repeat_Row')]") { 
        add_class("mw_repeat_payment")
      }
      $js = "
      $(document).ready(function() {
       //$(\"table tr[class='donationRepeatRowBefore']\").remove();
       //$(\"table tr[id='level_standardauto_repeat_Row']\").remove();

       $(\"tbody tr[class='donationRepeatRowBefore']\").appendTo( $(\"tbody[id='level-standard.75156']\") );
       $(\"tbody tr[id='level_standardauto_repeat_Row']\").appendTo( $(\"tbody[id='level-standard.75156']\") );
       //$(\"input[id='level_standardauto_repeatname']\").appendTo( $(\"tbody[id='level-standard.75156']\") );

       //$(\"table tr[class='donationRepeatRowBefore']\").appendTo('table');
       //level-standard.75156

       //$(\"table[id='level-standard.75156'] .row:first\").remove().insertAfter($(\"table[id='level-standard.75156'] .row:last\"));

       //alert('done');
       });
"
# insert_javascript( $js )
      #HSUS-457: End;
      $("./following-sibling::tbody[1]") {
        add_class("mw_donation_note")
        
      }
      move_here("./following-sibling::tbody[contains(@class, 'mw_donation_note')]") {
        name("div")
      }
    }

    # Provide a way to limit the size of the labels of the radio buttions
    $(".//label[@class='RadioGroupLabel']/..") {
      add_class("radioGroupLabeltd")
    }

    # $(".//tbody[contains(@id, 'level-standard')]/following-sibling::tbody[1]") {
    #   add_class("mw_testing")
    #   $("./preceding-sibling::tbody[contains(@id, 'level-standard')]") {
    #     add_class("mw_testing")
    #   }
    #   # move_to("../preceding-sibling::tbody[contains(@id, 'level-standard')]")
    #   move_to("./ancestor::table[1]//tbody[contains(@id, 'level-standard')]")
    # }
  }

  # This should select the donation form table, first row
  $(".//tr[@class='FormRow'][1]") {
  # $(".//tbody[@class='FormRow'][1]//") {

    # Move the "Select Gift Amount away from the first option"
    # Fix for HSUS-482
    #insert_before("tr", class:"FormRow mw_gift_desc") {
      move_here("./following-sibling::tr[1]/td[@class='FormLabel']") {
        # Change the attribute so that we can hide the empty 
        # .requiredIndicator and .FormLabel <td>'s
        attribute("class", "mw_formlabel")
      }
    #}
    # End of HSUS-482
  }

  # bump down the radio button for the "other" donation amount
  $(".//input[@class='DonationLevelOtherAmount']/ancestor::tr[1]//input[@type='radio']") {
    add_class('mw_radio_alignment')
  }

  $(".//tbody[contains(@id, 'html-caption')]//td[@class='FormCaption']/p") {
    remove("./@style")
    add_class("mw_donation_info")
  }



  # Shift the .requiredIndicator (*) to the description
  $(".//tbody[contains(@id, 'billing') or contains(@id, 'email') or contains(@id, 'Recipient') or contains(@id, 'City') or contains(@id, 'Sender_Signature') or contains(@id, 'Zip_Code')]//td[@class='requiredIndicator']") {
    #add_class("mw_testing")
    move_to("./../preceding-sibling::tr[1]", 'top')
  }

  # Remove the [x] images from the errors, so that the text can be red instead
  remove(".//tr[@class='holdsErrorMsg']//img")

  # Remove the width="100%" from the error message
  $(".//tr[@class='holdsErrorMsg']/td[@class='FormInfoMsg']") {
    remove("./@width")
  }

  # Evenly space out the Credit card types
  $(".//tr[@id='payment_typecc_type_Row']/td[@class='FormInput']//table[1]") {
    add_class("mw_credit_card_flex")
  }

  # Improve the look of the credit card form
  $(".//td[@class='FormInput'][input]") {
    add_class("mw_donate_clear")
  }
  
  # Make the seals easier to deal with for CSS
  $(".//script[contains(@src, 'verisign')][1]/ancestor::table[1]") {
    add_class("mw_seals")
    remove("@height")
    # HSUS-230, align icons
    $("./ancestor::tr[@class='FormRow']") {
      add_class("mw_seals_center")
    }
  }
  $(".//div[@id='othergive']/following-sibling::table[contains(@class, 'mw_seals')]") {
    # attributes(class: "mw_bottom_seal", align:"center")
  }

  # Locate the other.. seal
  /*$(".//script[contains(@src, 'verisign')][2]/ancestor::table[1]") {
    add_class("mw_bottom_seals")
    # move_here("")
    }*/

    $(".//div[@id='vs_seal']/..") {
      attribute("id", "vs_seal_wrapper")

      $("./ancestor::table[1]/..") {
        attribute("id", "mw_bottom_seal")
      # name("div")
    }
  }

  # Make the Donate button pretty
  $(".//tbody[contains(@id, 'buttons')]") {
    $(".//td[@align='right']") {
      attribute("align", "center")
      # log("Does the image button exist?")
      # log($(".//ancestor::tbody[1]/following-sibling::tbody[1]//img[contains(@src, 'xdonation_form_submit')]"))
      
      match($(".//ancestor::tbody[1]/following-sibling::tbody[1]//img[contains(@src, 'donation_form_submit')]")) {
        with(/0/) {
          log("Image button exists for donation form, hiding #pstep_finish")
          $(".//input[@id='pstep_finish']") {
            remove("./@onmouseover | ./@onmouseout")
            add_class("mw_btn2")
            attribute("value", "Submit")
          }
        }
        else() {
          $(".//input[@id='pstep_finish']") {
            log("Image button exists for donation form, hiding #pstep_finish")
            add_class("mw_hide")
          }
          
        }
      }
      # $(".//input[@id='pstep_finish']") {
      #   remove("./@onmouseover | ./@onmouseout")
      #   add_class("mw_btn2")
      #   attribute("value", "Submit")
      # }
    }
  }

  # Pre wrap the expiration date credit card <select>

  $(".//fieldset[contains(@class, 'cardExpGroup')]/select") {
    %expdate = fetch("@id")
    wrap("div", id:concat(%expdate, "_wrapper"))
  }

  # add in some extra arrows for the select box
  $(".//select/..") {
    add_class("mw_select_arrows")
  }

  # Make the phone number dialable
  $(".//a[contains(@href, 'mailto')]/parent::p") {
    wrap_text_children("span") {
      $phone_text = fetch("./text()")
      $phone_num = ""
      $phone_text {
        log("trying to match a number")
        log(this())
        replace(/(\d*\-*\d{3}\-\d{3}\-\d{4})/) {
          #, contcat("<a tel:'", $1, "'>", $1, "</a>")
          $phone_num = $1
        }
      }
      /*match($phone_num, "") {
        name("a")
        attributes(href: "tel:"+$phone_num)
        }*/
        inner(){
        #$click_tel = concat("<a tel:'", $1, "'>", $1, "</a>")
        replace(/(\d*\-*\d{3}\-\d{3}\-\d{4})/, concat("<a href='tel:", $phone_num, "'>", $phone_num, "</a>"))
      }
    }
    
    $(".//a[strong]") {
      remove("@style")
    }
  }

  # converts a generic format phone number to be clickable on mobile
#Courtasey of the accenture project
/*@func XMLNode.telephonize() {
  $phone_text = fetch("./text()")
  $phone_num = ""
  $phone_text {
    replace(/^\s*([ \+\-()\d]{9,}\d)\s*$/) {
      $phone_num = $1
      log($phone_num)
    }
  }
  match_not($phone_num, "") {
    name("a")
    attributes(href: "tel:"+$phone_num)
  }
  }*/

  # footer detailing
  $(".//li[@class=' mw_link_center']/a") {
    add_class("mw_bar2")
    $("../..") {
      add_class("mw_footer_link_list")

      $("./li[not(@class)]") {
        add_class('mw_footer_copyright')
      }
    }
    
  }

  # Deal with youtube videos
  $(".//object") {
    $("./embed") {
      #remove("@width")
      #remove("@height")
      attributes(width:"100%", height:"200px")
    }
    $("..") {
      remove("@style")
    }
  }


  # Use custom keyboards
  contextual_keyboard(".//input[@id='billing_addr_zipname']", "numeric")
  contextual_keyboard(".//input[@id='donor_email_addressname']", 'email')
  # HSUS-96 - numeric keyboard with decimal
  # contextual_keyboard(".//input[@class='DonationLevelOtherAmount']", 'numeric')
  $(".//input[@class='DonationLevelOtherAmount']") {
    keyboard('number')
    #some browsers are particular about having a '$' in the value and won't display that
    %amount = fetch("@value")
    %amount {
      replace(/\$/, '')
    }
    attribute("value", %amount)
  }
  contextual_keyboard(".//input[@class='DonationLevelOtherAmount']", 'number')
  contextual_keyboard(".//input[@id='donor_phonename']", "tel")
  contextual_keyboard(".//input[@id='payment_typecc_numbername']", "numeric")
  contextual_keyboard(".//input[@id='payment_typecc_cvvname']", 'numeric')



  # Donation Thankyou page

  # vehicle donation
  $(".//img[contains(@src, 'vehicle')]/ancestor::table[1]") {
    add_class("mw_donate_vehicle")

    $(".//img/ancestor::td[1]") {
      add_class("mw_donate_vehicle_img")

      $("./following-sibling::td[1]") {
        add_class("mw_donate_vehicle_text")
      }
    }
  }

  # Share table
  $(".//img[contains(@src, 'facebook')]/ancestor::table[1]") {
    add_class("mw_donation_share")
    remove("@style")

    $(".//td[@width='20']") {
      remove()
    }


    $(".//td | .//tr") {
      remove("@width")
      remove("@height")
    }
  }


  # Summary table
  $(".//td[@class='FormSectionHeader']/ancestor::table[1]") {
    add_class("mw_transaction_summary mw_bar5")
    attribute("data-ur-toggler-component", "button")

    $("./following-sibling::table[1]") {
      attribute("data-ur-toggler-component", "content")
    }

    $("..") {
      attribute("data-ur-set", "toggler")
      attribute("style", "width: 100%;")
    }
  }
  

  $(".//div[@id='othergive']") {
    attribute("data-ur-set", "toggler")

    $("./h2") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")
    }

    $("./ul") {
      attribute("data-ur-toggler-component", "content")
    }

    $("..") {
      attribute("style", "width: 100%;")
    }
  }

  #HSUS-448: Start;
  # $(".//tbody[./tr[@id='donor_phone_Row']]") {
  #   # remove("preceding-sibling::tbody[1] | following-sibling::tbody[position() < 4]")
  # }
  # $(".//tr[@id='payment_typecc_cvv_Row']") {
  #   $("./td[contains(@class,'mw_donate_clear')]/a[@class='HelpLink']") {
  #     move_to("ancestor::tr[@id='payment_typecc_cvv_Row']/td[@class='FormLabel']") 
  #   }
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typeradio_Row']/td[@class='requiredIndicator']") {
  #   move_to("ancestor::tbody[1]/tr[contains(@class,'mw_gift_desc')]", "top")
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typelist_Row']/td[@class='requiredIndicator']") {
  #   move_to("ancestor::tbody[1]/tr[contains(@class,'FormRow mw_gift_desc')]", "top")
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typeradio_Row']/td[@class='FormInput']/fieldset/table") {
  #   add_class("mw_new_payments_inline")
  #   $("./tr"){
  #     add_class("mw_new_payments_inline_tr")
  #     $("./td[1]"){
  #       add_class("mw_new_payments_inline_tr_td_radio")
  #     }
  #     $("./td[2]"){
  #       add_class("mw_new_payments_inline_tr_td_flag")
  #     }
  #   }
  # }
  # $(".//img[@alt='PayPal']") {
  #   add_class("mw_new_payments_inline_tr_td_flag_image")
  #   $("../../td[contains(@class, 'mw_monthly_donation_desc')][2]"){
  #     text() {
  #       set("")
  #     }
  #   }
  #   move_to("../../td[contains(@class, 'mw_monthly_donation_desc')]")
  # }
  # $(".//a[@href='https://www.paypal.com/us/cgi-bin/webscr?cmd=xpt/Marketing/popup/OLCWhatIsPayPal-outside' and @class='Smaller']") {
  #   remove()
  # }
  # $(".//img[@alt='Amazon Payments']") {
  #   add_class("mw_new_payments_inline_tr_td_flag_image")
  #   $("../../td[contains(@class, 'mw_monthly_donation_desc')][2]"){
  #     text() {
  #       set("")
  #     }
  #   }
  #   move_to("../../td[contains(@class, 'mw_monthly_donation_desc')]")
  # }
  # $(".//a[@href='https://payments.amazon.com/sdui/sdui/about?nodeId=77175' and @class='Smaller']") {
  #   remove()
  # }
  # $(".//tr[@id='payment_typecc_type_Row']/td[contains(@class, 'mw_select_arrows')]") {
  #   add_class('mw_select_arrows_inline')
  # }
  # $(".//td[contains(@class,'mw_seals_center') and @valign='top' and @height='100%']") {
  #   remove()
  # }
  # $(".//input[@id='payment_typecc_cvvname']") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//input[@id='payment_typecc_exp_date_MONTH']") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//input[@id='payment_typecc_exp_date_YEAR']") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//tr[@id='payment_typepay_typelist_Row']/td") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//select[@id='payment_typepay_typelist']") {
  #   add_class("mw_input_100_p")
  # }
  # $(".//div[@id='payment_typecc_exp_date_MONTH_wrapper']") {
  #   add_class("mw_div_50_p")
  # }
  # $(".//div[@id='payment_typecc_exp_date_YEAR_wrapper']") {
  #   add_class("mw_div_50_p")
  # }
  $(".//table[contains(@class, 'mw_seals') and @align='left' and @border=0]") {
    remove()
  }
  #HSUS-448: End;
  $(".//span[contains(text(), 'Select a Payment Type:')]") {
    move_here("ancestor::tr[contains(@class, 'FormRow')][1]/following-sibling::tr[1]/td[@class='requiredIndicator']", "top") {
      name("span")
    }
  }
  $(".//label[@for='payment_typepay_typeradiocredit']") { 
    $("..") {
      add_class("mw_v_align")
    }
  }
  remove(".//a[@class='Smaller']")
  remove(".//td[contains(@class,'mw_seals_center')][last()]")
  $(".//tr[@id='donor_email_opt_in_Row']") {
    remove("ancestor::tbody[1]")
  }
  # HSUS-482:[Mobile & Tablet] Gift Donation Form Styling
  
  $(".//input[@id='fulfill_eCard']") {
   move_to("ancestor::body//table[@class='tbl-ecard-type-select']//td[2]","bottom")
 }
 $(".//table[@id='overTable']/tbody[contains(@id,'tribute_type') or contains(@id,'tribute_notify') or contains(@id,'Card_Type')]") {
  add_class("mw_hidden")
}
  # Fix For HSUS-482
  $(".//td[@class='mw_formlabel']") {
    move_to("ancestor::body//tr[@id='payment_typecc_number_Row']","top")
  }
  $(".//tr[@valign='bottom']") {
    $("./td[@align='center']") {
      add_class("mw_new_padding")
    }
  }
  # Fix for HSUS-482
  $(".//tbody[.//div[@class='section-separator']]") {
    $(".//td") {
      add_class("mw_separator")
    }
  }
  $(".//tbody[contains(@id,'e_card_preview')]") {
    remove()
  }
  # End of HSUS-482
   # HSUS-482:End

   //HSUS-476
   $(".//div[@class='mw_powered_by']"){
    move_to("//div[@class='legal']")
  }

  $(".//img[@alt='better business bureau']/../.."){
    add_class("mw_float_right")
  }

  $(".//td[contains(@class, 'printed-card-section')]") {
    add_class("ecard-section")
  }

  # Fix for HSUS-487
  $(".//table[@id='overTable']/tbody[last() not(.//h3)]") {
    #".//table[@id='overTable']/tbody[last()]"
    # remove()
    add_class("mw_hide")
  }
  $(".//table[@id='overTable']/tbody[not(@id) or not(@class)]") {
    remove()
    # add_class("mw_testing")
  }
  $(".//tr[@id='level_standardauto_repeat_Row']") {
    $("./td[contains(@class,'FormLabel')]") {
      add_class("mw_display")
      $("./div") {
        add_class("mw_display")
      }
    }
  }
  match($path,/site\/Donation2\?df_id\=(14482\&14482)|(14481\&14481)/i) {
    $(".//div[@id='othergive']") {
      move_to("ancestor::body//div[@id='dataFormContainer']/table","after")
    }
  }
  match($path,/site\/Donation2\?df_id\=(14380\&14380)|(14381\&14381)/i) {
    $(".//div[@class=' mw_sidebar_content_hide']") {
      $("./img") {
        attribute("src") {
          value() {
            replace("////secure.humanesociety.org///","")
          }
        }
      }
      move_to("ancestor::body//div[@id='ga-header']","bottom")
      add_class("mw_alignment")
    }
  }
  $(".//div[@id='donation-top']") {
    $(".//div[./img]") {
      remove("@style")
    }
    remove("./br")
    $(".//img") {
      add_class("mw_width")
    }
    $(".//img[contains(@alt,'Or make a one time gift')]") {
      add_class("mw_center")
    }
  }

  $(".//label[@for='payment_typepay_typeradiopaypal']/.."){
    add_class("mw_paypal_wrapper")
  }
  # End OF HSUS-487

  $(".//td[contains(@class, 'printed-card-section')]"){
    $("./img"){
      move_to("..", "bottom")
    }
  }

  $(".//tr[@id='payment_typecc_number_Row']/td[@class='requiredIndicator']"){
    add_class("mw_hidden")
  }

  $(".//tr[@id='payment_typecc_number_Row']"){
    insert_top("td", "*", class:"requiredIndicator")
  }
  // Fix for HSUS-511
  $(".//div[contains(text(),'Billing Information')]/.."){
    add_class("mw_billing_separator")
    move_to("//tr[@id='billing_first_name_Row']", "top")
  }

  $needsPaymentRequiredText = "true"

  $(".//div[contains(text(), 'Payment Information')]/span"){
    //since we found the required payment text, we no longer need to insert it
    $needsPaymentRequiredText = "false"
  }

  match($needsPaymentRequiredText, /true/){
    $(".//div[contains(text(), 'Payment Information')]"){
      insert("span", "* Required")
    }
  }
  # HSUS-492: Make Thermometer Visible on Year End Donation Forms-Fixed
  $(".//div[@id='progress']/img[contains(@src,'DynImg')]"){
    %src = fetch("@src")
    %src {
      replace('DynImg', 'site/DynImg')
    }
    attribute("src", %src)
  }
 
  $(".//div[@id='side']") {
    move_to("ancestor::body//div[@id='donation-top']","after")
  }
  # HSUS-492-end

  # Fix for HSUS-511
  $(".//input[@id='pstep_finish']") {
    remove("./@class | ./@value")
    add_class("images-submit_logo")
  }
  $(".//table[contains(@summary,'Credit Card')]") {
    $(".//td//img") {
      remove("./@src | ./@alt")
    }
    $(".//img[@id='payment_typecc_type_Visa']") {
      add_class("images-cc_logo_retina")
    }
  }
  $(".//a[contains(text(),'ABOUT TRUST ONLINE')]") {
    add_class("mw_norton")
  }
  $(".//div[contains(@class,'section-separator')]/span") {
    text() {
      replace("* Required","Required")
    }
  }
  # Fix for HSUS-513
  $(".//div[contains(text(),'Choose the amount of your donation')]") {
    add_class("mw_new_margin")
  }
  remove(".//tbody[@id='html-caption.82150']|//tbody[@id='html-caption.74181']|//tbody[@id='html-caption.84661']|//tbody[@id='html-caption.44761']|//tbody[@id='html-caption.81560']|//tbody[@id='html-caption.84660']")
  remove(".//td[contains(@class,'RequiredCellWidth')]//ancestor::tr[1]") // For HSUS-512
  remove(".//td[@id='RightEdge']")
  remove(".//p[contains(@class,'mw_donation_info')][last()]")
  $(".//tbody[@id='level-standard.41522']") {
    $(".//tr[@class='FormRow']") {
      $("./td[@class=' mw_separator']") {
        add_class("mw_hide")
      }
    }
  }
  $(".//a[contains(.,'click here')]") { // For HSUS-512
    add_class("mw_donate_link")
    $("./u | ./strong") { // For HSUS-512 and HSUS-511
      text(" here")
      insert_top("span", "tap")
    }
  }
  remove(".//tbody[@id='html-caption.82150']|//tbody[@id='html-caption.74181']|//tbody[@id='html-caption.84661']")
  remove(".//td[contains(@class,'RequiredCellWidth')]//ancestor::tbody[1]") 
  remove(".//td[@id='RightEdge']")
  # Fix for HSUS-511
  $(".//tbody[contains(@id, 'buttons')]") {
    add_class("mw_margin_top_20")
  }
  # Start of Fix HSUS-511
  $(".//td[@class='FormCaption'][not(div)][not(p)]/ancestor::tbody") {
   remove()
  }
  # End Fix HSUS-511
}
$("./body") {
  add_class("mw_valor_award_tablet")
  # header logo img
  $("./div[@class='mw_header']/a[@class='mw_header_spillover']/img") {
    attribute("src") {
      value() {
        replace(/[\/|\w|\.]+(\.\..*)/) {
          set($1)
        }
      }
    }
  }
  # end header logo img
  remove("./div[@id='wrapper']/br")
  $("./div[@id='wrapper']") {
    insert_top("div", class: "mw_masthead") {
      insert("img", src: "http://www.humanesociety.org/assets/images/1024x256-tablet-mastheads/tablet_masthead_default.png", class: "mw_tablet_masthead_image")
    }
    $("./div[@id='page']") {
      remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style] | ./br")
      $("./div[@id='contentDiv']/div[@id='cols']") {
        add_class("mw_box2_tablet")
        $("./div[@id='main']/div[@id='wrapper-body']") {
          remove("./@style")
          # share
          $("./ul[@id='share_bar']/li/img[@class='share_image']") {
            name("span")
            insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
            remove()
          }
          # end share
          $("./div[contains(@id, 'pov-col')]") {
            $(".//h3") {
              add_class("mw_h3")
            }
            $("./div[@class='pov-text']") {
              $("./h2") {
                add_class("mw_h2")
                remove("./br")
              }
              $("./p") {
                name("div")
                wrap_text_children("span")
                $("./br/following-sibling::span[1]") {
                  wrap("div", class:"mw_wrap_div")
                }
                $("./a | ./span | ./strong") {
                  move_to("preceding-sibling::div[1]", "bottom")
                }
                remove("./br")
              }
            }
            $(".//div[@class='pov']") {
              remove(".//@style | .//@width")
              $("./img") {
                add_class("mw_img")
              }
              $("./div[@id='pov-radio-error']") {
                move_to("./preceding-sibling::label[@class='pov-label']", "bottom")
              }
              $("./p[not(*)]") {
                text() {
                  replace(/^[\s\u00a0]+/, "")
                  replace(/[\s\u00a0]+\|$/, "")
                }
              }
            }
            # cast your vote area
            $(".//div[@id='pov-fields-input-boxes']") {
              remove("./p/@style | ./div[@id='bogotext']//img/@style")
              $("./div/input") {
                add_class("mw_input")
              }
              $("./label[./input[@class='radio']]") {
                add_class("mw_radio")
                move_here("./following-sibling::div[@id='pov-radio-area-legal' or @id='pov-radio-error-legal']", "bottom")
              }
              $("./input[@class='pov-submit-button']") {
                add_class("mw_btn1")
                wrap("div", class: "mw_submit_btn")
              }
            }
            # end cast your vote area
          }
        }
      }
    }
  }
}
$("./body") {
  add_class("mw-take-your-pet")

  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1", id:"mw_footer") {
      move_here("//div[@id='footer']") {
        $("./p") {
          add_class("mw_content")
          move_to("./ancestor::div[@id='footer']", "bottom")
        }
        $("./ul") {
          wrap("div")
        }
      }
      remove(".//@style | ./div[@id='footer']/div[./img] | .//li[./a[contains(@href, 'facebook') or contains(@href, 'twitter')]]")

      $(".//ul/li[1]") {
        add_class('mw_footer_copyright')
      }
      $(".//li[./a]") {
        add_class("mw_link_center")
        $("./a") {
          add_class("mw_bar2")
        }
      }
      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # end footer

  remove(".//@style | ./div[@id='footer']/div[./img]")

  table_dump("./table")
  $("./div[contains(@class,'mw_was_table')]") {
    remove("./div[contains(@class,'mw_was_tr')][1]")
    $(".//div[@id='disaster-container']") {
      remove("./div[@class='infographicshare']")
    }
  }
}
$("./body") {
  add_class("mw-take-your-pet-tablet")

  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1") {

      move_here("//div[@id='footer']") {
        remove("./div[./img]")
        attribute("id") {
          value() {
            replace("er", "")
          }
        }
      }

      #manually styled footers
      move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
        remove("@style")
        remove("./img")
        $("./p") {
          name("li")
          add_class("mw_footer_info")
          move_to("./following-sibling::ul", "bottom")
        }
        $(".//*[@style]") {
          remove("@style")
        }
        $("./ul/li[1]") {
          add_class('mw_footer_copyright')
        }
        $(".//li[./a]") {
          add_class("mw_links_inline")
          remove("./self::li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
        }
      }

      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # footer

  remove(".//@style | ./div[@id='footer']/div[./img]")

  table_dump("./table")
  $("./div[contains(@class,'mw_was_table')]") {
    remove("./div[contains(@class,'mw_was_tr')][1]")
    $(".//div[@id='disaster-container']") {
      remove("./div[@class='infographicshare']")
      # HSUS-463: [Mobile & Tablet] Take Your Pet Contest Page
      insert_top("div", id: "mw_mast_head") {
        insert("img", src: asset("images/take_your_pet_landingpage.jpg"), alt: "take_your_pet_landingpage", width: "100%", height: "auto")
      }
      # End HSUS-463
    }
  }

}
$("./body") {
  add_class("mw_my_profile")
  $(".//div[contains(@class, 'mw_masthead')]/img | ./div[@class='mw_header']/a/img") {
    attribute("src") {
      value() {
        replace(/SPageNavigator\//, "")
      }
    }
  }
  remove(".//@style")
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
      remove(".//hr")
      $(".//h2") {
        add_class("mw_h1")
      }
      $(".//input[@type='image']") {
        $text = fetch("./@id")
        btn_delegate() {
          add_class("mw_btn4")
          text($text)
        }
      }
      # top profile info
      $(".//div[@id='centerHeader']") {
        add_class("mw_flex_box")
        $("./div") {
          add_class("mw_sidebar1 mw_flex_box_item_1")
          remove(".//a[@class='cta']/img")
          $("./p[not(./a)]") {
            add_class("mw_profile_p")
          }
          wrap_text_children("span", class: "mw_profile_p") {
            match(text(), /\A\s+\Z/) {
              remove()
            }
          }
        }
      }
      # Humane Society International
      $(".//div[@id='hsiAlert']") {
        add_class("mw_sidebar1")
      }
      # blue box
      $(".//div[@class='action']") {
        add_class("mw_sidebar2")
      }
      # wayne's blog
      $(".//div[@id='blog_feed']") {
        insert_top("h2", "WAYNE'S BLOG")
      }
    }
  }
  remove(".//div[@id='page-head'] | .//div[@id='head']")
  
  # HSUS-377 Giving Opportunities
  match($path, /^\/site\/donation($|\/[\d]+)/i) {
    $("./div[@class='mw_header']/a/img") {
      attribute("src") {
        value() {
          replace(/\/site\/Donation\/\.\./, "")
        }
      }
    }
    $(".//div[contains(@class, 'mw_masthead')]/img") {
      attribute("src") {
        value() {
          replace(/\/site\/Donation\/\.\..*/, "wrpr\/girlcat\.jpg")
        }
      }
    }
    $(".//div[@id='wrapper-body']/h3") {
      add_class("mw_h3")
    }
  }
}
$("./body") {
  add_class("mw_signup_tablet")

  # remove the odd text nodes that are adding strange text
  wrap_text_children("span", class:"mw_hide")

  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
    $(".//ul[@id='share_bar']") {
      $("./li[./img[contains(@class, 'share_image')]]") {
        text("Share")
        add_class("mw_share")
      }
      $("./li[./a[contains(@class, 'addthis')]]") {
        add_class("mw_social_icon")
      }
    }
    $("./div[@id='contentDiv']") {
      $("./div[not(@id)]") {
        remove()
      }
      # add_class("mw_gray_inner")
      # add_class("mw_box3")
      $("./div[@id='head'] | ./div[@id='head']/div[contains(@style, 'background')] | .//p") {
        remove("@style")
      }
      $(".//div[contains(@class, 'section')]/div[contains(@style, 'height')]") {
        remove("@style")
      }
    }
    $("./div[@id='page-bottom-spacer']") {
      remove()
    }

    $(".//div[@class='appArea'][table]") {
      # add_class("mw_box3")
    }

    $(".//div[@class='appArea']/p") {
      wrap_text_children("span")
      $("./span[string-length()<=4 and not(*)]") {
        remove()
      }
    }

    $(".//div[@id='wrapper-body']") {
      remove("./@style")
      $("./form[1]") {
        add_class("mw_box3")
      }
      remove("./div[@class='templateComponent']/preceding-sibling::p[1]")
    }

    $(".//h3") {
      add_class('mw_h1 mw_hide')
    }

    $(".//h1") {
      add_class("mw_h3")

      $("./following-sibling::p") {
        add_class("mw_signup_description")
      }
    }

    # Remove the td's with width of 5% or <br>s
    $(".//td[@width='5%'] | .//br") {
      remove()
    }

    # Give the td's containing the <label> a class
    $(".//input[not(@type='checkbox')]/ancestor::td[1] | .//select/ancestor::td[1]") {
      add_class("mw_signup_field")
    }
    $(".//td[./select]") {
      add_class("mw_select_arrows")
    }

    # make the checkboxes look nice-r
    $(".//input[@type='checkbox']/ancestor::td[1]") {
      add_class("mw_signup_checkbox")

      $("./following-sibling::td[1]") {
        add_class('mw_signup_checkbox_label')
      }
    }

    # Make the buttons on the bottom
    $(".//input[@id='ACTION_SUBMIT_SURVEY_RESPONSE']") {
      match($path) {
        # HSUS-422 : for the Meatless Monday Recipe submit button
        with(/pagename\=meatless_monday_contest/) {
          btn_delegate() {
            add_class("mw_btn2 mw_monday_contest_submit")
            text(fetch("following-sibling::input[@id='ACTION_SUBMIT_SURVEY_RESPONSE']/@value"))
          }
        }
        else() {
          add_class("mw_signup_btn")
        }
      }
    }

    $(".//input[@id='ACTION_CANCEL_RESPONSE_SUBMIT']") {
      add_class('mw_cancel_btn mw_hide')
    }
    
    # HSUS-422
    $(".//table[@id='meatlessmonday']") {
      remove(".//@width | .//@height | .//@style")
      $(".//td") {
        add_class("mw_signup_field")
      }
      $(".//td[./input[@id='cons_email_opt_in']]") {
        add_class("mw_cons_email_opt_in")
      }
    }
    match($path, /meatless/) {
      add_class("mw_meatless")
    }

    # Custom keyboards
    contextual_keyboard(".//input[@id='cons_email']", "email")
    contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")
    contextual_keyboard(".//input[@id='3314_2820_4_2322']", "tel")
    
  }
}
$("./body") {
  add_class("mw_edit_profile_tablet")
  # when error message appear, the img will broken
  $(".//img[contains(@src, 'ConsProfileUser') or contains(@src, 'ConsInterestsUser')]") {
    attribute("src") {
      value() {
        replace(/\/(ConsProfileUser|ConsInterestsUser)/, "")
      }
    }
  }
  remove(".//div[@id='page-head'] | .//ul[@id='site-nav'] | .//div[@id='head']")
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
      # main content
      $("./div[@id='wrapper-body']") {
        # desktop site display none
        $(".//p/a[contains(@href, 'Passwd')]") {
          add_class("mw_hide")
        }
        $(".//h3") {
          add_class("mw_h3")
        }
        # btns
        $(".//p[./input[@class='Button']]") {
          add_class("mw_btn_center")
          $("./input[@value='Save' or @title='Done' or @title='Register' or contains(@value, 'Home')]") {
            add_class("mw_btn2")
          }
          $("./input[@value='Cancel' or @value='Reset']") {
            add_class("mw_btn1")
          }
        }
        # end of btns
        
        # Email Subscriptions
        $(".//form[@id='ConsConfigInterests']") {
          remove("./table[.//input[@id='ConsInterestsUseremailPrefsEMAILOpenAll']] | ./table/@style")
          $(".//tr[./th]") {
            add_class("mw_table_title")
          }
        }
        # end of Email Subscriptions
      }
      # end of main content
    }
  }
  # table_dump(".//table")  
}
$("./body") {
  add_class("mw_splash_tablet")

  $(".//div[@class='mw_donation_image_center']/.."){
    add_class("mw_content_wrapper")
    $("./p"){
      add_class("mw_text_wrapper")
    }
  }

  $(".//table[@align='center']"){
    add_class("mw_contentTable")
    $("./tbody/tr[1]"){
      add_class("mw_splash_header")
    }
  }

  $(".//td[contains(@class, 'mw_content_wrapper')]"){
    move_here("./p[contains(@class, 'mw_donate_info')][1]", "top"){
      add_class("mw_donatebtn_top")
    }
  }
}

remove("//table/@style")
$("./body") {
  add_class("mw_signup")

  # remove the odd text nodes that are adding strange text
  wrap_text_children("span", class:"mw_hide")

  $(".//div[@id='page']") {

    $("./div[@id='contentDiv']") {
      $("./div[not(@id)]") {
        remove()
      }
      $("./div[@id='head'] | ./div[@id='head']/div[contains(@style, 'background')] | .//p") {
        remove("@style")
      }
      $(".//div[contains(@class, 'section')]/div[contains(@style, 'height')]") {
        remove("@style")
      }
    }
    $("./div[@id='page-bottom-spacer']") {
      remove()
    }

    $(".//div[@class='appArea']/p") {
      wrap_text_children("span")
      $("./span[string-length()<=4 and not(*)]") {
        remove()
      }
    }

    $(".//div[@id='wrapper-body']") {
      remove("./@style")
      $("./form[1]") {
        add_class("mw_box3")
        $(".//p[./input[@id='ACTION_CANCEL_RESPONSE_SUBMIT']]") {
          add_class("mw_submit_p")
        }
      }
      remove("./div[@class='templateComponent']/preceding-sibling::p[1]")
      # share bar
      $("./ul[@id='share_bar']") {
        $("./li[./img[@class='share_image']]") {
          insert("span", fetch("./img/@alt"), class: "mw_share_text")
          remove("./img")
        }
      }
    }

    $(".//h3") {
      add_class('mw_h1')
    }

    $(".//h1") {
      add_class("mw_h3")

      $("./following-sibling::p") {
        add_class("mw_signup_description")
      }
    }

    # Remove the td's with width of 5% or <br>s
    $(".//td[@width='5%'] | .//br") {
      remove()
    }

    # Give the td's containing the <label> a class
    $(".//input[not(@type='checkbox')]/ancestor::td[1] | .//select/ancestor::td[1]") {
      add_class("mw_signup_field")
    }
    $(".//td[./select]") {
      add_class("mw_select_arrows")
    }

    # make the checkboxes look nice-r
    $(".//input[@type='checkbox' and @id='3314_2820_7_2342_1']/ancestor::td[1]") {
      add_class("mw_signup_checkbox")

      $("./following-sibling::td[1]") {
        add_class('mw_signup_checkbox_label')
      }
    }

    # Make the buttons on the bottom
    $(".//input[@id='ACTION_SUBMIT_SURVEY_RESPONSE']") {
      match($path) {
        # HSUS-422 : for the Meatless Monday Recipe submit button
        with(/pagename\=meatless_monday_contest/) {
          btn_delegate() {
            add_class("mw_btn2 mw_monday_contest_submit")
            text(fetch("following-sibling::input[@id='ACTION_SUBMIT_SURVEY_RESPONSE']/@value"))
          }
        }
        else() {
          add_class("mw_signup_btn")
        }
      }
    }

    $(".//input[@id='ACTION_CANCEL_RESPONSE_SUBMIT']") {
      add_class('mw_cancel_btn')
    }
    # HSUS-422
    $(".//table[@id='meatlessmonday']") {
      remove(".//@style | .//@width | .//@height")
      $(".//td[./input[@id='cons_email_opt_in']]") {
        add_class("mw_cons_email_opt_in")
      }
    }


    # Custom keyboards
    contextual_keyboard(".//input[@id='cons_email']", "email")
    contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")
    contextual_keyboard(".//input[@id='3314_2820_4_2322']", "tel")
    
  }
}
$("./body") {
  add_class("mw_ticketing_tablet")
  # remove powered by convio img
  remove("./div[./a[contains(@href, 'poweredby')]]")
  $("./div[@id='ga-container']") {
    $("./div[@id='ga-content']/table") {
      add_class("mw_box2")
      $("./tbody/tr/td/table") {
        add_class("mw_main_content")
      }
    }
    $(".//table") {
      remove("./@style | ./@bgcolor | ./@align")
      $(".//h3") {
        add_class("mw_h2")
      }
      # main content
      $(".//div[@class='appArea']") {
        remove("./br")
        $("./p[not(*)]") {
          match(text(), /\A\s+\Z/) {
            remove()
          }
        }
        
        # name field
        $("./table[not(@class or @summary)]") {
          add_class("mw_name_field")
        }
        
        # Available Ticket Classes for This Event
        $("./table[@class='lc_Table']") {
          add_class("mw_main_table")
        }
        
        # RRequest Ticket Purchases Here
        $("./table[contains(@class, 'lc_Table')][.//td[@class='lc_Totals']]") {
          add_class("mw_summary_table")
          $("./tr[./td]/td[position() = last()]") {
            add_class("mw_calculated")
          }
        }
        # btns
        $("./p") {
          add_class("mw_btn_wrap")
          $("./input[@id='rsvp_save']") {
            add_class("mw_btn2")
          }
          $("./input[@id='rsvp_reset']") {
            add_class("mw_btn1")
          }
          $("./input[@id='rsvp_cancel']") {
            add_class("mw_btn1")
          }
        }
        # end of btns
      }
      # end of main content
    }
  }
  # for Ticket Class link
  # https://secure.humanesociety.org/site/Ticketing?view=Tickets&id=109422
  $("./div[@class='appArea'][./form[@name='TicketClassDetails']]/ancestor::body[1]") {
    add_class("mw_ticket_detail")
    $(".//h3") {
      add_class("mw_h2")
    }
  }
}
$("./body") {
  add_class("mw_chimps")
  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1", id:"mw_footer") {
      move_here("//div[@id='footer']") {
        $("./p") {
          add_class("mw_content")
          move_to("./ancestor::div[@id='footer']", "bottom")
        }
        $("./ul") {
          wrap("div")
        }
      }
      remove(".//@style | ./div[@id='footer']/div[./img] | .//li[./a[contains(@href, 'facebook') or contains(@href, 'twitter')]]")

      $(".//ul/li[1]") {
        add_class('mw_footer_copyright')
      }
      $(".//li[./a]") {
        add_class("mw_link_center")
        $("./a") {
          add_class("mw_bar2")
        }
      }
      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # end footer


  $("./table | ./div[@id='ga-container']/div[@id='ga-content']/table") {
    move_here(".//div[@class='lp-template-container']/..", "before") {
      attribute("class", "mw_box2")
      remove(".//@style | .//@height | .//@align | .//br[@clear='all']")
      name("div")
      $("./div[@class='lp-template-container']") {
        # Share icon
        $("./div[@class='infographicshare']") {
          $("./img") {
            name("span")
            text(fetch("./@alt"))
            remove("./@alt | ./@src")
          }
          $("./a") {
            text("")
          }
        }
        # "DONATE TO HELP CHIMPS" button
        $("./div[@id='lp-donate-button']") {
          move_to("./following-sibling::div[@class='lp-aa-box']", "before")
          $("./a") {
            add_class("mw_btn2")
            inner("DONATE TO HELP CHIMPS")
          }
        }
        $("./div[@class='lp-aa-box']") {
          remove("./div[./img]")
          $("./div") {
            wrap_text_children("span") {
              text() {
                replace(/^[\s\u00a0]+/, "")
                replace(/[\s\u00a0]+\|$/, "")
              }
            }
            remove("./br")
          }
        }
        # Donate now box
        $("./div[@class='lp-donate-box']/div[@class='supertaf-donate-section']/div[@class='supertaf-donate-form']/form[@id='taf-donate']") {
          $("./input[@name='s_src']") {
            add_class("mw_hide")
          }
          $("./div[@class='supertaf-donate-text']") {
            insert_before("div","DONATE NOW", class:"mw_donate_title")
          }
          $("./div[@class='supertaf-donate-amounts']") {
            $("./label | ./input[@id='supertaf-box']") {
              move_to("./preceding-sibling::div[@class='mw_amount'][1]", "bottom")
            }
            $("./input[@class='supertaf-donate-button']") {
              btn_delegate() {
                attribute("class", "mw_btn2")
                inner("CONTINUE")
              }
            }
            remove("./br | ./label | ./input[not(@id='supertaf-box' or @type='submit')]")
            $("./strong") {
              inner("$")
              wrap("div", class:"mw_amount") {
                move_here("./following-sibling::input[@id='supertaf-box']", "bottom")
              }
            }
          }
        }
      }
    }
    remove()
  }
}
$("./body") {
  add_class("mw_my_profile")
  remove(".//div[@id='page-head'] | .//div[@id='head']")
  $(".//div[@id='contentDiv']") {
    remove(".//@style")
    $("./div[@id='cols']/div[@id='main']/div[@id='wrapper-body']") {
      remove(".//hr")
      add_class("mw_main_wrap")
      $("./h2") {
        add_class("mw_h1")
      }
      $(".//input[@type='image']") {
        $text = fetch("./@id")
        btn_delegate() {
          add_class("mw_btn4")
          text($text)
        }
      }
      # top profile info
      $("./div[@id='centerHeader']/div") {
        add_class("mw_sidebar1")
        remove(".//a[@class='cta']/img")
        $("./p[not(./a)]") {
          add_class("mw_profile_p")
        }
        wrap_text_children("span", class: "mw_profile_p") {
          match(text(), /\A\s+\Z/) {
            remove()
          }
        }
      }
      # Humane Society International
      $("./div[@id='hsiAlert']") {
        add_class("mw_sidebar1")
      }
      # blue box
      $("./div[@class='action']") {
        add_class("mw_sidebar2")
      }
      # wayne's blog
      $("./div[@id='blog_feed']") {
        insert_top("h2", "WAYNE'S BLOG")
      }
      # Your Giving History
      $("./div[@id='transactionHistory']") {
        $("./h2") {
          add_class("mw_h1")
        }
      } 
    }
    remove("./div[not(contains(@id, 'cols'))]")
  }
  
  # HSUS-377 Giving Opportunities
  match($path, /^\/site\/donation($|\/[\d]+)/i) {
    $(".//div[@id='wrapper-body']/h3") {
      add_class("mw_h3")
    }
    $(".//div[@id='wrapper-body']/table") {
      add_class("mw_versign")
      table_dump(".")
    }
  }
}
$("./body") {
  add_class("mw_virtualtownhall")
  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1", id:"mw_footer") {
      move_here("//div[@id='footer']") {
        $("./p") {
          add_class("mw_content")
          move_to("./ancestor::div[@id='footer']", "bottom")
        }
        $("./ul") {
          wrap("div")
        }
      }
      remove(".//@style | ./div[@id='footer']/div[./img] | .//li[./a[contains(@href, 'facebook') or contains(@href, 'twitter')]]")

      $(".//ul/li[1]") {
        add_class('mw_footer_copyright')
      }
      $(".//li[./a]") {
        add_class("mw_link_center")
        $("./a") {
          add_class("mw_bar2")
        }
      }
      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # end footer
   
  $("./table | ./div[@id='ga-container']/div[@id='ga-content']/table") {
    move_here(".//div[@class='lp-template-container']/..", "before") {
      attribute("class", "mw_box2")
      remove(".//@style | .//@height | .//@align | .//br[@clear='all']")
      name("div")
      $("./div[@class='lp-template-container']") {        
        # Share icon
        $("./div[@class='townhallshare']") {
          $("./img") {
            name("span")
            text(fetch("./@alt"))
            remove("./@alt | ./@src")
          }
          $("./a") {
            text("")
          }
        }
        # "DONATE TO HELP CHIMPS" button
        $("./div[@id='lp-donate-button']") {
          move_to("./following-sibling::div[@class='lp-aa-box']", "before")
          $("./a") {
            add_class("mw_btn2")
            inner("DONATE") # HSUS-462 changed from DONATE NOW to DONATE
          }
        }
        #FORM AND SUBMIT
        $("./iframe[@id='townhall_iframe'] | ./div[@id='townhall-ty-elements']") {
          add_class("mw_hide")
        }
        $("./form") {
          $("./div[@id='townhall-bottom-elements']") {
            $("./p") {
              add_class("mw_h3")
              remove("./br")
            }
            $("./div[not(@id)]") {        
              add_class("mw_hide")
            }
          }
          $(".//input[@type='submit']") {
            add_class('mw_btn2')
            wrap("div",class:"mw_submit")
          }     
        }
        #END FORM AND SUBMIT        
      }
    }
    remove()
  }
}
$("./body") {
  add_class("mw_site_donate_tablet")
  
  #inject the blue logo
  $(".//div[@class='mw_header']/a[@class='mw_header_spillover']") {
    insert("img", class:"hsus_blue_logo", src:"http://www.humanesociety.org/assets/images/global/logo.png")
  }

  # Remove the header image
  # remove(".//div[@id='ga-header']")

  $(".//div[@id='ga-header']/div[@id='donation-top']") {
    move_to("./ancestor::div[@id='ga-header']/following-sibling::div[@id='page-content']//div[@id='donate-form']", "top")
  }

  # add a header 
  $(".//div[@id='shell'] | .//div[@id='wrapper']") {
    insert_top("div", class:"mw_head_spacer") {
      insert("div", class:"mw_head_spacer_text", "Donate")
    }
  }


  $(".//*[contains(@style, 'padding')]") {
    remove("./@style")
  }

  # Main donate form
  $(".//div[@id='donate-form']") {
    add_class("mw_box2_tablet")

    $("./table") {
      add_class("mw_gray_inner")
      # HSUS-358 remove empty p
      # https://secure.humanesociety.org/site/Donation2?df_id=1505&1505.donation=form1&s_src=webdn_mb_hptopnavD1505A
      $(".//td/h3") {
        add_class("mw_h1")
      }
      $("./tr/td/p[not(*)]") {
        text() {
          replace(/^[\s\u00a0]*$/, "")
        }
        match(fetch("./text()"), "") {
          remove()
        }
      }
      # end of HSUS-358
    }

    # center the one time gift image
    $(".//img[contains(@alt, 'one time gift')]/ancestor::td") {
      add_class("mw_one_time_gift_center")
    }

    # This might fix the images not displaying on older devices
    # the src looked something like src="////secure.humanesociety.org///../images/content/pagebuilder/19930.png"
    fixImages()
  }

  $(".//h3[img]/ancestor::td[1]") {
    add_class("mw_donate_desc")
    remove("@width")
    remove("@height")
    # move_to("..", "top")
  }

  # Tablet has hero image inline with header
  $(".//h3/img[contains(@src,'jpg')]") {
    move_to("..", "after")
    remove("@width")
    remove("@height")
  }

  # Change the "click here" to "tap here"
  $(".//a[contains(@href, 'Donation2') and not(./img)]") {
    text() {
      replace(/Click/, "tap")
      replace(/click/, "tap")      
    }
  }
  
  $(".//td[img]/..") {
    remove("./td[@id='caption']")
    $("./td") {
      add_class("mw_monthly_donation_desc")


      #move_here("./img", "top")
      $("./img[contains(@alt,'PayPal')]") {
        remove("./@src")
        add_class("images-pp_c_mark")
        # move_to("../..", "top")
      }

    }
    # Merge the header stuff into one td
    $("./td[1]") {
      move_here("../td[2]/*")

      $("./table") {
        remove("./@style")
      }
    }

  }
  # for the monthly donation form, to move the image below the h3 tag
  $(".//td[h3]/img[contains(@src, 'jpg') and not(@class)]") {
    add_class("mw_image_pad")
    # move_to("../..", "top")
    move_to("../h3", "after")
    # $("./following-sibling::p[1]") {
    #   add_class("mw_testing")
    # }
    wrap("div", class: "mw_captioned_img_styling")
  }

  $(".//td/img[contains(@src, 'jpg') and not(@class)]") {
    add_class("mw_image_pad_float")
    move_to("..", "top")
    wrap("div", class: "mw_captioned_img_styling")
  }

  # For the puppy mill page and similar
  $(".//td/div[@style and img]") {
    # Remove styling on the Div
    add_class("mw_captioned_img_styling")
    remove("@style")
  }

  # Match <p>'s that only have &nbsp;
  #$(".//p | .//td") {
    # inner(){
    #   replace(/\xC2\xA0/, "")
    # }
  #}
  # match($text) {
  #   with(/\xC2\xA0/) {
  #     add_class("mw_testing")
  #   }
  # }

  # Humane card form
  $(".//img[contains(@alt, 'humane') and contains(@alt, 'card')] | .//img[@alt=' ']") {
    # add_class("mw_testing")

    $("./ancestor::table[1]") {
      # add_class("mw_testing")
      attribute("align", "center")
      # HSUS-358 Click should be tap
      $(".//a/span[contains(text(), 'Click on the image')]") {
        text() {
          replace(/Click/, "Tap")
        }
      }
      $("./parent::td") {
        add_class("mw_card_center")
      }
    }
  }

  $(".//form[@id='ProcessForm']") {
  # Fix for HSUS-482
    #add_class("mw_box5") 

    $(".//tbody[contains(@id, 'level-standard')]") {
      #HSUS-457: Start;
      $currentId = fetch('@id')
      $("./tr[@class='donationRepeatRowBefore']") { 
        add_class("mw_repeat_payment")
      }
      $("./tr[@class='FormRow' and contains(@id, 'level_standardauto_repeat_Row')]") { 
        add_class("mw_repeat_payment")
      }
      $js = "
      $(document).ready(function() {
       $(\"tbody tr[class='donationRepeatRowBefore']\").appendTo( $(\"tbody[id='" + $currentId + "']\") );
       $(\"tbody tr[id='level_standardauto_repeat_Row']\").appendTo( $(\"tbody[id='" + $currentId + "']\") );
       });
"
insert_javascript( $js )
      #HSUS-457: End;
      $("./tr[@class='FormRow']") {        
        add_class("mw_radio_columns")
      }
      $("./following-sibling::tbody[1]") {
        add_class("mw_donation_note")        
      }
      move_here("./following-sibling::tbody[contains(@class, 'mw_donation_note')]") {
        name("div")
      }
    }    
    # Provide a way to limit the size of the labels of the radio buttions
    $(".//label[@class='RadioGroupLabel']/..") {
      add_class("radioGroupLabeltd")    
    }

    # $(".//tbody[contains(@id, 'level-standard')]/following-sibling::tbody[1]") {
    #   add_class("mw_testing")
    #   $("./preceding-sibling::tbody[contains(@id, 'level-standard')]") {
    #     add_class("mw_testing")
    #   }
    #   # move_to("../preceding-sibling::tbody[contains(@id, 'level-standard')]")
    #   move_to("./ancestor::table[1]//tbody[contains(@id, 'level-standard')]")
    # }
  }

  # This should select the donation form table, first row
  $(".//tr[@class='FormRow'][1]") {
    remove("./td/@colspan")
    $("./td[.//div[@id='wsformheader']]") {
      $(".//br") {
        name("span")
        text(" ")
      }
      add_class("mw_donate_subtitle")
    }
  # $(".//tbody[@class='FormRow'][1]//") {    
    # Move the "Select Gift Amount away from the first option"
    # Fix for HSUS-482
    #insert_before("tr", class:"FormRow mw_gift_desc") {
      move_here("./following-sibling::tr[1]/td[@class='FormLabel']") {
        # Change the attribute so that we can hide the empty 
        # .requiredIndicator and .FormLabel <td>'s
        attribute("class", "mw_formlabel")
      }
    }
  #} 
  # End of HSUS-482

  # bump down the radio button for the "other" donation amount
  $(".//input[@class='DonationLevelOtherAmount']/ancestor::td[1]") {
    # /ancestor::tr[1]//input[@type='radio']
    add_class('mw_radio_alignment')
    $("preceding-sibling::td[1]") {
      add_class("mw_other_td")
      $("ancestor::tbody[contains(@class,'DFEC_el_wrapper')][1]") {
        add_class("mw_choose_form")
        #remove(".//tr[@class='FormRow']")
      }
    }
  }

  $(".//tbody[contains(@id, 'html-caption')]//td[@class='FormCaption']/p") {
    remove("./@style")
    add_class("mw_donation_info")
    $("./ancestor::td[@class='FormCaption']") {
      add_class("mw_donate_subtitle")
      $(".//br") {
      # Fix for HSUS-482
        #name("span")
        #text(" ")
      # End of HSUS-482  
    }
  }
}

  # Shift the .requiredIndicator (*) to the description
  $(".//tbody[contains(@id, 'billing') or contains(@id, 'email') or contains(@id, 'Recipient') or contains(@id, 'City') or contains(@id, 'Sender_Signature') or contains(@id, 'Zip_Code')]//td[@class='requiredIndicator']") {
    #add_class("mw_testing")
    move_to("./../preceding-sibling::tr[1]", 'top')
  }

  # Remove the [x] images from the errors, so that the text can be red instead
  remove(".//tr[@class='holdsErrorMsg']//img")

  # Remove the width="100%" from the error message
  $(".//tr[@class='holdsErrorMsg']/td[@class='FormInfoMsg']") {
    remove("./@width")
  }
  
  # Remove
  $(".//p[contains(@class,'mw_donation_info')][contains(text(),'Who is this donation in memory of?')]/ancestor::tbody[@class='DFEC_el_wrapper'][1]") {
    remove("following-sibling::tbody[contains(@id,'html-caption')][1]")
  }
  remove(".//tr[@id='memorial_name_Row']/td[@class='requiredIndicator']")
  remove(".//tr[@id='recipient_s_state_province__Row']/td[@class='requiredIndicator']")

  # Evenly space out the Credit card types
  $(".//tr[@id='payment_typecc_type_Row']/td[@class='FormInput']//table[1]") {
    add_class("mw_credit_card_flex")
  }

  # Improve the look of the credit card form
  $(".//td[@class='FormInput'][input]") {
    add_class("mw_donate_clear")
  }
  
  # Make the seals easier to deal with for CSS
  $(".//script[contains(@src, 'verisign')][1]/ancestor::table[1]") {
    add_class("mw_seals")
    remove("@height")

    $("./ancestor::tr[@class='FormRow']") {
      add_class("mw_seals_center")
    }

    $("./ancestor::td[1]") {
      add_class("mw_seals_center")
      $(".//td[.//img[@alt='charity navigator']]") {
        add_class("mw_charity")
        $("ancestor::tbody[@class='DFEC_el_wrapper']/following-sibling::tbody[contains(@id,'html-caption')][1]") {
          add_class("mw_last_content")
          remove("following-sibling:: tbody[contains(@id,'html-caption')]")
        }
        # move_to("ancestor::tr[1]")
      }
    }
  }
  $(".//div[@id='othergive']/following-sibling::table[contains(@class, 'mw_seals')]") {
    attributes(class: "mw_bottom_seal", align:"center")
  }

  # Locate the other.. seal
  /*$(".//script[contains(@src, 'verisign')][2]/ancestor::table[1]") {
    add_class("mw_bottom_seals")
    # move_here("")
    }*/

    $(".//div[@id='vs_seal']/..") {
      attribute("id", "vs_seal_wrapper")
    }

  # Make the Donate button pretty
  $(".//tbody[contains(@id, 'buttons')]") {
    $(".//td[@align='right']") {
      attribute("align", "center")

      $(".//input[@id='pstep_finish']") {
        remove("./@onmouseover | ./@onmouseout")        
        #HSUS-210
        btn_delegate() {
          #add_class("mw_btn2 mw_SubmitButton")
          #text("SUBMIT")
          add_class("images-submit_logo")
        }
      }
    }
  }

  # Pre wrap the expiration date credit card <select>

  # HSUS-246 Donation Form Styling Improvements
  $(".//fieldset[contains(@class, 'cardExpGroup')]") {
    add_class("mw_flex_box")
    name("div")
    $("./select") {
      %expdate = fetch("@id")
      wrap("div", id:concat(%expdate, "_wrapper"),class:"mw_flex_box_item_1")
    }
  }

  # add in some extra arrows for the select box
  $(".//select/..") {
    add_class("mw_select_arrows")
  }
  # greeting card section
  $(".//tbody[contains(@id,'greeting_on_card_')]/tr[@id='greeting_on_card__Row']/td[@class='requiredIndicator']") {
    move_to("ancestor::tbody[1]/tr[contains(@class,'mw_gift_desc')]","top")
  }
  remove(".//tr[@id='payment_typecc_type_Row' or @id='state_province__Row' or @id='message_Row']/td[@class='requiredIndicator']")
  remove(".//label[contains(@for,'billing_addr_street2name') or contains(@for,'billing_addr_country')]/ancestor::tr[1]/td[@class='requiredIndicator']")

  # Make the phone number dialable
  $(".//a[contains(@href, 'mailto')]/parent::p") {
    wrap_text_children("span") {
      $phone_text = fetch("./text()")
      $phone_num = ""
      $phone_text {
        #log("trying to match a number")
        #log(this())
        replace(/(\d*\-*\d{3}\-\d{3}\-\d{4})/) {
          #, contcat("<a tel:'", $1, "'>", $1, "</a>")
          $phone_num = $1
        }
      }
      /*match($phone_num, "") {
        name("a")
        attributes(href: "tel:"+$phone_num)
        }*/
        inner(){
        #$click_tel = concat("<a tel:'", $1, "'>", $1, "</a>")
        replace(/(\d*\-*\d{3}\-\d{3}\-\d{4})/, concat("<a href='tel:", $phone_num, "'>", $phone_num, "</a>"))
      }
    }
    
    $(".//a[strong]") {
      remove("@style")
    }
  }

  # converts a generic format phone number to be clickable on mobile
#Courtasey of the accenture project
/*@func XMLNode.telephonize() {
  $phone_text = fetch("./text()")
  $phone_num = ""
  $phone_text {
    replace(/^\s*([ \+\-()\d]{9,}\d)\s*$/) {
      $phone_num = $1
      log($phone_num)
    }
  }
  match_not($phone_num, "") {
    name("a")
    attributes(href: "tel:"+$phone_num)
  }
  }*/

  # footer detailing
  $(".//li[@class=' mw_link_center']/a") {
    add_class("mw_bar2")
    $("../..") {
      add_class("mw_footer_link_list")

      $("./li[not(@class)]") {
        add_class('mw_footer_copyright')
      }
    }
    
  }

  # Deal with youtube videos
  $(".//object") {
    $("./embed") {
      #remove("@width")
      #remove("@height")
      attributes(width:"100%", height:"200px")
    }
    $("..") {
      remove("@style")
    }
  }


  # Use custom keyboards
  contextual_keyboard(".//input[@id='billing_addr_zipname']", "numeric")
  contextual_keyboard(".//input[@id='donor_email_addressname']", 'email')
  # HSUS-96 - numeric keyboard with decimal
  # contextual_keyboard(".//input[@class='DonationLevelOtherAmount']", 'numeric')
  $(".//input[@class='DonationLevelOtherAmount']") {
    keyboard('number')
    
    #some browsers are particular about having a '$' in the value and won't display that
    %amount = fetch("@value")
    %amount {
      replace(/\$/, '')
    }
    attributes(value: %amount, step:"0.01")
  }
  contextual_keyboard(".//input[@class='DonationLevelOtherAmount']", 'number')

  contextual_keyboard(".//input[@id='donor_phonename']", "tel")
  contextual_keyboard(".//input[@id='payment_typecc_numbername']", "numeric")
  contextual_keyboard(".//input[@id='payment_typecc_cvvname']", 'numeric')



  # Donation Thankyou page

  # vehicle donation
  $(".//img[contains(@src, 'vehicle')]/ancestor::table[1]") {
    add_class("mw_donate_vehicle")

    $(".//img/ancestor::td[1]") {
      add_class("mw_donate_vehicle_img")

      $("./following-sibling::td[1]") {
        add_class("mw_donate_vehicle_text")
      }
    }
  }

  # Share table
  $(".//img[contains(@src, 'facebook')]/ancestor::table[1]") {
    add_class("mw_donation_share")
    remove("@style")

    $(".//td[@width='20']") {
      remove()
    }


    $(".//td | .//tr") {
      remove("@width")
      remove("@height")
    }
  }


  # Summary table
  $(".//td[@class='FormSectionHeader']/ancestor::table[1]") {
    add_class("mw_transaction_summary mw_bar5")
    attribute("data-ur-toggler-component", "button")

    $("./following-sibling::table[1]") {
      attribute("data-ur-toggler-component", "content")
    }

    $("..") {
      attribute("data-ur-set", "toggler")
      attribute("style", "width: 100%;")
    }
  }
  
  $(".//tr[@id='payment_typecc_cvv_Row']") {
    $("./td[contains(@class,'mw_donate_clear')]/a[@class='HelpLink']") {
      move_to("ancestor::tr[@id='payment_typecc_cvv_Row']/td[@class='FormLabel']") 
    }
  }
  
  # taken out for HSUS-490

  # $(".//div[@id='othergive']") {
  #   attribute("data-ur-set", "toggler")

  #   $("./h2") {
  #     attribute("data-ur-toggler-component", "button")
  #     add_class("mw_bar5")
  #   }

  #   $("./ul") {
  #     attribute("data-ur-toggler-component", "content")
  #   }

  #   $("..") {
  #     attribute("style", "width: 100%;")
  #   }
  # }

  # HSUS-490  - all content is hidden from this except title, so just hide it completely
  $(".//div[@id='othergive']") {
    add_class("mw_hidden")
    ## commented out in cased needed, though seems as though it should just be hidden
    # add_class("mw_other_ways_give")
    # $(".//li") {
    #   add_class("mw_other_way")
    # }
    # $("./h2") {
    #   inner() {
    #     replace(/to Give/i, "<span class='mw_bold'>to Give</span>")
    #   }
    # }
  }
  
  #HSUS-448: Start;
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typeradio_Row']/td[@class='requiredIndicator']") {
  #   move_to("ancestor::tbody[1]/tr[contains(@class,'mw_gift_desc')]", "top")
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typelist_Row']/td[@class='requiredIndicator']") {
  #   move_to("ancestor::tbody[1]/tr[contains(@class,'FormRow mw_gift_desc')]", "top")
  # }
  # $(".//tbody[contains(@id,'payment_type')]/tr[@id='payment_typepay_typeradio_Row']/td[@class='FormInput']/fieldset/table") {
  #   add_class("mw_new_payments_inline")
  #   $("./tr"){
  #     add_class("mw_new_payments_inline_tr")
  #     $("./td[1]"){
  #       add_class("mw_new_payments_inline_tr_td_radio")
  #     }
  #     $("./td[2]"){
  #       add_class("mw_new_payments_inline_tr_td_flag")
  #     }
  #   }
  # }
  # $(".//img[@alt='PayPal']") {
  #   add_class("mw_new_payments_inline_tr_td_flag_image")
  #   $("../../td[contains(@class, 'mw_monthly_donation_desc')][2]"){
  #     text() {
  #       set("")
  #     }
  #   }
  #   move_to("../../td[contains(@class, 'mw_monthly_donation_desc')]")
  # }
  # $(".//a[@href='https://www.paypal.com/us/cgi-bin/webscr?cmd=xpt/Marketing/popup/OLCWhatIsPayPal-outside' and @class='Smaller']") {
  #   remove()
  # }
  # $(".//img[@alt='Amazon Payments']") {
  #   add_class("mw_new_payments_inline_tr_td_flag_image")
  #   $("../../td[contains(@class, 'mw_monthly_donation_desc')][2]"){
  #     text() {
  #       set("")
  #     }
  #   }
  #   move_to("../../td[contains(@class, 'mw_monthly_donation_desc')]")
  # }
  # $(".//a[@href='https://payments.amazon.com/sdui/sdui/about?nodeId=77175' and @class='Smaller']") {
  #   remove()
  # }
  # $(".//tr[@id='payment_typecc_type_Row']/td[contains(@class, 'mw_select_arrows')]") {
  #   add_class('mw_select_arrows_inline')
  # }
  # $(".//table[contains(@class, 'mw_seals') and @align='center' and @border=0]") {
  #   remove()
  # }
  $(".//table[@class='mw_bottom_seal']") {
    remove()
  }
  #HSUS-448: End;
  $(".//span[contains(text(), 'Select a Payment Type:')]") {
    move_here("ancestor::tr[contains(@class, 'FormRow')][1]/following-sibling::tr[1]/td[@class='requiredIndicator']", "top") {
      name("span")
    }
  }
  $(".//label[@for='payment_typepay_typeradiocredit']") { 
    $("..") {
      add_class("mw_v_align")
    }
  }
  remove(".//a[@class='Smaller']")
  # Fix for HSUS-482
  #remove(".//td[contains(@class,'mw_seals_center')][last()]") 
  $(".//tr[@id='payment_typecc_type_Row']/td") {
    add_class("mw_padding")
  }

  # Remove the seals from having a table align
  $(".//div[@id='side']") {
    $("./table") {
      remove("@align")
    }
  }

  # HSUS-482:[Mobile & Tablet] Gift Donation Form Styling
  
  $(".//input[@id='fulfill_eCard']") {
   move_to("ancestor::body//table[@class='tbl-ecard-type-select']//td[2]","bottom")
 }
 $(".//table[@id='overTable']/tbody[contains(@id,'tribute_type') or contains(@id,'tribute_notify') or contains(@id,'Card_Type')]") {
  add_class("mw_hidden")
}
  # Fix For HSUS-482
  $(".//tbody[@id='tribute_honoree_first_name.79286']") {
    $(".//td[@class='requiredIndicator']") {
      move_to("ancestor::body//tbody[@id='tribute_honoree_first_name.79286']/tr[1]","top")
    }
  }
  $(".//tbody[@id='tribute_honoree_last_name.79287']") {
    $(".//td[@class='requiredIndicator']") {
      move_to("ancestor::body//tbody[@id='tribute_honoree_last_name.79287']/tr[1]","top")
    }
  }
  #End of HSUS-482
  # HSUS-482:END
  # Fix For HSUS-482
  $(".//td[@class='mw_formlabel']") {
    move_to("ancestor::body//tr[@id='payment_typecc_number_Row']","top")
  }
  $(".//tr[@valign='bottom']") {
    $("./td[@align='center']") {
      add_class("mw_new_padding")
    }
  }
  # Fix for HSUS-482
  $(".//tbody[.//div[@class='section-separator']]") {
    $(".//td") {
      add_class("mw_separator")
    }
  }
  $(".//tbody[contains(@id,'e_card_preview')]") {
    remove()
  }
  # End of HSUS-482

  
  # HSUS-476
  $(".//div[@class='mw_powered_by']"){
    move_to("//div[@class='legal']")
  }

  $misaligned_seals = "true"

  $(".//img[@alt='eCard']"){
      //seals are properly aligned on this page
      $misaligned_seals = "false"
    }

    match($misaligned_seals){
      with(/true/){
        $(".//table[contains(@class, 'mw_seals')]"){
          add_class("mw_misaligned_seals")
        }
      }
    }
   # Fix for HSUS-487
   $(".//tr[@id='level_standardauto_repeat_Row']") {
    $("./td[contains(@class,'FormLabel')]") {
      add_class("mw_display")
      $("./div") {
        add_class("mw_display")
      }
    }
    $("./td[contains(@class,'FormInput')]") {
      move_to("ancestor::body//tbody[contains(@class,'mw_choose_form')]","after")
    }
  }
  match($path,/site\/Donation2\?df_id\=(14482\&14482)|(14481\&14481)/i) {
    $(".//div[@id='othergive']") {
      move_to("ancestor::body//div[@id='dataFormContainer']/table","after")
    }
  }
  match($path,/site\/Donation2\?df_id\=(14380\&14380)|(14381\&14381)/i) {
    $(".//div[@class=' mw_sidebar_content_hide']") {
      $("./img") {
        attribute("src") {
          value() {
            replace("////secure.humanesociety.org///","")
          }
        }
      }
      move_to("ancestor::body//div[@id='donation-top']","after")
      add_class("mw_alignment")
    }
  }
  $(".//td[contains(@class,'mw_seals_center')]") {
    $(".//td[.//img[@alt='charity navigator']|.//img[@alt='better business bureau']]") {
      # remove()
    }
  }
  $(".//tbody[contains(@id,'donor-email-opt-in')]") {
    remove()
  }
  # End OF HSUS-487

  $(".//td[contains(@class, 'printed-card-section')]"){
    $("./div/img"){
      move_to("../..", "bottom")
    }
  }

  $(".//tr[contains(@id,'billing_first_name')]"){
    $("./td[1]"){
      add_class("mw-donate-firstname")
    }
    $("./td[2]"){
      add_class("mw-donate-firstname")
    }
  }

  $(".//tbody[contains(@id,'billing-first-name')]"){
    insert_before("tbody", class:"section-separator-holder")
  }

  $(".//tbody[contains(@class,'section-separator-holder')]"){
    insert("tr", class:"FormRow")
    $("./tr"){
      insert("td", class:"FormCaption mw_separator")
      $("./td"){
      # Fix for HSUS-511 
      #  insert("div", "Billing Information", class:"section-separator mw-section-separator")
      }
    }
  }

  $(".//span[.='* Required']"){
    #add_class("mw_hidden")
    $("../../div[contains(text(), 'Billing Information')]"){
      #add_class("mw_hidden")
    }
  }

  $(".//label[@for='payment_typecc_numbername']"){
    move_to("//tr[@id='payment_typecc_number_Row']/td[1]","after")
    wrap("td", class:"FormLabel")
  }
  # HSUS-492: Make Thermometer Visible on Year End Donation Forms-Fixed
  $(".//div[@id='progress']/img[contains(@src,'DynImg')]"){
    %src = fetch("@src")
    %src {
      replace('DynImg', 'site/DynImg')
    }
    attribute("src", %src)
  }
  $(".//div[@id='side']"){
    move_to("ancestor::body//div[@id='donation-top']","after")
  }
  # HSUS-492-end

  # Fix for HSUS-511
  $(".//table[contains(@summary,'Credit Card')]") {
    $(".//td//img") {
      remove("./@src | ./@alt")
    }
    $(".//img[@id='payment_typecc_type_Visa']") {
      add_class("images-cc_logo_retina")
    }
  }
  $(".//a[contains(text(),'ABOUT TRUST ONLINE')]") {
    add_class("mw_norton")
  }
  $(".//div[contains(@class,'section-separator')]/span") {
    text() {
      replace("* Required","Required")
    }
  }
  match_not($path,/site\/Donation2\?1514.*/) {
    $(".//tbody[contains(@class,'mw_choose_form')]") {
      $(".//tr[@class='FormRow']") {
        move_to("ancestor::tbody","after")
      }
    }
  }
  # Fix for HSUS-511
#For HSUS-522 [Mobile & Tablet] Donation Form Update: Thermometer Wrapper One-Time (14940)
   $(".//span[@class='CheckBoxFormLabelText']"){
      text(){
        clear()
        set("Help animals all year with your monthly gift!")
      }
      move_to("//input[@id='level_standardauto_repeatname']","before")
      insert_after("br")     
      $("./ancestor::td[1]"){
       move_to("//tbody[@id='level-standard.82106']","after"){
        }
      }
  }
#End HSUS-522 [Mobile & Tablet] Donation Form Update: Thermometer Wrapper One-Time (14940)
  #Start Fix HSUS-511
  $(".//div[@id='donation-top']/div"){
    add_class("mw_vid")
  }
  #End Fix HSUS-511
}
$("./body") {
  add_class("mw_donate_login")
  remove(".//div[@id='page-head'] | .//div[@id='head'] | .//td/@width | .//table/@width")
  $(".//div[@id='contentDiv']") {
    remove(".//@style")
    $("./div[@id='cols']/div[@id='main']/div[@id='wrapper-body']") {
      add_class("mw_main_login")
      $("./span") {
        text() {
          replace(/^[\s\u00a0]+/, "")
          replace(/[\s\u00a0]+\|$/, "")
        }
      }
      remove("./br")
      $(".//div[@class='outer-border']") {
        $("./table/tr[1]/td[./span or ./form or ./div[@class='right-block']]") {
          add_class("mw_keep_td")
        }
        remove("./table/tr[1]/td[not(contains(@class, 'mw_keep_td'))]")
        $(".//table") {
          $(".//div[@class='input-border']//input/ancestor::tr[1]") {
            add_class("mw_input_form")
            $("./td[./input]") {
              add_class("mw_input_wrap")
            }
          }
          $(".//input[@type='submit']") {
            add_class("mw_btn2")
          }
          table_dump(".")
        }
        $("./span") {
          text() {
            replace(/^[\s\u00a0]+/, "")
            replace(/[\s\u00a0]+\|$/, "")
          }
        }
        
        $(".//div[@class='actions']/following-sibling::div[@id]") {
          add_class("mw_social_login")
        }
        
        remove(".//br")
      }
    }
    $("./div[not(contains(@id, 'cols'))]") {
      remove()
    }
  }
}
$("./body") {
  add_class("mw_virtualtownhall_tablet")
  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1") {

      move_here("//div[@id='footer']") {
        remove("./div[./img]")
        attribute("id") {
          value() {
            replace("er", "")
          }
        }
      }

      #manually styled footers
      move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
        remove("@style")
        remove("./img")
        $("./p") {
          name("li")
          add_class("mw_footer_info")
          move_to("./following-sibling::ul", "bottom")
        }
        $(".//*[@style]") {
          remove("@style")
        }
        $("./ul/li[1]") {
          add_class('mw_footer_copyright')
        }
        $(".//li[./a]") {
          add_class("mw_links_inline")
          remove("./self::li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
        }
      }

      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # footer

  $("./table | ./div[@id='ga-container']/div[@id='ga-content']/table") {
    attribute("id", "wrapper")
    remove(".//@width | .//@align | .//@bgcolor | .//@style | .//br[@clear='all']")
    # Header image
    $("./tr[./td[not(./table)]] | ./tbody/tr[./td[not(./table)]]") {
      attribute("class", "mw_banner_img")
      $("./td//img") {
        attribute("src") {
          value() {
            replace(/[\/|\w|\.]+(\.\..*)/) {
              set($1)
            }
          }
        }
        move_to("./ancestor::tr[@class='mw_banner_img']", "bottom")
      }
      remove("./td[not(.//img)]")
      $("./following-sibling::tr[1]") {
        attribute("class", "mw_box2_tablet")
      }
    }
  }
  table_dump(".//table")
  $(".//div[@class='lp-template-container']") {
    $("./div[@class='townhallshare']") {
      attribute("id", "share")
      $("./img") {
        name("span")
        inner(fetch("./@alt"))
        remove("./@alt | ./@height | ./@src")
      }
      $("./a[contains(text(), 'Facebook')]") {
        add_class("addthis_button_facebook")
        remove("./text()")
      }
      $("./a[contains(text(), 'Twitter')]") {
        add_class("addthis_button_twitter")
        remove("./text()")
      }
      $("./a[contains(text(), 'Tumblr')]") {
        add_class("addthis_button_tumblr")
        remove("./text()")
      }
      $("./a[contains(text(), 'Pinterest')]") {
        add_class("addthis_button_pinterest")
        remove("./text()")
      }
      $("./a[contains(text(), 'Reddit')]") {
        add_class("addthis_button_reddit")
        remove("./text()")
      }
      $("./a[contains(text(), 'Email')]") {
        add_class("addthis_button_email")
        remove("./text()")
      }
    }
    $("./div[@id='lp-donate-button']/a") {
      attribute("class", "mw_btn2")
      inner("DONATE") # HSUS-462 changed from DONATE NOW to DONATE
    }
    
    #FORM AND SUBMIT
    $("./iframe[@id='townhall_iframe'] | ./div[@id='townhall-ty-elements']") {
      add_class("mw_hide")
    }
    $("./form") {
      $("./div[@id='townhall-bottom-elements']") {
        $("./p") {
          add_class("mw_h3")
          remove("./br")
        }
        $("./div[not(@id)]") {        
          add_class("mw_hide")
        }
      }
      $(".//input[@type='submit']") {
        add_class('mw_btn2')
        wrap("div",class:"mw_submit")
      }     
    }
    #END FORM AND SUBMIT

  }
  
  $(".//div[@id='body']/following-sibling::p[contains(text(),']]')]") {
    remove()
  }
  
  $(".//script[contains(text(),'validate(')]") {
    text() {
      replace(/insertBefore/,"insertAfter")
    }            
  }
}
$("./body") {
  add_class("mw_stock_gifts")
  
  $("./div[@id='wrapper']/div[@id='page']/div[@id='contentDiv']") {
    match($tablet) {
      with(/true/) {
        add_class("mw_box2_tablet")
      }
      else() {
        add_class("mw_box2")
      }
    }
    
    remove("../div[@id='page-bottom-spacer']")
    
    $(".//div[@id='main']/div[contains(@class, 's_borderless')]") {
      $("./h1") {
        add_class("mw_h1")
      }
      $("./ul[not(@id='tools')]") {
        add_class("mw_list1")
      }
      $("./p[not(*)]") {
        match(text(), (/\A\s+\Z/)) {
          remove()
        }
      }
    }
    
    match($tablet, /true/) {
      $(".//ul[@id='action']") {
        add_class("mw_flex_box")
        $("./li") {
          add_class("mw_flex_box_item_1")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_ticketing")
  # remove powered by convio img
  remove("./div[./a[contains(@href, 'poweredby')]]")
  $("./div[@id='ga-container']") {
    $("./div[@id='ga-content']/table") {
      add_class("mw_box2")
    }
    $(".//table") {
      remove("./@style | ./@bgcolor | ./@align")
      $(".//h3") {
        add_class("mw_h3")
      }
      # main content
      $(".//div[@class='appArea']") {
        remove("./br")
        $("./p[not(*)]") {
          match(text(), /\A\s+\Z/) {
            remove()
          }
        }
        # name field
        $("./table[not(@class or @summary)]") {
          add_class("mw_name_field")
          $("./tr[.//input[@type='text']]") {
            $("./td[1]") {
              move_here("./following-sibling::td[1]/p", "bottom")
              remove("./following-sibling::td[1]")
              $("./p") {
                name("span")
              }
            }
          }
          # first / last
          $("./tr/td/table") {
            $("./tr[1]/td") {
              move_here("./ancestor::tr[1]/following-sibling::tr/td[position() = '"+ index() +"']", "bottom") {
                wrap_text_children("span") {
                  match(text(), /\A\s+\Z/) {
                    remove()
                  }
                }
              }
            }
          }
        }
        # end of name field
        
        # Available Ticket Classes for This Event
        $("./table[@class='lc_Table'][not(.//td[@class='lc_Totals'])]") {
          add_class("mw_main_tablet")
          move_here("./preceding-sibling::p[1]", "top")
          $("./tr[./th]") {
            $("./th") {
              var("th_" + index(), fetch("./p/text()"))
            }
          }
          $("./tr[position() > 1]") {
            $("./td") {
              remove("./@align")
              insert_top("span", class: "mw_table_field", var("th_" + index()) + ":")
            }
          }
          remove("./tr[./th]")
        }
        # end of Available Ticket Classes for This Event
        
        # RRequest Ticket Purchases Here
        $("./table[@class='lc_Table'][.//td[@class='lc_Totals']]") {
          add_class("mw_summary_table")
          move_here("./preceding-sibling::p[1]", "top")
          remove("./tr[./th] | .//td/@align")
        }
        # end of Request Ticket Purchases Here:
        
        $("./table[not(@class)][@summary]") {
          add_class("mw_info_table")
          remove(".//br")
          $("./tr[.//input]") {
            add_class("mw_info_item")
          }
          $("./tr/td[position() = last()]") {
            wrap_text_children("span") {
              match(text(), /\A\s+\Z/) {
                remove()
              }
            }
            move_here("./preceding-sibling::td[1]", "top") {
              add_class("mw_list_title")
              match(text(), /\A\s+\Z/) {
                remove()
              }
            }
          }
        }
        # btns
        $("./p") {
          add_class("mw_btn_wrap")
          wrap_text_children("span") {
            match(text(), /\A\s+\Z/) {
              remove()
            }
          }
          $("./input[@id='rsvp_save']") {
            add_class("mw_btn2")
          }
          $("./input[@id='rsvp_reset']") {
            add_class("mw_btn1")
          }
          move_here("./input[@id='rsvp_cancel']", "after") {
            add_class("mw_btn1")
            wrap("div", class: "mw_cancel_wrap")
          }
        }
        # end of btns
      }
      # end of main content
    }
  }
  table_dump(".//table")
  
  # for Ticket Class link
  # https://secure.humanesociety.org/site/Ticketing?view=Tickets&id=109422
  $("./div[@class='appArea'][./form[@name='TicketClassDetails']]/ancestor::body[1]") {
    add_class("mw_ticket_detail")
    $(".//h3") {
      add_class("mw_h3")
    }
  }
}
$("./body") {
  add_class("mw_donate")

  $(".//div[@id='cols']") {
    add_class("mw_box2")
  }

  $(".//div[contains(@class, 's_borderless')]") {
    remove("./@style")
  }

  # Remove all inline styles?
  #remove(".//*[@style]/@style")


  # Monthly donation | One Time Gift
  $(".//div[@id='monthly_sec'] | .//div[@id='onetime_sec']") {
    add_class("mw_box7 mw_donate_form")

    $("./h2") {
      add_class("mw_bar4")
    }

    $("./form") {
      $("./span") {
        add_class("mw_amount")
      }

      #move the input box into the associated label

      $(".//label") {
        move_here("./preceding-sibling::input", "top")
      }

      $(".//button") {
        add_class("mw_btn2")
      }

      $(".//p[button[@type='submit']]") {
        add_class("mw_btn_center")
      }

      # Make the custom amount a numeric keyboard
      $(".//input[@id='onetime-value'] | .//input[@id='monthly-value']") {
        # HSUS-96
        keyboard("number")
        attribute("size", "6")
      }
    }
  }

  # Become a member, humane leader, gift donation, memorial donation
  $(".//a[@class='more']") {
    add_class("mw_bar1")
  }

  # Make the Shop to help Animals and Other Ways to give togglers

  $(".//div[@id='otherways'] | .//div[@id='otherways']/following-sibling::div") {
    attribute("data-ur-set", "toggler")
    remove("./@style")

    $("./h2") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_help_animals")
    }
    $("./div[contains(@class, 'col')]") {
      attribute("data-ur-toggler-component", "content")
    }
  }

  # Bottom 
  $(".//div[@id='side']/div[last()][not(contains(@id,'state'))]") {
    add_class("mw_donate_seals mw_flex_box")
    remove("./@style")

    $("./a") {
      add_class("mw_flex_box_item_1")
    }

    $("./a/img") {
      remove("./@style")
    }
  }
  # Move the trust logos to the top of the donate form. HSUS-112

  $(".//div[@id='side']") {
    $("./div[contains(@class,'mw_donate_seals')]") {
      move_to("./ancestor::div[@id='cols']//div[@id='give']", "top")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    # wayne blog
    $(".//div[@id='wayne']") {
      add_class("mw_sidebar4")
    }
    # In your state
    $("./div[@id='state']") {
      add_class("mw_sidebar5")
    }
    move_to("ancestor::div[@id='cols']","after")
    remove("ancestor::div[@id='page']/div[@id='page-bottom-spacer']")
  }
  
  # HSUS-306 Philanthropy Contact page
  # http://www.humanesociety.org/donate/help/
  match($path,/^\/donate\/help/) {
    $(".//div[@id='main']/div[contains(@class,'section')]") {
      add_class("mw_help_section")
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
      $("self::div[contains(@class,'simple')]/h2[1]/following-sibling::p") {
        wrap_text_children("span", class:"mw_help_content")
        remove(".//br")
      }
      remove("./br")
      $("./h3") {
        add_class("mw_h3")
      }
      $("./h2") {
        add_class("mw_h2")
      }
      $("ancestor::div[@id='cols']/div[@id='side']") {
        # remove wayne's podcast and in your state section
        move_to("ancestor::div[@id='cols']","after")
      }
      remove("ancestor::div[@id='page']/div[@id='page-bottom-spacer']")
    }
  }
  # END HSUS-306 Philanthropy Contact page

}
$("./body") {
  add_class("mw_edit_profile")
  # when error message appear, the img will broken
  $(".//img[contains(@src, 'ConsProfileUser') or contains(@src, 'ConsInterestsUser')]") {
    attribute("src") {
      value() {
        replace(/\/(ConsProfileUser|ConsInterestsUser)/, "")
      }
    }
  }
  remove(".//div[@id='page-head'] | .//ul[@id='site-nav'] | .//div[@id='head']")
  # main content
  $(".//div[@id='wrapper-body']") {
    remove("./@style | ./br")
    # desktop site display none
    $(".//p/a[contains(@href, 'Passwd')]") {
      add_class("mw_hide")
    }
    $(".//h3") {
      add_class("mw_h3")
    }
    # btns
    $(".//p[./input[@class='Button']]") {
      add_class("mw_btn_center")
      $("./input[@value='Save' or @title='Done' or @title='Register' or contains(@value, 'Home')]") {
        add_class("mw_btn2")
      }
      $("./input[@value='Cancel' or @value='Reset']") {
        add_class("mw_btn1")
      }
    }
    # end of btns
    
    # edit profile
    $(".//form[@id='EditCons']/fieldset") {
      $(".//td[not(*)]") {
        match(text(), /\A\s+\Z/) {
          remove()
        }
      }
      $("./table[@class='grid']") {
        $("./tr") {
          $(".//table[contains(@class, 'cons-name')]") {
            $("./tr[1]") {
              $("./td") {
                move_here("../following-sibling::tr/td[1]") {
                  add_class("mw_edit_data")
                }
              }
            }
          }
        }
        $("./tr/td[./p[@class='label'][not(contains(text(), 'Opt-in'))]][not(.//input)][not(.//select)][not(.//label[@class='wrapable'])]") {
          add_class("mw_edit_field")
        }
        $(".//p[@class='label'][./label[@class='wrapable']]") {
          add_class("mw_input_title")
        }
        # Text Message Opt-in:
        $("./self::table[.//input[contains(@id, 'custom_boolean')]]") {
          $("./tr/td[1]/p") {
            add_class("mw_optin")
            move_here("../following-sibling::td/input", "top")
          }
        }
        $("./self::table[.//p[contains(text(), 'Opt-in')]]/tr/td[1]/p") {
          move_here("../following-sibling::td/span", "after")
          add_class("mw_optin_data")
        }
      }
      table_dump(".")
    }
    # end of edit profile
    
    # Email Subscriptions
    $(".//form[@id='ConsConfigInterests']") {
      remove("./table[.//input[@id='ConsInterestsUseremailPrefsEMAILOpenAll']] | ./table/@style | ./br")
      $("./table[@class='tree-view']") {
        $(".//tr[./th]") {
          $("./th") {
            var("th_" + index(), fetch("./p/text()"))
          }
        }
        $(".//tr[not(./th)]") {
          $("./td") {
            remove("./img[contains(@src, 'sp.gif')]")
            insert_top("span", class: "mw_tree_field", var("th_" + index()) + ":") {
              insert_after("div", class: "mw_tree_data") {
                move_here("./following-sibling::*", "bottom")
              }
            }
          }
        }
        remove(".//tr[./th]")
        table_dump(".")
      }
    }
    # end of Email Subscriptions
  }
  # end of main content
}
$("./body") {
  add_class("mw_hslf_donate_tablet")

  $(".//a[@class='mw_header_spillover']") {
    # insert("img", src:"http://www.humanesociety.org/assets/images/global/logo.png")
  }

  fixImages()

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")

    $("./div[@id='main']") {
      add_class('mw_gray_inner')
    }
  }

  # Remove the styling
  $(".//table") {
    remove("@style")
    remove("@bgcolor")

    $("./tbody/tr/td") {
      remove("@width")
    }
  }

  $("./table") {
    # add_class("mw_box1")
  }

  # Remove all inline styling.. except for those with display: none; for the tables and children
  $("./table//*[@style and not(contains(@style, 'display'))]") {
    remove("@style")
  }
  $(".//table[@bgcolor]") {
    remove("@bgcolor")
  }

  # The main donation form content
  $(".//table[@id='contentTable']") {

    $(".//td[@id='contentArea']") {
      #add_class("mw_box2")
      add_class("mw_box2_tablet") 
    }

    # remove the forced width
    remove("@width")

    # hide the sidebar links..
    $("../preceding-sibling::td") {
      add_class("mw_hide")
    }

    # Tag the row that the main content table is in
    $("./ancestor::tr[1]") {
      add_class("mw_content_table_row")
    }

    # Remove some margin styling
    $(".//td[@id='breadcrumbbar']") {
      remove("./br")
      $("./div") {
        remove("@style")
      }
      
    }

    # Before adding the arrows to the credit card popups, wrap them in <span>s
    $(".//fieldset[@class='cardExpGroup']/select") {
      wrap("span")
    }

    # add in some extra arrows for the select box
    $(".//select/..") {
      add_class("mw_select_arrows")
    }

    # Replace the "Make a donation" image with text.. because image text is so 1998
    $(".//td[@class='FormCaption']") {
      
      # Remove the forced width on the table
      $("./table") {
        remove("@style")
      }

      $(".//img[contains(@alt, 'Donation')]") {
        %title = fetch("@alt")

        insert_top("div", class:"mw_hslf_title", %title)
        add_class("mw_hide")

        $("..") {
          remove("./br")
        }
      }

      
    }

    # Here's where all the action takes place
    $(".//form[@id='ProcessForm']") {
      add_class("mw_gray_inner")
      $(".//table | .//tr | .//tbody") {
        name("div")
      }
      $(".//td") {
        name("span")
      }

      # try splitting up the donation amounts similar to how the mockup is
    $(".//div[contains(@id,'level-standard')]") {
        $("./div[contains(@class, 'FormRow') and position() < 7]") {
          add_class("mw_amount_column_one")
        }
        $("./div[position() > 6]") {
          add_class("mw_amount_column_two")
        }
      }
      wrap_together(".//div[contains(@class, 'mw_amount_column_one')]", "div", id:"mw_amount_column_one")
      wrap_together(".//div[contains(@class, 'mw_amount_column_two')]", "div", id:"mw_amount_column_two")

      # Provide a way to limit the size of the labels of the radio buttions
      $(".//label[@class='RadioGroupLabel']/..") {
        add_class("radioGroupLabeltd")

        $("./ancestor::div[@class='FormRow']") {
          add_class("mw_radio_columns")
        }
      }

      # bump down the radio button for the "other" donation amount
      $(".//input[@class='DonationLevelOtherAmount']/ancestor::td[1]") {
        # /ancestor::tr[1]//input[@type='radio']
        add_class('mw_radio_alignment')
      }

      $(".//span[@class='requiredIndicator'] | .//span[@class='FormLabel']") {
        inner() {
          replace(/\xC2\xA0/, '')
        }
      }

      # Make the Credit cards one row
      $(".//div[@id='payment_typecc_type_Row']//fieldset") {
        add_class("mw_creditcard_row")

        $("./div") {
          add_class("mw_flex_box")

          $("./span") {
            add_class("mw_flex_box_item_1")
          }
        }
      }

      $(".//div[@id='overTable']") {
        wrap_together("./div[not(contains(@id,'html-caption'))]", "div", class:"mw_box6 mw_form_donate")

        move_here("./div[contains(@id, 'html-caption')][1]", "top")
      }
    }
  }

  # Hide all the table rows that we are not using..

  $("./table/tbody/tr[not(@class)]") {
    add_class('mw_hide')
  }

  $(".//input[@class='NextButton']") {
    add_class ("mw_btn2")
    remove("@onmouseover")
    remove("@onmouseout")
  }


  ##########################################
  # This is an alternate form

  $(".//table[@id='formtop']/ancestor::table[@align='center'][1]") {
    remove("@width")
    add_class("mw_box2")

    $(".//td") {
      remove("@width")
      remove("@style")
      $("./p") {
        remove("@style")
      }
    }

    # Make the body text look more appealing
    $(".//tr[1]/td[1]/p[1]") {
      add_class("mw_hslf_donate_block_header")
    }

    $(".//param[@name='width']") {
      attribute("value", "280")
    }
  }

  $(".//img[contains(@alt, 'commercial')]") {
    add_class("mw_hide")
    %descText = fetch("@alt")

    insert_after("p", class:"commercialText", %descText)
    $("..") {
      attribute("style", "display: block;")
    }
  }

  # This is the donor gift
  $(".//td[@valign='top']") {
    remove("@bgcolor")
    $("./table") {
      remove("@width")
      add_class("mw_hsus_donation_gift")
    }
  }
  # remove the extra Donate Monthly button
  $(".//table[contains(@class, 'mw_hsus_donation_gift')]//img[contains(@alt, 'donate monthly')]/ancestor::tr[1]") {
    remove()
  }

  # Remove this <hr>
  $(".//td[hr]/..") {
    remove()
  }

  # Clean up the FAQ section
  # Remove their toggling script.. use ours
  $(".//div[@id='FAQsection']") {

    remove("./preceding-sibling::script")
    
    $("./p[contains(@class,'question')]") {
      remove("./img")
      add_class("mw_bar5")
      attribute("data-ur-toggler-component", "button")
    }

    $("./p[contains(@class, 'answer')] | ./div[contains(@id, 'answer')]") {
      attribute("data-ur-toggler-component", "content")
      remove("@style")

      # Wrap the Questions and Answers together
      wrap("div", data-ur-set:"toggler", class:"qa_section") {
        move_here("./preceding-sibling::p[contains(@id, 'question')][1]", "top")
      }
    }
  }

  # Custom Keyboards
  $(".//input[@class='DonationLevelOtherAmount']") {
    keyboard("number")
    attribute("size", "6")
  }
   contextual_keyboard(".//input[@id='billing_addr_zipname']", "numeric")
  contextual_keyboard(".//input[@id='donor_email_addressname']", "email")
  # contextual_keyboard(".//input[@id='donor_phonename']", 'tel')
  contextual_keyboard(".//input[@id='payment_typecc_numbername']", 'numeric')
  contextual_keyboard(".//input[@id='payment_typecc_cvvname']", 'numeric')
}
# tell a friend advocacy pages
# https://secure.humanesociety.org/site/Advocacy?cmd=display&page=ActionAlertTakenPage&id=6075


$("./body") {

  add_class("mw_tellafriend")
  fixImages()

  remove(".//div[@id='ga-header']/img")

  # are we in a taf-tab page?
  # some tell-a-friend pages have big sections with prewritten textareas.
  $(".//div[@id='ga-content' and .//div[contains(@class, 'taf-share-container')]]") {
    add_class("mw_taf_tabs")
  }

  # ditch convio
  $(".//div[a[contains(@href, 'poweredby')]]") {
    remove()
  }

  # main content, with tabs
  $(".//div[contains(@class, 'mw_taf_tabs')]") {

    move_here(".//div[@id='ga-header']", "top") {
    # this code use to fixed #HSUS-341 page and #HSUS-379 Thank you page
    # https://secure.humanesociety.org/site/Advocacy?cmd=display&page=OnScreenThanks&id=5951
    # https://secure.humanesociety.org/site/Advocacy?cmd=display&page=OnScreenThanks&id=6045
      move_here("./following-sibling::table[1]//div[@id='action-alert' or @class='appArea']", "after") {
        attribute("class", "mw_box2")
        remove(".//@style")
        remove("./div[@class='showondesktop']")
        $("./h2") {
          attribute("class", "mw_h3")
        }
        $("./h3") {
          attribute("class", "mw_h3")
        }
        # HSUS-510
        remove("./br")
        $("./div[contains(@class, 'taf-share-container')]") {
          attributes(data-ur-set:"tabs")
          insert_top("div", class:"mw_share_button mw_flex_box")
          $("./a") {
            name("div")
            %mw_tab_index = index()
            %mw_tab_class = fetch("./@class") {
              replace(/\w+_/, "")
            }
            insert_before("div", %mw_tab_class, data-ur-tabs-component:"button", class:"mw_"+%mw_tab_class+"_button mw_flex_box_item_1", data-ur-tab-id: "mw_tab_"+%mw_tab_index) {
              $("./self::div[contains(@class, 'facebook')]") {
                attribute("data-ur-state", "enabled")
              }
              move_to("./preceding-sibling::div[contains(@class, 'mw_share_button')]", "bottom")
            }
            attributes(data-ur-tabs-component:"content", data-ur-tab-id: "mw_tab_"+%mw_tab_index)
            $("./self::div[contains(@class, 'facebook')]") {
              attribute("data-ur-state", "enabled")
            }
            # fixed textarea no text issue
            $(".//textarea") {
              remove("./@rows | ./@cols | ./@unselectable | ./@disabled")
              attribute("readonly", " ")
            }
            insert_bottom("a", fetch("./@class"), class: fetch("./@class")+" mw_btn2", href: fetch("./@href")) {
              text() {
                replace(/\w+_/, "SHARE ON ")
                replace("facebook", "FACEBOOK")
                replace("twitter", "TWITTER")
                replace("ON email", "VIA EMAIL")
              }
              wrap("div", class:"mw_btn_box")
            }
          }
        }
        $("./div[@class='supertaf-donate-section']/div[@class='supertaf-donate-form']/form[@id='taf-donate']") {
          $("./div[@class='supertaf-donate-text']") {
            insert_top("div", "DONATE NOW", class:"mw_donate_title")
          }
          $("./div[@class='supertaf-donate-amounts']") {
            $("./label | ./input[@id='supertaf-box']") {
              move_to("./preceding-sibling::div[@class='mw_amount'][1]", "bottom")
            }
            $("./input[@class='supertaf-donate-button']") {
              btn_delegate() {
                attribute("class", "mw_btn2")
                inner("CONTINUE")
              }
            }
            # Fix for HSUS-510 : Mobile
            #remove("./br | ./label | ./input[not(@id='supertaf-box' or @type='submit')]")
            $("./strong") {
              #inner("$")
              # wrap("div", class:"mw_amount") {
              # move_here("./following-sibling::input[@id='supertaf-box']", "bottom")
              # }
            }
          }
        }
        # HSUS-373
        $("./div[@id='share_bar']") {
          add_class("mw_new_tell_a_friend")
          $(".//a[./img[@alt='Donate now']]") {
            add_class("mw_donate_now")
          }
          $(".//a") {
            insert("span", fetch("./img/@alt"))
            remove("./img")
          }
        }
        # HSUS-427 Remove Excess White Space on Alert 5699's Thank You Page
        $("./iframe[contains(@src, 'glitternetwork')]") {
          add_class("mw_hide2")
        }
      }
      # end revert code
    }
    remove("./table")
  }


  # main content, no tabs
  $(".//div[@id='ga-content' and not(@class)]") {
    # get header and fix nesting
    move_here(".//div[@class='appArea']", "top")
    move_here(".//div[@id='ga-header']", "top")
    remove("./table")

    $(".//div[@class='appArea' or @id='action-alert']") {
      add_class("mw_main mw_box2")

      # text
      $(".//div[@class='showonmobile']") {
        move_here(".//td") {
          name("div")
        }
        remove("./table")
        $(".//div[contains(@id, 'headline')]") {
          add_class("mw_h1")
        }
      }

      # share logos
      $(".//div[@id='share_bar']") {
        add_class("mw_share_logos")
        remove("@id")
        move_here(".//a")
        remove("./table")
      }
    }
  }

}

# old metamoai code

  # move_here("./following-sibling::table[1]//div[@id='action-alert' or @class='appArea']", "after") {

  # remove("./div[.//img[@alt='Powered By Convio']]")
$("./body") {
  add_class("mw_valor_award")
  remove("./div[@id='wrapper']/br")
  $("./div[@id='wrapper']/div[@id='page']") {
    remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style]")
    $("./div[@id='contentDiv']/div[@id='cols']/div[@id='main']/div[@id='wrapper-body']") {
      remove("./@style")
      # share
      $("./ul[@id='share_bar']/li/img[@class='share_image']") {
        name("span")
        insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
        remove()
      }
      # end share
      $("./div[contains(@id, 'pov-col')]") {

        $(".//h3") {
          add_class("mw_h3")
        }
        $("./div[@class='pov-text']") {
          $("./h2") {
            add_class("mw_h2")
            remove("./br")
          }
          $("./p") {
            name("div")
            wrap_text_children("span")
            $("./br/following-sibling::span[1]") {
              wrap("div", class:"mw_wrap_div")
            }
            $("./a | ./span | ./strong") {
              move_to("preceding-sibling::div[1]", "bottom")
            }
            remove("./br")
          }
        }
        $(".//div[@class='pov']") {
          remove(".//@style | .//@width")
          $("./img") {
            add_class("mw_img")
          }
          $("./p[not(*)]") {
            text() {
              replace(/^[\s\u00a0]+/, "")
              replace(/[\s\u00a0]+\|$/, "")
            }
          }
        }
        # cast your vote area
        $(".//div[@id='pov-fields-input-boxes']") {
          remove("./p/@style | ./div[@id='bogotext']//img/@style")
          $("./div/input") {
            add_class("mw_input")
          }
          $("./label[./input[@class='radio']]") {
            add_class("mw_radio")
            move_here("./following-sibling::div[@id='pov-radio-area-legal' or @id='pov-radio-error-legal']", "bottom")
          }
          $("./input[@class='pov-submit-button']") {
            add_class("mw_btn1")
            wrap("div", class: "mw_submit_btn")
          }
        }
        # end cast your vote area
      }
    }
  }
}
$("./body") {
  add_class("mw_donate_tablet")
  
  #HSUS-192 
  remove(".//div[@id='page-bottom-spacer']")
  
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  # add a header 
  # $(".//div[@id='shell'] | .//div[@id='wrapper']") {
  #   insert_top("div", class:"mw_head_spacer") {
  #     insert("div", class:"mw_head_spacer_text", "Donate")
  #   }
  # }

  $(".//div[contains(@class, 's_borderless')]") {
    remove("./@style")
  }

  # Remove all inline styles?
  #remove(".//*[@style]/@style")

  # Become a member, humane leader, gift donation, memorial donation
  $(".//a[@class='more']") {
    add_class("mw_bar1")
  }

  # main content
  $(".//div[@id='content']") {
    # top section
    $("./div[@id='givenow']") {
      # Monthly donation | One Time Gift
      $("./div[@id='monthly_sec'] | ./div[@id='onetime_sec']") {
        add_class("mw_box7 mw_flex_box_item_1 mw_donate_form")

        $("./h2") {
          add_class("mw_bar4")
        }

        $("./form") {
          $("./span") {
            add_class("mw_amount")
          }

          #move the input box into the associated label

          $(".//label") {
            move_here("./preceding-sibling::input", "top")
          }

          $(".//button") {
            add_class("mw_btn2")
          }

          $(".//p[button[@type='submit']]") {
            add_class("mw_btn_center")
          }

          # Make the custom amount a numeric keyboard
          $(".//input[@id='onetime-value'] | .//input[@id='monthly-value']") {
            keyboard("number")
            attribute("size", "6")
          }
        }
      }
      wrap_together("./div[contains(@class,'mw_box7')]", "div") {
        add_class("mw_flex_box")
      }
      # end of Monthly donation | One Time Gift

      $("./div[contains(@class, 'col')]/dt[@class='menu_head']") {
        wrap("div", class:"mw_content") {
          move_here("./following-sibling::p[@class='para'][1]", "bottom")
          move_here("./following-sibling::a[contains(@class, 'more')][1]", "bottom")
        }
      }
      $("./div[contains(@class, 'col1')]/div[contains(@class, 'mw_content')]") {
        add_class("mw_flex_box_item_1")
        wrap("div", class:"mw_flex_box") {
          move_here("./ancestor::div[@id='givenow'][1]/div[contains(@class, 'col2')]/div[contains(@class, 'mw_content')][1]", "bottom") {
            add_class("mw_flex_box_item_1")
          }
          move_to("..", "before")
        }
      }
      remove("./div[contains(@class, 'col')]")
    }
    # end of top section

    # Other Ways to give
    $(".//div[@id='otherways']") {
      remove(".//@style")
      # section title
      $("./h2") {
        add_class("mw_help_animals")
      }
      # end of section title
      # HSUS-232 align "Other Ways to give" section
      $("./div[contains(@class, 'col')]") {
        $("./dl") {
          name("div")
          add_class("mw_content")
        }
        $("./dt[@class='menu_head']") {
          wrap("div", class:"mw_content") {
            move_here("./following-sibling::dd[@class='menu_body'][1]", "bottom")
          }
        }
      }
      $("./div[contains(@class, 'col1')]/div[contains(@class, 'mw_content')]") {
        add_class("mw_flex_box_item_1")
        wrap("div", class:"mw_flex_box") {
          move_here("./ancestor::div[@id='otherways'][1]/div[contains(@class, 'col2')]/div[contains(@class, 'mw_content')][1]", "bottom") {
            add_class("mw_flex_box_item_1")
          }
          move_to("..", "before")
        }
      }
      remove("./div[contains(@class, 'col')]")
    }
    # end of Other Ways to give

    # Shop To Help Animals
    $("./div[contains(@class, 'section')][not(@id)]") {
      remove("./@style")
      # section title
      $("./h2") {
        add_class("mw_help_animals")
      }
      # end of section title
      $("./div[contains(@class, 'col')]") {
        add_class("mw_flex_box_item_1")
      }
      wrap_together("./div[contains(@class, 'col')]", "div") {
        add_class("mw_flex_box")
      }
    }
  }
  # end of main content

  # Bottom
  # HSUS-232 move the logos to the top right
  $(".//div[@id='side']/div[last()]") {
    add_class("mw_donate_seals")
    remove("./@style")
    $("./a/img") {
      remove("./@style")
    }
  }
  # end of HSUS-232

  # Move the trust logos to the top of the donate form. HSUS-112
  $(".//div[@id='side']/div[contains(@class,'mw_donate_seals')]") {
    move_to("./ancestor::div[@id='cols']//div[@id='give']", "top")
  }
  # end of HSUS-112
  
  # HSUS-306 Philanthropy Contact page
  # http://www.humanesociety.org/donate/help/
  match($path,/^\/donate\/help/) {
    $(".//div[@id='main']/div[contains(@class,'section')]") {
      add_class("mw_help_section")
      $("./p[not(*)]") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
      $("self::div[contains(@class,'simple')]/h2[1]/following-sibling::p") {
        wrap_text_children("span", class:"mw_help_content")
        remove(".//br")
      }
      remove("./br")
      $("./h3") {
        add_class("mw_h3")
      }
      $("./h2") {
        add_class("mw_h2")
      }
    }
  }
  # END HSUS-306 Philanthropy Contact page
  #  sidebar
  $(".//div[@id='side']") {
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5 mw_flex_box_item_1")
      $(".//h2") {
        add_class("mw_h2")
      }
      wrap("div",class: "mw_flex_box")
    }
    $("./div[./div[@id='wayne']]") {
      add_class("mw_flex_box_item_1")
      remove(".//@style")
      move_to("following-sibling::div[@class='mw_flex_box']")
      $("./div[@id='wayne']") {
        add_class("mw_sidebar4")
        $(".//h2") {
          add_class("mw_h2")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_st_francis_box_tablet")

  $("./div[@id='wrapper']") {
    $("./div[@id='page']") {
      remove("./div[@id='page-head'] | ./div[@id='contentDiv']/div[@id='head'] | ./div[@id='contentDiv']/div[@style] | ./br")
      $("./div[@id='contentDiv']/div[@id='cols']") {
        add_class("mw_box2_tablet") 
        $("./div[@id='main']/div[@id='wrapper-body']") {
          remove("./@style")
          # share
          $("./ul[@id='share_bar']/li/img[@class='share_image']") {
            name("span")
            insert_after("span", fetch("./@alt")+":" , class: "mw_share_text")
            remove()
          }
          # end share
          
          # toptext
          $("./div[@id='francis-toptext']") {            
            # removing all toptext style
            $("./*") {
              remove("@style")
            }
            
            $("./div[@id='francis-title']/h1") {
              add_class("mw_h2")
            }
            
            $("./div[a]") {
              attribute("id","mw_topic_photo")
            }
            
            #form title
            $("./p[position() = last()]"){              
              add_class("mw_h3")
              move_to("../../form","top")
            }
            
            $("./ul") {
              wrap("div") {
                attribute("id","mw_topics")
                move_here("./preceding-sibling::p[1]","top")
              }  
            }
            insert("div") {
              attribute("class","mw_topic")
              move_here("../div[@id='mw_topic_photo' or @id='mw_topics']")              
            }
          }
          # end toptext
          #form
          $("./form") {
            attribute("class","mw_st_form")
            $("./div[@id='chimps-bottom-elements']//input | ./div[@id='chimps-bottom-elements']//textarea") {
              remove("@style")
            }            
            $(".//input[@type='text'] | .//select") {
              add_class("mw_input")
            }
            $(".//input[@class='francis-submit-button']") {
             add_class("mw_btn1")
             wrap("div") {
               attribute("class","mw_submit_btn")
             }
            }
          }
          #
          
          $(".//script[contains(text(),'validate(')]") {
            text() {
              replace(/insertBefore/,"insertAfter")
            }            
          }
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_hslf_donate")

  fixImages()

  # Remove the styling
  $(".//table") {
    remove("@style")
    remove("@bgcolor")

    $("./tbody/tr/td") {
      remove("@width")
    }
  }

  $("./table") {
    add_class("mw_box1")
  }

  # Remove all inline styling.. except for those with display: none; for the tables and children
  $("./table//*[@style and not(contains(@style, 'display'))]") {
    remove("@style")
  }
  $(".//table[@bgcolor]") {
    remove("@bgcolor")
  }

  # The main donation form content
  $(".//table[@id='contentTable']") {

    $(".//td[@id='contentArea']") {
      add_class("mw_box2")
    }

    # remove the forced width
    remove("@width")

    # hide the sidebar links..
    $("../preceding-sibling::td") {
      add_class("mw_hide")
    }

    # Tag the row that the main content table is in
    $("./ancestor::tr[1]") {
      add_class("mw_content_table_row")
    }

    # Remove some margin styling
    $(".//td[@id='breadcrumbbar']") {
      remove("./br")
      $("./div") {
        remove("@style")
      }
      
    }

    # Replace the "Make a donation" image with text.. because image text is so 1998
    $(".//td[@class='FormCaption']") {
      
      # Remove the forced width on the table
      $("./table") {
        remove("@style")
      }

      $(".//img[contains(@alt, 'Donation')]") {
        %title = fetch("@alt")

        insert_top("div", class:"mw_hslf_title", %title)
        add_class("mw_hide")

        $("..") {
          remove("./br")
        }
      }

      
    }

    # Here's where all the action takes place
    $(".//form[@id='ProcessForm']") {
      $(".//table | .//tr | .//tbody") {
        name("div")
      }
      $(".//td") {
        name("span")
      }

      $(".//span[@class='requiredIndicator'] | .//span[@class='FormLabel']") {
        inner() {
          replace(/\xC2\xA0/, '')
        }
      }

      # Make the Credit cards one row
      $(".//div[@id='payment_typecc_type_Row']//fieldset") {
        add_class("mw_creditcard_row")

        $("./div") {
          add_class("mw_flex_box")

          $("./span") {
            add_class("mw_flex_box_item_1")
          }
        }
      }

      $(".//div[@id='overTable']") {
        wrap_together("./div[not(contains(@id,'html-caption'))]", "div", class:"mw_box6 mw_form_donate")

        move_here("./div[contains(@id, 'html-caption')][1]", "top")
      }
    }
  }

  # Hide all the table rows that we are not using..

  $("./table/tbody/tr[not(@class)]") {
    add_class('mw_hide')
  }

  $(".//input[@class='NextButton']") {
    add_class ("mw_btn2")
    remove("@onmouseover")
    remove("@onmouseout")
  }


  ##########################################
  # This is an alternate form

  $(".//table[@id='formtop']/ancestor::table[@align='center'][1]") {
    remove("@width")
    add_class("mw_box2")

    $(".//td") {
      remove("@width")
      remove("@style")
      $("./p") {
        remove("@style")
      }
    }

    # Make the body text look more appealing
    $(".//tr[1]/td[1]/p[1]") {
      add_class("mw_hslf_donate_block_header")
    }

    $(".//param[@name='width']") {
      attribute("value", "280")
    }
  }

  $(".//img[contains(@alt, 'commercial')]") {
    add_class("mw_hide")
    %descText = fetch("@alt")

    insert_after("p", class:"commercialText", %descText)
    $("..") {
      attribute("style", "display: block;")
    }
  }

  # This is the donor gift
  $(".//td[@valign='top']") {
    remove("@bgcolor")
    $("./table") {
      remove("@width")
      add_class("mw_hsus_donation_gift")
    }
  }
  # remove the extra Donate Monthly button
  $(".//table[contains(@class, 'mw_hsus_donation_gift')]//img[contains(@alt, 'donate monthly')]/ancestor::tr[1]") {
    remove()
  }

  # Remove this <hr>
  $(".//td[hr]/..") {
    remove()
  }

  # Clean up the FAQ section
  # Remove their toggling script.. use ours
  $(".//div[@id='FAQsection']") {

    remove("./preceding-sibling::script")
    
    $("./p[contains(@class,'question')]") {
      remove("./img")
      add_class("mw_bar5")
      attribute("data-ur-toggler-component", "button")
    }

    $("./p[contains(@class, 'answer')] | ./div[contains(@id, 'answer')]") {
      attribute("data-ur-toggler-component", "content")
      remove("@style")

      # Wrap the Questions and Answers together
      wrap("div", data-ur-set:"toggler", class:"qa_section") {
        move_here("./preceding-sibling::p[contains(@id, 'question')][1]", "top")
      }
    }
  }

  # Custom Keyboards
  $(".//input[@class='DonationLevelOtherAmount']") {
    keyboard("number")
    attribute("size", "6")
  }
   contextual_keyboard(".//input[@id='billing_addr_zipname']", "numeric")
  contextual_keyboard(".//input[@id='donor_email_addressname']", "email")
  # contextual_keyboard(".//input[@id='donor_phonename']", 'tel')
  contextual_keyboard(".//input[@id='payment_typecc_numbername']", 'numeric')
  contextual_keyboard(".//input[@id='payment_typecc_cvvname']", 'numeric')
}
$("./body") {
  add_class("mw_chimps_tablet")
  $footer_exist = "false"
  $(".//div[contains(@class, '_footer')]") {
    $footer_exist = "true"
  }
  # footer
  match($footer_exist, "true") {
    remove("./div[.//img[contains(@src, 'poweredbyconvio')]]")
  }
  match($footer_exist, "false") {
    insert_bottom("div", class: "_footer mw_box1") {

      move_here("//div[@id='footer']") {
        remove("./div[./img]")
        attribute("id") {
          value() {
            replace("er", "")
          }
        }
      }

      #manually styled footers
      move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
        remove("@style")
        remove("./img")
        $("./p") {
          name("li")
          add_class("mw_footer_info")
          move_to("./following-sibling::ul", "bottom")
        }
        $(".//*[@style]") {
          remove("@style")
        }
        $("./ul/li[1]") {
          add_class('mw_footer_copyright')
        }
        $(".//li[./a]") {
          add_class("mw_links_inline")
          remove("./self::li[./a[contains(@href, 'twitter') or contains(@href, 'facebook')]]")
        }
      }

      insert_bottom("div", class:"mw_powered_by", "Mobile Site Powered by ") {
        insert("span", class:"footer-strong", "Moovweb")
      }
    }
  }
  # footer

  $("./table | ./div[@id='ga-container']/div[@id='ga-content']/table") {
    attribute("id", "wrapper")
    remove(".//@width | .//@align | .//@bgcolor | .//@style | .//br[@clear='all']")
    # Header image
    $("./tr[./td[not(./table)]] | ./tbody/tr[./td[not(./table)]]") {
      attribute("class", "mw_banner_img")
      $("./td//img") {
        attribute("src") {
          value() {
            replace(/[\/|\w|\.]+(\.\..*)/) {
              set($1)
            }
          }
        }
        move_to("./ancestor::tr[@class='mw_banner_img']", "bottom")
      }
      remove("./td[not(.//img)]")
      $("./following-sibling::tr[1]") {
        attribute("class", "mw_box2_tablet")
      }
    }
  }
  table_dump(".//table")
  $(".//div[@class='lp-template-container']") {
    $("./div[@class='infographicshare']") {
      attribute("id", "share")
      $("./img") {
        name("span")
        inner(fetch("./@alt"))
        remove("./@alt | ./@height | ./@src")
      }
      $("./a[contains(text(), 'Facebook')]") {
        add_class("addthis_button_facebook")
        remove("./text()")
      }
      $("./a[contains(text(), 'Twitter')]") {
        add_class("addthis_button_twitter")
        remove("./text()")
      }
      $("./a[contains(text(), 'Tumblr')]") {
        add_class("addthis_button_tumblr")
        remove("./text()")
      }
      $("./a[contains(text(), 'Pinterest')]") {
        add_class("addthis_button_pinterest")
        remove("./text()")
      }
      $("./a[contains(text(), 'Reddit')]") {
        add_class("addthis_button_reddit")
        remove("./text()")
      }
      $("./a[contains(text(), 'Email')]") {
        add_class("addthis_button_email")
        remove("./text()")
      }
    }
    $("./div[@id='lp-donate-button']/a") {
      attribute("class", "mw_btn2")
      inner("DONATE TO HELP CHIMPS")
    }

    $("./div[@class='lp-aa-box']") {
      move_here("./preceding-sibling::div[@id='lp-donate-button'][1]", "before")
      remove("./div[./img]")
    }
    $("./div[@class='lp-donate-box']/div[@class='supertaf-donate-section']/div[@class='supertaf-donate-form']/form[@id='taf-donate']") {
      $("./div[@class='supertaf-donate-text']") {
        insert_top("h2", "DONATE NOW", class:"mw_h2")
      }
      $("./div[@class='supertaf-donate-amounts']") {
        $("./input[contains(@id, 'supertaf-amount')]") {
          wrap("div", class:"mw_amount")
        }
        $("./label | ./input[@id='supertaf-box']") {
          move_to("./preceding-sibling::div[@class='mw_amount'][1]", "bottom")
          $("./self::input[@id='supertaf-box']") {
            attribute("onclick", "document.getElementById('supertaf-amount-other').checked = true;")
          }
        }
        $("./input[@class='supertaf-donate-button']") {
          btn_delegate() {
            attribute("class", "mw_btn2")
            inner("CONTINUE")
          }
        }
      }
    }
    $("./following-sibling::p[@align='center']") {
      add_class("mw_narrow_size")
    }
  }
}
$("./body") {
  add_class("mw_donate_login")
  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
      
    $("./div[@id='main']") {
      add_class('mw_gray_inner')
      $(".//td[./div[@class='right-block']]") {
        add_class("mw_right_block")
        remove(".//br")
      }
      $(".//form/ancestor::tr[1]") {
        add_class("mw_form_wrap")
        # td[1] in empty
        remove("./td[1]")
      }
      $(".//input[@type='submit']") {
        add_class("mw_btn2")
      }
      $(".//div[@class='outer-border']/table") { 
        remove("./tr[1]/td[1][not(./form)]")
        $(".//div[@class='input-border']//input/ancestor::tr[1]") {
          add_class("mw_input_form")
          $("./td[./input]") {
            add_class("mw_input_td")
          }
        }
        # https://secure.humanesociety.org/site/UserLogin
        $("./tr[1]/td[1]/form") {
          $("./ancestor::table[1]") {
            add_class("mw_login_fail")
          }
        }
      }
    }
  }
  remove(".//div[@id='page-head'] | .//div[@id='head'] | .//td/@width | .//table/@width")
}
$("./body") {
  add_class("mw_match_gift")

  $(".//div[@id='page']") {
    add_class("mw_box2")

    $(".//div[@id='wrapper-body']") {
      # Remove the left padding on the page description
      remove("./@style")

      $("./h1") {
        add_class("mw_h1")
      }

      $(".//a") {
        # remove the red color on the link
        remove("./@style")
      }

      $(".//input[@class='search_button']") {
        add_class("mw_btn2")
      }
    }
  }
}
$("./body") {
  add_class("mw_splash")

  $(".//div[@class='mw_donation_image_center']/../.."){
    $("./p"){
      add_class("mw_text_wrapper")
    }
  }

  $(".//div[@id='FAQsection']"){
    $("../p") {
      add_class("mw_donate_info")
    }
    $("../a") {
      add_class("mw_donate_link")
      remove(".//@style")
    }
  }

  $(".//iframe[contains(@src, 'youtube-nocookie')]/.."){
    add_class("mw_video_container")
    $(".."){
      add_class("mw_content_wrapper")
    }
  }
}

match($tablet) {
  with("true") {
    # for tablet-only Tritium
    @import _splash_tablet.ts
  }
  else() {
    # for mobile-only Tritium
    @import _splash_mobile.ts
  }
}
# http://www.humanesociety.org/sitemap.html
# very similar to animal_main but I'm making a separate file to keep that ts from getting too crazy

# March 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_animal_main mw_sitemap")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//p[string-length()<2 and not(*)]")
  remove(".//div[@class='toolsSpacer']")
  $(".//div[@id='page']") {
    add_class("mw_box2_tablet")
  }

  $(".//h2") {
    add_class("mw_h2")
  }

  # issue and section accordions
  $(".//ul[@id='issue-browser']") {
    $("./li") {
      $("./a") {
        wrap("div") {
          add_class("menu_head")
          attributes(data-ur-toggler-component:"button")
          insert_top("div", class:"mw_plusminus")
        }
        remove("@href")
        name("span")
        add_class("mw_h1")
      }
      $("./ul") {
        add_class("menu_body")
        attributes(data-ur-toggler-component:"content")
        $(".//a") {
          add_class("mw_animal_button")
        }
      }
      name("div")
      add_class("mw_animal_accord mw_map_accord")
      attributes(data-ur-set:"toggler")
    }
    name("div")
    add_class("menu_list")
  }

  # side bar
  $(".//div[@id='side']") {
    # add_class("mw_flex_box")
    $("./ul[@id='action']") {
      add_class("mw_sidebar1_h")
    }
    $(".//div[@id='state']") {
      add_class("mw_sidebar5 mw_flex_box_item_1")
      $(".//h2") {
        add_class("mw_h2")
      }
      wrap("div",class: "mw_flex_box")
    }
    $("./div[./div[@id='wayne']]") {
      add_class("mw_flex_box_item_1")
      remove(".//@style")
      move_to("preceding-sibling::div[@class='mw_flex_box']")
      $("./div[@id='wayne']") {
        add_class("mw_sidebar4")
        $(".//h2") {
          add_class("mw_h2")
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_email_preferences")
  remove(".//div[@id='page-head']")
  $(".//div[@id='contentDiv']") {
    remove("./div[@id='head'] | .//div[@id='wrapper-body']/@style | ./div/@style")
    $("./div[not(*)]") {
      match(text(), /\A\s+\Z/) {
        remove()
      }
    }
    $(".//h3[@class='ObjTitle']") {
      add_class("mw_h3")
    }
    $(".//input[@class='Button']") {
      add_class("mw_btn4 mw_unsubscribe_btn")
      $(".."){
        add_class("mw_inline_flex")
      }
    }
  }
  # wrap options
  $(".//td/label") {
    wrap_text_children("div", class: "mw_option_text") {
      match(text(), /\A\s+\Z/) {
        remove()
      }
      text() {
        replace(/^\s+/, "")
      }
    }
  }
  # For "Unsubscribe Request" page
  $(".//label[@for='first_name']/ancestor::table[1]") {
    add_class("mw_URtable")
    table_dump(".")
    $("./div[contains(@class,'mw_was_tr')]/div[contains(@class,'mw_was_td')]/span[@class='ErrorMessage']") {
      $("./ancestor::div[contains(@class,'mw_was_td')]") {
        add_class("mw_error_message")
      }
    }
  }
}
# Place holder/example file
# HSUS 167 popup to add to the home screen
$("./head") {
  insert_bottom("script", type:"text/javascript") {
    text("var addToHomeConfig = {touchIcon:true, expire:525600, message:'Add HumaneSociety.org to your <strong>iPad&apos;s</strong> home screen. Tap the %icon button &amp; choose &apos;Add to Home Screen&apos;.'};")
  }
  insert_bottom("script", src:asset("javascript/add2home.js"))
  $("./title") {
    text("HSUS")
  }
}


$("./body") {
  add_class("mw_tablet_home")

  # The carousel
  $(".//div[@id='wrapper']") {
    move_here(".//div[contains(@class, 'mw_carousel_content_tablet')]", "top") {
      wrap("div", data-ur-set:"carousel", data-ur-fill:"1", data-ur-autoscroll:"enabled", data-ur-autoscroll-delay:"4000", data-ur-autoscroll-dir:"next" ,data-ur-carousel-component:"view_container", class:"mw_masthead mw_carousel") {
        insert_bottom("span", data-ur-carousel-component:"dots")
      }
      
      attribute("data-ur-carousel-component", "scroll_container")

      $("./div") {
        attribute("data-ur-carousel-component", "item")
        
        $("./div | ./a") {
          add_class("mw_content_text")
        }
      }
    }

  }

  $(".//div[@id='cols']") {
    add_class("mw_box2_noborder")

    # HSUS-430 New News Briefs
    $(".//div[@class='section news-brief-home-page-inner s_borderless']") {
      $(".//p[@class='image']") {
        move_to("..", "top")
      }
    }

    # Twitter/Facebook left hand feed , also HSUS-430 News Feed / News Brief
    $(".//div[@class='section simple area-news'] | .//div[@class='section news-brief-home-page s_borderless']") {
      #section news-brief-home-page-inner s_borderless
      add_class("mw_onefourth")

      # Make the connect link a bar_1
      $("./a[@class='more']") {
        add_class("mw_bar1")
      }

      # Change the H3 to something else.. because it is getting globally styled
      $(".//h3") {
        name("p")
        attribute("class", "mw_community_content")
      }

      # Give the divs wrapping the feeds names so we can sort the facebook first
      $(".//a[contains(@href, 'facebook')]/ancestor::div[not(@id)][1]") {
        add_class("mw_facebook_feed")
      }
      $(".//a[contains(@href, 'twitter')]/ancestor::div[not(@id)][1]") {
        add_class("mw_twitter_feed")
      }
      $(".//div[@class=' mw_twitter_feed']") {
        # comment out for HSUS-216: on mock up twitter feeds comes first
        # move_to("..", "bottom")
      }

      # Move Connect to bottom
      $(".//a[@class='more mw_bar1']") {
        move_to("..", "bottom")
      }

      # Move the social feed to the top of #main 
      move_to("./ancestor::div[@id='main']", "top")
    }
    # HSUS-436-START:(Mobile & Tablet) Minor spacing issues on homepage
    $(".//div[contains(@class,'area-news')]/div[position() = 1]") {
      remove("./@style")
      add_class("mw_news_heading")
    }
    # HSUS-436-END
    # Truncate any news posts beyond 3
    remove(".//div[contains(@class, 'area-news')]//li[position()>3]")
    remove(".//div[contains(@class, 'news-brief-home-page')]//li[position()>3]")

    

    # Articles and Donate/Signup/Blog
    $(".//ol[@id='headlines']") {
      #add_class("mw_flex_box")
      # make the articles 1/3 width
      $("./li") {
        # add_class("mw_flex_box_item_1")
        add_class("mw_third")

        $(".//a[@class='more']") {
          add_class("mw_bar1")
        }
      }

      # Donate, Signup, Blog
      wrap("div", class:"mw_threefourth mw_articles_action") {
        move_here("./ancestor::div[@id='cols']/div[@id='side']") {
          add_class("mw_flex_box")

          $("./ul") {
            # Donate section
            $("./li[@id='donate']") {
              add_class("mw_box5") #mw_flex_box_item_1
              name("div")
              move_to("./ancestor::div[@id='side']", "top")

              $("./a") {
                add_class("mw_h1")
              }

              # reorder the radio buttons
              $(".//label/input[@type='radio']") {
                move_to("./parent::label[1]", "top")
              }

              # Change the button look
              $(".//button") {
                add_class("mw_btn3")
                text("DONATE")
              }
              # HSUS-186
              $("./div[@id='give_another_way']/a") {
                text("Give another way")
              }
            }

            #Combine the Signup, takeaction and shop
            $("./li[@id='takeaction']") {
              name("div")
              # move_to("../li[@id='signup']")
            }
            $("./li[@id='shop']") {
              name("div")
              # move_to("../li[@id='signup']")
            }

            $("./li[@id='signup']") {
              # add_class("mw_box5")
              name("div")
              # move_to("./ancestor::div[@id='side']")
              contextual_keyboard(".//input[@id='cons_email']", "email")
              contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")

              # Change the button
              $(".//button") {
                add_class("mw_btn3")
              }
            }

            name("div")
            add_class("mw_box5")
            $("./div/a") {
              add_class("mw_h1")
            }
          }

          $("./div[contains(@id, 'rss')]") {
            add_class("mw_box4")
            remove("@style")
            #HSUS-450
            $(".//a[@id='podcastbutton1a']") {
              remove()
            }
            #END HSUS-450
            
            $("./a") {
              add_class("mw_h1")
            }
          }

          # Going to try and wrap the div's in divs (yo dawg) and do the flexbox
          $("./div") {
            wrap("div", class:"mw_flex_box_item_1")
          }

        }
      }
    }
  }
}

/*
//HSUS-473
$(".//p[@class='tax-statement'][1]"){
  insert_after("br")
  insert_after("br")
}
*/
# 404 Page Not Found

# Sarah LaFrance April 2 2013

$("./body") {
  add_class("mw_not_found")

  # Remove masthead image, HSUS-440
  remove(".//img[contains(@class,'mw_tablet_masthead_image')]")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//ul[@id='tools']") // sorry if anyone wanted to share the 404
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@class='toolsSpacer']")
  remove(".//p[string-length(text())= 1]")

  $(".//div[@id='cols']") {
    add_class("mw_box2_tablet")
  }

  # main content
  $(".//div[@id='main']") {
    $(".//h1") {
      add_class("mw_h1")
    }
    $(".//h2") {
      add_class("mw_h2")
    }
    $(".//div[@id='feature']") {
      remove(".//br")
      # $(".//a[@class='more']") {
      #   inject("  &raquo;  ")
      # }
      $("./p") {
        add_class("mw_links")
      }
    }
  }

  # handle that empty div mess at the botom
  $(".//div[@id='contentDiv']/div") {
    remove("@style")
    wrap_text_children("span")
    remove("./span[string-length()<3]")
  }

  $(".//div[@id='cols']") {
    remove("./div[not(@id) and not(@class)]")
    remove("ancestor::div/following-sibling::br")
    $(".//div") {
      remove("@style")
    }
  }

  # side bar
  $(".//div[@id='side']") {
    $("./ul") {
      add_class("mw_sidebar1_h")
    }
  }

}
# http://www.humanesociety.org/sitemap.html
# very similar to animal_main but I'm making a separate file to keep that ts from getting too crazy

# March 12 2013 Sarah LaFrance

$("./body") {
  add_class("mw_animals_main")

  # remove unneeded sections
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-head']")
  remove(".//p[string-length()<2 and not(*)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//h2") {
    add_class("mw_h2")
  }

  # issue and section accordions
  $(".//ul[@id='issue-browser']") {
    $("./li") {
      $("./a") {
        wrap("div") {
          add_class("menu_head")
          attributes(data-ur-toggler-component:"button")
          insert_top("div", class:"mw_plusminus")
        }
        remove("@href")
        name("span")
      }
      $("./ul") {
        add_class("menu_body")
        attributes(data-ur-toggler-component:"content")
        $(".//a") {
          add_class("mw_animal_button")
        }
      }
      name("div")
      add_class("mw_animal_accord mw_map_accord")
      attributes(data-ur-set:"toggler")
    }
    name("div")
    add_class("menu_list")
  }

  # side bar
  $(".//div[@id='side']") {
    $(".//div[@id='state']") {
      add_class("mw_sidebar5")
      $(".//h2") {
        add_class("mw_h2")
      }
    }
    $(".//div[@id='wayne']") {
      remove("@style")
      add_class("mw_sidebar4")
      $(".//h2") {
        add_class("mw_h2")
      }
    }
  }
}
# restaurant locator form, and anything else that looks the same
# http://www.humanesociety.org/restaurant_locator

# Sarah LaFrance March 9, 2013

$("./body") {
  add_class("mw_rest_form")
  # HSUS-284 map
  attributes(onload:"initialize()")
  # end of HSUS-284 map
  # remove
  remove(".//div[@id='page-head']")
  remove(".//div[@id='head']")
  remove(".//div[@id='page-bottom-spacer']")
  remove(".//p[string-length()<=1 and not(*)]")
  remove(".//div[@class='toolsSpacer']")

  $(".//div[@id='main']") {
    add_class("mw_box2")

    $("./div[contains(@class, 'section simple')]/h2") {
      add_class("mw_h3")
    }
    $("./div[.//input]") {
      add_class("mw_form")
      remove("@style")
      remove(".//br")
      $(".//p") {
        remove("@style")
      }
      $(".//input[contains(@value, 'Search')]") {
        wrap("div", class:"mw_btn_wrapper mw_flex_box") {
          $("./input[contains(@value, 'Search')]") {
            btn_delegate() {
              add_class("mw_btn1 mw_flex_box_item_1")
              text("FIND")
            }
          }
          move_here("following-sibling::input[contains(@value, 'Reset')]", "bottom") {
            btn_delegate() {
              add_class("mw_btn2 mw_flex_box_item_1")
              text("RESET")
            }
          }
        }
      }
    }
  }
}
$("./body") {
  add_class("mw_forms")

  # fix the redirection on meatless monday page
  $(".//script[contains(text(), 'window.location')]") {
    inner() {
      replace(/action\.humane/, 'm.action.humane')
    }
  }

  # Wrap the page in a box2
  $(".//div[@id='main']") {
    add_class("mw_box2")
    $("./div[@id='feature']") {
      table_dump(".//table")
      $("./h2") {
        add_class("mw_h2")
      }
      $(".//div[./div/div[contains(@id,'captcha_player')]]") {
        add_class("mw_captcha_section")
        $("ancestor::div[contains(@class,'mw_was_tr')][1]") {
          add_class("mw_submit_number")
        }
      }
    }
    $("./div[@id='features']") {
      add_class("mw_form_features")
      remove("self::div[.//div[@id='flashcontent']]")
      $(".//h3") {
        add_class("mw_h3")
      }
      $(".//ul") {
        name("div")
        add_class("mw_ul")
        $("./li") {
          name("div")
          add_class("mw_li")
          wrap_text_children("span") {
            remove("self::span[contains(text(),'.')]")
          }
          $(".//p[@class='image']/following-sibling::p") {
            wrap("div",class:"mw_download_content") {
              move_here("following-sibling::a") {
                $("ancestor::div[1]") {
                  add_class("mw_download_section")
                }
              }
            }
          }
        }
      }
    }
    $(".//p[contains(text(),'*')]") {
      add_class("mw_label_star")
    }
    $(".//p[not(*)]") {
      match(fetch("./text()"), /\A[\s ]*\Z/) {
        remove()
      }
    }
    $(".//div[contains(@class,'req')]") {
      add_class("mw_hide")
    }
    # HSUS-411 Share desktop URLs on Thank You page
    $(".//p[contains(@class, 'simple')]/a[contains(@href, 'facebook')]") {
      attribute("href") {
        value() {
          replace(/m(\w{5})?\./, "")
        }
      }
    }
    $(".//a[contains(@href, 'thankyou/mailto')]") {
      attribute("href") {
        value() {
          replace(/m(\w{5})?\./, "www.")
        }
      }
    }
    $(".//iframe") {
      attribute("src") {
        value() {
          rewrite("link")
        }
      }
      attributes(id:"mw_flick_wrapper", height:"")
    }
  }

  # Remove the styling on any header
  $(".//h1") {
    remove("@style")
  }

  $(".//div[contains(@id, 'image')]") {
    remove("@style")
    add_class("mw_img_center")
  }

  # remove any align stuff of the image
  $(".//img") {
    remove("@align")
  }
  
  # remove Spam text box - ticket #HSUS-169
  remove(".//div[./input[@id='denySubmit']]")
  
  # Make all the TD containing inputs blocks and take up 100% of the width
  $(".//input[not(@type='checkbox')]/.. | .//select/..") {
    add_class("mw_input_wrapper")
  }

  # Remove the width from the message box area
  $(".//textarea") {
    remove("@cols")
  }

  # make the selects look more selectable
  $(".//select/..") {
    add_class("mw_select_arrows")
  }

  # Make the submit button big and red
  $(".//input[@type='submit']") {
    attribute("value","Submit")
    add_class('mw_btn2')
  }

  # Remove any particular styling on the table.. or paragraph
  # E.G. http://mlocal.humanesociety.org/forms/humane_society_jobs.html
  $(".//table[@style] | .//p[@style]") {
    remove("@style")
  }

  $(".//div[@id='main']") {
    remove(".//div/@style")
  }

  # Custom Keyboards
  contextual_keyboard(".//input[@id='cons_phone']","tel")
  contextual_keyboard(".//input[@id='cons_email']","email")
  contextual_keyboard(".//input[@id='cons_zip_code']","number")

  # # remove sidebar boxes
  # $(".//div[@id='side']") {
  #   add_class("mw_hide")
  # }
  match($path,/^\/site\/Survey/) {
    add_class("mw_survey")
    $(".//div[@class='appArea']") {
      remove(".//@width | .//@align")
    }
    remove(".//div[@id='contentDiv']/div[not(@id)]")
    $(".//td/span[contains(@class, 'NetscapeFix')]/..") {
      add_class("mw_input_td")
    }
    $(".//td") {
      $("./p[not(*)]") {
        text() {
          replace(/&nbsp/, "")
          replace(/^[\s\u00a0]+/, "")
          replace(/[\s\u00a0]+\|$/, "")
        }
      }
      wrap_text_children("span") {
        text() {
          replace(/^[\s\u00a0]+/, "")
          replace(/[\s\u00a0]+\|$/, "")
        }
      }
      remove("./br")
     }
  }
  $(".//input[contains(@name, 'OptionalCode')]") {
    add_class("mw_hide")
  }
}
$("./body") {
  add_class("mw_magazine")

  $(".//div[@id='main']") {
    add_class('mw_box2')
    $("./div[contains(@class,'s_borderless')]") {
      wrap_text_children("span")
      $("./span[contains(text(),'Have a great photo of an animal? ')]") {
        add_class("mw_h2")
      }
      $("./h3[not(*)] |./p[not(*)] |./span[not(*)] ") {
        match(fetch("./text()"), /\A[\s ]*\Z/) {
          remove()
        }
      }
    }
    $("./div[@id='feature']/a[@class='back']") {
      wrap("div", class:"mw_back")
    }
    $(".//span[@data-ur-carousel-component='dots']") {
      wrap("div",class:"mw_dots")
    }  
    # HSUS-406
    $(".//div[contains(@id, 'aa_article')]/p[./span[contains(@class, 'dropcap')]]") {
      add_class("mw_first_p")
    }
  }

  $(".//div[@id='page']//h1") {
    add_class("mw_h1")
  }
  $(".//div[@id='page']//h2") {
    add_class("mw_h2")
  }
  $(".//div[@id='page']//h3") {
    add_class("mw_h3")
  }

  $(".//div[@id='feature']") {
    # Wrap the text node in a span so I can move it around
    wrap_text_children("span", class:"feature_desc")

    # add mw_bar1 to the links
    $(".//a[@class='more']") {
      add_class("mw_bar1")
    }
  }

  # images box

  
  $(".//div[@id='pubs']/ul/li") {
    add_class('mw_magazine_pub')

    $("./p[@class='date']") {
      wrap("div", class:"pub_float") {
        move_here("../h3")
      }
    }
  }

  $("./div[@id='wrapper']/div[@id='page']/div[@id='page-head']") {
    move_here("./ul[@id='site-nav']/li[contains(@class, 'expanded')]/ul", "top") {
      $("./li/a") {
        add_class("mw_bar3 mw_h3")
        # ticket 168, removing any stray whitespace from the links
        $url_text = fetch("@href")
        $url_text {
          replace(/[\s]*$/, '')
        }
        attribute("href", $url_text)
      }
    }
    remove("./ul[@id='site-nav'] | ./h1 | ./div[contains(@id, 'item')]")
  }

  # Fix the iFrame youtube video
  $(".//iframe") {
    remove("./@width | ./@height")
  }

  # Assign a page to the story pagination
  $(".//blockquote/p") {
    add_class("mw_pagination")
  }

  # For the multi-page stories.. wanted to call out the farm descriptions
  # example: http://mlocal.humanesociety.org/news/magazines/2012/07-08/back_to_the_land_page_5.html

  $(".//p[strong]") {
    add_class("mw_photo_caption_callout")
  }

  $(".//div[@id='page-bottom-spacer']") {
    remove()
  }
  
  $(".//div[@id='side']") {
    remove("./div[not(@class) and not(@id)]")
    $("./div[@id='resources' or @id='magazine-promo'] or @id='resources-promo']") { // blue boxes
      $("./h2") {
        add_class("mw_h1")
      }
      $(".//li/a | .//p/a") {
        inject("  &raquo;  ")
      }
      remove("./a[./img]")
    }
    $(".//div[@id='resources']") {
      add_class("mw_sidebar2")
    }
    $(".//div[@id='related-content']") {
      add_class("mw_sidebar2")
    }
    $(".//div[@id='magazine-promo' or @id='resources-promo'] ") {
      add_class("mw_sidebar7")
      $(".//a[contains(@class, 'more')]") {
        inject("  &raquo;  ")
      }
    }
  }
  
  # HSUS-437
  $(".//div[@id='main']/div[contains(@class, 's_borderless')]//form[@class='checkboxes']/ul") {
    add_class("mw_checklist")
  }
}
/*
  Mappings

  Mappings are matchers that we use to determine if we should execute a
  bit of Tritium during an execution. Aka, run something when we are
  are on a certain page.

  Example starting code:
  */

# new addition March 14: to redirect a site to desktop, match its url
#                        log some useful message and then set variable
#                        $desktop_export to "true". -- SL

# $mw_analytics = ""

match($status) {

  with(/302/) {
    log("--> STATUS: 302") # redirect: just let it go through
  }

  with(/200/) {
    log("--> STATUS: 200")

    # HSUS-479
    remove("./body/div[a[contains(@href,'poweredby')]]")

    match($host) {
      with(/video\.humanesociety\.org/) {
        log("--> Videos subdomain in mappings.ts")

        match($path) {

          ###############
          # Video Pages #
          ###############
          log($path)

          with(/^\/$|^\/\?/) { 
            log("--> Matching video root in mappings.ts") #/
            $mw_analytics = "HSUS-video-root"

            @import "pages/video_slideshow/video_home.ts"
          }


          # fix for the animal fighting & cruelty
          # the title is too long and messes up the header for iPhones in portrait mode.
          with(/index\.php\?id\=PLE01490092359B5C3/) {
            log("--> Matching index.php fix for long category title in mappings.ts")
            $("./head") {
              insert("style", type:"text/css", ".mw_video_common #topNav .mw_header_menu_item.active .mw_header_menu_item_content{font-size: 11px;}")
            }
            @import "pages/video_slideshow/video_home.ts"
            $mw_analytics = "HSUS-video-root"
          }

          with(/index\.php/) {
            log("--> Matching index.php in mappings.ts")
            @import "pages/video_slideshow/video_home.ts"
            $mw_analytics = "HSUS-video-root"
          }

          with(/category/) {
            log("--> Matching /category in mappings.ts")
            @import "pages/video_slideshow/video_home.ts"
            $mw_analytics = "HSUS-video-root"
          }

          with(/press\/video\.php/) {
            log("--> Matching video press page in mappings.ts")
            @import "pages/video_slideshow/video_press_page.ts"
            $mw_analytics = "HSUS-video-press-page"
          }

          # Press login..
          with(/press\/users/) {
            log("--> Matching press/users in mappings.ts")
            @import "pages/video_slideshow/login.ts"
            $mw_analytics = "HSUS-video-press-login"
          }

          with(/press/) {
            log("--> Matching video press root in mappings.ts")
            @import "pages/video_slideshow/video_press_home.ts"
            $mw_analytics = "HSUS-video-press-root"
          }

          with(/video/) {
            log("--> Matching /video/ in mappings.ts")
            @import "pages/video_slideshow/video_home.ts"
            $mw_analytics = "HSUS-video-root"
          }
          
          with(/frames/) {
            log("--> Matching /video/ in mappings.ts")
            @import "pages/video_slideshow/animal_legacy_video.ts"
            $mw_analytics = "HSUS-animal-legacy-video"
          }
          
          # HSUS-309
          # http://video.humanesociety.org/assets/links/view.php?bctid=1113136319001
          with(/^\/assets\/links\/view\.php\?/i) {
            log("--> Matching /video/ in mappings.ts") #"
            @import "pages/video_slideshow/individual_video.ts"
          }
        }

      }

        ##############
        # Slideshows #
        ##############

        with(/slideshows\.humanesociety\.org/) {
          log("--> Slideshows subdomain in mappings.ts")
          match($path) {
            with(/^\/$|^\/\?/) { #/
              log("--> Matching slideshows root in mappings.ts")
              @import "pages/video_slideshow/slideshow_home.ts"
              $mw_analytics = "HSUS-slideshow-root"
            }

            with(/index\/gallery/) {
              log("--> Matching slideshows index/gallery in mappings.ts")
              @import "pages/video_slideshow/slideshow_home.ts"
              $mw_analytics = "HSUS-slideshow-gallery"
            }
          }
        }

      #############################################
      # secure.humanesociety.org - Donations, etc #
      #############################################

      with(/secure3\.convio\.net/) {
        match($path) {
          with(/humane\/admin\/Donation2Preview/i) {
            log("--> importing pages/donate/_site_donate.ts in mappings.ts")
            @import "pages/donate/_site_donate.ts"
            $mw_analytics = "HSUS-site-donation"
          }
        }
      }

      with(/secure\.humanesociety\.org/) {
        log("--> Secure subdomain in mappings.ts")
        @import "pages/work/convio.ts"

        match($path) {
          # Example:
          # https://mlocal.secure.humanesociety.org/site/Donation2?df_id=1452&1452.donation=form1&source=gac4ac
          with(/site\/Donation2\?df_id\=1452\&1452/) {
            log("HSLF donation form")
            @import "pages/donate/_hslf_donate.ts"
            $mw_analytics = "HSUS-site-donation"
          }
          
          # https://secure.humanesociety.org/site/Donation/2093707163
          with(/^\/site\/donation($|\/[\d]+)/i) {
            log("--> importing pages/donate/_donate_login.ts in mappings_tablet.ts")
            @import "pages/donate/_my_profile.ts"
          }
          with(/site\/donation/i) {
            log("--> importing pages/donate/_site_donate.ts in mappings.ts")
            @import "pages/donate/_site_donate.ts"
            $mw_analytics = "HSUS-site-donation"
          }

          #Example:
          # https://mlocal.secure.humanesociety.org/site/SSurvey?SURVEY_ID=2820&ACTION_REQUIRED=URI_ACTION_USER_REQUESTS

          with(/site\/SSurvey/) {
            log("--> importing pages/donate/_sign_up.ts in mappings.ts")
            @import "pages/donate/_sign_up.ts"
            $mw_analytics = "HSUS-site-survey"
          }

          # Humane alert page
          # https://secure.humanesociety.org/site/Advocacy?cmd=display&page=OnScreenThanks&id=5951
          with(/site\/Advocacy\?(pagename=homepage\&)?.*\&page=(onscreenthanks|actionalerttakenpage)/i) {
            log("--> importing pages/donate/_tellafriend.ts in mappings.ts")
            @import "pages/donate/_tellafriend.ts"
            $mw_analytics = "HSUS-site-advocacy"
          }

          # pledges in campaign section
          # this isn't really under work, it can moved later for convenience
          with(/site\/Advocacy/) {
            log("--> importing pages/work/pledge.ts and pages/work/convio.ts in mappings.ts")
            @import "pages/work/pledge.ts"
            # @import "pages/work/convio.ts"
            $mw_analytics = "HSUS-site-advocacy"
          }

          # meatless monday signup
          with(/\/site\/SPageServer\?pagename\=meatlessmondaysignup/) {
            log("--> Importing pledge form for meatless monday")
            @import "pages/donate/_sign_up.ts"
            $mw_analytics = "HSUS-site-advocacy"
          }
          with(/pagename\=meatless_monday_contest/) {
            log("--> Importing pledge form for meatless monday")
            @import "pages/donate/_sign_up.ts"
            $mw_analytics = "HSUS-site-advocacy"
          }

          # https://secure.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013
          # https://secure.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
          with(/\/site\/SPageServer\?.*pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
            log("--> importing pages/drtv/drtv_base.ts in mappings.ts")
            @import "pages/drtv/drtv_base.ts"
            match($path) {
              with(/thanks/) {
                log("--> importing pages/drtv/drtv_donation.ts in mappings.ts")
                @import "pages/drtv/drtv_thank.ts"
              }
              else() {
                log("--> importing pages/drtv/drtv_donation.ts in mappings.ts")
                @import "pages/drtv/drtv_donation.ts"
              }
            }
          }

          # https://secure.humanesociety.org/site/SPageServer?pagename=drtv_splashb_MSI
          with(/\/site\/SPageServer\?.*pagename\=drtv\_splashb\_MSI/) {
            log("--> importing pages/drtv/drtv_base.ts in mappings.ts")
            @import "pages/drtv/drtv_base.ts"
            log("--> importing pages/drtv/drtv_donation.ts in mappings.ts")
            @import "pages/drtv/drtv_splash.ts"
          }

          # send the DRTV pages to desktop for the time being 
          with(/\/site\/SPageServer\?pagename\=drtv\_/) {
            log("--> Sending DRTV form to desktop")
            # $desktop_export = "true"
            # remove("//meta[@name='viewport']")
          }

          # pets of valor award
          # https://secure.humanesociety.org/site/SPageNavigator/pets_of_valor_vote.html
          # https://secure.humanesociety.org/site/SPageServer?pagename=pets_of_valor_vote
          with(/\/site\/(SPageNavigator\/|SPageServer\?\w+=)pets\_of\_valor\_vote/) {
            log("--> importing pages/donate/valor_award.ts in mappings.ts")
            @import "pages/donate/valor_award.ts"
          }

          # Chimps landing page

          # HSUS-436
          # https://secure.humanesociety.org/site/SPageServer?pagename=chimp_art_contest
          with(/^\/site\/SPageServer\?pagename\=chimp_art_contest/) {
            log("Chimps art test page")
            # @import pages/news/article.ts
            @import pages/custom/chimp_art_mobile.ts
          }

          with(/thanks_chimpanzee_art_contest.html$/) {
            # @import base_tablet.ts
            # @import "pages/forms.ts"
          }

          with(/site\/SPageServer\?.?pagename\=st_francis_day_box/) {
            log("--> importing pages/donate/_st_francis_box.ts in mappings.ts")
            @import "pages/donate/_st_francis_box.ts"
          }

          with(/site\/SPageServer\?.?pagename\=virtual_town_hall/) {
            log("--> importing pages/donate/_virtual_town_hall_tablet.ts in mappings.ts")
            @import "pages/donate/_virtual_town_hall.ts"
          }

          #HSUS-463
          #https://secure.humanesociety.org/site/SPageServer?pagename=take_your_pet
          with(/site\/SPageServer\?.?pagename\=take_your_pet/) {
            log("--> importing pages/donate/_take_your_pet.ts in mappings.ts")
            @import "pages/donate/_take_your_pet.ts"
          }

          # REUS donation
          # https://secure.humanesociety.org/site/SPageServer?pagename=reus_hsus_donation_2013_ye_research_ppc_splash
          # https://secure.humanesociety.org/site/SPageNavigator/reus_hsus_donation_2013_ye_research_ppc_splash.html
          with(/\/site\/(SPageNavigator\/|SPageServer\?pagename=)reus_hsus_donation_2013/) {
            log("--> importing pages/donate/valor_award.ts in mappings.ts")
            @import "pages/custom/reus_hsus_donation_2013_mobile.ts"
          }
          
          # HSUS-497
          # https://secure.humanesociety.org/site/SPageServer?pagename=EP_ppc_splash_mwcopy
          # https://secure.humanesociety.org/site/SPageServer?pagename=reus_HSUS_donation_2013_ye_stella_ppc_splash
          with(/ppc_splash/) {
            log("--> importing pages/donate/_splash.ts in mappings.ts")
            @import "pages/donate/_splash.ts"
          }

          with(/^\/site\/(SPageNavigator\/(new_life_for_chimps|puppy_mill_pledge_action_takers)\.html|SPageServer\?(\w+=\w+)+)/) {
            log("--> importing pages/donate/_chimps.ts in mappings.ts")
            @import "pages/donate/_chimps.ts"
          }

          # https://secure.humanesociety.org/site/UserLogin
          # https://secure.humanesociety.org/site/UserLogin?CMD=ForgotLogin
          # https://secure.humanesociety.org/site/UserLogin?CMD=ForgotPassword
          with(/site\/UserLogin/) {
            log("--> importing pages/donate/_donate_login.ts in mappings_tablet.ts")
            @import "pages/donate/_donate_login.ts"
          }
          # profile home
          # https://secure.humanesociety.org/site/SPageNavigator/HSUS_my_profile.html
          with(/^\/site\/SPageNavigator\/HSUS_my_profile/) {
            log("--> importing pages/donate/_donate_login.ts in mappings_tablet.ts")
            @import "pages/donate/_my_profile.ts"
          }
          # edit profile
          # https://secure.humanesociety.org/site/ConsProfileUser
          # https://secure.humanesociety.org/site/ConsInterestsUser
          with(/^\/site\/(ConsProfileUser|ConsInterestsUser)/i) {
            log("--> importing pages/donate/edit_profile.ts in mappings_tablet.ts")
            @import "pages/donate/edit_profile.ts"
          }
          
          # You're Invited
          # https://secure.humanesociety.org/site/Ticketing?view=Tickets&id=109422&JServSessionIdr004=e4u8fmzzg5.app305b
          with(/\/site\/Ticketing/) {
            log("--> importing pages/donate/ticketing.ts in mappings.ts")
            @import "pages/donate/ticketing.ts"
          }

          # catchall
          else() {
            log("--> importing pages/donate/_hslf_donate.ts in mappings.ts")
            @import "pages/donate/_hslf_donate.ts"
            $mw_analytics = "HSUS-site-donation"
          }
        }
      }

      ##########################################
      # action.humanesociety.org - Issues, etc #
      ##########################################

      with(/action\.humanesociety\.org/) {
        log("--> Action subdomain in mappings.ts")

        match($path) {
          # ticket HSUS-375 [Mobile & Tablet] Sacramento events page
          # http://m.action.humanesociety.org/site/Calendar?id=109422&view=Detail&autologin=true
          with(/site\/Calendar\?id=109422+&view=Detail+&autologin=true/i) {
            log('--> Calendar Page')
            @import "pages/calendar/calendar_page.ts"
          }
          # calendar events
          with(/site\/Calendar(\/[\d]*)?\?(id=[\d]*\&)?view=Detail/) {
            log('--> importing pages/calendar/event.ts')
            @import "pages/calendar/event.ts"
            $mw_analytics = "HSUS-calendar"
          }
          
          # http://action.humanesociety.org/site/Calendar?view=Detail&id=109422
          with(/site\/Calendar\?view=Detail/) {
            log("--> importing pages/calendar/event.ts")
            @import "pages/calendar/event.ts"
          }
          
          # http://action.humanesociety.org/site/Calendar?id=110964&view=RSVP
          with(/site\/Calendar\?id=[\d]*\&view=RSVP/) {
            log("--> importing pages/calendar/day_list.ts")
            @import "pages/calendar/day_list.ts"
          }
          # http://action.humanesociety.org/site/Calendar?view=RSVP&id=111041
          with(/site\/Calendar\?view=RSVP&id=[\d]*/) {
            log("--> importing pages/calendar/day_list.ts")
            @import "pages/calendar/day_list.ts"
          }
          # Calendar stuff
          with(/site\/Calendar\/[\d]*\?view=MonthGrid\&Day/) {
            # $path {
            #   replace(/Grid/, "List")
            # }
            # export("Location", $path)
            log('--> importing calendar instead of redirecting to list')
            @import "pages/calendar/day_grid.ts"
            $mw_analytics = "HSUS-calendar-day-grid"
          }

          # For HSUS-484
          #New Calendar URL?
          # url: http://action.humanesociety.org/site/PageNavigator/hsus_calendar.html
          with(/^\/site\/PageNavigator\/hsus_calendar.html/) {
            @import "pages/calendar/day_grid.ts"
          }
          # End of HSUS-484

          # day, week grid redirect
          with(/site\/Calendar\/[\d]*\?view=(Day|Week)Grid\&Day/) {
            log('--> redirecting grid mode calendar to list mode')
            $path {
              replace(/Grid/, "List")
            }
            export("Location", $path)
          }          
          # day, week, month list
          with(/site\/Calendar\/[\d]*\?view=(Day|Month|Week)List\&Day/) {
            log('--> importing pages/calendar/day_list.ts')
            @import "pages/calendar/day_list.ts"
            $mw_analytics = "HSUS-calendar-day-list"
          }
          
          # clicked to query
          with(/site\/Calendar(\/[\d]*|$)/) {
            log('--> importing pages/calendar/day_list.ts')
            @import "pages/calendar/day_list.ts"
            $mw_analytics = "HSUS-calendar-day-list"
          }

          with(/MatchingGifts/) {
            log("--> importing pages/donate/_matchinggifts.ts in mappings.ts")
            @import "pages/donate/_matchinggifts.ts"
            $mw_analytics = "HSUS-donation-matchinggifts"
          }
          # Your Seafood Boycott Helps: Do You Know Why?
          with(/MessageViewer/) {
            log("--> importing pages/message_viewer.ts in mappings.ts")
            @import "pages/message_viewer.ts"
            $mw_analytics = "HSUS-messageviewer"
          }

          # https://action.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013
          # https://action.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
          with(/\/site\/PageServer\?.*pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
            log("--> importing pages/drtv/drtv_base.ts in mappings.ts")
            @import "pages/drtv/drtv_base.ts"
            match($path) {
              with(/thanks/) {
                log("--> importing pages/drtv/drtv_thank.ts in mappings.ts")
                @import "pages/drtv/drtv_thank.ts"
              }
              else() {
                log("--> importing pages/drtv/drtv_donation.ts in mappings.ts")
                @import "pages/drtv/drtv_donation.ts"
              }
            }
          }

          # https://action.humanesociety.org/site/SPageServer?pagename=drtv_splashb_MSI
          with(/\/site\/PageServer\?.*pagename\=drtv\_splashb\_MSI/) {
            log("--> importing pages/drtv/drtv_base.ts in mappings.ts")
            @import "pages/drtv/drtv_base.ts"
            log("--> importing pages/drtv/drtv_splash.ts in mappings.ts")
            @import "pages/drtv/drtv_splash.ts"
          }

          # http://action.humanesociety.org/site/PageServer?pagename=electedOfficials
          # http://action.humanesociety.org/site/PageServer?pagename=electedOfficials_federal
          with(/site\/PageServer\?.*pagename\=electedOfficials/i) {
            log("--> importing pages/work/action_elected.ts in mappings.ts")
            @import "pages/work/action_elected.ts"
          }

          # this isn't really under work, it can moved later for convenience
          # http://action.humanesociety.org/site/PageServer?pagename=humane_welcome_page&JServSessionIdr004=8w797fvbu1.app305b
          with(/site\/PageServer/) {
            log('--> importing pages/work/welcome.ts in mappings.ts')
            @import "pages/work/welcome.ts"
            $mw_analytics = "HSUS-calendar-day"
          }
          # HSUS-344
          # http://action.humanesociety.org/site/GigyaLogin
          with(/site\/GigyaLogin/) {
            log('--> importing pages/work/gigyalogin.ts in mappings.ts')
            @import "pages/work/gigyalogin.ts"
          }
          # End HSUS-344

          ## HSUS - 443
          # mconnect action forms
          # http://www.action.humanesociety.org/site/PageNavigator/mconnect.html
          with(/site\/PageNavigator\/mconnect/i) {
            log('--> found mconnect action form')
            @import "pages/work_tablet/action_form_mconnect.ts"
            $mw_analytics = "HSUS-mconnect-action-form-tablet"
          }
          ## HSUS - 443
          
          # ticket HSUS-275 Billy's Legacy
          # http://action.humanesociety.org/site/PageNavigator/hsus_yearend2012_humaneheroes.html?utm_source=vanitybillyslegacy&utm_medium=hsusweb&utm_campaign=billyslegacy13
          with(/site\/PageNavigator/) {
            # http://action.humanesociety.org/site/PageNavigator/chimpsdeservebetterscientistendorsementthankyou.html
            # for the submit success page
            with(/chimpsdeservebetterscientistendorsementthankyou/) {
              log("--> importing pages/video_slideshow/submit_success.ts in mappings.ts")
              @import "pages/video_slideshow/submit_success.ts"
              $mw_analytics = "HSUS-animal-legacy"
            }
            else() {
              log("--> importing pages/video_slideshow/animal_legacy.ts in mappings.ts")
              @import "pages/video_slideshow/animal_legacy.ts"
              $mw_analytics = "HSUS-animal-legacy"
            }
          }

          # ticket HSUS-278 Protect seals pledge
          # http://action.humanesociety.org/site/Survey?ACTION_REQUIRED=URI_ACTION_USER_REQUESTS&SURVEY_ID=8382
          with(/^\/site\/Survey\?ACTION_REQUIRED=[^&]+&SURVEY_ID=8382/i) {
            log('--> found action form')
            @import "pages/work/protect_seals_pledge.ts"
            $mw_analytics = "HSUS-survey-seals-pledge"
          }
          # ticket HSUS-367 Unmapped Survey Page
          # http://action.humanesociety.org/site/Survey?ACTION_REQUIRED=URI_ACTION_USER_REQUESTS&SURVEY_ID=6038
          with(/^\/site\/Survey/) {
            log('--> Importing pages/forms.ts in mappings.ts')
            @import "pages/forms.ts"
            $mw_analytics = "HSUS-contact-form"
          }
          
          # HSUS-401
          # Email Preferences
          # http://action.humanesociety.org/site/CO?i=ATIXJfiAhQUCE76ukI6rs0KVyAmeQ6Wd&cid=0
          # http://action.humanesociety.org/site/CO?i=tigud82sbXBijJ127B_G1gfcRFWydCrg&cid=0
          # HSUS-402
          # http://mlocal.action.humanesociety.org/site/CO?unsub_interests=0&first_name=&last_name=&primary_email=456%40fs.com&unsub=Unsubscribe&op.unsubFallback=
          with(/^\/site\/co\?(i=.*cid=0|unsub_interests.*)/i) {
            log("--> importing pages/email_preferences.ts in mappings.ts")
            @import "pages/email_preferences.ts"
          }
          # Fix for HSUS-485
          #http://mlocal.action.humanesociety.org/site/CO;jsessionid=74DC692F46524B250E378A67C46872FF.app338b?op.unsubscribe.confirm=
          with(/^\/site\/co\?op.*/i) {
            log("--> importing pages/email_preferences.ts in mappings.ts")
            @import "pages/email_preferences.ts"
          }
          # End of HSUS-485
        }
      }

      ##########
      # Legacy #
      ##########

      with(/legacy\.humanesociety\.org/) {
        match($path) {

          # Article page
          with(/^\/index(\.html|\.php)\?article/) {
            log("--> importing pages/legacy/legacy_article.ts in mappings.ts")
            @import "pages/legacy/legacy_article.ts"
            $mw_analytics = "HSUS-legacy-article"
          }

          # Other Article
          with(/^\/Article/) {
            log("--> importing pages/legacy/legacy_article.ts in mappings.ts")
            @import "pages/legacy/legacy_article.ts"
            $mw_analytics = "HSUS-legacy-article"
          }

          # Brochures
          # http://legacy.humanesociety.org/ebrochures.php?ebrochure=24
          with(/ebrochures\.php/) {
            log("--> importing pages/legacy/? in mappings.ts")
            @import "pages/legacy/legacy_article.ts"
            $mw_analytics = "HSUS-legacy-article"
          }

          # Root page
          # http://legacy.humanesociety.org/
          with(/^\/$|^\/\?|^\/index\.html|^\/index\.php/) {
            log("--> importing pages/legacy/legacy_root.ts in mappings.ts")
            @import "pages/legacy/legacy_root.ts"
            $mw_analytics = "HSUS-legacy-root"
          }

          # Contact page
          # http://legacy.humanesociety.org/contact.php
          with(/^\/contact/) {
            log("--> importing pages/legacy/legacy_contact.ts in mappings.ts")
            @import "pages/legacy/legacy_contact.ts"
            $mw_analytics = "HSUS-legacy-contact"
          }
        }
      }

      
      # Regular site
      else() {
        match($path) {

          with(/^\/$|^\/\?|^\/index\.html/) {
            log("--> Importing pages/home.ts in mappings.ts")
            @import "pages/home.ts"
            $mw_analytics = "HSUS-home"
          }
          with(/newsfeedtest|newsbrieftest2/) {
            log("--> Importing pages/home.ts in mappings.ts")
            @import "pages/home.ts"
          }
          
          # URL: humanesociety.org/header-b.html
          with(/ws\-test\-b\.html|^\/testing.*homepage/) {
            log("--> Alt Header. Importing pages/home.ts in mappings.ts")
            @import "pages/home.ts"
            $mw_analytics = "HSUS-home"
          }

          # testing/wstest-mar-29.html
          # test_homepage_with_moovweb
          with(/testing\/wstest\-mar\-29\.html/) { 
            log("--> Importing pages/home.ts in mappings.ts")
            @import "pages/home.ts"
            $mw_analytics = "HSUS-home"
          }
          
          # stock gifts
          # http://www.humanesociety.org/donate/plan/stock_gifts.html
          with(/^\/donate\/plan\/stock_gifts/) {
            log("--> importing pages/donate/_stock_gifts.ts in mappings.ts")
            @import "pages/donate/_stock_gifts.ts"
            $mw_analytics = "HSUS-stock-gifts"
          }
          
          # Moved this ahead of /index.html for the donate/index.html page
          with(/\/donate\//) {
            log('--> Matching donate in mappings.ts')
            @import "pages/donate/_donate_root.ts"
            $mw_analytics = "HSUS-donate-root"
          }

          
          ###############
          # Index Page  #
          ###############
          with(/^\/index\.html/) {
            log('--> Matching index page in mappings.ts')
            $mw_analytics = "HSUS-home"
            
          }

          ######################
          # Internal Resources #
          ######################

          # with(/^\/(tips|issues)/) {
          #   log('--> Matching Internal Resources in mappings.ts')
          # }

          # not done
          with(/^\/restaurant_locator/) {
            log('--> Importing pages/restaurant_form.ts')
            @import "pages/restaurant_form.ts"
            $mw_analytics = "HSUS-restaurant-form"
          }

          with(/^\/sitemap\.html/) {
            log('--> Importing pages/sitemap.ts in mappings.ts')
            @import "pages/sitemap.ts"
            $mw_analytics = "HSUS-sitemap"
          }

          with(/^\/privacy\.html/) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-privacy"
          }

          ########
          # News #
          ########

          # this needs to go before news because of how ruby matches regexes

          //previous version of the mapping below. why are we matching on a testpage here?
          # with(/(^\/testing\/)|(^\/news\/(press_releases|news)\/($|index\.jsp*))/) {
            with(/(^\/news\/(press_releases|news)\/($|index\.jsp*))/) {
            log('--> Importing pages/news/press.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
            $mw_analytics = "HSUS-press"
          }
          with(/^\/news\/resources\/facts\//) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/qa.ts"
            $mw_analytics = "HSUS-qa"
          }
          with(/^\/news\/(resources\/qa|interview|dispatch)\//) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/qa.ts"
            $mw_analytics = "HSUS-qa"
          }
          # with(/^\/news\/(interview\/|magazines\/[^\/]*interview)/) {
          #   log('--> importing interview.ts in mappings.ts')
          #   @import "pages/news/interview.ts"
          # }
          with(/^\/news\/(press_releases|news)\//) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-news-article"
          }
          with(/^\/news\/related_news\.html/) {
            log('--> importing pages/news/press.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
            $mw_analytics = "HSUS-press"
          }
          with(/^\/news\/workplace_giving/) {
            log('--> importing pages/news/press.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
            $mw_analytics = "HSUS-press"
          }

          with(/^\/news\/publications\/whitepapers/) {
            log('--> importing pages/news/whitepapers.ts in mappings.ts')
            # @import "pages/news/news_base.ts"
            @import "pages/news/whitepapers.ts"
            $mw_analytics = "HSUS-whitepaper"
          }
          with(/^\/news\/blog/) {
            log('--> Importing pages/news/news.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news_tablet/news_main.ts"  
            $mw_analytics = "HSUS-blog"
            # @import "pages/news/news.ts"
            $(".//div[@id='page-head']") {
              add_class("mw_hide")
            }
            $mw_analytics = "HSUS-blog"
          }

          with(/^\/news\/profile\/off-duty/) {
            log('--> importing pages/news_tablet/off_duty.ts in mappings_tablet.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/off_duty.ts"
            $mw_analytics = "HSUS-off-duty"
          }

          with(/^\/news\/news\_briefs/) {
            log("--> Importing pages/news/news_base.ts in mappings.ts")
            # @import "pages/news/news_base.ts"
            # @import "pages/news/news_briefs.ts"

            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
          }


          with(/^\/news\/($|\?|index\.html)/) {
            log('--> Importing pages/news/news.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/news.ts"
            $mw_analytics = "HSUS-news"
          }

          #############
          # Magazines #
          #############

          # Magazine root
          with(/^\/news\/magazines\/($|\?|index\.html)/) {
            log("--> Importing pages/magazine_root.ts in mappings.ts")
            @import "pages/magazine_root.ts"
            $mw_analytics = "HSUS-magazine-root"
          }

          # Exploring the magazine 

          with(/^\/news\/magazines\//) {
            log("--> Importing pages/magazine_root.ts in mappings.ts")
            @import "pages/magazine_root.ts"
            $mw_analytics = "HSUS-magazine-root"
          }

          ###########
          # ANIMALS #
          ###########

          with(/^\/animals\/($|\?|index\.html)/) {
            log('--> Importing pages/animals/animal_main.ts in mappings.ts')
            @import "pages/animals/animal_main.ts"
            $mw_analytics = "HSUS-animal-main"
          }
          with(/^\/animals\/(pets|wild_neighbors)\/($|\?|index\.html)/) {
            log('--> Importing pages/animals/pets.ts in mappings.ts')
            @import "pages/animals/pets.ts"
            $mw_analytics = "HSUS-animal-pets"
          }
          with(/^\/animals\/(pets|wild_neighbors)\/news\.html/) {
            log('--> Importing pages/animals/animal_news.ts in mappings.ts')
            # @import "pages/animals/animal_news.ts"
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          with(/^\/animals\/browse_animals/) {
            log('--> Importing pages/animals/a_to_z.ts in mappings.ts')
            @import "pages/animals/a_to_z.ts"
            $mw_analytics = "HSUS-animal-a-to-z"
          }
          with(/^\/animals\/animal_news/) {
            log('--> Importing pages/animals/animal_news.ts in mappings.ts')
            # @import "pages/animals/animal_news.ts"
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          with(/^\/animals\/(animal_)?resources/) {
            log('--> Importing pages/news/press.ts in mappings.ts')
            @import "pages/news/press.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          # cat-ccordion section
          # temp location
          with(/testing\/hsus_testing\/editorial\/cat-accordion\.html/) {
            log('--> importing cat_problem_solver.ts in mappings.ts - testing environment')
            @import "pages/animals/cat_problem_solver.ts"
            $mw_analytics = "HSUS-animal-cat"
          }
          # permanent location
          with(/animals\/cats\/cat_problem_solver/) {
            log('--> importing cat_problem_solver.ts in mappings.ts')
            @import "pages/animals/cat_problem_solver.ts"
            $mw_analytics = "HSUS-animal-cat"
          }
          with(/^\/animals\/[^\/.]*\/tips\/($|\?|index\.html)/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal-qa"
          }
          with(/^\/animals\/[^\/]*\/tips\/[^\/]*\.html/) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/article.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-animal"
          }
          with(/^\/animals\/.*\/($|\?|index\.html)/) {
            log('--> Importing pages/animals/pets.ts in mappings.ts')
            @import "pages/animals/pets.ts"
            $mw_analytics = "HSUS-animal-pets"
          }
          with(/^\/animals\//) {
            log('--> Importing article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-animal-article"
          }
          # Fix for HSUS-493
          # http://humanesociety.org/news/resources/tips/thanksgiving-pets-turkeys-cooking.html
          with(/tips\/thanksgiving-pets-turkeys-cooking\.html/i) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-thanks-qa"
          }
          # End of HSUS-493
          ###################
          # Work and Issues #
          ###################
          with(/^\/work\/($|\?|index\.html)/) {
            log('--> Importing pages/work/work_main.ts in mappings.ts')
            @import "pages/work/work_main.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          with(/^\/issues\/($|\?|index\.html)/) {
            log('--> Importing pages/work/issues.ts in mappings.ts')
            @import "pages/work/issues.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          # ACTION section's in here
          with(/^\/action\/($|\?|index\.html)/) {
            log('--> Importing pages/work/action_main.ts in mappings.ts')
            @import "pages/work/action_main.ts"
            $mw_analytics = "HSUS-work-action"
          }
          with(/^\/action\/(now|fed_bill|toolkit)\/($|\?|index\.(html|jsp))/) {
            log('--> Importing pages/work/action_now.ts in mappings.ts')
            @import "pages/work/action_now.ts"
            $mw_analytics = "HSUS-work-action-now"
          }
          with(/^\/action\/(now|fed_bill|toolkit)\//) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-work-action-article"
          }
          # href http://www.humanesociety.org/action/alerts/maryland/
          with(/^\/action\/alerts\/[.]*/) {
            log('--> Importing pages/work/action_alerts.ts in mappings.ts')
            @import "pages/work/action_alerts.ts"
            $mw_analytics = "HSUS-work-action-alert"
          }
          with(/^\/action\/55_actions_to_help_animals\.html/) {
            log('--> Importing pages/news/article.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts" 
            $mw_analytics = "HSUS-work-action-article"
          }
          with(/^\/issues\/campaigns\/($|\?|index\.html)/) {
            log('--> Importing pages/work/campaign.ts in mappings.ts')
            @import "pages/work/campaign.ts"
            $mw_analytics = "HSUS-work-campaign"
          }
          # fact sheets
          with(/^\/issues\/puppy_mills\/facts\/($|\?|index\.html)/) {
            log('--> Importing pages/work/campaign_subject.ts in mappings.ts')
            @import "pages/work/campaign_subject.ts"
            $mw_analytics = "HSUS-work-campaign-subject"
          }

          # HSUS-437
          with(/^\/issues\/animal_rescue\/tips\/pet_disaster/) {
            @import "pages/news/press.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-work-fact-news"
          }
          # End HSUS-437

          with(/^\/(animals|issues|animal_community)\/(campaigns\/)?[^\/]*\/(facts|fact-sheets|tips)/) {
            log('--> Importing pages/fact_sheet.ts in mappings.ts')
            @import "pages/fact_sheet.ts"
            $mw_analytics = "HSUS-work-fact-sheet"
          }
          with(/^\/issues\/(campaigns\/)?[^\/]*\/news\.html/) {
            log('--> Importing pages/news/press.ts in mappings.ts')
            @import "pages/news/press.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-work-fact-news"
          }
          # faqs
          with(/^\/(issues|animals|animal_community)\/.*\/qa/) {
            log('--> Importing pages/work/qanda.ts in mappings.ts')
            @import "pages/work/qanda.ts"
            $mw_analytics = "HSUS-work-qa"
          }
          with(/^\/issues\/campaigns\//) {
            log('--> Importing pages/work/campaign_subject.ts in mappings.ts')
            @import "pages/work/campaign_subject.ts"
            $mw_analytics = "HSUS-work-campaign"
          }
          with(/^\/issues\/issue_resources/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          with(/^\/issues\/issue_news\.html/) {
            log('--> Importing pages/news/press.ts in mappings_tablet.ts')
            @import "pages/news/press.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-work-news"
          }
          # eating and recipes
          with(/^\/issues\/eating\/recipes\/(recipes\.html|index\.html)?/) { #/
            log('--> Importing pages/work/recipes_main.ts')
            @import "pages/work/recipes_main.ts"
            $mw_analytics = "HSUS-work-recipes"
          }
          # spay day
          with(/^\/issues\/spay_day/) {
            log('--> Importing pages/work/spay_day.ts')
            @import "pages/work/spay_day.ts" 
            $mw_analytics = "HSUS-work-spayday"
          }

          # seal splat page
          with(/^\/issues\/seal_hunt\/2013_hunt\/home\.html/) {
            log('--> Importing pages/work/seal_splat.ts')
            @import "pages/work/seal_splat.ts"
            $mw_analytics = "HSUS-seal-splat"
          }
          with(/^\/issues\/seal_hunt\/((protect_seals|index)\.html)?/) { #/
            log('--> Importing pages/work/seal_splat.ts')
            @import "pages/work/seal_splat.ts"
            $mw_analytics = "HSUS-seal-spalt"
          }

          with(/^\/issues\//) {
            log('--> Importing pages/work/issue_subject.ts')
            @import "pages/work/issue_subject.ts"
            $mw_analytics = "HSUS-work-issues"
          }

          # app section for seal stuff
          with(/^\/apps\/protectseals\//) {
            log('--> Importing pages/fact_sheet.ts in mappings.ts')
            @import "pages/fact_sheet.ts"
            $mw_analytics = "HSUS-work-seal"
          }

          #############
          # Community #
          #############

          with(/^\/animal_community\/($|\?|index\.html)/) {
            log('--> Importing pages/community/community_main.ts')
            @import "pages/community/community_main.ts"
            $mw_analytics = "HSUS-community"
          }
          # url: http://www.humanesociety.org/animal_community/shelters/wildlife_care_center/sign-up-for-email-from-sfwc.html
          with(/sign-up-for-email-from-sfwc/) {
            log("--> importing pages/donate/_sign_up.ts in mappings.ts")
            @import "pages/donate/_sign_up.ts"
            $mw_analytics = "HSUS-community-signup"
          }
          with(/^\/animal_community\/shelters\/direct_care_news/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
            $mw_analytics = "HSUS-community-shelters"
          }          
          with(/^\/animal_community\/shelters\/.*($|index\.html)/) {
            log('--> Importing pages/community/care_centers.ts')
            @import "pages/community/care_centers.ts"
            $mw_analytics = "HSUS-community-shelters"
          }
          with(/^\/animal_community\/resources\/($|\?|index\.html)/) {
            log('--> Importing pages/community/resources.ts')
            @import "pages/community/resources.ts"
            $mw_analytics = "HSUS-community-resources"
          }
          with(/^\/animal_community\/resources\/rescue_groups/) {
            log('--> Importing pages/news/article.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-community-article"
          }
          with(/^\/parents_educators\/($|\?|index\.html)/) {
            log('--> Importing pages/community/parents.ts')
            @import "pages/community/parents.ts"
            $mw_analytics = "HSUS-community-parents-educators"
          }
          with(/^\/parents_educators\//) {
            log('--> Importing pages/news/article.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/article.ts"
            $mw_analytics = "HSUS-community-parents-educators"
          }
          with(/^\/community\/volunteers\//) {
            log('--> Importing pages/community/volunteers.ts')
            @import "pages/community/volunteers.ts"
            $mw_analytics = "HSUS-community-volunteers"
          }
          with(/^\/community\/connect\.html/) {
            log('--> Importing pages/community/connect.ts in mappings.ts')
            @import "pages/community/connect.ts"
            $mw_analytics = "HSUS-community-connect"
          }
          with(/^\/animal_community\/hsvma\/hsvma_ravs\.html/) {
            log('--> Importing pages/community/parents.ts')
            @import "pages/community/parents.ts"
            $mw_analytics = "HSUS-community-hsvma"
          }

          #########
          # About #
          #########

          with(/^\/about\/($|\?|index\.html)/) {
            log('--> Importing pages/about/about_main.ts in mappings.ts')
            @import "pages/about/about_main.ts"
            $mw_analytics = "HSUS-about"
          }
          with(/^\/about\/overview\//) {
            log('--> Importing pages/about/overview.ts in mappings.ts')
            @import "pages/about/overview.ts"
            $mw_analytics = "HSUS-about-overview"
          }
          with(/^(\/about\/leadership\/)|(\/testing\/ellen-pascale\/experts\.html)/) { // for HSUS-519
            log('--> Importing pages/about/leadership.ts in mappings.ts')
            @import "pages/about/overview.ts"
            @import "pages/about/leadership.ts"
            $mw_analytics = "HSUS-about-leadership"
          }
          with(/^\/about\/contact\//) {
            log('--> found FAQ page in mappings.ts')
            @import "pages/about/about_main.ts"
            @import "pages/about/faq.ts"
            $mw_analytics = "HSUS-about-faq"
          }
          with(/^\/about\/podcast\//) {
            log('--> Redirecting podcast to desktop in mappings.ts')
            $desktop_export="true"
            $mw_analytics = "HSUS-about-podcast-desktop-export"
          }
          with(/^\/about\/events\/($|\?|index\.html)/) {
            log('--> found events page')
            @import "pages/about/about_main.ts"
            @import "pages/about/events.ts"
            $mw_analytics = "HSUS-about-events"
          }
          with(/^\/about\/events\//) {
            log('--> Importing pages/about/event_page.ts in mappings.ts')
            @import "pages/about/event_page.ts"
            $mw_analytics = "HSUS-about-events"
          }
          with(/^\/about\/state\/($|\?|index\.html)/) {
            log('--> found main state page')
            @import "pages/about/about_main.ts"
            @import "pages/about/state_news.ts"
            $mw_analytics = "HSUS-about-state"
          }
          with(/^\/about\/state\/(humane_state_ranking|humane-state-ranking)/) {
            log('--> found state rank map')
            @import "pages/about/state_ranking.ts"
            $mw_analytics = "HSUS-about-state"
          }
          with(/^\/about\/state\//) {
            log('--> found state page')
            @import "pages/about/state_page.ts"
            $mw_analytics = "HSUS-about-state"
          }
          with(/^\/about\/departments\/($|\?|index\.html)/) {
            log('--> Importing pages/about/dept_main.ts in mappings.ts')
            @import "pages/about/dept_main.ts"
            $mw_analytics = "HSUS-about-departments"
          }

          # Faith department
          with(/^\/about\/departments\/faith\/($|\?|index\.html|facts\/statements|resources\.html)/) {
            log('--> Importing pages/about/faith_base.ts in mappings.ts')
            @import "pages/about/faith_base.ts"
            $mw_analytics = "HSUS-faith"
          }
          with(/^\/about\/departments\/faith\/animal_ministry_guide\/($|index\.html|food|wildlife|pet_resources)/) {
            log('--> Importing pages/about/faith_base.ts in mappings.ts')
            @import "pages/about/faith_base.ts"
            $mw_analytics = "HSUS-faith"
          }
          with(/^\/about\/departments\/faith\/(.*)?(order|register|share|fill-the-bowl)/) {
            log('--> Importing pages/about/faith_form.ts in mappings.ts')
            @import "pages/about/faith_form.ts"
            $mw_analytics = "HSUS-faith-form"
          }
          with(/^\/about\/departments\/faith\/related_news/) {
            log('--> Importing pages/news/press.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
            $mw_analytics = "HSUS-faith-news"
          }
          with(/^\/about\/departments\/faith\//) {
            log('--> Importing pages/about/faith_article.ts in mappings.ts')
            @import "pages/about/faith_base.ts"
            $mw_analytics = "HSUS-faith"
          }
          # end faith section

          with(/^\/about\/departments\/state_affairs\/State_Directors/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/qa.ts"
            $mw_analytics = "HSUS-about-departments-qa"
          }
          with(/^\/about\/departments\/([^\/]*\/($|\?|)|[^\/]*\.html)/) {
            log('--> Importing pages/about/departments.ts')
            @import "pages/about/departments.ts"
            $mw_analytics = "HSUS-about-departments"
          }
          with(/^\/about\/employment/) {
            log('--> importing pages/about/employ.ts in mappings.ts')
            @import "pages/about/employ.ts"
            @import "pages/about/about_base.ts"
            $mw_analytics = "HSUS-about-employment"
          }
          with(/^\/about\/podcast/) {
            log('--> sending podcast to desktop in amppings.ts')
            $desktop_export = "true"
            $mw_analytics = "HSUS-about-podcast-desktop-export"
          }
          with(/^\/about\//) {
            log('--> Importing pages/about/about_base.ts in mappings.ts')
            @import "pages/about/about_base.ts"
            $mw_analytics = "HSUS-about"
          }

          #############
          # Map Pages #
          #############
          with(/assets\/maps\/feral-cat-groups/) {
            log("--> Importing pages/maplist.ts in mappings.ts")
            @import "pages/maplist.ts"
            $mw_analytics = "HSUS-map-list"
          }
          with(/assets\/maps\/volunteer_opportunities/) {
            log("--> Importing pages/maps.ts in mappings.ts")
            @import "pages/maps.ts"
            $mw_analytics = "HSUS-map"
          }
          with(/assets\/maps\/affording\-your\-pet/) {
            log("--> Importing pages/maplist.ts in mappings.ts")
            @import "pages/maplist.ts"
            $mw_analytics = "HSUS-map-list"
          }

          with(/^\/assets\/maps\/.+\?/) { #/
            log("--> might be a list")
            log("--> Importing pages/maplist.ts in mappings.ts")
            @import "pages/maplist.ts"
            $mw_analytics = "HSUS-maps"
          }

          with(/^\/assets\/maps/) {
            log("--> Importing pages/maps.ts in mappings.ts")
            @import "pages/maps.ts"
            $mw_analytics = "HSUS-maps"
          }



          ##################
          # Search Results #
          ##################

          with(/^\/search\/(tweaked-)?search/) {
            log('--> Importing pages/search_results.ts in mappings.ts')
            @import "pages/search_results.ts"
            $mw_analytics = "HSUS-search"
          }
          with(/^\/search\.jsp/) {
            log('--> Importing pages/search_results.ts in mappings.ts')
            @import "pages/search_results.ts"
            $mw_analytics = "HSUS-search"
          }

          with(/^\/testing\/search\-test\.html/) {
            log('--> Importing pages/search_results.ts in mappings.ts')
            @import "pages/search_results.ts"
            $mw_analytics = "HSUS-search"
          }
          #################
          # Contact Forms #
          #################

          with(/forms/) {
            log('--> Importing pages/forms.ts in mappings.ts')
            @import "pages/forms.ts"
            $mw_analytics = "HSUS-contact-form"
          }

          ###########
          # TESTING #
          ###########

          # HSUS-242 windowshade example page
          with(/^\/testing\/hsus_testing\/editorial\/getting_ticks_off_dog\.html/) {
            log('--> Importing pages/news/qa.ts in mappings.ts')
            @import "pages/news/qa.ts"
            @import "pages/news/news_base.ts"
          }
          # End HSUS-242 windowshade example page

          # HSUS-406 this entry only use for temp address and we can delete if the page is online
          with(/^\/testing\/hsus_testing\//) {
            log("--> Importing pages/magazine_root.ts in mappings.ts")
            @import "pages/magazine_root.ts"
            $mw_analytics = "HSUS-magazine-root"
          }
          # http://www.humanesociety.org/testing/pet_of_the_week_submission.html
          with(/^\/testing\/pet_of_the_week_submission\.html/) {
            @import "pages/forms.ts"
            $mw_analytics = "HSUS-contact-form"
          }
          # HSUS-406 end

          # HSUS-436
          # https://secure.humanesociety.org/site/SPageServer?pagename=chimp_art_contest
          with(/PageBuilderPreviewPage|^\/site\/SPageServer\?pagename\=chimp_art_contest/) {
            log("Chimps art test page")
            # @import pages/news/article.ts
            @import pages/custom/chimp_art_mobile.ts
          }

          with(/thanks_chimpanzee_art_contest.html$/) {
            # @import base_tablet.ts
            @import "pages/forms.ts"
          }


          # HSUS-436 End

          # HSUS-506 http://mlocal.humanesociety.org/testing/chris_keane/footer/test-footer-revisions.html
          with(/test-footer-revisions/) {
            log('--> footer revisions testpage')
            @import "pages/home.ts"
          }

          #########
          # Shop #
          #######

          with(/^\/shop/) {
            log("--> importing pages/shopping.ts mappings.ts")
            @import "pages/shop.ts"
            $mw_analytics = "HSUS-shop"
          }

          match($desktop_export, "true") {
            log("--> No page match in mappings.ts")
            @import desktop_redirect.ts
          }
          
          # HSUS-344
          # http://humanesociety.org/testing/cd-test2.html
          with(/^\/testing\/cd-test2\.html/) {
            log('--> Importing pages/animals/animal_main.ts in mappings.ts')
            @import "pages/animals/animal_main.ts"
            $mw_analytics = "HSUS-animal-main"
          }
          # end of HSUS-344
          with(/flickr/) {
            @import "pages/flickr.ts"
          }
          
          else() {
            match($desktop_export, "true") {
              log("--> No page match in mappings.ts")
              @import desktop_redirect.ts
            }
            log("--> No page match in mappings.ts")
            log("--> Doing a basic page mapping for CMS")
            $(".//body") {
              match($host) {
                with(/mstage|mlocal/) {
                  $("./div[@id='wrapper']") {
                    insert_top("div", style:"margin: 10px; padding: 10px; background-color: white; color: red;", "This page does not have an associated mapping for transformation. File it as a ticket for Moovweb")
                  }
                }
              }
              add_class("mw_no_match_basic")
              $(".//div[@id='main']") {
                add_class("mw_box2")
              }
            }
          }
        }
      }

      # match($path) {
      #   with(/(\?|\&)moov\=rainbows/) {
      #     $('./head') {
      #       log("MAKIN IT RAIN-BOW!")
      #       insert_bottom("style", type:"text/css", "#wrapper::before{ content:''; width:90%; height: 100%; position: fixed; bottom: -50%; left: 5%; display: block; box-shadow: 0px 0px 0px 3px red, 0px 0px 0px 6px orange, 0px 0px 0px 9px yellow, 0px 0px 0px 12px green, 0px 0px 0px 15px blue, 0px 0px 0px 18px purple; -webkit-border-radius: 100%; z-index: 999;}") 
      #     }
      #   }

      #   with(/(\?|\&)moov\=3d/) {
      #     $('./head') {
      #       log("MAKIN IT 3D!")
      #       insert_bottom("style", type:"text/css", "*{ box-shadow: 1px 1px 0px 1px red, 2px 2px 0px 1px orange, 3px 3px 0px 1px yellow, 4px 4px 0px 1px green, 5px 5px 0px 1px blue, 6px 6px 0px 1px violet, 7px 7px 0px 1px purple; }") 
      #     }
      #   }
      # }
    }
  }

  # search results are a 304?
  with(/304/) {
    log("--> STATUS: 304")
    match($path) {
      with(/search\/search/) {
        log('--> Importing pages/search_results.ts in mappings.ts')
        @import "pages/search_results.ts"
      }
    }
  }

  # 404 page?
  # http://mlocal.humanesociety.org/news/resources.html
  with(/404/) {
    log("--> STATUS: 404")
    @import "pages/page_not_found.ts"
  }

  else() {
    # not 200 or 302 response status
    log("--> STATUS: " + $status + " assuming its an error code pages/error.ts")
    @import "pages/error.ts"
  }

}

/*
  Mappings

  Mappings are matchers that we use to determine if we should execute a
  bit of Tritium during an execution. Aka, run something when we are
  are on a certain page.

  Example starting code:
  */

# new addition March 14: to redirect a site to desktop, match its url
#                        log some useful message and then set variable
#                        $desktop_export to "true". -- SL

match($path, /site\/Advocacy\?cmd\=display/) {;
  $status = "200"
}
match($status) {

  with(/302/) {
    log("--> STATUS: 302") # redirect: just let it go through
  }
  with(/200/) {
    log("--> STATUS: 200")
    match($host) {
      with(/video\.humanesociety\.org/) {
        log("--> Videos subdomain in mappings_tablet.ts")

        match($path) {

          ###############
          # Video Pages #
          ###############
          log($path)

          with(/^\/$|^\/\?/) { #/
            log("--> Matching video root in mappings_tablet.ts")
            $mw_analytics = "HSUS-video-root-tablet"

            @import "pages/video_slideshow/video_home_tablet.ts"
          }


          # fix for the animal fighting & cruelty
          # the title is too long and messes up the header for iPhones in portrait mode.
          # with(/index\.php\?id\=PLE01490092359B5C3/) {
          #   log("--> Matching index.php fix for long category title in mappings_tablet.ts")
          #   $("./head") {
          #     insert("style", type:"text/css", ".mw_video_common #topNav .mw_header_menu_item.active .mw_header_menu_item_content{font-size: 11px;}")
          #   }
          #   @import "pages/video_slideshow/video_home_tablet.ts"
          # }

          with(/index\.php/) {
            log("--> Matching index.php in mappings_tablet.ts")
            @import "pages/video_slideshow/video_home_tablet.ts"
            $mw_analytics = "HSUS-video-root-tablet"
          }

          with(/category/) {
            log("--> Matching /category in mappings_tablet.ts")
            @import "pages/video_slideshow/video_home_tablet.ts"
            $mw_analytics = "HSUS-video-root-tablet"
          }

          with(/press\/video\.php/) {
            log("--> Matching video press page in mappings_tablet.ts")
            @import "pages/video_slideshow/video_press_page_tablet.ts"
            $mw_analytics = "HSUS-video-press-page-tablet"
          }

          # Press login..
          with(/press\/users/) {
            log("--> Matching press/users in mappings_tablet.ts")
            @import "pages/video_slideshow/login_tablet.ts"
            $mw_analytics = "HSUS-video-press-login-tablet"
          }

          with(/press/) {
            log("--> Matching video press root in mappings_tablet.ts")
            @import "pages/video_slideshow/video_press_home_tablet.ts"
            $mw_analytics = "HSUS-video-root-tablet"
          }

          with(/video/) {
            log("--> Matching /video/ in mappings_tablet.ts")
            @import "pages/video_slideshow/video_home_tablet.ts"
            $mw_analytics = "HSUS-animal-legacy-video-tablet"
          }
          
          # HSUS-309
          # http://video.humanesociety.org/assets/links/view.php?bctid=1113136319001
          with(/^\/assets\/links\/view\.php\?/i) { #/
            log("--> Matching /video/ in mappings.ts")
            @import "pages/video_slideshow/individual_video.ts"
          }
        }

      }

        ##############
        # Slideshows #
        ##############

        with(/slideshows\.humanesociety\.org/) {
          log("--> Slideshows subdomain in mappings_tablet.ts")
          match($path) {
            with(/^\/$|^\/\?/) { #/
              log("--> Matching slideshows root in mappings_tablet.ts")
              @import "pages/video_slideshow/slideshow_home_tablet.ts"
              $mw_analytics = "HSUS-slideshow-root-tablet"

            }

            with(/index\/gallery/) {
              log("--> Matching slideshows index/gallery in mappings_tablet.ts")
              @import "pages/video_slideshow/slideshow_home_tablet.ts"
              $mw_analytics = "HSUS-slideshow-gallery-tablet"
            }
          }
        }

      #############################################
      # secure.humanesociety.org - Donations, etc #
      #############################################

      # Test Convio mapping
      with(/secure3\.convio\.net/) {
        match($path) {
          with(/humane\/admin\/Donation2Preview/i) {
            log("--> importing pages/donate/_site_donate.ts in mappings.ts")
            @import "pages/donate/_site_donate_tablet.ts"
            $mw_analytics = "HSUS-site-donation"
          }
        }
      }

      with(/secure\.humanesociety\.org/) {

        log("--> Secure subdomain in mappings_tablet.ts")
        @import "pages/work_tablet/convio_tablet.ts"
        match($path) {

          # Example:
          # https://mlocal.secure.humanesociety.org/site/Donation2?df_id=1452&1452.donation=form1&source=gac4ac
          with(/site\/Donation2\?df_id\=1452\&1452/) {
            log("HSLF donation form")
            @import "pages/donate/_hslf_donate_tablet.ts"
            $mw_analytics = "HSUS-site-donation-tablet"
          }
          
          # https://secure.humanesociety.org/site/Donation/2093707163
          with(/^\/site\/donation($|\/[\d]+)/i) {
            log("--> importing pages/donate/_my_profile_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_my_profile_tablet.ts"
          }
          with(/site\/donation/i) {
            log("--> importing pages/donate/_site_donate_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_site_donate_tablet.ts"
            $mw_analytics = "HSUS-site-donation-tablet"
          }

          #Example:
          # https://mlocal.secure.humanesociety.org/site/SSurvey?SURVEY_ID=2820&ACTION_REQUIRED=URI_ACTION_USER_REQUESTS


          with(/site\/SSurvey/) {
            log("--> importing pages/donate/_sign_up.ts in mappings_tablet.ts")
            @import "pages/donate/_sign_up_tablet.ts"
            $mw_analytics = "HSUS-site-survey-tablet"
          }

          # Humane alert page
          # https://secure.humanesociety.org/site/Advocacy?cmd=display&page=OnScreenThanks&id=5951
          with(/site\/Advocacy\?(pagename=homepage\&)?.*\&page=(onscreenthanks|actionalerttakenpage)/i) {
            # Formerly:
            # /site\/Advocacy\?(pagename=homepage\&)?cmd=display\&page=(onscreenthanks|actionalerttakenpage)/i
            log("--> importing pages/donate/_humane_tablet.ts in mappings.ts")
            @import "pages/donate/_tellafriend_tablet.ts"
            $mw_analytics = "HSUS-site-advocacy-tablet"
          }

          # pledges in campaign section
          # this isn't really under work, it can moved later for convenience
          with(/site\/Advocacy/) {
            log("--> importing pages/work/pledge_tablet.ts and pages/work_tablet/convio.ts in mappings_tablet.ts")
            @import "pages/work_tablet/pledge_tablet.ts"
            # @import "pages/work_tablet/convio_tablet.ts"
            $mw_analytics = "HSUS-site-advocacy-tablet"
          }

          # meatless monday signup
          with(/\/site\/SPageServer\?pagename\=meatlessmondaysignup/) {
            log("--> Importing pledge form for meatless monday")
            @import "pages/donate/_sign_up_tablet.ts"
            $mw_analytics = "HSUS-site-advocacy-tablet"
          }
          with(/pagename\=meatless_monday_contest/) {
            log("--> Importing pledge form for meatless monday")
            @import "pages/donate/_sign_up_tablet.ts"
            $mw_analytics = "HSUS-site-advocacy-tablet"
          }

          # https://secure.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013
          # https://secure.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
          with(/\/site\/SPageServer\?.*pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
            log("--> importing pages/drtv_tablet/drtv_base.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_base.ts"
            match($path) {
              with(/thanks/) {
                log("--> importing pages/drtv_tablet/drtv_thank.ts in mappings_tablet.ts")
                @import "pages/drtv_tablet/drtv_thank.ts"
              }
              else() {
                log("--> importing pages/drtv_tablet/drtv_donation.ts in mappings_tablet.ts")
                @import "pages/drtv_tablet/drtv_donation.ts"
              }
            }
          }

          # https://secure.humanesociety.org/site/SPageServer?pagename=drtv_splashb_MSI
          with(/\/site\/SPageServer\?.*pagename\=drtv\_splashb\_MSI/) {
            log("--> importing pages/drtv_tablet/drtv_base.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_base.ts"
            log("--> importing pages/drtv_tablet/drtv_splash.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_splash.ts"
          }

          # send the DRTV pages to desktop for the time being 
          with(/\/site\/SPageServer\?pagename\=drtv\_/) {
            log("--> Sending DRTV form to desktop")
            # $desktop_export = "true"
            # remove("//meta[@name='viewport']")
          }

          # pets of valor award
          # https://secure.humanesociety.org/site/SPageNavigator/pets_of_valor_vote.html
          # https://secure.humanesociety.org/site/SPageServer?pagename=pets_of_valor_vote
          with(/\/site\/(SPageNavigator\/|SPageServer\?\w+=)pets\_of\_valor\_vote/) {
            log("--> importing pages/donate/valor_award_tablet.ts in mappings.ts")
            @import "pages/donate/valor_award_tablet.ts"
          }

          # REUS donation
          # https://secure.humanesociety.org/site/SPageServerpagename=reus_hsus_donation_2013_ye_research_ppc_splash
          # https://secure.humanesociety.org/site/SPageNavigator/reus_hsus_donation_2013_ye_research_ppc_splash.html
          with(/\/site\/(SPageNavigator\/|SPageServer\?pagename=)reus_hsus_donation_2013/) {
            log("--> importing pages/donate/valor_award.ts in mappings_tablet.ts")
            @import "pages/custom/reus_hsus_donation_2013_tablet.ts"
          }

          # Chimps landing page
          with(/site\/SPageServer\?pagename\=chimp_art_contest/) {
            log("Chimps art test page")
            @import pages/custom/chimp_art_tablet.ts
          }

          with(/thanks_chimpanzee_art_contest.html$/) {
            # @import base_tablet.ts
            # @import pages/news_tablet/forms_tablet.ts
          }
          
          with(/site\/SPageServer\?.?pagename\=st_francis_day_box/) {
            log("--> importing pages/donate/_st_francis_box_tablet.ts in mappgins_tablet.ts")
            @import "pages/donate/_st_francis_box_tablet.ts"
          }
          
          with(/site\/SPageServer\?.?pagename\=virtual_town_hall/) {
            log("--> importing pages/donate/_virtual_town_hall_tablet.ts in mappgins_tablet.ts")
            @import "pages/donate/_virtual_town_hall_tablet.ts"
          }          

          #HSUS-463
          #https://secure.humanesociety.org/site/SPageServer?pagename=take_your_pet
          with(/site\/SPageServer\?.?pagename\=take_your_pet/) {
            log("--> importing pages/donate/_take_your_pet_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_take_your_pet_tablet.ts"
          }

          # HSUS-497
          # https://secure.humanesociety.org/site/SPageServer?pagename=EP_ppc_splash_mwcopy
          # https://secure.humanesociety.org/site/SPageServer?pagename=reus_HSUS_donation_2013_ye_stella_ppc_splash
          with(/ppc_splash/) {
            log("--> importing pages/donate/_splash.ts in mappings.ts")
            @import "pages/donate/_splash.ts"
          }

          with(/^\/site\/(SPageNavigator\/(new_life_for_chimps|puppy_mill_pledge_action_takers)\.html|SPageServer\?(\w+=\w+)+)/) {
            log("--> importing pages/work/pledge.ts in mappings_tablet.ts")
            @import "pages/donate/_chimps_tablet.ts"
          }
          # https://secure.humanesociety.org/site/UserLogin
          # https://secure.humanesociety.org/site/UserLogin?CMD=ForgotLogin
          # https://secure.humanesociety.org/site/UserLogin?CMD=ForgotPassword
          with(/site\/UserLogin/) {
            log("--> importing pages/donate/_donate_login_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_donate_login_tablet.ts"
          }
          # profile home
          # https://secure.humanesociety.org/site/SPageNavigator/HSUS_my_profile.html
          with(/^\/site\/SPageNavigator\/HSUS_my_profile/) {
            log("--> importing pages/donate/_my_profile_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_my_profile_tablet.ts"
          }
          # edit profile
          # https://secure.humanesociety.org/site/ConsProfileUser
          # https://secure.humanesociety.org/site/ConsInterestsUser
          with(/\/site\/(ConsProfileUser|ConsInterestsUser)/i) {
            log("--> importing pages/donate/edit_profile_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/edit_profile_table.ts"
          }
          
          # You're Invited
          # https://secure.humanesociety.org/site/Ticketing?view=Tickets&id=109422&JServSessionIdr004=e4u8fmzzg5.app305b
          with(/\/site\/Ticketing/) {
            log("--> importing pages/donate/ticketing_tablet.ts in mappings.ts")
            @import "pages/donate/ticketing_tablet.ts"
          }

          # catchall
          else() {
            log("--> importing pages/donate/_hslf_donate_tablet.ts in mappings_tablet.ts")
            @import "pages/donate/_hslf_donate_tablet.ts"
            $mw_analytics = "HSUS-site-donation-tablet"
          }
        }
      }

      #################
      # ACTION / WORK #
      #################

      with(/action\.humanesociety\.org/) {
        log("--> Action subdomain in mappings_tablet.ts")

        match($path) {
          # ticket HSUS-375 [Mobile & Tablet] Sacramento events page
          # http://m.action.humanesociety.org/site/Calendar?id=109422&view=Detail&autologin=true
          with(/site\/Calendar\?id=109422+&view=Detail+&autologin=true/i) {
            log('--> Calendar Page')
            @import "pages/calendar_tablet/calendar_page.ts"
          }
          # http://action.humanesociety.org/site/Calendar?id=111041&view=RSVP
          with(/site\/Calendar\?id=[\d]*\&view=RSVP/) {
           log("--> importing pages/calendar_tablet/day_grid.ts")
           @import "pages/calendar_tablet/day_grid.ts"
         }
          # http://action.humanesociety.org/site/Calendar*?view=RSVP&id=111041
          with(/site\/Calendar\?view=RSVP&id=[\d]*/) {
           log("--> importing pages/calendar_tablet/day_grid.ts")
           @import "pages/calendar_tablet/day_grid.ts"
         }
          # calendar events
          with(/site\/Calendar\/[\d]*\?view=Detail/) {
            log('--> importing pages/calendar_tablet/event.ts')
            # @import "pages/about_tablet/events_tablet.ts"
            @import "pages/calendar_tablet/event.ts"
            $mw_analytics = "HSUS-calendar-tablet"
          }
          # Fix for HSUS-481
          with(/site\/Calendar\?id/i) {
            log('--> importing pages/calendar_tablet/event.ts')
            # @import "pages/about_tablet/events_tablet.ts"
            @import "pages/calendar_tablet/event.ts"
          }
          # Fix for HSUS-481

          # http://action.humanesociety.org/site/Calendar?view=Detail&id=109422
          with(/site\/Calendar\?view=Detail/) {
            log("--> importing pages/calendar_tablet/event.ts")
            @import "pages/calendar_tablet/event.ts"
          }
          
          # Calendar stuff is handled differently to mobile
          with(/site\/Calendar\/[\d]*\?view=MonthGrid\&Day/) {
            # $path {
            #   replace(/Grid/, "List")
            # }
            # export("Location", $path)
            log('--> importing calendar instead of redirecting to list')
            @import "pages/calendar_tablet/day_grid.ts"
            $mw_analytics = "HSUS-calendar-day-grid-tablet"
          }
          # day, week grid redirect
          # with(/site\/Calendar\/[\d]*\?view=(Day|Week)Grid\&Day/) {
          #   log('--> redirecting grid mode calendar to list mode')
          #   $path {
          #     replace(/Grid/, "List")
          #   }
          #   export("Location", $path)
          # }          
          # day, week, month list
          with(/site\/Calendar\/[\d]*\?view=(Day|Month|Week)List\&Day/) {
            log('--> importing pages/calendar_tablet/day_list.ts')
            @import "pages/calendar_tablet/day_list.ts"
            $mw_analytics = "HSUS-calendar-day-list-tablet"
          }
          # # clicked to query or sign up page
          with(/site\/Calendar(\/[\d]*|$)/) {
            log('--> importing pages/calendar_tablet/day_grid.ts')
            @import "pages/calendar_tablet/day_grid.ts"
            $mw_analytics = "HSUS-calendar-day-list-tablet"
          }

          # https://action.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013
          # https://action.humanesociety.org/site/SPageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
          with(/\/site\/PageServer\?.*pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
            log("--> importing pages/drtv_tablet/drtv_base.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_base.ts"
            match($path) {
              with(/thanks/) {
                log("--> importing pages/drtv_tablet/drtv_thank.ts in mappings_tablet.ts")
                @import "pages/drtv_tablet/drtv_thank.ts"
              }
              else() {
                log("--> importing pages/drtv_tablet/drtv_donation.ts in mappings_tablet.ts")
                @import "pages/drtv_tablet/drtv_donation.ts"
              }
            }
          }

          # https://action.humanesociety.org/site/SPageServer?pagename=drtv_splashb_MSI
          with(/\/site\/PageServer\?.*pagename\=drtv\_splashb\_MSI/) {
            log("--> importing pages/drtv_tablet/drtv_base.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_base.ts"
            log("--> importing pages/drtv_tablet/drtv_splash.ts in mappings_tablet.ts")
            @import "pages/drtv_tablet/drtv_splash.ts"
          }

          # with(/MatchingGifts/) {
          #   log("--> importing pages/donate/_matchinggifts.ts in mappings_tablet.ts")
          #   # @import "pages/donate/_matchinggifts.ts"
          # }
          # this isn't really under work, it can moved later for convenience
          # http://action.humanesociety.org/site/PageServer?pagename=humane_welcome_page&JServSessionIdr004=8w797fvbu1.app305b
            # with(/site\/PageServer\?pagename=humane_welcome_page/) {
            #   log('--> importing pages/work_tablet/welcome.ts in mappings_tablet.ts')
            #   @import "pages/work_tablet/welcome.ts"
            # }
          # HSUS-311 Protect seals pledge
          # http://action.humanesociety.org/site/Survey?ACTION_REQUIRED=URI_ACTION_USER_REQUESTS&SURVEY_ID=8382
          with(/^\/site\/Survey\?ACTION_REQUIRED=[^&]+&SURVEY_ID=8382/i) {
            log('--> importing pages/work_tablet/protect_seals_pledge_tablet.ts in mappings_tablet.ts')
            @import "pages/work_tablet/protect_seals_pledge_tablet.ts"
            $mw_analytics = "HSUS-survey-seals-pledge-tablet"
          }
          
          ## HSUS - 443
          # mconnect action forms
          # http://www.action.humanesociety.org/site/PageNavigator/mconnect.html
          with(/site\/PageNavigator\/mconnect/i) {
            log('--> found mconnect action form')
            @import "pages/work_tablet/action_form_mconnect.ts"
            $mw_analytics = "HSUS-mconnect-action-form-tablet"
          }
          ## HSUS - 443

          # For HSUS-484
          # url: http://action.humanesociety.org/site/PageNavigator/hsus_calendar.html.
          with(/\/PageNavigator\/hsus_calendar\.html/) {
            @import "pages/calendar_tablet/day_grid.ts"
          }
          # End of HSUS-484

          # action forms
          with(/site\/(PageServer|Survey|PageNavigator)/) {
            log('--> found action form')
            @import "pages/work_tablet/action_form.ts"
            $mw_analytics = "HSUS-action-form-tablet"
          }

          # HSUS-344 Gigya landing page
          with(/site\/GigyaLogin/) {
            log("Gigya landing")
            @import "pages/gigya_tablet.ts"
          }
          
          # HSUS-401
          # Email Preferences
          # http://action.humanesociety.org/site/CO?i=ATIXJfiAhQUCE76ukI6rs0KVyAmeQ6Wd&cid=0
          # http://action.humanesociety.org/site/CO?i=tigud82sbXBijJ127B_G1gfcRFWydCrg&cid=0
          # HSUS-402
          # http://mlocal.action.humanesociety.org/site/CO?unsub_interests=0&first_name=&last_name=&primary_email=456%40fs.com&unsub=Unsubscribe&op.unsubFallback=
          with(/^\/site\/co\?(i=.*cid=0|unsub_interests.*)/i) {
            log("--> importing pages/email_preferences_tablet.ts in mappings_tablet.ts")
            @import "pages/email_preferences_tablet.ts"
          }
          # Fix for HSUS-485
          #http://mlocal.action.humanesociety.org/site/CO;jsessionid=74DC692F46524B250E378A67C46872FF.app338b?op.unsubscribe.confirm=
          with(/^\/site\/co\?op.*/i) {
            log("--> importing pages/email_preferences_tablet.ts in mappings_tablet.ts")
            @import "pages/email_preferences_tablet.ts"
          }
          # End of HSUS-485
        }
      }

      ##########
      # Legacy #
      ##########

      with(/legacy\.humanesociety\.org/) {
        match($path) {

          # Article page
          with(/^\/index(\.html|\.php)\?article/) {
            log("--> importing pages/legacy/legacy_article.ts in mappings.ts")
            @import "pages/legacy/legacy_article_tablet.ts"
            $mw_analytics = "HSUS-legacy-article-tablet"
          }

          # Other Article
          with(/^\/Article/) {
            log("--> importing pages/legacy/legacy_article.ts in mappings.ts")
            @import "pages/legacy/legacy_article_tablet.ts"
            $mw_analytics = "HSUS-legacy-article-tablet"
          }

          # Brochures
          # http://legacy.humanesociety.org/ebrochures.php?ebrochure=24
          with(/ebrochures\.php/) {
            log("--> importing pages/legacy/? in mappings.ts")
            @import "pages/legacy/legacy_article_tablet.ts"
            $mw_analytics = "HSUS-legacy-article-tablet"
          }

          # Root page
          # http://legacy.humanesociety.org/
          with(/^\/$|^\/\?|^\/index\.html|^\/index\.php/) {
            log("--> importing pages/legacy/legacy_root.ts in mappings.ts")
            @import "pages/legacy/legacy_root_tablet.ts"
            $mw_analytics = "HSUS-legacy-root-tablet"
          }
          
          # Contact page
          # http://legacy.humanesociety.org/contact.php
          with(/^\/contact/) {
            log("--> importing pages/legacy/legacy_contact_tablet.ts in mappings.ts")
            @import "pages/legacy/legacy_contact_tablet.ts"
            $mw_analytics = "HSUS-legacy-contact-tablet"
          }
        }
      }

      # Regular site
      else() {
        match($path) {

          with(/^\/$|^\/\?|^\/index\.html/) {
            log("--> Importing pages/home.ts in mappings_tablet.ts")
            @import "pages/home_tablet.ts"
            $mw_analytics = "HSUS-home-tablet"
          }
          with(/newsfeedtest|newsbrieftest2/) {
            log("--> Importing pages/home.ts in mappings_tablet.ts")
            @import "pages/home_tablet.ts"
          }
          
          # URL: humanesociety.org/header-b.html
          with(/header\-b\.html|^\/testing.*homepage/) {
            log("--> Alt Header. Importing pages/home.ts in mappings_tablet.ts")
            @import "pages/home_tablet.ts"
            $mw_analytics = "HSUS-home-tablet"
          }

          with(/test_homepage_with_moovweb/) {
            log("--> Importing pages/home.ts in mappings_tablet.ts")
            # @import "pages/home.ts"
          }
          
          # stock gifts
          # http://www.humanesociety.org/donate/plan/stock_gifts.html
          with(/^\/donate\/plan\/stock_gifts/) {
            log("--> importing pages/donate/_stock_gifts.ts in mappings.ts")
            @import "pages/donate/_stock_gifts.ts"
            $mw_analytics = "HSUS-stock-gifts-tablet"
          }
          
          # Moved this ahead of /index.html for the donate/index.html page
          with(/\/donate\//) {
            log('--> Matching donate in mappings_tablet.ts')
            @import "pages/donate/_donate_root_tablet.ts"
            $mw_analytics = "HSUS-donate-root-tablet"
          }

          
          ###############
          # Index Page  #
          ###############
          with(/^\/index\.html/) {
            log('--> Matching index page in mappings_tablet.ts')
            $mw_analytics = "HSUS-home-tablet"
          }

          ######################
          # Internal Resources #
          ######################

          # with(/^\/(tips|issues)/) {
          #   log('--> Matching Internal Resources in mappings_tablet.ts')
          # }

          # not done
          with(/^\/restaurant_locator/) {
            log('--> Importing pages/restaurant_form.ts')
            @import "pages/restaurant_form_tablet.ts"
            $mw_analytics = "HSUS-restaurant-form-tablet"
          }

          with(/^\/sitemap\.html/) {
            log('--> Importing pages/sitemap.ts in mappings_tablet.ts')
            @import "pages/sitemap_tablet.ts"
            $mw_analytics = "HSUS-sitemap-tablet"
          }

          with(/^\/privacy\.html/) {
            log('--> Importing pages/news_tablet/article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-privacy-tablet"          
          }
          with(/(testing\/chris_keane\/moovweb\/test\-tablet\-masthead\-article\-page\.html)/) {
            log('--> Importing pages/news_tablet/article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
          }

          # 55 Ways to Help Animals
          # URL: http://www.humanesociety.org/action/55_actions_to_help_animals.html
          with(/^\/action\/55_actions_to_help_animals\.html/) {
            log('--> Importing pages/news_tablet/article.ts in mappings.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-work-action-article"
          }

          ########
          # News #
          ########

          # this needs to go before news because of how ruby matches regexes

          //previous version of the mapping below. why are we matching on a testpage here?
          # with(/(^\/testing\/)|(^\/news\/(press_releases|news)\/($|index\.jsp*))/) {
            with(/(^\/news\/(press_releases|news)\/($|index\.jsp*))/) {
            log('--> Importing pages/news_tablet/press.ts in mappings.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
            $mw_analytics = "HSUS-press"
          }
          with(/^\/news\/resources\/facts\//) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/qa.ts"
          }
          with(/^\/news\/(resources\/qa|interview|dispatch)\//) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/qa.ts"
            $mw_analytics = "HSUS-qa"
          }
          # with(/^\/news\/(interview\/|magazines\/[^\/]*interview)/) {
          #   log('--> importing interview.ts in mappings_tablet.ts')
          #   # @import "pages/news_tablet/interview.ts"
          # }
          with(/^\/news\/(press_releases|news)\//) {
            log('--> Importing pages/news_tablet/article.ts in mappings.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-news-article"
          }
          with(/^\/news\/related_news\.html/) {
            log('--> importing pages/news_tablet/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
          }
          with(/^\/news\/workplace_giving/) {
            log('--> importing pages/news_tablet/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
            $mw_analytics = "HSUS-press"
          }

          with(/^\/news\/publications\/whitepapers/) {
            log('--> importing pages/news_tablet/whitepapers.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/whitepapers.ts"
            $mw_analytics = "HSUS-whitepaper"
          }
          with(/^\/news\/resources\/research/) {
            log('--> importing pages/news_tablet/whitepapers.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
          }
          with(/^\/news\/blog/) {
            log('--> Importing pages/news_tablet/news.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_main.ts"
            $(".//div[@id='page-head']") {
              add_class("mw_hide")
            }
            $mw_analytics = "HSUS-blog"
          }
          with(/^\/news\/profile\/off-duty/) {
            log('--> importing pages/news_tablet/off_duty.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/off_duty.ts"
            $mw_analytics = "HSUS-off-duty"
          }
          # HSUS-430
          with(/^\/news\/news\_briefs/) {
            log("--> Importing pages/news_tablet/news_base.ts in mappings.ts")
            # @import "pages/news_tablet/news_briefs.ts"
            # @import "pages/news_tablet/press.ts"
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
          }
          # End HSUS-430

          with(/^\/news\/($|\?|index\.html)/) {
            log('--> Importing pages/news_tablet/news_main.ts in mappings.ts')
            @import "pages/news_tablet/news_main.ts"
            $mw_analytics = "HSUS-news"
          }

          #############
          # Magazines #
          #############

          # Magazine root
          with(/^\/news\/magazines\/($|\?|index\.html)/) {
            log("--> Importing pages/magazine_root.ts in mappings_tablet.ts")
            @import "pages/magazine_root_tablet.ts"
            $mw_analytics = "HSUS-magazine-root"
          }

          # Exploring the magazine 

          with(/^\/news\/magazines\//) {
            log("--> Importing pages/magazine_root.ts in mappings_tablet.ts")
            @import "pages/magazine_root_tablet.ts"
            $mw_analytics = "HSUS-magazine-root"
          }

          ###########
          # ANIMALS #
          ###########

          with(/^\/animals\/($|\?|index\.html)/) {
            log('--> Importing pages/animals_tablet/animal_main.ts in mappings.ts')
            @import "pages/animals_tablet/animal_main.ts"
            $mw_analytics = "HSUS-animal-main"
          }
          with(/^\/animals\/(pets|wild_neighbors)\/($|\?|index\.html)/) {
            log('--> Importing pages/animals_tablet/pets.ts in mappings.ts')
            @import "pages/animals_tablet/pets.ts"
            $mw_analytics = "HSUS-animal-pets"
          }
          with(/^\/animals\/(pets|wild_neighbors)\/news\.html/) {
            log('--> Importing pages/animals_tablet/animal_news.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          with(/^\/animals\/browse_animals/) {
            log('--> Importing pages/animals_tablet/a_to_z.ts in mappings_tablet.ts')
            @import "pages/animals_tablet/a_to_z.ts"
            $mw_analytics = "HSUS-animal-a-to-z"
          }
          with(/^\/animals\/animal_news/) {
            log('--> Importing pages/animals_tablet/animal_news.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          with(/^\/animals\/(animal_)?resources/) {
            log('--> Importing pages/news_tablet/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/press.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal-news"
          }
          # cat-ccordion section
          # temp location
          with(/testing\/hsus_testing\/editorial\/cat-accordion\.html/) {
            log('--> importing cat_problem_solver.ts in mappings_tablet.ts - testing environment')
            @import "pages/animals_tablet/cat_problem_solver.ts"
            $mw_analytics = "HSUS-animal-cat"
          }
          # permanent location
          with(/animals\/cats\/cat_problem_solver/) {
            log('--> importing cat_problem_solver.ts in mappings_tablet.ts')
            @import "pages/animals_tablet/cat_problem_solver.ts"
            $mw_analytics = "HSUS-animal-cat"
          }
          with(/^\/animals\/[^\/.]*\/tips\/($|\?|index\.html)/) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal-qa"
          }
          with(/^\/animals\/[^\/]*\/tips\/[^\/]*\.html/) {
            log('--> Importing pages/news_tablet/article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/article.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-animal"
          }
          with(/^\/animals\/.*\/($|\?|index\.html)/) {
            log('--> Importing pages/animals_tablet/pets.ts in mappings_tablet.ts')
            @import "pages/animals_tablet/pets.ts"
            $mw_analytics = "HSUS-animal-pets"
          }
          with(/^\/animals\//) {
            log('--> Importing article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-animal-article"
          }
          # Fix for HSUS-493
          # http://humanesociety.org/news/resources/tips/thanksgiving-pets-turkeys-cooking.html
          with(/tips\/thanksgiving-pets-turkeys-cooking\.html/i) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-thanks-qa"
          }
          # End of HSUS-493

          ###################
          # Work and Issues #
          ###################
          with(/^\/work\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/work_main.ts in mappings_tablet.ts')
            @import "pages/work_tablet/work_main.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          with(/^\/issues\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/issues.ts in mappings_tablet.ts')
            @import "pages/work_tablet/issues.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          # ACTION section's in here
          with(/^\/action\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/action_main.ts in mappings_tablet.ts')
            @import "pages/work_tablet/action_main.ts"
            $mw_analytics = "HSUS-work-action"
          }
          with(/^\/action\/(now|fed_bill|toolkit)\/($|\?|index\.(html|jsp))/) {
            log('--> Importing pages/work_tablet/action_now.ts in mappings_tablet.ts')
            @import "pages/work_tablet/action_now.ts"
            $mw_analytics = "HSUS-work-action-now"
          }
          with(/^\/action\/(now|fed_bill|toolkit)\//) {
            log('--> Importing pages/news_tablet/article.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
            $mw_analytics = "HSUS-work-action-article"
          }
          # href http://www.humanesociety.org/action/alerts/maryland/
          with(/^\/action\/alerts\/[.]*/) {
            log('--> Importing pages/work_tablet/action_alerts.ts in mappings_tablet.ts')
            @import "pages/work_tablet/action_alerts.ts"
            $mw_analytics = "HSUS-work-action-alert"
            $mw_analytics = "HSUS-work-action-article"
          }
          with(/^\/issues\/campaigns\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/campaign.ts in mappings_tablet.ts')
            @import "pages/work_tablet/campaign.ts"
            $mw_analytics = "HSUS-work-campaign"
          }
          # fact sheets
          with(/^\/issues\/puppy_mills\/facts\/($|\?|index\.html)/) {
            log('--> Importing pages/work_tablet/campaign_subject.ts in mappings_tablet.ts')
            @import "pages/work_tablet/campaign_subject.ts"
            $mw_analytics = "HSUS-work-campaign-subject"
          }
          # HSUS-437
          with(/^\/issues\/animal_rescue\/tips\/pet_disaster/) {
            log("Pet disaster prepairdness")
            log('--> Importing pages/fact_sheet.ts in mappings_tablet.ts')
            # @import "pages/fact_sheet_tablet.ts"
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
            $mw_analytics = "HSUS-news-tablet"
          }
          # End HSUS-437
          with(/^\/(animals|issues|animal_community)\/(campaigns\/)?[^\/]*\/(facts|fact-sheets|tips)/) {
            log('--> Importing pages/fact_sheet.ts in mappings_tablet.ts')
            @import "pages/fact_sheet_tablet.ts"
            $mw_analytics = "HSUS-work-fact-sheet"
          }
          with(/^\/issues\/(campaigns\/)?[^\/]*\/news\.html/) {
            log('--> Importing pages/news/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/press.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-work-fact-news"
          }
          # faqs
          with(/^\/(issues|animals|animal_community)\/.*\/qa/) {
            log('--> Importing pages/work_tablet/qanda.ts in mappings_tablet.ts')
            @import "pages/work_tablet/qanda.ts"
            $mw_analytics = "HSUS-work-qa"
          }
          with(/^\/issues\/issue_news\.html/) {
            log('--> Importing pages/news/press.ts in mappings_tablet.ts')
            @import "pages/news_tablet/press.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-work-issues"
          }
          with(/^\/issues\/campaigns\//) {
            log('--> Importing pages/work_tablet/campaign_subject.ts in mappings_tablet.ts')
            @import "pages/work_tablet/campaign_subject.ts"
            $mw_analytics = "HSUS-work-campaign"
          }
          with(/^\/issues\/issue_resources/) {
            log('--> Importing pages/news_tablet/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/qa.ts"
            @import "pages/news_tablet/news_base.ts"
            $mw_analytics = "HSUS-work-news"
          }
          # eating and recipes
          with(/^\/issues\/eating\/recipes\/(recipes\.html|index\.html)?/) { #/
            log('--> Importing pages/work_tablet/recipes_main.ts')
            @import "pages/work_tablet/recipes_main.ts"
            $mw_analytics = "HSUS-work-recipes"
          }
          # spay day
          with(/^\/issues\/spay_day/) {
            log('--> Importing pages/work_tablet/spay_day.ts')
            @import "pages/work_tablet/spay_day.ts" 
            $mw_analytics = "HSUS-work-spayday"
          }
          # seal splat page
          with(/^\/issues\/seal_hunt\/2013_hunt\/home\.html/) {
            log('--> Importing pages/work_tablet/seal_splat.ts')
            @import "pages/work_tablet/seal_splat.ts"
            $mw_analytics = "HSUS-seal-splat"
          }
          with(/^\/issues\/seal_hunt\/((protect_seals|index)\.html)?/) { #/
            log('--> Importing pages/work_tablet/seal_splat.ts')
            @import "pages/work_tablet/seal_splat.ts"
            $mw_analytics = "HSUS-seal-splat"
          }

          with(/^\/issues\//) {
            log('--> Importing pages/work_tablet/issue_subject.ts')
            @import "pages/work_tablet/issue_subject.ts"
            $mw_analytics = "HSUS-work-issues"
          }

          # # app section for seal stuff
          with(/^\/apps\/protectseals\//) {
           log('--> Importing pages/fact_sheet.ts in mappings.ts')
             # @import "pages/fact_sheet.ts"
             @import "pages/fact_sheet_tablet.ts"
           }

          #############
          # Community #
          #############

          with(/^\/animal_community\/($|\?|index\.html)/) {
            log('--> Importing pages/community_tablet/community_main.ts')
            @import "pages/community_tablet/community_main.ts"
          }
          with(/^\/animal_community\/shelters\/direct_care_news/) {
            log('--> Importing pages/news_tablet/press.ts WO')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/qa.ts"
          }
          with(/^\/animal_community\/shelters\/(.*\.html)?/) { #//
            log('--> Importing pages/community_tablet/care_centers.ts')
            @import "pages/community_tablet/care_centers.ts"
          }
          with(/^\/animal_community\/resources\/($|\?|index\.html)/) {
            log('--> Importing pages/community_tablet/resources.ts')
            @import "pages/community_tablet/resources.ts"
          }
          with(/^\/animal_community\/resources\/rescue_groups/) {
            log('--> Importing pages/news_tablet/article.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
          }
          with(/^\/animal_community\/careers/) {
            log('--> Importing pages/community_tablet/care_centers.ts')
            @import "pages/community_tablet/care_centers.ts"
          }
          with(/^\/animal_community\/working_shelters/) {
            log('--> Importing pages/news_tablet/press.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/press.ts"
          }          
          with(/^\/parents_educators\/($|\?|index\.html)/) {
            log('--> Importing pages/community_tablet/parents.ts')
            @import "pages/community_tablet/parents.ts"
          }
          with(/^\/parents_educators\//) {
            log('--> Importing pages/news_tablet/article.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/article.ts"
          }
          with(/^\/community\/volunteers\//) {
            log('--> Importing pages/community_tablet/volunteers.ts')
            @import "pages/community_tablet/volunteers.ts"
          }
          with(/^\/community\/connect\.html/) {
            log('--> Importing pages/community_tablet/connect.ts in mappings_tablet.ts')
            @import "pages/community_tablet/connect.ts"
          }
          with(/^\/animal_community\/hsvma\/hsvma_ravs\.html/) {
            log('--> Importing pages/community_tablet/parents.ts')
            @import "pages/community_tablet/parents.ts"
          }

          #########
          # About #
          #########

          with(/^\/about\/($|\?|index\.html)/) {
            log('--> Importing pages/about_tablet/about_main.ts in mappings_tablet.ts')
            @import "pages/about_tablet/about_main_tablet.ts"
          }
          with(/^\/about\/overview\//) {
            log('--> Importing pages/about_tablet/overview.ts in mappings_tablet.ts')
            @import "pages/about_tablet/overview_tablet.ts"
          }
          with(/^(\/about\/leadership\/)|(\/testing\/ellen-pascale\/experts\.html)/) {  // for HSUS-519
            log('--> Importing pages/about_tablet/leadership.ts in mappings_tablet.ts')
            @import "pages/about_tablet/overview_tablet.ts"
            @import "pages/about_tablet/leadership_tablet.ts"
          }
          with(/^\/about\/contact\//) {
            log('--> found FAQ page in mappings_tablet.ts')
            @import "pages/about_tablet/about_main_tablet.ts"
            @import "pages/about_tablet/faq_tablet.ts"
          }
          with(/^\/about\/podcast\//) {
            log('--> Redirecting podcast to desktop in mappings_tablet.ts')
            $desktop_export="true"
          }
          with(/^\/about\/events\/($|\?|index\.html)/) {
            log('--> found events page')
            @import "pages/about_tablet/about_main_tablet.ts"
            @import "pages/about_tablet/events_tablet.ts"
          }
          with(/^\/about\/events\//) {
            log('--> Importing pages/about_tablet/event_page.ts in mappings_tablet.ts')
            @import "pages/about_tablet/event_page_tablet.ts"
          }
          with(/^\/about\/state\/($|\?|index\.html)/) {
            log('--> found main state page')
            @import "pages/about_tablet/about_main_tablet.ts"
            @import "pages/about_tablet/state_news_tablet.ts"
          }
          # EX: http://www.humanesociety.org/about/state/humane_state_ranking_2012.html
          with(/^\/about\/state\/humane_state_ranking/) {
            log('--> found state rank map')
            @import "pages/about_tablet/state_ranking_tablet.ts"
          }
          with(/^\/about\/state\//) {
            log('--> found state page')
            log("--> importing /pages/about_tablet/state_page_tablet.ts in mappings_tablet.ts")
            @import "pages/about_tablet/state_page_tablet.ts"
          }
          with(/^\/about\/departments\/($|\?|index\.html)/) {
            log('--> Importing pages/about_tablet/dept_main.ts in mappings_tablet.ts')
            @import "pages/about_tablet/dept_main_tablet.ts"
          }

          # Faith department
          with(/^\/about\/departments\/faith\/($|\?|index\.html|facts\/statements|resources\.html)/) {
            log('--> Importing pages/about_tablet/faith_base.ts in mappings_tablet.ts')
            @import "pages/about_tablet/faith_base_tablet.ts"
          }
          with(/^\/about\/departments\/faith\/animal_ministry_guide\/($|index\.html|food|wildlife|pet_resources)/) {
            log('--> Importing pages/about_tablet/faith_base.ts in mappings_tablet.ts')
            @import "pages/about_tablet/faith_base_tablet.ts"
          }
          with(/^\/about\/departments\/faith\/(.*)?(order|register|share|fill-the-bowl)/) {
            log('--> Importing pages/about_tablet/faith_form.ts in mappings_tablet.ts')
            @import "pages/about_tablet/faith_form_tablet.ts"
          }
          with(/^\/about\/departments\/faith\/related_news/) {
            log('--> Importing pages/news/press.ts in mappings_tablet.ts')
            @import "pages/news/news_base.ts"
            @import "pages/news/press.ts"
          }
          with(/^\/about\/departments\/faith\//) {
            log('--> Importing pages/about_tablet/faith_article.ts in mappings_tablet.ts')
            @import "pages/about_tablet/faith_base_tablet.ts"
          }
          # end faith section

          with(/^\/about\/departments\/state_affairs\/State_Directors/) {
            log('--> Importing pages/news/qa.ts in mappings_tablet.ts')
            @import "pages/news_tablet/news_base.ts"
            @import "pages/news_tablet/qa.ts"
          }
          with(/^\/about\/departments\/([^\/]*\/($|\?|)|[^\/]*\.html)/) {
            log('--> Importing pages/about_tablet/departments.ts')
            @import "pages/about_tablet/departments_tablet.ts"
          }
          with(/^\/about\/employment/) {
            log('--> importing pages/about_tablet/employ.ts in mappings_tablet.ts')
            @import "pages/about_tablet/employ_tablet.ts"
            @import "pages/about_tablet/about_base_tablet.ts"
          }
          with(/^\/about\/podcast/) {
            log('--> sending podcast to desktop in amppings.ts')
            $desktop_export = "true"
          }

          with(/^\/about\//) {
            log('--> Importing pages/about_tablet/about_base_tablet.ts in mappings_tablet.ts')
            @import "pages/about_tablet/about_base_tablet.ts"
          }

          #############
          # Map Pages #
          #############
          with(/assets\/maps\/feral-cat-groups/) {
            log("--> Importing pages/maplist_tablet.ts in mappings_tablet.ts")
            @import "pages/maplist_tablet.ts"
          }
          # href http://www.humanesociety.org/assets/maps/volunteer_opportunities.html
          with(/assets\/maps\/volunteer_opportunities/) {
            log("--> Importing pages/maps_tablet.ts in mappings.ts")
            @import "pages/maps_tablet.ts"
          }
          with(/assets\/maps\/affording\-your\-pet/) {
            log("--> Importing pages/maplist_tablet.ts in mappings.ts")
            @import "pages/maplist_tablet.ts"
          }

          with(/^\/assets\/maps\/.+\?/) { #/
            log("--> might be a list")
            log("--> Importing pages/maplist_tablet.ts in mappings.ts")
            @import "pages/maplist_tablet.ts"
          }
          # href http://www.humanesociety.org/assets/maps/feral-cats.html
          with(/^\/assets\/maps/) {
            log("--> Importing pages/maps_tablet.ts in mappings_tablet.ts")
            @import "pages/maps_tablet.ts"
          }



          ##################
          # Search Results #
          ##################

          with(/^\/search\/(tweaked-)?search/) {
            log('--> Importing pages/search_results_tablet.ts in mappings_tablet.ts')
            @import "pages/search_results_tablet.ts"
          }
          with(/^\/search\.jsp/) {
            log('--> Importing pages/search_results_tablet.ts in mappings_tablet.ts')
            @import "pages/search_results_tablet.ts"
          }

          with(/^\/testing\/search\-test\.html/) {
            log('--> Importing pages/search_results.ts in mappings.ts')
            @import "pages/search_results_tablet.ts"
          }
          #################
          # Contact Forms #
          #################

          # with(/forms/) {
            # log('--> Importing pages/forms.ts in mappings_tablet.ts')
            # @import "pages/forms.ts"
          # }

          # href http://www.humanesociety.org/forms/contact_us/animal_experimentation_contact.html
          # href http://www.humanesociety.org/forms/contact_us/wildlife_contact_form.html
          with(/forms\/contact_us\/(animal_experimentation_contact|wildlife_contact_form).html/) {
            log('--> Importing pages/new_tablet/forms_contact_tablet.ts in mappings_tablet.ts')
            @import "pages/news_tablet/forms_base_tablet.ts"
            @import "pages/news_tablet/forms_contact_tablet.ts"
          }

          # href http://www.humanesociety.org/forms/contact_us/our_website_contact.html
          with(/forms\/contact_us/) {
            log('--> Importing pages/new_tablet/contact_us_info_tablet.ts in mappings_tablet.ts')
            @import "pages/news_tablet/forms_base_tablet.ts"
            @import "pages/news_tablet/contact_us_info_tablet.ts"
          }

          # href http://www.humanesociety.org/forms/puppy_buyer_complaint_form.html
          # href http://www.humanesociety.org/forms/humane_wildlife_services_request_form.html
          # href http://www.humanesociety.org/forms/pets_valor_nomination.html
          with(/forms/) {
            log('--> Importing pages/new_tablet/forms_tablet.ts in mappings_tablet.ts')
            @import "pages/news_tablet/forms_base_tablet.ts"
            @import "pages/news_tablet/forms_tablet.ts"
          }

          # HSUS-506 http://mlocal.humanesociety.org/testing/chris_keane/footer/test-footer-revisions.html
          with(/test-footer-revisions/) {
            log('--> footer revisions testpage')
            @import "pages/home_tablet.ts"
          }

          # HSUS-436
          with(/PageBuilderPreviewPage|/) {
            log("Chimps art test page")
            # @import pages/news/article.ts
            @import pages/custom/chimp_art_tablet.ts
          }
          with(/site\/SPageServer\?pagename\=chimp_art_contest/) {
            log("Chimps art test page")
            @import pages/custom/chimp_art_tablet.ts
          }

          with(/thanks_chimpanzee_art_contest.html$/) {
            # @import base_tablet.ts
            # @import pages/news_tablet/forms_tablet.ts
          }

          # End HSUS-436


          ########
          # Shop #
          ########

          with(/^\/shop/) {
            log("--> importing pages/shopping.ts mappings_tablet.ts")
            @import "pages/shop_tablet.ts"
          }

          match($desktop_export, "true") {
            log("--> No page match in mappings_tablet.ts")
            @import desktop_redirect.ts
          }
          
          # HSUS-344
          # http://humanesociety.org/testing/cd-test2.html
          with(/^\/testing\/cd-test2\.html/) {
            log('--> Importing pages/animals_tablet/animal_main.ts in mappings.ts')
            @import "pages/animals_tablet/animal_main.ts"
            $mw_analytics = "HSUS-animal-main"
          }
          # end of HSUS-344

          # HSUS-406 this entry only use for temp address and we can delete if the page is online
          with(/^\/testing\/hsus_testing\//) {
            log("--> Importing pages/magazine_root_tablet.ts in mappings_tablet.ts")
            @import "pages/magazine_root_tablet.ts"
            $mw_analytics = "HSUS-magazine-root"
          }
          # HSUS-406 end
          
          with(/flickr/) {
            @import "pages/flickr_tablet.ts"
          }

          else() {
            match($desktop_export, "true") {
              log("--> No page match in mappings_tablet.ts")
              @import desktop_redirect.ts
            }
            log("--> No page match in mappings_tablet.ts")
            log("--> Doing a basic page mapping for CMS")
            $(".//body") {
              match($host) {
                with(/mstage|mlocal/) {
                  $("./div[@id='wrapper']") {
                    insert_top("div", style:"margin: 10px; padding: 10px; background-color: white; color: red;", "This page does not have an associated mapping for transformation. File it as a ticket for Moovweb")
                  }
                }
              }
              add_class("mw_no_match_basic")
              $(".//div[@id='main']") {
                add_class("mw_box2")
              }
            }
          }
        }
      }

#       match($path) {
#         with(/(\?|\&)moov\=rainbows/) {
#           $('./head') {
#             log("MAKIN IT RAIN-BOW!")
#             insert_bottom("style", type:"text/css", "#wrapper::before{ content:''; width:90%; height: 100%; position: fixed; bottom: -50%; left: 5%; display: block; box-shadow: 0px 0px 0px 3px red, 0px 0px 0px 6px orange, 0px 0px 0px 9px yellow, 0px 0px 0px 12px green, 0px 0px 0px 15px blue, 0px 0px 0px 18px purple; -webkit-border-radius: 100%; z-index: 999;}") 
#           }
#         }
# 
#         with(/(\?|\&)moov\=3d/) {
#           $('./head') {
#             log("MAKIN IT 3D!")
#             insert_bottom("style", type:"text/css", "*{ box-shadow: 1px 1px 0px 1px red, 2px 2px 0px 1px orange, 3px 3px 0px 1px yellow, 4px 4px 0px 1px green, 5px 5px 0px 1px blue, 6px 6px 0px 1px violet, 7px 7px 0px 1px purple; }") 
#           }
#         }
#       }
}
}

  # search results are a 304?
  with(/304/) {
    log("--> STATUS: 304")
    match($path) {
      with(/search\/search/) {
        log('--> Importing pages/search_results_tablet.ts in mappings_tablet.ts')
        @import "pages/search_results_tablet.ts"
      }
    }
  }

  # 404 page?
  # http://mlocal.humanesociety.org/news/resources.html
  with(/404/) {
    log("--> STATUS: 404")
    @import "pages/page_not_found_tablet.ts"
  }

  else() {
    # not 200 or 302 response status
    log("--> STATUS: " + $status + " assuming its an error code pages/error.ts")
    @import "pages/error.ts"
  }

}

# HSUS-420 : New Accordion
$(".//div[@id='toggle']") {
  $(".//dl[@class='accordion']") {
    name("div")
    attributes(data-ur-set: "toggler")
  }
  $(".//dt") {
    add_class("mw_bar3")
    name("div")
    attributes(data-ur-toggler-component: "button", data-ur-state: "disabled")
  }
  $(".//dd") {
    name("div")
    attributes(data-ur-toggler-component: "content")
    wrap_text_children("p") {
      match(text(), (/\A\s+\Z/)) {
        remove()
      }
    }
  }
}

# HSUS-433: Style Vine Video for site, make universal
$(".//iframe[@class='vine-embed']") {
  add_class("mw_vine_video")
  attributes(width: "100%", height: "280")
  $("./parent::div[contains(@id, 'item')]") {
    add_class("mw_vine_video_wrapper")
  }
}
# Fix for HSUS-444
remove(".//div[contains(@id, 'splashbox_widget_c')]")
# End of HSUS-444

#HSUS-452, make checklists universal
  $uid = 'mw_1'
  $("//form[contains(@class, 'checkboxes')]") {
    $("./ul") {
      name("table")
      $("./li") {
        name("tr")
        $("./input") {
          attributes(id: $uid, onchange: '$("[for=\'"+this.id+"\']").attr("checked", function(idx, old) { return !old; });')
          wrap("td")
        }
        $("./label") {
          attributes(for: $uid, onclick: ";")
          wrap("td")
        }
        $uid = $uid+'1'
      }
    }
  }
#END HSUS-452
# HSUS-420 : New Accordion
$(".//div[@id='toggle']") {
  $(".//dl[@class='accordion']") {
    name("div")
    attributes(data-ur-set: "toggler")
  }
  $(".//dt") {
    add_class("mw_bar3")
    name("div")
    attributes(data-ur-toggler-component: "button", data-ur-state: "disabled")
  }
  $(".//dd") {
    name("div")
    attributes(data-ur-toggler-component: "content")
    wrap_text_children("p") {
      match(text(), (/\A\s+\Z/)) {
        remove()
      }
    }
  }
}

# HSUS-433: Style Vine Video for site, make universal
$(".//iframe[@class='vine-embed']") {
  add_class("mw_vine_video")
  attributes(width: "auto", height: "300")
  $("./parent::div[contains(@id, 'item')]") {
    add_class("mw_vine_video_wrapper")
  }
}

# Fix for HSUS-444
remove(".//div[contains(@id, 'splashbox_widget_c')]")
# End of HSUS-444

#HSUS-452, make checklists universal
$uid = 'mw_1'
$("//form[contains(@class, 'checkboxes')]") {
  $("./ul") {
    name("table")
    $("./li") {
      name("tr")
      $("./input") {
        attributes(id: $uid, onchange: '$("[for=\'"+this.id+"\']").attr("checked", function(idx, old) { return !old; });')
        wrap("td")
      }
      $("./label") {
        attributes(for: $uid, onclick: ";")
        wrap("td")
      }
      $uid = $uid+'1'
    }
  }
}
#END HSUS-452


$("./head") {
  remove("./*[not(self::meta[@name='viewport'])]")
  insert("meta", id: "mw_desktop_link_config", cookie_hours: "24", immediate: "true", this_page_only: "true")
  insert("script", type: "text/javascript", src: asset("javascript/main_mobile.js"))
}
remove("./body")
# The main file executed by Tritium. The start of all other files.

match($content_type) {
  with(/html/) {
    # Rewrite the xmlns nodes before the html parser clobbers them
    replace(/\<(\/?)(\w+)\:\w+\>/, "$2_mwns_") #/ 
    # replace(/\<(\/?)(\w+\:\w+)\>/, "$2_mwns_") #/ 

    replace(/\<\/body\>/,"") #/
    replace(/\<\/html\>/,"") #/
    append("</body> </html>")


    @import "device_detection.ts"  
    @import "check_fragment.ts"
    # Force UTF-8 encoding. If you'd like to auto-detect the encoding,
    # simply remove the "UTF-8" argument.  e.g. html(){ ... }
    match($html_fragment, /false/) {
      # html("UTF-8") { # The donate pages are ISO-8859-1 encoded, so autodetection would be best (HSUS-171)
      html() {

              
        # This file is meant to be used while the site is being built 
        # and the project might be in the production environment. This will help to 
        # ensure that the project can live on a prod environment, but not
        # be world accessible.
        
        # Coming Soon...
        # Comment out the line below once you begin working
        # @import "coming_soon.ts"

        @import "html.ts"
      }
    }

    # Rewrite the xmlns nodes to restore them
    log("rewriting nodes")
    replace(/(\<(\/?)(\w+))_mwns_(\:\w+\>)/, "$1$4") 
    # replace(/(\<(\/?)(\w+))_mwns_(\:\w+\>)/, "$1$4") # revised regex
  }
  # with(/plain/i) {
  #   @import plain.ts
  # }
  # with(/javascript/) {
  #   @import "ajax.ts"
  # }
  else() {
    log(concat("Passing through ", $content_type, " unmodified"))
  }
}

log("--> Running plain.ts")

# Normal Ajax can be parsed simply using html_fragment()
# html_fragment("utf-8") {
#   
#   rewrite_links()
#   absolutize_srcs()
# 
#   # Needed to begin mobilizing
#   remove_all_styles()
# 
#   match($path) {
#     # with(/foo/) {
#     #   log("--> Importing ajax/foo.ts in plain.ts")
#     #   @import ajax/foo.ts
#     # }
#   }
# }

#############
#############
#############

# The following section is required for when dealing with .NET Ajax
# The content length is encoded and requires extra special handling
# by calculating said length. 

# Aspx for multiple different parts per response
# replace(/(\s*?\|?)(\d+)(\|[^\|]*\|[^\|]*\|)(.*?)\|(?=((\d+\|)|$))|/m) {
#   $first = $1
#   $second = $2    # content length
#   $third = $3     # parent container
#   $fourth = $4    # actual content
#   $fourth {
#     $charset_determined = "utf-8" # force encoding for proper length
#     html_fragment("utf-8") {
#       
#       rewrite_links()
#       absolutize_srcs()
# 
#       # Needed to begin mobilizing
#       remove_all_styles()
# 
#       match($path) {
#         # with(/foo/) {
#         #   log("--> Importing ajax/foo.ts in plain.ts")
#         #   @import ajax/foo.ts
#         # }
#       }
#     }
#     replace(/&amp;/, "&")
#     replace(/%20/, " ")
#     replace(/%22/, "\"")
#   }
#   log("changed")
#   
#   # log(concat("=>  $first:  ", $first))
#   # log(concat("=>  $second:  ", $second))
#   # log(concat("=>  $third:  ", $third))
#   # log(concat("=>  $fourth:  ", $fourth))
#   
#   match($second) {
#     with(/^0$/) {
#       log("!!!! $second is 0")
#       $second = length($fourth)
#       $collection = concat($collection, $first, $second, $third, $fourth, "|")      
#     }
#     with(/^$/) {
#       log("!!!! $second is null")
#       $collection = concat($collection, $first, $second, $third, $fourth)            
#     }
#     not(/^0$/) {
#       $second = length($fourth)
#       log("!!!! $second is just something else")
#       $collection = concat($collection, $first, $second, $third, $fourth, "|")      
#     }
#   }
#   # Error => You've probably broken the AJAX somehow
#   match($third) {
#     with(/\|error\|/) {
#       log("!!!! Error Ajax")
#       $collection = concat($collection, $first, $second, $third, $fourth, "|")      
#     }
#   }
#   
#   # log(concat("=>  $collection:  ", $collection))
#   
#   # log("--> ===================================")
# }
# set($collection)

# HTML Transformations go here

$("/html") {

  @import perfect_proxy.ts

  match ($perfect_proxy) {
    with(/false/) {
      rewrite_links()
      absolutize_srcs()

        
      # Add the mobile meta tags 
      clean_mobile_meta_tags()

        
      # Needed to begin mobilizing

      # Late load all the images on the site
      # lateload()
        
      # Remove all script tags not marked with "data-keep" attribute
      @import "optimization.ts"
      remove_desktop_js();
      
      # HSUS-344
      # https://mlocal.secure.humanesociety.org/site/UserLogin
      # social popup will broken
      match($path, /^\/site\/UserLogin/) {
        $(".//link[@rel='stylesheet'][contains(@id, 'yui_marker_loader_css')]") {
          attribute("data-mw-keep", "true")
        }
      }
      # end of HSUS-344
      remove_all_styles()
      remove_html_comments()

      add_assets()

      # @import "sections/header.ts"
      # @import "sections/footer.ts"

      match($tablet) {
        with(/true/) {
          log("==> tablet mappings")
            log("--> Importing _base_tablet.ts in html.ts")
          @import "_base_tablet.ts"
          @import "sections/header_tablet.ts"
          @import "sections/footer_tablet.ts"
          @import "mappings_tablet.ts"
        }

        else() {
          log("==> mobile mappings")
          log("--> Importing base.ts in html.ts")
          @import "base.ts"
          @import "sections/header.ts"
          @import "sections/footer.ts"
          @import "mappings.ts"
        }
      }
      # @import "mappings.ts"

      # Include mw_analytics file to track the mobile site
      @import "mw_analytics.ts"
    }

    else() {
      rewrite_links()
      absolutize_srcs()

      # fix any images with extra /'s
      fixImages()

      # Remove the redirect script
      $(".//script") {
        %source = fetch("text()")

        match(%source, /mw_mobile_site/) {
          log("found the redirect script")
          remove()
        }
      }
      # Their cookie.js script caused infinite redirection loops (to 404 pages sometimes) when perfect-proxying some pages.
      remove(".//script[contains(@src, 'cookie')]")
      # HSUS-425 to prevent redirection loop
      remove(".//script[contains(@src, 'session-status')]")
    }
  }
#   rewrite_links()
#   absolutize_srcs()
# 
#     
#   # Add the mobile meta tags 
#   clean_mobile_meta_tags()
# 
#     
#   # Needed to begin mobilizing
#   remove_all_styles()
#   remove_html_comments()
# 
#   # Late load all the images on the site
#   # lateload()
#     
#   # Remove all script tags not marked with "data-keep" attribute
#   @import "optimization.ts"
#   remove_desktop_js();
# 
#   # Include mw_analytics file to track the mobile site
#   @import "mw_analytics.ts"
# 
# 
# 
#   add_assets()
# 
#   @import "sections/header.ts"
#   @import "sections/footer.ts"
# 
#   @import "mappings.ts"
}


log("--> Running ajax.ts")

# match($path) {
#   # Match the Ajax path
#   with(/foo/) {
#     html_fragment() {
#       log("--> Importing ajax/foo.ts in ajax.ts")
#       @import ajax/foo.ts
#     }
#   }
# }

# needed for product images
# replace("%24", "$")
# replace("&amp;", "&")
$tablet = "true"

match($user_agent, /Mobi(le)?/) {
  # some tablet UAs falsely match e.g. Apple iPad, Samsung Galaxy Tab, Motorola Xoom, Amazon Kindle, Barnes & Noble Nook, RIM Playbook, HP TouchPad, HTC Flyer
  match_not($user_agent, /iPad|GT-P\d{4}|SCH-I(800|815|905)|Xoom|Kindle|Nook|NOOK|PlayBook|Touchpad|Flyer/) {
    $tablet = "false"
  }
}

log("Tablet?")
log($tablet)

# $device_stylesheet = "main"
# match($user_agent) {
#   with(/Android/) {
#     $device_stylesheet="devices/android"
#   }
#   with(/Blackberry/) {
#     $device_stylesheet="devices/blackberry"
#   }
#   with(/iPhone/) {
#     $device_stylesheet="devices/iphone"
#   }
#   with(/iPad/) {
#     $device_stylesheet="devices/ipad"
#   }
#   with(/WebKit/) {
#     $device_stylesheet="devices/webkit"
#   }
# }

match($user_agent) {
  with(/iPhone|iPad|iPod/) {
    $device_stylesheet = "devices/ios"
  }
  # new Androids can just use main.scss
  with(/Android [12].*WebKit/) {
    $device = "Android"
    $device_stylesheet = "devices/android"
  }
  with(/Silk\/1\.[01]/) {
    $device = "Android"
    $device_stylesheet = "devices/android"
  }
  with(/Blackberry/) {
    $device_stylesheet = "devices/blackberry"
  }

  # for development purposes.. load the devices/ios stylesheet by default
  else() {
    $device_stylesheet = "devices/ios"
  }
}

match($tablet) {
  with("true") {
    $device_stylesheet = $device_stylesheet + "_tablet"
  }
  else() {
    $device_stylesheet = $device_stylesheet + "_mobile"
  }
}
$("./head/script[not(@src)]") {
  # log(text())
  %mouseover_check = fetch("./text()")
  match(%mouseover_check, /mouseover/) {
    log("--> Removing a mouseover script")
    remove()
  }
}

$('./body') {
  insert_top("div", id: "mw_slider_overlay")
  
  # HSUS-362 : Moovweb menu header
  $insert_header = "false"

  match($host) {
    with(/video/) {
      $insert_header = "true"
    }
    #HSUS-503
     with(/slideshows/) {
      $insert_header = "true"
    }
     # End HSUS-503
    else() {
      $("self::body[.//ul[@id='site-nav']]") {
        $insert_header = "true"
      }
    }
  }
  
    match($insert_header, /true/) {
        insert_top("div", class: "mw_header") {

          # Header Logo
          %home = $host
          %home {
            replace(/video\./, "")
            replace(/slideshows\./,"")
            replace(/action\./, "")
            replace(/secure\./, "")
            replace(/legacy\./, "")
          }

          insert("a", href:concat("http://",%home), class:"mw_header_spillover") { 
            # insert("div", class: "images-logo3")

            #Copy their logo image here
            copy_here("./ancestor::body//a[@class='logo']/img") {
              remove("@width")
              remove("@height")
            }
          }

          # Donate Button
          # insert("a", class:"mw_btn4", href:concat("http://",%home,"/donate"), "Donate")
          insert("div", class:"mw_donate_bar", data-ur-set:"toggler") {
            %donate = %home # $host
            %donate {
              # replace(/video\./, "")
              replace(/\.humane/, ".secure.humane")
            }

            insert("div", class:"mw_btn4", data-ur-toggler-component:"button","Donate") {
              match($has_search_bar, /false/) {
                add_class("mw_no_serach_bar")
              }
            }
            insert("div", data-ur-toggler-component:"content", class:"mw_donation_option_list") {
              copy_here("//div[@id='top_donate']/a") {
                add_class("mw_donate_option")
              }
              copy_here("//select[@id='donate-menu']/option") {
                name("a")
                attributes(href: fetch("./@value"))
                remove("./@value")
                remove("./@style")
                add_class("mw_donate_option")
              }
              $("./a") {
                $donate_txt = fetch("./text()")
                match($donate_txt) {
                  with(/Donate Monthly/i) {
                    $donate_txt = "Monthly"
                  }
                  with(/Donate one time/i) {
                    $donate_txt = "One Time"
                  }
                  with(/Donate in memory/i) {
                    $donate_txt = "In Memory"
                  }
                  with(/Donate to celebrate/i) {
                    $donate_txt = "In Celebration"
                  }
                  with(/Make a Leadership gift/i) {
                    $donate_txt = "To make a Leadership gift"
                  }
                  with(/Create your Legacy/) {
                    $donate_txt = "To create your Legacy"
                  }
                }
                text($donate_txt)
              }
            }
          }

          # Search Button

          # insert("div", class:"mw_header_search mw_header_search_btn") {
          #   insert("div", class:"images-search")
          #   insert("div", class:"images-searcharrow")
          # }
          move_here("//div[@id='top_search']") {
            remove(".//label")

            $(".//p") {
              # add_class("mw_flex_box")
              $("./input") {
                # add_class("mw_flex_box_item_1")
                # HSUS-179 (Tablet) Search Box
                attribute("placeholder","Search")
              }
            }
            $(".//button") {
              add_class("mw_btn5")
              text("")
            }
          }

          # HSUS-431 Header changes for desktop and tablet
          move_here("//div[@class='social_media']") {
            $("./a[contains(@href, 'facebook')]") {
              insert_top("div", class: "images-facebook_social")
            }
            $("./a[contains(@href, 'twitter')]") {
              insert_top("div", class: "images-twitter_social")
            }
          }
          # end HSUS-431

          # Menu Button

          insert("div", class: "mw_header_menu mw_header_btn") {
            insert("div", class:"images-menu")
          }

          # Main nav
          insert_after ("div", class: "mw_menu_nav") {
            copy_here("//ul[@id='site-nav'] | //ul[@id='topNav']") {
              attribute("id", "mw_site-nav")

                insert("div", class: "mw_branding") {
                insert("a", href:concat("http://", %home), class: "images-navlogo") 
                insert("p", class:"mw_branding_desc", "We're the nation's largest and most effective animal protection organization.")
              }
            }
          }

          # Search bar

          /*insert_after("div", class: "mw_search_bar") {
            move_here("//div[@id='top_search']") {
              remove(".//label")

              $(".//p") {
                add_class("mw_flex_box")
                $("./input") {
                  add_class("mw_flex_box_item_1")
                }
              }
              $(".//button") {
                add_class("mw_btn1")
                text("Search")
              }
            }
          }*/
      }
    }
    # end of HSUS-36

  # Remove the accessibility stuff

  $("./ul[@id='accessibility']") {
    remove()
  }
  
  # Page masthead
  # wrap_together(".//div[@class='mw_hidden_content']", "div") {
  #   add_class("mw_masthead")
  #   move_to("..", "top")
  #   move_here(".//div[@class='mw_masthead_title_text']")
  #   move_here(".//img[@class='mw_tablet_masthead_image']")
  # }

  # Page masthead
  $new_masthead = "false"
#  $mastead_exists = "false"
#
#  $(".//div[contains(@class, 'mw_hidden_content']") {
#    $mastead_exists = "false"
#  }
#
#  # Generate a temporary masthead if one does not exist
#  $(".//div[@id='wrapper']") {
#    insert_top("div", class:"mw_masthead", style:"height:200px;") {
#      insert("div", class:"mw_masthead_title_text", style:"color: white;", "Hello!")
#    }
#  }
#
  $(".//div[@class='mw_hidden_content_tablet']") {
    $new_masthead = "true"
  }

  wrap_together(".//div[contains(@class, 'mw_hidden_content')]", "div") {
    add_class("mw_masthead")
    # move_to("..", "top")
    move_to("./ancestor::div[@id='wrapper']", "top")
    match($new_masthead) {
      with(/true/) {
        move_here(".//div[@class='mw_hidden_content_tablet']//img")
        move_here(".//div[@class='mw_hidden_content_tablet']//div[@class='mw_masthead_title_text']")
      }

      else() {
        move_here(".//img[@class='mw_hidden_content_tablet']")
        move_here(".//div[@class='mw_masthead_title_text']")
      }
    } 
  }
  
  # HSUS-384 legacy.humanesociety.org header img
  match($host, /legacy/) {
    $("./div[@id='wrapper']") {
      insert_top("div", class: "mw_masthead") {
        insert("img", src: "http://www.humanesociety.org/assets/images/1024x256-tablet-mastheads/tablet_masthead_default.png", class: "mw_tablet_masthead_image")
      }
    }
  }
  
  
}
# HSUS-243
# https://secure.humanesociety.org/site/SPageServer?JServSessionIdr004=otzef48w28.app305b&pagename=HSUS_DRTV_MSI_spot_2013
# http://action.humanesociety.org/site/PageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
match($path, /pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
 $("./body") {
   insert_bottom("div", id: "mw_drtv_footer")
 }
}
# HSUS-243 end

$("./body/div[@id='wrapper'] | ./body/div[@id='shell'] | ./body//div[@id='action-alert']/.. | ./body//div[@id='ga-content'] | ./body//div[@id='mw_drtv_footer']") {
  insert_bottom("div", class: "_footer mw_box1") {
    match($source_host, /legacy/) {
      add_class("mw_lefacy_footer")
    }
    move_here("//div[@id='site-footer-container']")
    move_here("//div[@id='footer']")

    #manually styled footers
    move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
      attribute("id", "foot")
      $(".//*[@style]") {
        remove("@style")
      }
      $("./ul") {
        $("./li[1]") {
          add_class('mw_footer_copyright')
        }
        # HSUS-243
        # https://secure.humanesociety.org/site/SPageServer?JServSessionIdr004=otzef48w28.app305b&pagename=HSUS_DRTV_MSI_spot_2013
        # http://action.humanesociety.org/site/PageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
        match($path, /pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
          move_here("./preceding-sibling::p[1]", "bottom") {
            name("li")
          }
          remove("./preceding-sibling::div[./img][1]")
          remove("./li[./a[./img]]")
        }
        # end of HSUS-243
      }
      $(".//li[./a]") {
        add_class("mw_links_inline")
        $("./a") {
          remove("@style")
        }
      }
      remove("@style")
      remove("./img")
      remove("./p")
    }
    move_here("//div[@id='foot']") {
      remove("@style")
      remove(".//br")
      $("./ul[1]") {
        $("./li[1]") {
          add_class('mw_footer_copyright')
        }
        $("./li") {
          $("./self::li[./a]") {
            add_class("mw_links_inline")
            $("./a") {
              remove("@style")
            }
            $("./a[not(contains(text(), '»'))]") {
              text(fetch("./text()")+ " »")
            }
          }
          $("./self::li[not(contains(@class, 'mw_footer_copyright'))][not(./a)]") {
            add_class("mw_footer_info")
          }
          # remove twitter and twitter link
          remove("./self::li[./a[contains(@id, 'twitter') or contains(@id, 'twitter')]]")
          remove("./@style") 
        }
      }
      $("./ul[2]") {
        add_class("mw_more_list")
      }
    }
    # move_here("//div[@class=' mw_pledge_footer']")

    insert_bottom("a", href:"http://www.moovweb.com/?mwci=TGIN", class:"mw_powered_by", "Mobile Site Powered by ") {
      insert("span", class:"footer-strong", "Moovweb")
    }
  }

  $(".//div[@class='connected-panel-inner']") {
    add_class("mw_flex_box")
  }

  $(".//div[@class='connected-panel-left']") {
    add_class("mw_flex_box_item_1")
  }
  
  $(".//div[@class='connected-panel-middle']") {
    add_class('mw_flex_box_item_1')

    $("./form[@id='email-signup-footer']") {

      $("./input[@type='submit']") {
        add_class("mw_btn5")
        name("button")
        remove("@value")
      }
    }
  }

  $(".//div[@class='connected-panel-right']") {
     add_class('mw_flex_box_item_1')

    $("./h3") {
      inner() {
        replace(/Get\s/, "")
      }
    }

    $("./form[@id='mobile-signup-footer']") {
      #attribute("data-ur-toggler-component", "content")

      $("./input[@type='submit']") {
        add_class("mw_btn5")
        name("button")
      }
      # HSUS-304
      remove("./span[@class='label-holder']")
    }
  }
  # Accordionize the bottom
  $(".//div[@class='taxonomy-nav']") {
    attribute("data-ur-set", "toggler")

    $("./h3") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")
    }

    $("./ul") {
      attribute("data-ur-toggler-component", "content")

      $("./li/a") {
        add_class("mw_bar1")
      }
    }
    # for HSUS-119: Main Links
    # $("./ancestor::div[@class='taxonomy'][1]") {
    #   move_here("./ancestor::div[@id='site-footer-container'][1]/div[contains(@class, 'logo-panel-footer')]/ul[@class='link-list']", "after") {
    #     add_class("mw_main_links")
    #     $(".//a[@href]") {
    #       add_class("mw_bar1")
    #     }
    #   }
    # }
    # end of for HSUS-119: Main Links
  }

  # merge all the taxonomy-nav into the taxonomy 
  $(".//div[@class='taxonomy']") {
    move_here(".//div[@class='taxonomy-nav']")
    remove("./div[@class='taxonomy-column']")
  }

  $(".//div[@class='legal']") {
    move_here("./ancestor::div[contains(@class,'footer')]//div[@class='site-footer logo-panel-footer']/ul", "before") {
      add_class("mw_nav_links")

      # Give the li's classnames based on the link

      $("./li/a") {
        %newId = fetch("text()")
        %newId {
          replace(/\s/, "")
        }
        $("..") {
          add_class(%newId)
        }
        
      }
    }

    # Move the images
    move_here("../div[@class='seals-approval']", "top") {
      $(".//img") {
        remove("@style")
        remove("@height")
        remove("@width")
      }
    }
  }

  # Custom keyboards
  # custom_keyboard(".//input[@id='cons_email']", "email")
  contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")

}

$(".//div[contains(@class,'_footer')]//h3") {
  name("p")
}

# Remove instances where there might be two footers. HSUS-113
$("./body//div[@id='ga-content']//div[@id='action-alert']/following-sibling::div[contains(@class, 'footer')]") {
  match($path) {
    with(/^\/site\/Advocacy\?cmd=display\&page=onscreenthanks/i) {
      # do nothing
    }
    # HSUS-362 missing footer
    with(/^\/site\/Advocacy\?cmd=display&page=UserAction&id/i) {
      move_to("./ancestor::div[@id='ga-content'][1]/table", "after")
      remove("./following-sibling::div[contains(@class, 'footer')]")
    }
    else() {
      remove()
    }
  }
}

//HSUS-473
$(".//p[@class='tax-statement'][1]"){
  insert_after("br")
  insert_after("br")
}

$(".//li[@class='rss']"){
  remove()
}

//HSUS-476
$(".//ul[contains(@class,'mw_nav_links')]"){
  move_to("//p[@class='copyright']", "after")
}

$("./head/script[not(@src)]") {
  # log(text())
  %mouseover_check = fetch("./text()")
  match(%mouseover_check, /mouseover/) {
    log("--> Removing a mouseover script")
    remove()
  }
}

$('./body') {

  # HSUS-153 , some pages have no search bar
  $has_search_bar = "false"
  $("/html/body//div[@id='top_search']") {
    $has_search_bar = "true"
  }

  insert_top("div", id: "mw_slider_overlay")
  insert_top("div", class: "mw_header") {
    
    # Header Logo
    %home = $host

    %home {
      replace(/video\./, "")
      replace(/slideshows\./,"")
      replace(/action\./, "")
      replace(/secure\./, "")
      replace(/legacy\./, "")
    }
    # remember to remove the ?utm_expid&mobile when things go live!
    insert("a", href:concat("http://",%home)) { #, "?utm_expid=68505748-5&mobile=0"
      insert("div", class: "images-logo3")
    }

    # Donate Button
#    insert("a", class:"mw_btn4", href:concat("http://",%home,"/donate"), "Donate") {
#      match($has_search_bar, /false/) {
#        add_class("mw_no_serach_bar")
#      }
#    }
    insert("div", class:"mw_donate_bar", data-ur-set:"toggler") {
      %donate = %home #$host
      %donate {
        # replace(/video\./, "")
        replace(/\.humane/, ".secure.humane")
      }

      insert("div", class:"mw_btn4", data-ur-toggler-component:"button","Donate") {
        match($has_search_bar, /false/) {
          add_class("mw_no_serach_bar")
        }
      }
      insert("div", data-ur-toggler-component:"content", class:"mw_donation_option_list") {
        copy_here("//div[@id='top_donate']/a") {
          add_class("mw_donate_option")
        }
        copy_here("//select[@id='donate-menu']/option") {
          name("a")
          attributes(href: fetch("./@value"))
          remove("./@value")
          remove("./@style")
          add_class("mw_donate_option")
        }
        $("./a") {
          $donate_txt = fetch("./text()")
          match($donate_txt) {
            with(/Donate Monthly/i) {
              $donate_txt = "Monthly"
            }
            with(/Donate one time/i) {
              $donate_txt = "One Time"
            }
            with(/Donate in memory/i) {
              $donate_txt = "In Memory"
              # Fix for HSUS-520 : Remove
              add_class("mw_hide")
            }
            with(/Donate to celebrate/i) {
              $donate_txt = "In Celebration"
              add_class("mw_hide")
              # Fix for HSUS-520 : Remove
            }
            with(/Make a Leadership gift/i) {
              $donate_txt = "To make a Leadership gift"
            }
            with(/Create your Legacy/) {
              $donate_txt = "To create your Legacy"
            }
          }
          text($donate_txt)
        }
      }
    }

    # Search Button
    match($has_search_bar, /true/) {
      insert("div", class:"mw_header_search mw_header_search_btn") {
        insert("div", class:"images-search")
        insert("div", class:"images-searcharrow")
      }
    }
    # Menu Button

    insert("div", class: "mw_header_menu mw_header_btn") {
      insert("div", class:"images-menu")
    }

    # Main nav
    insert_after ("div", class: "mw_menu_nav") {
      copy_here("//ul[@id='site-nav'] | //ul[@id='topNav']") {
        attribute("id", "mw_site-nav")

          insert("div", class: "mw_branding") {
          insert("a", href:concat("http://", %home), class: "images-navlogo") #, "?utm_expid=68505748-5&mobile=0"
          insert("p", class:"mw_branding_desc", "We're the nation's largest and most effective animal protection organization.")
        }
      }
    }

    # Search bar
    # HSUS-153 , some pages have no search bar
    match($has_search_bar, /true/) {
      insert_after("div", class: "mw_search_bar") {
        move_here("//div[@id='top_search']") {
          remove(".//label")

          $(".//p") {
            add_class("mw_flex_box")
            $("./input") {
              add_class("mw_flex_box_item_1")
            }
          }
          $(".//form[@id='site-search'][input]") {
            add_class("mw_flex_box")
          }
          $(".//form/input") {
            add_class("mw_flex_box_item_1")
          }
          $(".//button") {
            add_class("mw_btn1")
            text("Search")
          }
        }
      }
    }
  }

  # Remove the accessibility stuff

  $("./ul[@id='accessibility']") {
    remove()
  }
  
  # Page masthead
  $new_masthead = "false"

  $(".//div[@class='mw_hidden_content_mobile']") {
    $new_masthead = "true"
  }

  wrap_together("/html/body[not(@id='home')]//div[contains(@class, 'mw_hidden_content')]", "div") {
    add_class("mw_masthead")
    log("new masthead? " + $new_masthead)
    match($new_masthead) {
      with(/true/) {
        move_here(".//div[@class='mw_hidden_content_mobile']//img")
        move_here(".//div[@class='mw_hidden_content_mobile']//div[@class='mw_masthead_title_text']")
      }

      else() {
        move_here(".//img[@class='mw_mobile_masthead_image']")
        move_here(".//div[@class='mw_masthead_title_text']")
      }
    }
    move_to("./ancestor::div[@id='wrapper']", "top")
  }
  
  # sidebar
  $(".//div[@id='side']") {
    # media contact box
    $(".//a[@id='media-contact']") {
      wrap("div", class:"mw_mediaBox")
      inner() {
        replace("2", "  &raquo;  ")
      }
    }
  }
  # Fix for HSUS-509 : Header is removed from the "secure" domain URL's
  # host is matched with "secure" 
  ##  match($host) {
  ##    with(/secure\./) {
  ##      # For HSUS-512, HSUS-513
  ##      match_not($path,/site\/Donation/i) {
  ##        $(".//div[@class='mw_header']") {
  ##          add_class("mw_hide")
  ##        }
  ##      }
  ##      # End of HSUS-512, HSUS-513
  ##    }
  ##  }
  # Fix for HSUS-509 : Header is removed from the "secure" domain URL's
}
# HSUS-243
# https://secure.humanesociety.org/site/SPageServer?JServSessionIdr004=otzef48w28.app305b&pagename=HSUS_DRTV_MSI_spot_2013
# http://action.humanesociety.org/site/PageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
match($path, /pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
  $("./body") {
    insert_bottom("div", id: "mw_drtv_footer")
  }
}
# HSUS-243 end
$("./body/div[@id='wrapper'][not(.//@id='page')] | ./body/div[@id='shell'][not(.//@id='page')] | ./body//div[@id='action-alert']/.. | ./body//div[@id='ga-content'] | ./body/table[.//link[contains(@href, 'sealpup_alert.jpg')]] | .//div[@id='page'] | ./body/div[@id='mw_drtv_footer']") {
  insert_bottom("div", class: "_footer mw_box1", id:"mw_footer") {
    move_here("//div[@id='site-footer-container']")
    move_here("//div[@id='footer']")

    #manually styled footers
    move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
      $(".//*[@style]") {
        remove("@style")
      }
      $("./ul") {
        $("./li[1]") {
          add_class('mw_footer_copyright')
        }
        # HSUS-243
        # https://secure.humanesociety.org/site/SPageServer?JServSessionIdr004=otzef48w28.app305b&pagename=HSUS_DRTV_MSI_spot_2013
        # http://action.humanesociety.org/site/PageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
        match($path, /pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
          move_here("./preceding-sibling::p[1]", "bottom") {
            add_class("mw_p_wrap")
            wrap("li")
          }
        }
        match($path, /pagename=drtv_splashb_MSI/) {
          $("./li[last()]") {
            wrap_text_children("p") {
              add_class("mw_p_wrap")
            }
          }
        }
        # end of HSUS-243       
      }
      $(".//li[./a]") {
        add_class("mw_link_center")
        $("./a") {
          add_class("mw_bar2")
          remove("@style")
        }
      }
      remove("@style")
      remove("./img")
      # remove("./p")
    }
    move_here("//div[@id='foot']") {
      remove("@style")
      remove(".//br")
      $("./ul[1]") {
        $("./li[1]") {
          add_class('mw_footer_copyright')
        }
        $("./li") {
          $("./self::li[./a]") {
            add_class("mw_link_center")
            $("./a") {
              add_class("mw_bar2")
              remove("@style")
            }
            # HSUS-385
            $("./a[not(contains(text(), '»'))]") {
              text(fetch("./text()")+ " »")
            }
          }
          $("./self::li[not(contains(@class, 'mw_footer_copyright'))][not(./a)]") {
            add_class("mw_footer_info")
          }
          # remove facebook and twitter link
          remove("./self::li[./a[contains(@id, 'facebook') or contains(@id, 'twitter')]]")
          remove("./@style") 
        }
      }
      $("./ul[2]") {
        add_class("mw_more_list")
      }
    }
    # move_here("//div[@class=' mw_pledge_footer']")
    $("//div[@class=' mw_pledge_footer']") {
      add_class("mw_testing")
    }

    insert_bottom("a", href:"http://www.moovweb.com/?mwci=TGIN", class:"mw_powered_by", "Mobile Site Powered by ") {
      insert("span", class:"footer-strong", "Moovweb")
    }
  }

  # Accordionize the bottom
  $(".//div[@class='connected-panel-middle']") {
    attribute("data-ur-set", "toggler")

    $("./h3") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")
    }

    $("./form[@id='email-signup-footer']") {
      attribute("data-ur-toggler-component", "content")

      $("./input[@type='submit']") {
        add_class("mw_btn2")
      }
    }
  }

  $(".//div[@class='connected-panel-right']") {
    attribute("data-ur-set", "toggler")
    

    $("./h3") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")

      # Move any notes to the toggler content
      $("./span[@class='connected-title-note']") {
        move_to("../following-sibling::form", "top")
      }
    }

    $("./form[@id='mobile-signup-footer']") {
      attribute("data-ur-toggler-component", "content")

      $("./input[@type='submit']") {
        add_class("mw_btn2")
      }
    }
  }

  $(".//div[@class='taxonomy-nav']") {
    attribute("data-ur-set", "toggler")

    $("./h3") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")
    }

    $("./ul") {
      attribute("data-ur-toggler-component", "content")

      $("./li/a") {
        add_class("mw_bar1")
      }
    }
    # for HSUS-119: Main Links
    # $("./ancestor::div[@class='taxonomy'][1]") {
    #   move_here("./ancestor::div[@id='site-footer-container'][1]/div[contains(@class, 'logo-panel-footer')]/ul[@class='link-list']", "after") {
    #     add_class("mw_main_links")
    #     $(".//a[@href]") {
    #       add_class("mw_bar1")
    #     }
    #   }
    # }
    # end of for HSUS-119: Main Links
  }

  $(".//div[@class='legal']") {
    move_here("./ancestor::div[contains(@class,'footer')]//div[@class='site-footer logo-panel-footer']/ul", "before") {
      add_class("mw_nav_links")
      $taxonomy_footer_exists = "false"
      $("./parent::div/preceding-sibling::div[contains(@class, 'taxonomy')]") {
        $taxonomy_footer_exists = "true"
      }
      match($taxonomy_footer_exists, /false/) {
        add_class("mw_stack_links")
        $("./li[a]") {
          add_class("mw_link_center")
          $("./a") {
            add_class("mw_bar2")
            remove("./@style")
            %link_txt = fetch("./text()")
            match_not(%link_txt, /»/) {
              inner_wrap("div", class: "mw_chevron_after")
            }
            # add the text as a class name to the li- to hide homepage, sitemap etc I think - simply, copying the code below
            $("..") {
              add_class(%link_txt)
            }
          }
        }
      }

      # Give the li's classnames based on the link

      $("./li/a[not(child::*)]") {
        %newId = fetch("text()")
        %newId {
          replace(/\s/, "")
        }
        $("..") {
          add_class(%newId)
        }
      }
    }
  }

  # Custom keyboards
  # custom_keyboard(".//input[@id='cons_email']", "email")
  contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")

}

# Remove instances where there might be two footers. HSUS-113
$("./body//div[@id='ga-content']//div[@id='action-alert']/following-sibling::div[contains(@class, 'footer')]") {
  remove()
}

//HSUS-473
$(".//li[@class='rss']"){
  remove()
}

#  This file adds in the divs that provide information to the moovweb specific
#  Google Analytics solution
#
#  The logic works as such. The variable $mw_analytics is added in the mappings file
#  to any scripts that need to have the analytics embedded. The variable is set to the
#  name of the corresponding tritium script. This helps to ensure no duplicates.
#  Then the value of the variable is matched below and the correct div with the page
#  name is included.
#

# replace page_name_home with the appropriate variable name
$("/html/body") {
  # match($mw_analytics) {
  #   with(/page_name_home/) {
  #     insert_bottom("div") {
  #       attribute("id", "mw_ga_config")
  #       attribute("page_name", "page_name_home")
  #     }
  #   }
  # }

  # match($mw_analytics) {
  #   with(/page_name_home/) {
  #     insert_bottom("div") {
  #       attribute("id", "mw_ga_config")
  #       attribute("page_name", "page_name_home")
  #     }
  #   }
  # }

  match($mw_analytics) {
    log("mw_analytics: "+ $mw_analytics)
    insert_bottom("div") {
      attributes(id:"mw_ga_config", page_name:$mw_analytics, pac-man:"wakka-wakka")
      # attribute("page_name", $mw_analytics)
    }
  }
}
# Keep Desktop Site Javascript
#
# By default we remove all the desktop site Javascript.
# Here we can selectively keep some scripts

# Global stuff
$("/html") {
  # Remove script based on content
  $(".//script") {
    # [not(@type)]
    %source = fetch("text()")

    # Remove the redirection script
    match(%source, /mw_mobile_site/) {
      log("found the redirect script")
      remove()
    }

    # Remove the rotatingFooterImage
    match(%source, /rotateFooterImage/) {
      log("Removing the rotatingFooterImage")
      remove()
    }

    # remove crazy egg script (dnn506yrbagrg.cloudfront.net/pages/scripts/0018/9004.js)
    match(%source, /dnn506yrbagrg\.cloudfront\.net/) {
      log("Removing the crazy egg script")
      remove()
    }
  }

  $(".//link") {
    %href = fetch("./@href")
    match(%href,/windowshades/) {
      log("Removing windowshades links")
      remove()
    }
  }

  #Remove the windowshade script
  $(".//script[not(@src)]") {
    %source = fetch("text()")

    match(%source, /NoThankYou/) {
      log("found the windowshade script")
      remove()
    }
  }
  $(".//script[not(@type)]") {
    %source = fetch("text()")

    match(%source, /utmx\_section/) {
      log("found the Google Analytics Experiment code script")
      remove()
    }
  }
  $(".//script[contains(@src, 'jquery\-alerts\.js')]") {
    log("jquery-alert.js")
    attribute("data-keep", "false")
  }


  # Google analytics
  $(".//script[contains(@src, 'ga\.js')]") {
    log("ga.js")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'ga_exp\.js')]") {
    log("ga_exp.js")
    attribute("data-keep", "true")
  }

  # HSUS-344
  # # Disabling this 7-24-13 - Sean
  # Gigya scripts
  # $(".//script[contains(@src, 'gigya\.js')]") {
  #   log("ga_exp.js")
  #   attribute("data-keep", "true")
  # }
  $(".//script[contains(@src, 'yui-min')]") {
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'utils')]") {
    attribute("data-keep", "true")
  }


  # HSUS-180
  # Google search
  # $(".//script[contains(@src, 'default\+en\.I\.js')]") {
  #   log("default+en.I.js")
  #   attribute("data-keep", "true")
  # }
  # $(".//script[contains(@src, 'Search\+en\.I\.js')]") {
  #   log("default+en.I.js")
  #   attribute("data-keep", "true")
  # }

  # $(".//script[contains(@src, 'google')]") {
  #   log("Google JS")
  #   attribute("data-keep", "true")
  # }

  #Convio cookie stuff
  $(".//script[contains(@src, 'cookie\.js')]") {
    log("cookie.js")
    attribute("data-keep", "true")
  }

  # Convio modules
  $(".//script[contains(@src, 'modules\.js')]") {
    log("ga_exp.js")
    attribute("data-keep", "true")
  }

  # Addthis widget for social sharing
  $(".//script[contains(@src, 'addthis_widget')]") {
    log("addthis_widget.js")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'verisign')]") {
    log("verisign SSL")
    %srcfix = fetch("./@src")
    
    log(%srcfix)
    %srcfix {
      replace(/secure\.humanesociety\.org/, $host)
    }
    #log($host)
    log(%srcfix)
    attribute("src", %srcfix)
    attribute("data-keep", "true")
  }

  $(".//script[contains(@src, 'slideshows')]") {
    log("found the tubepress script")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'jquery')]") {
    log("found the tubepress script")
    attribute("data-keep", "true")
  }

  $(".//script[contains(@src, 'iscroll')]") {
    log("found the tubepress script")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'BrightcoveExperience')]") {
    log("found the tubepress script")
    attribute("data-keep", "true")
  }

  # New twitter feed for homepage
  $(".//script[contains(@src, 'social.js')]") {
    log("found the social.js")
    attribute("data-keep", "true")
  }

  # restaurant locator map script
  $(".//script[contains(@src, 'maps.googleapis.com/maps/api')]") {
    log("found google maps api")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'maps.gstatic.com/cat_js/intl')]") {
    log("found gstatic maps")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'thickbox-compressed')]") {
    log("found thickbox")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'jquery-tablesorter')]") {
    log("found table sorter")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'jsapi')]") {
    log("found js api")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'file=visualization&v=1&packages=table')]") {
    log("found table visualizer")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'api/visualization')]") {
    log("found visualization api")
    attribute("data-keep", "true")
  }

# universally force videos and slideshows into viewport

  $(".//iframe|.//object") {
    remove("@style")
    remove("@width")
    remove("@height")
    # does this count as inline styling?
    attribute("width", "100%")
    attribute("height", "300px")
  }

  $(".//div[contains(@id, 'item-')]") {
    remove("@style")
    $(".//script") {
      inner() {
        replace(/width: \"[\d]*\"/, 'width: "100%"')
        replace(/height: \"[\d]*\"/, 'height: "300px"')
      }
    }
  }

  $(".//iframe[contains(@src, 'facebook')]") {
    remove()
  }

  # handle image sliders
  $(".//div[@id='images' and ./ul[count(*)>1]]") { 
    attributes(data-ur-set:"carousel", data-ur-fill:"1", data-ur-carousel-component:"view_container", class:"mw_carousel", data-ur-autoscroll: "enabled")
    insert_bottom("span", data-ur-carousel-component:"dots")
    $("./ul") {
      $("./li") {
        name("div")
        attributes(data-ur-carousel-component:"item")
        add_class("mw_carousel_item")
      }
      name("div")
      attributes(data-ur-carousel-component:"scroll_container")
      add_class("mw_carousel_scroll_container")
    }
  }
}
# Adding test page too for HSUS-444
match_not($path, /^\/($|\?|index\.html)|wstest\-mar\-29|ws\-test\-b|newsbrieftest2|newsfeedtest|homepage/) {
  # stuff to remove universally
  # except on front page
  $(".//div[@class='dyk']") {
    remove()
  }
  $(".//div[@id='side']") {
    $(".//div[@class='simple']") {
      remove()
    }
    $(".//div[not(@id) and not(@class)]") {
      # HSUS-141
      # I am going to set a global hide on this class so I can override where necessary
      add_class("mw_sidebar_content_hide")
      # remove()
    }
    $(".//div[contains(@id, 'item-')]") {
      remove()
    }
    $(".//div[@id='seals-app']") {
      add_class("mw_sidebar_seals")
    }
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1") // new universal class
      $("./li") {
        remove("./p")
        remove("./form[not(@id='lmainLogonForm')]")
        remove("./div")
        $("./a") {
          $destination = fetch("@href")
          $destination {
            replace(/\s$/, "") //chop off the occasional trailing spaces
          }
          attribute("href", $destination)
          # taking care of repeated buttons - HSUS-516 
          $("following-sibling::a") {
            match(fetch("@href"), $destination) {
              remove()
            }
          }
          # end HSUS-516
        }
        

      }
      remove("./li[not(@id)]")
      remove("./li[not(*)]")
      remove("./div")
      
      # Disabling HSUS-344
      # # Disabling this 7-24-13 - Sean
      # match($path, /testing\/cd-test2/) {
      #  wrap_together("./li[contains(@id, 'signup')]", "div", class: "mw_signup_content", data-ur-toggler-component: "content", data-ur-state: "disabled") {
      #    $("./li") {
      #      name("div")
      #      remove(".//@style")
      #      $("self::div[@id='signup']/a") {
      #        inject("  &raquo;  ")
      #      }
      #    }
      #    wrap("li", class: "mw_signup", data-ur-set: "toggler") {
      #      insert_top("div", class: "mw_signup_button",data-ur-toggler-component: "button",data-ur-state: "disabled") {
      #        insert("span", "SIGN UP")
      #      }
      #    }
      #  }
      # }
    }
  } 
}

# Action Alerts page
match($path) {

  with(/^\/action\/alerts/) {
    $(".//script[contains(@src, 'global')]") {
      attribute("data-keep", "true")
    }
  }

  #HSUS-367 (Mobile & Tablet) Unmapped Survey Page
  with(/^\/site\/Survey/) {
    $(".//script[contains(@src, 'utils')]") {
      attribute("data-keep", "true")
    }
  }
  # end HSUS-367

  # Find Your Federal Legislators
  with(/PageServer\?pagename\=electedOfficials/) {
    $(".//script[contains(@src, 'findreps')]") {
      log("found the FormComponentsBehavior script")
      attribute("data-keep", "true")
    }
  }

  #HSUS-463 take your pet contest
  with(/site\/SPageServer\?.?pagename\=take_your_pet/) {
    $(".//script[contains(@src, 'vine')]") {
      log("keeping vine embed script")
      attribute("data-keep", "true")
    }
  }

  #HSUS-482
  with(/Donation2/i) {
    $(".//script[contains(@src, 'prototype.js')]") {
      log("keeping prototype script")
      attribute("data-keep", "true")
    }
  }
  # HSUS-484
  with(/hsus_calendar/) {
    # $(".//script[contains(@src, 'calendar') and not(contains(@src, 'orgevent'))]") {
    #   log("keeping calendar script")
    #   attribute("data-keep", "true")
    # }
    # $(".//script[contains(@src, 'obs_comp')]") {
    #   log("keeping obs_comp script")
    #   attribute("data-keep", "true")
    # }
    # $(".//script[contains(@src, 'form')]") {
    #   log("keeping form script")
    #   attribute("data-keep", "true")
    # }
    $(".//script") {
      attribute("data-keep", "true")
      log("!!!!!!", fetch("@src"))
      # match(fetch("@src"), /yahoo/) {
      #   log("!!!!!!!!!!", fetch("@src"))
      # }
    }

  }
  
  # HSUS-344 "or sign up using"
  # http://www.humanesociety.org/testing/cd-test2.html
  # I made this global.. because it will be deployed for all the pages
  # Sean
  # with(/testing\/cd-test2/) {
  #   $(".//script[contains(@src, 'yui-min')]") {
  #     attribute("data-keep", "true")
  #   }
  #   $(".//script[contains(@src, 'utils')]") {
  #     attribute("data-keep", "true")
  #   }
  # }

}


# Domain Specific
match($host) {
  with(/video\.humanesociety\.org/) {
    log("matched video.humanesociety.org in optimization.ts")
    # Tubepress script
    $(".//script[contains(@src, 'tubepress')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'BrightcoveExperiences')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'jquery')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }
  }

  with(/action\.humanesociety\.org/) {
    # grab the desktop header image out of the styling sheet
    $(".//style[contains(text(), '#whoweare')]") {
      log("in action forms, found inline header image")
      text() {
        capture(/(.*)(#head.*})(.*)/) {
          $head_img = $2;
        }
      }
      # trim down to image url
      $head_img {
        replace(/\A[^\(]*\(/, '')
        replace(/\).*\z/, '')
      }
      log("%%%%%%%%%%%% " + $head_img)
      insert_after("img") {
        attribute("src", $head_img)
        attribute("id", "desktop_head")
      }
    }
  }

  with(/slideshows\.humanesociety\.org/) {
    log("matched slideshows.humanesociety.org")

    #slideshow script
    $(".//script[contains(@src, 'slideshows')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }
    $(".//script[contains(@src, 'jquery')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'iscroll')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }
  }

  with(/secure\.humanesociety\.org/) {
    # $(".//script[contains(@src, 'donations2')]") {
    #   log("found the donations2 script")
    #   attribute("data-keep", "true")
    # }

    $(".//script[contains(@src, 'FormComponentsBehavior')]") {
      log("found the FormComponentsBehavior script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'modules')]") {
      log("found the modules script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'utils')]") {
      log("found the utils script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'obs_comp_rollup')]") {
      log("found the obs_comp_rollup script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'yui')]") {
      log("found the yui script")
      attribute("data-keep", "true")
    }
  }

  # Legacy
  # Trying to preserve their custom inline styles, as they are used to generate the diagrams on the page
  # $(".//span[@id='articlesSpan']/style") {
  #   log("Legacy custom styles")
  #   attribute("data-keep", "true")
  #   name("span")
  # }
  with(/legacy\.humanesociety\.org/) {
    $(".//script[contains(@src, 'stelter-global')]") {
      log("found the stelter-global script")
      attribute("data-keep", "true")
    }
  }

  # Remove anything they tag not worthy of a mobile experience
  $(".//*[@mw-mobile-experience='remove']") {
    log("Removing tagged desktop item in Optimizations.ts")
    remove()
  }

}
$html_fragment = "false"


match($host) {
  with(/video\.humanesociety\.org/) {
    match($path) {
      with(/tubepress/) {
        log("tubepress video in check_fragment.ts")
        $html_fragment="true"

      }
    }
  }
}

match($html_fragment, /true/) {
  $content_type = "ajax"

  html_fragment() {
    rewrite_links()
    absolutize_srcs()
    remove(".//script[contains(@src, 'moovweb_client_side')]")

    @import "fragment_mappings.ts"
  }
}
match ($path) {
  with(/shortcode_printer/) {
    log("here's where the mapping would go")

    video_ajax()

  }

  with(/playerHtml/) {
    %header = fetch("*")
    log(%header)
    match(%header) {
      with(/%3Cdiv.*?%3E/) {
        log("Match successful")

      }
    }

    text() {
      match($tablet, /false/) {
        # remove the inline styles
        replace(/style%3D%22.*?%22/,'')

        #remove the width and height of the video player
        replace(/width%3D%22.*?%22/,'')
        replace(/height%3D%22.*?%22/,'')
      }

      #remove the id of the share container
      # replace(/id%3D%22shareContainer?%22/, 'class%3D%22mw_box2%20mw_share_container%22')

      # Wrap the share header and description together
      replace(/%3Cdiv%20id%3D%22shareContainer?%22/, '%3Cdiv%20class%3D%22mw_box2%22%3E%3Cdiv%20class%3D%22mw_share_container%22')

      #move the header into the description box
      # %header = fetch(/%3Cdiv.*?%3E/)
      # log(%header)
      # replace(/shareContainer%20--%3E/, "shareContainer%20--%3E%3Cdiv%20class%3D%22mw_box2%22%3E")

      # give the header some style
      replace(/tubepress_embedded_title%22/, 'tubepress_embedded_title%20mw_h2%22')

      # remove facebook stylesheet
      replace(/%3Clink%20rel%3D%22stylesheet%22.+?%2F%3E/, '')

      # Hopefully add closing div tag
      replace(/\"\s\}$/, '%3C%2Fdiv%3E" }')
    }
  }
}

$tablet = "true"

match($user_agent, /Mobi(le)?/) {
  # some tablet UAs falsely match e.g. Apple iPad, Samsung Galaxy Tab, Motorola Xoom, Amazon Kindle, Barnes & Noble Nook, RIM Playbook, HP TouchPad, HTC Flyer
  match_not($user_agent, /iPad|GT-P\d{4}|SCH-I(800|815|905)|Xoom|Kindle|Nook|NOOK|PlayBook|Touchpad|Flyer/) {
    $tablet = "false"
  }
}

log("Tablet?")
log($tablet)

# $device_stylesheet = "main"
# match($user_agent) {
#   with(/Android/) {
#     $device_stylesheet="devices/android"
#   }
#   with(/Blackberry/) {
#     $device_stylesheet="devices/blackberry"
#   }
#   with(/iPhone/) {
#     $device_stylesheet="devices/iphone"
#   }
#   with(/iPad/) {
#     $device_stylesheet="devices/ipad"
#   }
#   with(/WebKit/) {
#     $device_stylesheet="devices/webkit"
#   }
# }

match($user_agent) {
  with(/iPhone|iPad|iPod/) {
    $device_stylesheet = "devices/ios"
  }
  # new Androids can just use main.scss
  with(/Android [12].*WebKit/) {
    $device = "Android"
    $device_stylesheet = "devices/android"
  }
  with(/Silk\/1\.[01]/) {
    $device = "Android"
    $device_stylesheet = "devices/android"
  }
  with(/Blackberry/) {
    $device_stylesheet = "devices/blackberry"
  }

  # for development purposes.. load the devices/ios stylesheet by default
  else() {
    $device_stylesheet = "devices/ios"
  }
}

match($tablet) {
  with("true") {
    $device_stylesheet = $device_stylesheet + "_tablet"
  }
  else() {
    $device_stylesheet = $device_stylesheet + "_mobile"
  }
}
$("./head/script[not(@src)]") {
  # log(text())
  %mouseover_check = fetch("./text()")
  match(%mouseover_check, /mouseover/) {
    log("--> Removing a mouseover script")
    remove()
  }
}

$('./body') {
  insert_top("div", id: "mw_slider_overlay")
  
  # HSUS-362 : Moovweb menu header
  $insert_header = "false"

  match($host) {
    with(/video/) {
      $insert_header = "true"
    }
    #HSUS-503
     with(/slideshows/) {
      $insert_header = "true"
    }
     # End HSUS-503
    else() {
      $("self::body[.//ul[@id='site-nav']]") {
        $insert_header = "true"
      }
    }
  }
  
    match($insert_header, /true/) {
        insert_top("div", class: "mw_header") {

          # Header Logo
          %home = $host
          %home {
            replace(/video\./, "")
            replace(/slideshows\./,"")
            replace(/action\./, "")
            replace(/secure\./, "")
            replace(/legacy\./, "")
          }

          insert("a", href:concat("http://",%home), class:"mw_header_spillover") { 
            # insert("div", class: "images-logo3")

            #Copy their logo image here
            copy_here("./ancestor::body//a[@class='logo']/img") {
              remove("@width")
              remove("@height")
            }
          }

          # Donate Button
          # insert("a", class:"mw_btn4", href:concat("http://",%home,"/donate"), "Donate")
          insert("div", class:"mw_donate_bar", data-ur-set:"toggler") {
            %donate = %home # $host
            %donate {
              # replace(/video\./, "")
              replace(/\.humane/, ".secure.humane")
            }

            insert("div", class:"mw_btn4", data-ur-toggler-component:"button","Donate") {
              match($has_search_bar, /false/) {
                add_class("mw_no_serach_bar")
              }
            }
            insert("div", data-ur-toggler-component:"content", class:"mw_donation_option_list") {
              copy_here("//div[@id='top_donate']/a") {
                add_class("mw_donate_option")
              }
              copy_here("//select[@id='donate-menu']/option") {
                name("a")
                attributes(href: fetch("./@value"))
                remove("./@value")
                remove("./@style")
                add_class("mw_donate_option")
              }
              $("./a") {
                $donate_txt = fetch("./text()")
                match($donate_txt) {
                  with(/Donate Monthly/i) {
                    $donate_txt = "Monthly"
                  }
                  with(/Donate one time/i) {
                    $donate_txt = "One Time"
                  }
                  with(/Donate in memory/i) {
                    $donate_txt = "In Memory"
                  }
                  with(/Donate to celebrate/i) {
                    $donate_txt = "In Celebration"
                  }
                  with(/Make a Leadership gift/i) {
                    $donate_txt = "To make a Leadership gift"
                  }
                  with(/Create your Legacy/) {
                    $donate_txt = "To create your Legacy"
                  }
                }
                text($donate_txt)
              }
            }
          }

          # Search Button

          # insert("div", class:"mw_header_search mw_header_search_btn") {
          #   insert("div", class:"images-search")
          #   insert("div", class:"images-searcharrow")
          # }
          move_here("//div[@id='top_search']") {
            remove(".//label")

            $(".//p") {
              # add_class("mw_flex_box")
              $("./input") {
                # add_class("mw_flex_box_item_1")
                # HSUS-179 (Tablet) Search Box
                attribute("placeholder","Search")
              }
            }
            $(".//button") {
              add_class("mw_btn5")
              text("")
            }
          }

          # HSUS-431 Header changes for desktop and tablet
          move_here("//div[@class='social_media']") {
            $("./a[contains(@href, 'facebook')]") {
              insert_top("div", class: "images-facebook_social")
            }
            $("./a[contains(@href, 'twitter')]") {
              insert_top("div", class: "images-twitter_social")
            }
          }
          # end HSUS-431

          # Menu Button

          insert("div", class: "mw_header_menu mw_header_btn") {
            insert("div", class:"images-menu")
          }

          # Main nav
          insert_after ("div", class: "mw_menu_nav") {
            copy_here("//ul[@id='site-nav'] | //ul[@id='topNav']") {
              attribute("id", "mw_site-nav")

                insert("div", class: "mw_branding") {
                insert("a", href:concat("http://", %home), class: "images-navlogo") 
                insert("p", class:"mw_branding_desc", "We're the nation's largest and most effective animal protection organization.")
              }
            }
          }

          # Search bar

          /*insert_after("div", class: "mw_search_bar") {
            move_here("//div[@id='top_search']") {
              remove(".//label")

              $(".//p") {
                add_class("mw_flex_box")
                $("./input") {
                  add_class("mw_flex_box_item_1")
                }
              }
              $(".//button") {
                add_class("mw_btn1")
                text("Search")
              }
            }
          }*/
      }
    }
    # end of HSUS-36

  # Remove the accessibility stuff

  $("./ul[@id='accessibility']") {
    remove()
  }
  
  # Page masthead
  # wrap_together(".//div[@class='mw_hidden_content']", "div") {
  #   add_class("mw_masthead")
  #   move_to("..", "top")
  #   move_here(".//div[@class='mw_masthead_title_text']")
  #   move_here(".//img[@class='mw_tablet_masthead_image']")
  # }

  # Page masthead
  $new_masthead = "false"
#  $mastead_exists = "false"
#
#  $(".//div[contains(@class, 'mw_hidden_content']") {
#    $mastead_exists = "false"
#  }
#
#  # Generate a temporary masthead if one does not exist
#  $(".//div[@id='wrapper']") {
#    insert_top("div", class:"mw_masthead", style:"height:200px;") {
#      insert("div", class:"mw_masthead_title_text", style:"color: white;", "Hello!")
#    }
#  }
#
  $(".//div[@class='mw_hidden_content_tablet']") {
    $new_masthead = "true"
  }

  wrap_together(".//div[contains(@class, 'mw_hidden_content')]", "div") {
    add_class("mw_masthead")
    # move_to("..", "top")
    move_to("./ancestor::div[@id='wrapper']", "top")
    match($new_masthead) {
      with(/true/) {
        move_here(".//div[@class='mw_hidden_content_tablet']//img")
        move_here(".//div[@class='mw_hidden_content_tablet']//div[@class='mw_masthead_title_text']")
      }

      else() {
        move_here(".//img[@class='mw_hidden_content_tablet']")
        move_here(".//div[@class='mw_masthead_title_text']")
      }
    } 
  }
  
  # HSUS-384 legacy.humanesociety.org header img
  match($host, /legacy/) {
    $("./div[@id='wrapper']") {
      insert_top("div", class: "mw_masthead") {
        insert("img", src: "http://www.humanesociety.org/assets/images/1024x256-tablet-mastheads/tablet_masthead_default.png", class: "mw_tablet_masthead_image")
      }
    }
  }
  
  
}
# HSUS-243
# https://secure.humanesociety.org/site/SPageServer?JServSessionIdr004=otzef48w28.app305b&pagename=HSUS_DRTV_MSI_spot_2013
# http://action.humanesociety.org/site/PageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
match($path, /pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
 $("./body") {
   insert_bottom("div", id: "mw_drtv_footer")
 }
}
# HSUS-243 end

$("./body/div[@id='wrapper'] | ./body/div[@id='shell'] | ./body//div[@id='action-alert']/.. | ./body//div[@id='ga-content'] | ./body//div[@id='mw_drtv_footer']") {
  insert_bottom("div", class: "_footer mw_box1") {
    match($source_host, /legacy/) {
      add_class("mw_lefacy_footer")
    }
    move_here("//div[@id='site-footer-container']")
    move_here("//div[@id='footer']")

    #manually styled footers
    move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
      attribute("id", "foot")
      $(".//*[@style]") {
        remove("@style")
      }
      $("./ul") {
        $("./li[1]") {
          add_class('mw_footer_copyright')
        }
        # HSUS-243
        # https://secure.humanesociety.org/site/SPageServer?JServSessionIdr004=otzef48w28.app305b&pagename=HSUS_DRTV_MSI_spot_2013
        # http://action.humanesociety.org/site/PageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
        match($path, /pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
          move_here("./preceding-sibling::p[1]", "bottom") {
            name("li")
          }
          remove("./preceding-sibling::div[./img][1]")
          remove("./li[./a[./img]]")
        }
        # end of HSUS-243
      }
      $(".//li[./a]") {
        add_class("mw_links_inline")
        $("./a") {
          remove("@style")
        }
      }
      remove("@style")
      remove("./img")
      remove("./p")
    }
    move_here("//div[@id='foot']") {
      remove("@style")
      remove(".//br")
      $("./ul[1]") {
        $("./li[1]") {
          add_class('mw_footer_copyright')
        }
        $("./li") {
          $("./self::li[./a]") {
            add_class("mw_links_inline")
            $("./a") {
              remove("@style")
            }
            $("./a[not(contains(text(), '»'))]") {
              text(fetch("./text()")+ " »")
            }
          }
          $("./self::li[not(contains(@class, 'mw_footer_copyright'))][not(./a)]") {
            add_class("mw_footer_info")
          }
          # remove twitter and twitter link
          remove("./self::li[./a[contains(@id, 'twitter') or contains(@id, 'twitter')]]")
          remove("./@style") 
        }
      }
      $("./ul[2]") {
        add_class("mw_more_list")
      }
    }
    # move_here("//div[@class=' mw_pledge_footer']")

    insert_bottom("a", href:"http://www.moovweb.com/?mwci=TGIN", class:"mw_powered_by", "Mobile Site Powered by ") {
      insert("span", class:"footer-strong", "Moovweb")
    }
  }

  $(".//div[@class='connected-panel-inner']") {
    add_class("mw_flex_box")
  }

  $(".//div[@class='connected-panel-left']") {
    add_class("mw_flex_box_item_1")
  }
  
  $(".//div[@class='connected-panel-middle']") {
    add_class('mw_flex_box_item_1')

    $("./form[@id='email-signup-footer']") {

      $("./input[@type='submit']") {
        add_class("mw_btn5")
        name("button")
        remove("@value")
      }
    }
  }

  $(".//div[@class='connected-panel-right']") {
     add_class('mw_flex_box_item_1')

    $("./h3") {
      inner() {
        replace(/Get\s/, "")
      }
    }

    $("./form[@id='mobile-signup-footer']") {
      #attribute("data-ur-toggler-component", "content")

      $("./input[@type='submit']") {
        add_class("mw_btn5")
        name("button")
      }
      # HSUS-304
      remove("./span[@class='label-holder']")
    }
  }
  # Accordionize the bottom
  $(".//div[@class='taxonomy-nav']") {
    attribute("data-ur-set", "toggler")

    $("./h3") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")
    }

    $("./ul") {
      attribute("data-ur-toggler-component", "content")

      $("./li/a") {
        add_class("mw_bar1")
      }
    }
    # for HSUS-119: Main Links
    # $("./ancestor::div[@class='taxonomy'][1]") {
    #   move_here("./ancestor::div[@id='site-footer-container'][1]/div[contains(@class, 'logo-panel-footer')]/ul[@class='link-list']", "after") {
    #     add_class("mw_main_links")
    #     $(".//a[@href]") {
    #       add_class("mw_bar1")
    #     }
    #   }
    # }
    # end of for HSUS-119: Main Links
  }

  # merge all the taxonomy-nav into the taxonomy 
  $(".//div[@class='taxonomy']") {
    move_here(".//div[@class='taxonomy-nav']")
    remove("./div[@class='taxonomy-column']")
  }

  $(".//div[@class='legal']") {
    move_here("./ancestor::div[contains(@class,'footer')]//div[@class='site-footer logo-panel-footer']/ul", "before") {
      add_class("mw_nav_links")

      # Give the li's classnames based on the link

      $("./li/a") {
        %newId = fetch("text()")
        %newId {
          replace(/\s/, "")
        }
        $("..") {
          add_class(%newId)
        }
        
      }
    }

    # Move the images
    move_here("../div[@class='seals-approval']", "top") {
      $(".//img") {
        remove("@style")
        remove("@height")
        remove("@width")
      }
    }
  }

  # Custom keyboards
  # custom_keyboard(".//input[@id='cons_email']", "email")
  contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")

}

$(".//div[contains(@class,'_footer')]//h3") {
  name("p")
}

# Remove instances where there might be two footers. HSUS-113
$("./body//div[@id='ga-content']//div[@id='action-alert']/following-sibling::div[contains(@class, 'footer')]") {
  match($path) {
    with(/^\/site\/Advocacy\?cmd=display\&page=onscreenthanks/i) {
      # do nothing
    }
    # HSUS-362 missing footer
    with(/^\/site\/Advocacy\?cmd=display&page=UserAction&id/i) {
      move_to("./ancestor::div[@id='ga-content'][1]/table", "after")
      remove("./following-sibling::div[contains(@class, 'footer')]")
    }
    else() {
      remove()
    }
  }
}

//HSUS-473
$(".//p[@class='tax-statement'][1]"){
  insert_after("br")
  insert_after("br")
}

$(".//li[@class='rss']"){
  remove()
}

//HSUS-476
$(".//ul[contains(@class,'mw_nav_links')]"){
  move_to("//p[@class='copyright']", "after")
}

$("./head/script[not(@src)]") {
  # log(text())
  %mouseover_check = fetch("./text()")
  match(%mouseover_check, /mouseover/) {
    log("--> Removing a mouseover script")
    remove()
  }
}

$('./body') {

  # HSUS-153 , some pages have no search bar
  $has_search_bar = "false"
  $("/html/body//div[@id='top_search']") {
    $has_search_bar = "true"
  }

  insert_top("div", id: "mw_slider_overlay")
  insert_top("div", class: "mw_header") {
    
    # Header Logo
    %home = $host

    %home {
      replace(/video\./, "")
      replace(/slideshows\./,"")
      replace(/action\./, "")
      replace(/secure\./, "")
      replace(/legacy\./, "")
    }
    # remember to remove the ?utm_expid&mobile when things go live!
    insert("a", href:concat("http://",%home)) { #, "?utm_expid=68505748-5&mobile=0"
      insert("div", class: "images-logo3")
    }

    # Donate Button
#    insert("a", class:"mw_btn4", href:concat("http://",%home,"/donate"), "Donate") {
#      match($has_search_bar, /false/) {
#        add_class("mw_no_serach_bar")
#      }
#    }
    insert("div", class:"mw_donate_bar", data-ur-set:"toggler") {
      %donate = %home #$host
      %donate {
        # replace(/video\./, "")
        replace(/\.humane/, ".secure.humane")
      }

      insert("div", class:"mw_btn4", data-ur-toggler-component:"button","Donate") {
        match($has_search_bar, /false/) {
          add_class("mw_no_serach_bar")
        }
      }
      insert("div", data-ur-toggler-component:"content", class:"mw_donation_option_list") {
        copy_here("//div[@id='top_donate']/a") {
          add_class("mw_donate_option")
        }
        copy_here("//select[@id='donate-menu']/option") {
          name("a")
          attributes(href: fetch("./@value"))
          remove("./@value")
          remove("./@style")
          add_class("mw_donate_option")
        }
        $("./a") {
          $donate_txt = fetch("./text()")
          match($donate_txt) {
            with(/Donate Monthly/i) {
              $donate_txt = "Monthly"
            }
            with(/Donate one time/i) {
              $donate_txt = "One Time"
            }
            with(/Donate in memory/i) {
              $donate_txt = "In Memory"
              # Fix for HSUS-520 : Remove
              add_class("mw_hide")
            }
            with(/Donate to celebrate/i) {
              $donate_txt = "In Celebration"
              add_class("mw_hide")
              # Fix for HSUS-520 : Remove
            }
            with(/Make a Leadership gift/i) {
              $donate_txt = "To make a Leadership gift"
            }
            with(/Create your Legacy/) {
              $donate_txt = "To create your Legacy"
            }
          }
          text($donate_txt)
        }
      }
    }

    # Search Button
    match($has_search_bar, /true/) {
      insert("div", class:"mw_header_search mw_header_search_btn") {
        insert("div", class:"images-search")
        insert("div", class:"images-searcharrow")
      }
    }
    # Menu Button

    insert("div", class: "mw_header_menu mw_header_btn") {
      insert("div", class:"images-menu")
    }

    # Main nav
    insert_after ("div", class: "mw_menu_nav") {
      copy_here("//ul[@id='site-nav'] | //ul[@id='topNav']") {
        attribute("id", "mw_site-nav")

          insert("div", class: "mw_branding") {
          insert("a", href:concat("http://", %home), class: "images-navlogo") #, "?utm_expid=68505748-5&mobile=0"
          insert("p", class:"mw_branding_desc", "We're the nation's largest and most effective animal protection organization.")
        }
      }
    }

    # Search bar
    # HSUS-153 , some pages have no search bar
    match($has_search_bar, /true/) {
      insert_after("div", class: "mw_search_bar") {
        move_here("//div[@id='top_search']") {
          remove(".//label")

          $(".//p") {
            add_class("mw_flex_box")
            $("./input") {
              add_class("mw_flex_box_item_1")
            }
          }
          $(".//form[@id='site-search'][input]") {
            add_class("mw_flex_box")
          }
          $(".//form/input") {
            add_class("mw_flex_box_item_1")
          }
          $(".//button") {
            add_class("mw_btn1")
            text("Search")
          }
        }
      }
    }
  }

  # Remove the accessibility stuff

  $("./ul[@id='accessibility']") {
    remove()
  }
  
  # Page masthead
  $new_masthead = "false"

  $(".//div[@class='mw_hidden_content_mobile']") {
    $new_masthead = "true"
  }

  wrap_together("/html/body[not(@id='home')]//div[contains(@class, 'mw_hidden_content')]", "div") {
    add_class("mw_masthead")
    log("new masthead? " + $new_masthead)
    match($new_masthead) {
      with(/true/) {
        move_here(".//div[@class='mw_hidden_content_mobile']//img")
        move_here(".//div[@class='mw_hidden_content_mobile']//div[@class='mw_masthead_title_text']")
      }

      else() {
        move_here(".//img[@class='mw_mobile_masthead_image']")
        move_here(".//div[@class='mw_masthead_title_text']")
      }
    }
    move_to("./ancestor::div[@id='wrapper']", "top")
  }
  
  # sidebar
  $(".//div[@id='side']") {
    # media contact box
    $(".//a[@id='media-contact']") {
      wrap("div", class:"mw_mediaBox")
      inner() {
        replace("2", "  &raquo;  ")
      }
    }
  }
  # Fix for HSUS-509 : Header is removed from the "secure" domain URL's
  # host is matched with "secure" 
  ##  match($host) {
  ##    with(/secure\./) {
  ##      # For HSUS-512, HSUS-513
  ##      match_not($path,/site\/Donation/i) {
  ##        $(".//div[@class='mw_header']") {
  ##          add_class("mw_hide")
  ##        }
  ##      }
  ##      # End of HSUS-512, HSUS-513
  ##    }
  ##  }
  # Fix for HSUS-509 : Header is removed from the "secure" domain URL's
}
# HSUS-243
# https://secure.humanesociety.org/site/SPageServer?JServSessionIdr004=otzef48w28.app305b&pagename=HSUS_DRTV_MSI_spot_2013
# http://action.humanesociety.org/site/PageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
match($path, /pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
  $("./body") {
    insert_bottom("div", id: "mw_drtv_footer")
  }
}
# HSUS-243 end
$("./body/div[@id='wrapper'][not(.//@id='page')] | ./body/div[@id='shell'][not(.//@id='page')] | ./body//div[@id='action-alert']/.. | ./body//div[@id='ga-content'] | ./body/table[.//link[contains(@href, 'sealpup_alert.jpg')]] | .//div[@id='page'] | ./body/div[@id='mw_drtv_footer']") {
  insert_bottom("div", class: "_footer mw_box1", id:"mw_footer") {
    move_here("//div[@id='site-footer-container']")
    move_here("//div[@id='footer']")

    #manually styled footers
    move_here("//ul[@style]/li[@style]/a[contains(@href,'privacy')]/ancestor::div[1]") {
      $(".//*[@style]") {
        remove("@style")
      }
      $("./ul") {
        $("./li[1]") {
          add_class('mw_footer_copyright')
        }
        # HSUS-243
        # https://secure.humanesociety.org/site/SPageServer?JServSessionIdr004=otzef48w28.app305b&pagename=HSUS_DRTV_MSI_spot_2013
        # http://action.humanesociety.org/site/PageServer?pagename=HSUS_DRTV_MSI_spot_2013_thanks
        match($path, /pagename\=HSUS\_DRTV\_MSI\_spot\_2013/) {
          move_here("./preceding-sibling::p[1]", "bottom") {
            add_class("mw_p_wrap")
            wrap("li")
          }
        }
        match($path, /pagename=drtv_splashb_MSI/) {
          $("./li[last()]") {
            wrap_text_children("p") {
              add_class("mw_p_wrap")
            }
          }
        }
        # end of HSUS-243       
      }
      $(".//li[./a]") {
        add_class("mw_link_center")
        $("./a") {
          add_class("mw_bar2")
          remove("@style")
        }
      }
      remove("@style")
      remove("./img")
      # remove("./p")
    }
    move_here("//div[@id='foot']") {
      remove("@style")
      remove(".//br")
      $("./ul[1]") {
        $("./li[1]") {
          add_class('mw_footer_copyright')
        }
        $("./li") {
          $("./self::li[./a]") {
            add_class("mw_link_center")
            $("./a") {
              add_class("mw_bar2")
              remove("@style")
            }
            # HSUS-385
            $("./a[not(contains(text(), '»'))]") {
              text(fetch("./text()")+ " »")
            }
          }
          $("./self::li[not(contains(@class, 'mw_footer_copyright'))][not(./a)]") {
            add_class("mw_footer_info")
          }
          # remove facebook and twitter link
          remove("./self::li[./a[contains(@id, 'facebook') or contains(@id, 'twitter')]]")
          remove("./@style") 
        }
      }
      $("./ul[2]") {
        add_class("mw_more_list")
      }
    }
    # move_here("//div[@class=' mw_pledge_footer']")
    $("//div[@class=' mw_pledge_footer']") {
      add_class("mw_testing")
    }

    insert_bottom("a", href:"http://www.moovweb.com/?mwci=TGIN", class:"mw_powered_by", "Mobile Site Powered by ") {
      insert("span", class:"footer-strong", "Moovweb")
    }
  }

  # Accordionize the bottom
  $(".//div[@class='connected-panel-middle']") {
    attribute("data-ur-set", "toggler")

    $("./h3") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")
    }

    $("./form[@id='email-signup-footer']") {
      attribute("data-ur-toggler-component", "content")

      $("./input[@type='submit']") {
        add_class("mw_btn2")
      }
    }
  }

  $(".//div[@class='connected-panel-right']") {
    attribute("data-ur-set", "toggler")
    

    $("./h3") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")

      # Move any notes to the toggler content
      $("./span[@class='connected-title-note']") {
        move_to("../following-sibling::form", "top")
      }
    }

    $("./form[@id='mobile-signup-footer']") {
      attribute("data-ur-toggler-component", "content")

      $("./input[@type='submit']") {
        add_class("mw_btn2")
      }
    }
  }

  $(".//div[@class='taxonomy-nav']") {
    attribute("data-ur-set", "toggler")

    $("./h3") {
      attribute("data-ur-toggler-component", "button")
      add_class("mw_bar5")
    }

    $("./ul") {
      attribute("data-ur-toggler-component", "content")

      $("./li/a") {
        add_class("mw_bar1")
      }
    }
    # for HSUS-119: Main Links
    # $("./ancestor::div[@class='taxonomy'][1]") {
    #   move_here("./ancestor::div[@id='site-footer-container'][1]/div[contains(@class, 'logo-panel-footer')]/ul[@class='link-list']", "after") {
    #     add_class("mw_main_links")
    #     $(".//a[@href]") {
    #       add_class("mw_bar1")
    #     }
    #   }
    # }
    # end of for HSUS-119: Main Links
  }

  $(".//div[@class='legal']") {
    move_here("./ancestor::div[contains(@class,'footer')]//div[@class='site-footer logo-panel-footer']/ul", "before") {
      add_class("mw_nav_links")
      $taxonomy_footer_exists = "false"
      $("./parent::div/preceding-sibling::div[contains(@class, 'taxonomy')]") {
        $taxonomy_footer_exists = "true"
      }
      match($taxonomy_footer_exists, /false/) {
        add_class("mw_stack_links")
        $("./li[a]") {
          add_class("mw_link_center")
          $("./a") {
            add_class("mw_bar2")
            remove("./@style")
            %link_txt = fetch("./text()")
            match_not(%link_txt, /»/) {
              inner_wrap("div", class: "mw_chevron_after")
            }
            # add the text as a class name to the li- to hide homepage, sitemap etc I think - simply, copying the code below
            $("..") {
              add_class(%link_txt)
            }
          }
        }
      }

      # Give the li's classnames based on the link

      $("./li/a[not(child::*)]") {
        %newId = fetch("text()")
        %newId {
          replace(/\s/, "")
        }
        $("..") {
          add_class(%newId)
        }
      }
    }
  }

  # Custom keyboards
  # custom_keyboard(".//input[@id='cons_email']", "email")
  contextual_keyboard(".//input[@id='cons_zip_code']", "numeric")

}

# Remove instances where there might be two footers. HSUS-113
$("./body//div[@id='ga-content']//div[@id='action-alert']/following-sibling::div[contains(@class, 'footer')]") {
  remove()
}

//HSUS-473
$(".//li[@class='rss']"){
  remove()
}

#  This file adds in the divs that provide information to the moovweb specific
#  Google Analytics solution
#
#  The logic works as such. The variable $mw_analytics is added in the mappings file
#  to any scripts that need to have the analytics embedded. The variable is set to the
#  name of the corresponding tritium script. This helps to ensure no duplicates.
#  Then the value of the variable is matched below and the correct div with the page
#  name is included.
#

# replace page_name_home with the appropriate variable name
$("/html/body") {
  # match($mw_analytics) {
  #   with(/page_name_home/) {
  #     insert_bottom("div") {
  #       attribute("id", "mw_ga_config")
  #       attribute("page_name", "page_name_home")
  #     }
  #   }
  # }

  # match($mw_analytics) {
  #   with(/page_name_home/) {
  #     insert_bottom("div") {
  #       attribute("id", "mw_ga_config")
  #       attribute("page_name", "page_name_home")
  #     }
  #   }
  # }

  match($mw_analytics) {
    log("mw_analytics: "+ $mw_analytics)
    insert_bottom("div") {
      attributes(id:"mw_ga_config", page_name:$mw_analytics, pac-man:"wakka-wakka")
      # attribute("page_name", $mw_analytics)
    }
  }
}
# Keep Desktop Site Javascript
#
# By default we remove all the desktop site Javascript.
# Here we can selectively keep some scripts

# Global stuff
$("/html") {
  # Remove script based on content
  $(".//script") {
    # [not(@type)]
    %source = fetch("text()")

    # Remove the redirection script
    match(%source, /mw_mobile_site/) {
      log("found the redirect script")
      remove()
    }

    # Remove the rotatingFooterImage
    match(%source, /rotateFooterImage/) {
      log("Removing the rotatingFooterImage")
      remove()
    }

    # remove crazy egg script (dnn506yrbagrg.cloudfront.net/pages/scripts/0018/9004.js)
    match(%source, /dnn506yrbagrg\.cloudfront\.net/) {
      log("Removing the crazy egg script")
      remove()
    }
  }

  $(".//link") {
    %href = fetch("./@href")
    match(%href,/windowshades/) {
      log("Removing windowshades links")
      remove()
    }
  }

  #Remove the windowshade script
  $(".//script[not(@src)]") {
    %source = fetch("text()")

    match(%source, /NoThankYou/) {
      log("found the windowshade script")
      remove()
    }
  }
  $(".//script[not(@type)]") {
    %source = fetch("text()")

    match(%source, /utmx\_section/) {
      log("found the Google Analytics Experiment code script")
      remove()
    }
  }
  $(".//script[contains(@src, 'jquery\-alerts\.js')]") {
    log("jquery-alert.js")
    attribute("data-keep", "false")
  }


  # Google analytics
  $(".//script[contains(@src, 'ga\.js')]") {
    log("ga.js")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'ga_exp\.js')]") {
    log("ga_exp.js")
    attribute("data-keep", "true")
  }

  # HSUS-344
  # # Disabling this 7-24-13 - Sean
  # Gigya scripts
  # $(".//script[contains(@src, 'gigya\.js')]") {
  #   log("ga_exp.js")
  #   attribute("data-keep", "true")
  # }
  $(".//script[contains(@src, 'yui-min')]") {
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'utils')]") {
    attribute("data-keep", "true")
  }


  # HSUS-180
  # Google search
  # $(".//script[contains(@src, 'default\+en\.I\.js')]") {
  #   log("default+en.I.js")
  #   attribute("data-keep", "true")
  # }
  # $(".//script[contains(@src, 'Search\+en\.I\.js')]") {
  #   log("default+en.I.js")
  #   attribute("data-keep", "true")
  # }

  # $(".//script[contains(@src, 'google')]") {
  #   log("Google JS")
  #   attribute("data-keep", "true")
  # }

  #Convio cookie stuff
  $(".//script[contains(@src, 'cookie\.js')]") {
    log("cookie.js")
    attribute("data-keep", "true")
  }

  # Convio modules
  $(".//script[contains(@src, 'modules\.js')]") {
    log("ga_exp.js")
    attribute("data-keep", "true")
  }

  # Addthis widget for social sharing
  $(".//script[contains(@src, 'addthis_widget')]") {
    log("addthis_widget.js")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'verisign')]") {
    log("verisign SSL")
    %srcfix = fetch("./@src")
    
    log(%srcfix)
    %srcfix {
      replace(/secure\.humanesociety\.org/, $host)
    }
    #log($host)
    log(%srcfix)
    attribute("src", %srcfix)
    attribute("data-keep", "true")
  }

  $(".//script[contains(@src, 'slideshows')]") {
    log("found the tubepress script")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'jquery')]") {
    log("found the tubepress script")
    attribute("data-keep", "true")
  }

  $(".//script[contains(@src, 'iscroll')]") {
    log("found the tubepress script")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'BrightcoveExperience')]") {
    log("found the tubepress script")
    attribute("data-keep", "true")
  }

  # New twitter feed for homepage
  $(".//script[contains(@src, 'social.js')]") {
    log("found the social.js")
    attribute("data-keep", "true")
  }

  # restaurant locator map script
  $(".//script[contains(@src, 'maps.googleapis.com/maps/api')]") {
    log("found google maps api")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'maps.gstatic.com/cat_js/intl')]") {
    log("found gstatic maps")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'thickbox-compressed')]") {
    log("found thickbox")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'jquery-tablesorter')]") {
    log("found table sorter")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'jsapi')]") {
    log("found js api")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'file=visualization&v=1&packages=table')]") {
    log("found table visualizer")
    attribute("data-keep", "true")
  }
  $(".//script[contains(@src, 'api/visualization')]") {
    log("found visualization api")
    attribute("data-keep", "true")
  }

# universally force videos and slideshows into viewport

  $(".//iframe|.//object") {
    remove("@style")
    remove("@width")
    remove("@height")
    # does this count as inline styling?
    attribute("width", "100%")
    attribute("height", "300px")
  }

  $(".//div[contains(@id, 'item-')]") {
    remove("@style")
    $(".//script") {
      inner() {
        replace(/width: \"[\d]*\"/, 'width: "100%"')
        replace(/height: \"[\d]*\"/, 'height: "300px"')
      }
    }
  }

  $(".//iframe[contains(@src, 'facebook')]") {
    remove()
  }

  # handle image sliders
  $(".//div[@id='images' and ./ul[count(*)>1]]") { 
    attributes(data-ur-set:"carousel", data-ur-fill:"1", data-ur-carousel-component:"view_container", class:"mw_carousel", data-ur-autoscroll: "enabled")
    insert_bottom("span", data-ur-carousel-component:"dots")
    $("./ul") {
      $("./li") {
        name("div")
        attributes(data-ur-carousel-component:"item")
        add_class("mw_carousel_item")
      }
      name("div")
      attributes(data-ur-carousel-component:"scroll_container")
      add_class("mw_carousel_scroll_container")
    }
  }
}
# Adding test page too for HSUS-444
match_not($path, /^\/($|\?|index\.html)|wstest\-mar\-29|ws\-test\-b|newsbrieftest2|newsfeedtest|homepage/) {
  # stuff to remove universally
  # except on front page
  $(".//div[@class='dyk']") {
    remove()
  }
  $(".//div[@id='side']") {
    $(".//div[@class='simple']") {
      remove()
    }
    $(".//div[not(@id) and not(@class)]") {
      # HSUS-141
      # I am going to set a global hide on this class so I can override where necessary
      add_class("mw_sidebar_content_hide")
      # remove()
    }
    $(".//div[contains(@id, 'item-')]") {
      remove()
    }
    $(".//div[@id='seals-app']") {
      add_class("mw_sidebar_seals")
    }
    $(".//ul[@id='action']") {
      add_class("mw_sidebar1") // new universal class
      $("./li") {
        remove("./p")
        remove("./form[not(@id='lmainLogonForm')]")
        remove("./div")
        $("./a") {
          $destination = fetch("@href")
          $destination {
            replace(/\s$/, "") //chop off the occasional trailing spaces
          }
          attribute("href", $destination)
          # taking care of repeated buttons - HSUS-516 
          $("following-sibling::a") {
            match(fetch("@href"), $destination) {
              remove()
            }
          }
          # end HSUS-516
        }
        

      }
      remove("./li[not(@id)]")
      remove("./li[not(*)]")
      remove("./div")
      
      # Disabling HSUS-344
      # # Disabling this 7-24-13 - Sean
      # match($path, /testing\/cd-test2/) {
      #  wrap_together("./li[contains(@id, 'signup')]", "div", class: "mw_signup_content", data-ur-toggler-component: "content", data-ur-state: "disabled") {
      #    $("./li") {
      #      name("div")
      #      remove(".//@style")
      #      $("self::div[@id='signup']/a") {
      #        inject("  &raquo;  ")
      #      }
      #    }
      #    wrap("li", class: "mw_signup", data-ur-set: "toggler") {
      #      insert_top("div", class: "mw_signup_button",data-ur-toggler-component: "button",data-ur-state: "disabled") {
      #        insert("span", "SIGN UP")
      #      }
      #    }
      #  }
      # }
    }
  } 
}

# Action Alerts page
match($path) {

  with(/^\/action\/alerts/) {
    $(".//script[contains(@src, 'global')]") {
      attribute("data-keep", "true")
    }
  }

  #HSUS-367 (Mobile & Tablet) Unmapped Survey Page
  with(/^\/site\/Survey/) {
    $(".//script[contains(@src, 'utils')]") {
      attribute("data-keep", "true")
    }
  }
  # end HSUS-367

  # Find Your Federal Legislators
  with(/PageServer\?pagename\=electedOfficials/) {
    $(".//script[contains(@src, 'findreps')]") {
      log("found the FormComponentsBehavior script")
      attribute("data-keep", "true")
    }
  }

  #HSUS-463 take your pet contest
  with(/site\/SPageServer\?.?pagename\=take_your_pet/) {
    $(".//script[contains(@src, 'vine')]") {
      log("keeping vine embed script")
      attribute("data-keep", "true")
    }
  }

  #HSUS-482
  with(/Donation2/i) {
    $(".//script[contains(@src, 'prototype.js')]") {
      log("keeping prototype script")
      attribute("data-keep", "true")
    }
  }
  # HSUS-484
  with(/hsus_calendar/) {
    # $(".//script[contains(@src, 'calendar') and not(contains(@src, 'orgevent'))]") {
    #   log("keeping calendar script")
    #   attribute("data-keep", "true")
    # }
    # $(".//script[contains(@src, 'obs_comp')]") {
    #   log("keeping obs_comp script")
    #   attribute("data-keep", "true")
    # }
    # $(".//script[contains(@src, 'form')]") {
    #   log("keeping form script")
    #   attribute("data-keep", "true")
    # }
    $(".//script") {
      attribute("data-keep", "true")
      log("!!!!!!", fetch("@src"))
      # match(fetch("@src"), /yahoo/) {
      #   log("!!!!!!!!!!", fetch("@src"))
      # }
    }

  }
  
  # HSUS-344 "or sign up using"
  # http://www.humanesociety.org/testing/cd-test2.html
  # I made this global.. because it will be deployed for all the pages
  # Sean
  # with(/testing\/cd-test2/) {
  #   $(".//script[contains(@src, 'yui-min')]") {
  #     attribute("data-keep", "true")
  #   }
  #   $(".//script[contains(@src, 'utils')]") {
  #     attribute("data-keep", "true")
  #   }
  # }

}


# Domain Specific
match($host) {
  with(/video\.humanesociety\.org/) {
    log("matched video.humanesociety.org in optimization.ts")
    # Tubepress script
    $(".//script[contains(@src, 'tubepress')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'BrightcoveExperiences')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'jquery')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }
  }

  with(/action\.humanesociety\.org/) {
    # grab the desktop header image out of the styling sheet
    $(".//style[contains(text(), '#whoweare')]") {
      log("in action forms, found inline header image")
      text() {
        capture(/(.*)(#head.*})(.*)/) {
          $head_img = $2;
        }
      }
      # trim down to image url
      $head_img {
        replace(/\A[^\(]*\(/, '')
        replace(/\).*\z/, '')
      }
      log("%%%%%%%%%%%% " + $head_img)
      insert_after("img") {
        attribute("src", $head_img)
        attribute("id", "desktop_head")
      }
    }
  }

  with(/slideshows\.humanesociety\.org/) {
    log("matched slideshows.humanesociety.org")

    #slideshow script
    $(".//script[contains(@src, 'slideshows')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }
    $(".//script[contains(@src, 'jquery')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'iscroll')]") {
      log("found the tubepress script")
      attribute("data-keep", "true")
    }
  }

  with(/secure\.humanesociety\.org/) {
    # $(".//script[contains(@src, 'donations2')]") {
    #   log("found the donations2 script")
    #   attribute("data-keep", "true")
    # }

    $(".//script[contains(@src, 'FormComponentsBehavior')]") {
      log("found the FormComponentsBehavior script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'modules')]") {
      log("found the modules script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'utils')]") {
      log("found the utils script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'obs_comp_rollup')]") {
      log("found the obs_comp_rollup script")
      attribute("data-keep", "true")
    }

    $(".//script[contains(@src, 'yui')]") {
      log("found the yui script")
      attribute("data-keep", "true")
    }
  }

  # Legacy
  # Trying to preserve their custom inline styles, as they are used to generate the diagrams on the page
  # $(".//span[@id='articlesSpan']/style") {
  #   log("Legacy custom styles")
  #   attribute("data-keep", "true")
  #   name("span")
  # }
  with(/legacy\.humanesociety\.org/) {
    $(".//script[contains(@src, 'stelter-global')]") {
      log("found the stelter-global script")
      attribute("data-keep", "true")
    }
  }

  # Remove anything they tag not worthy of a mobile experience
  $(".//*[@mw-mobile-experience='remove']") {
    log("Removing tagged desktop item in Optimizations.ts")
    remove()
  }

}
$html_fragment = "false"


match($host) {
  with(/video\.humanesociety\.org/) {
    match($path) {
      with(/tubepress/) {
        log("tubepress video in check_fragment.ts")
        $html_fragment="true"

      }
    }
  }
}

match($html_fragment, /true/) {
  $content_type = "ajax"

  html_fragment() {
    rewrite_links()
    absolutize_srcs()
    remove(".//script[contains(@src, 'moovweb_client_side')]")

    @import "fragment_mappings.ts"
  }
}
match ($path) {
  with(/shortcode_printer/) {
    log("here's where the mapping would go")

    video_ajax()

  }

  with(/playerHtml/) {
    %header = fetch("*")
    log(%header)
    match(%header) {
      with(/%3Cdiv.*?%3E/) {
        log("Match successful")

      }
    }

    text() {
      match($tablet, /false/) {
        # remove the inline styles
        replace(/style%3D%22.*?%22/,'')

        #remove the width and height of the video player
        replace(/width%3D%22.*?%22/,'')
        replace(/height%3D%22.*?%22/,'')
      }

      #remove the id of the share container
      # replace(/id%3D%22shareContainer?%22/, 'class%3D%22mw_box2%20mw_share_container%22')

      # Wrap the share header and description together
      replace(/%3Cdiv%20id%3D%22shareContainer?%22/, '%3Cdiv%20class%3D%22mw_box2%22%3E%3Cdiv%20class%3D%22mw_share_container%22')

      #move the header into the description box
      # %header = fetch(/%3Cdiv.*?%3E/)
      # log(%header)
      # replace(/shareContainer%20--%3E/, "shareContainer%20--%3E%3Cdiv%20class%3D%22mw_box2%22%3E")

      # give the header some style
      replace(/tubepress_embedded_title%22/, 'tubepress_embedded_title%20mw_h2%22')

      # remove facebook stylesheet
      replace(/%3Clink%20rel%3D%22stylesheet%22.+?%2F%3E/, '')

      # Hopefully add closing div tag
      replace(/\"\s\}$/, '%3C%2Fdiv%3E" }')
    }
  }
}
